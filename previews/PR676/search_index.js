var documenterSearchIndex = {"docs":
[{"location":"Microphysics0M/#Microphysics-0M","page":"0-moment precipitation microphysics","title":"Microphysics 0M","text":"The Microphysics0M.jl module defines a 0-moment bulk parameterization of   the moisture sink due to precipitation. It offers a simplified way of removing the excess water   without assuming anything about the size distributions of cloud   or precipitation particles.\n\nThe q_tot (total water specific content) sink due to precipitation   is obtained by relaxation with a constant timescale   to a state with condensate exceeding a threshold value removed. The threshold for removing excess q_tot is defined either by the   condensate specific content or supersaturation. The thresholds and the relaxation timescale are defined in   ClimaParams.jl.\n\nnote: Note\nTo remove precipitation instantly, the relaxation timescale should be equal to the timestep length.","category":"section"},{"location":"Microphysics0M/#Moisture-sink-due-to-precipitation","page":"0-moment precipitation microphysics","title":"Moisture sink due to precipitation","text":"If based on maximum condensate specific content, the sink is defined as:\n\nbeginequation\n  left fracd  q_totdt right_precip =-\n    fracmax(0 q_lcl + q_icl - q_c0)tau_precip\nendequation\n\nwhere:\n\nq_lcl, q_icl are cloud liquid water and cloud ice specific contents,\nq_c0 is the condensate specific content threshold above which water is removed,\ntau_precip is the relaxation timescale.\n\nIf based on saturation excess, the sink is defined as:\n\nbeginequation\n  left fracd  q_totdt right_precip =-\n    fracmax(0 q_lcl + q_icl - S_0  q_vap^sat)tau_precip\nendequation\n\nwhere:\n\nq_lcl, q_icl are cloud liquid water and cloud ice specific contents,\nS_0 is the supersaturation threshold above which water is removed,\nq_vap^sat is the saturation specific humidity,\ntau_precip is the relaxation timescale.","category":"section"},{"location":"TerminalVelocity/#Terminal-velocity","page":"Terminal Velocity","title":"Terminal velocity","text":"CloudMicrophysics.jl offers several parameterizations of the relationship between particle size and terminal velocity:\n\nA simple power-law used in the 1-moment microphysics scheme,\nAn analytical Stokes-regime formulation for cloud liquid droplets in two-moment microphysics,\nThe rain terminal velocity used in Seifert and Beheng 2006 [10],\nThe rain and ice terminal velocities described in Chen et. al. 2022  [12].\n\nThe above terminal velocities need to be averaged over the assumed   particle size distributions, to get the mass- or number-weighted   group terminal velocities used in the bulks schemes:\n\nIn the non-equilibrium microphysics, we use the Chen et al. [12] parameterization and assume a monodisperse size distribution to obtain the cloud liquid and cloud ice sedimentation velocities.\nIn 1M microphysics, we assume an exponential size distribution for rain and snow and use the power-law formulation when deriving process rates such as accretion. The Chen et al. [12] terminal velocity is available in 1-moment scheme for rain and snow, but without re-deriving other process rates.\nIn the 2-moment scheme, for rain, the Seifert and Beheng [10] or the Chen et al. [12] parameterizations can be used. For cloud liquid droplets, we use the analytical Stokes-regime terminal velocity formulation.\nThe P3 scheme can only be run with the Chen et al. [12] terminal velocity and uses it when deriving the process rates.\n\nSee the relevant sections in 1M, 2M, P3 and non-equilibrium microphysics documentation   for more details.","category":"section"},{"location":"TerminalVelocity/#Power-law-relationship","page":"Terminal Velocity","title":"Power-law relationship","text":"We assume that rain drop and snow terminal velocities can be parameterized as\n\nv_term(r) = chi_v  v_0 left(fracrr_0right)^v_e + Delta_v\n\nwhere:\n\nr is the particle radius,\nr_0 is the typical particle radius used to nondimensionalize,\nv_0  v_e  are the default  coefficients,\nchi_v, Delta_v are the coefficients that can be used during model calibration to expand around the default values. Without calibration all chi parameters are set to 1 and all Delta parameters are set to 0.\n\nThe rain drop terminal velocity coefficients are obtained from the   balance between the gravitational acceleration (taking into account   the density difference between water and air) and the drag force:\n\nbeginequation\nv_0^rai =\n  left(\n    frac83  C_drag left( fracrho_wrho -1 right)\n  right)^12 (g r_0^rai)^12\nlabeleqvdrop\nendequation\n\nwhere:\n\ng is the gravitational acceleration,\nC_drag is the drag coefficient,\nrho is the density of air,\nrho_w is the density of water.\n\nAssuming a constant drag coefficient for rain drops is a big approximation,   as it should be size and flow   dependent. The coefficients for the snow terminal velocity are empirical.\n\nsymbol definition units default value reference\nC_drag rain drop drag coefficient - 055 C_drag is such that the mass averaged terminal velocity is close to [5]\nr_0^rai typical rain drop radius m 10^-3 \nv_e^rai exponent in v_term(r) for rain - 05 \nr_0^sno typical snow crystal radius m 10^-3 \nv_0^sno coefficient in v_term(r) for snow fracms 2^94 r_0^14 eq (6b) [2]\nv_e^sno exponent in v_term(r) for snow - 025 eq (6b) [2]","category":"section"},{"location":"TerminalVelocity/#Stokes-flow-terminal-velocity","page":"Terminal Velocity","title":"Stokes-flow terminal velocity","text":"In the Stokes regime (Re < 1), the analytical fall speed of a spherical particle is given by\n\nv_term(r) = frac29 frac(rho_water - rho_air) gmu_air r^2\n\nwhere mu_air = rho_air  nu_air is the dynamic viscosity of air, and nu_air is the kinematic viscosity. In general, nu_air depends on temperature and pressure, but in our parameterization it is treated as a constant for simplicity.\n\nIn two-moment cloud microphysics parameterizations (e.g., Seifert & Beheng 2006), this expression can be integrated over a gamma droplet size distribution to obtain number-weighted and mass-weighted mean fall velocities of cloud droplets.","category":"section"},{"location":"TerminalVelocity/#Seifert-and-Beheng-2006","page":"Terminal Velocity","title":"Seifert and Beheng 2006","text":"Seifert and Beheng [10] uses an empirical relationship between the rain drop size   and its terminal velocity\n\nv_term(D) = left(fracrho_0rhoright)^frac12 a_R - b_R e^-c_R D\n\nwhere:\n\na_R, b_R and c_R are  free parameters,\nD is the rain drop diameter.\n\nThe default parameter values are\n\nsymbol default value units\na_R 965 fracms\nb_R 103 fracms\nc_R 600 frac1m","category":"section"},{"location":"TerminalVelocity/#Chen-et.-al.-2022","page":"Terminal Velocity","title":"Chen et. al. 2022","text":"Chen et al. [12] provide a terminal velocity parameterization   based on an empirical fit to a high-accuracy model. The terminal velocity depends on particle shape, size, and density. It considers the deformation of large rain drops,   as well as a size-specific air density dependence. The fall speed of individual particles is parameterized as\n\nbeginequation\n    v_term(D) = phi^kappa sum_i=1^j  a_i D^b_i e^-c_i  D\nendequation\n\nwhere:\n\nD is the particle diameter,\na_i, b_i, c_i are the free parameters,\nphi is the aspect ratio, and\nkappa is a parameter that depends on the particle shape (kappa=0 for spheres, kappa=13 for oblate and kappa=-16 for prolate spheroids).\n\nFor ice, j=2, and for rain, j=3, to account for deformation at larger drop sizes. The rain parameterization is valid for D  100  mu m. The free parameter values for solid particles are different for small and large sizes,   with a cutoff diameter D = 625  mu m.\n\nThe aspect ratio is defined as:\n\nbeginequation\n    phi equiv ca\nendequation\n\nwhere:\n\na is the basal plane axial half-length, and\nc is perpendicular to the basal plane.\n\nIn the non-equilibrium cloud microphysics scheme, we assume that both cloud   droplets and ice crystals are spherical and phi=1. In all bulk schemes, we assume that rain drops are spherical and phi=1. In the 1-moment bulk scheme for snow we assume kappa = 13   and aspect ratio phi = 015 by default. Additionally in the 1-moment scheme for snow we provide an option   to assume either an oblate or a prolate shape and compute the aspect ratio   based on the m(r) and a(r) relationships. For both assumed shapes the particle volume can be represented as V_p = 4pi3  a^2 c. For oblates the particle cross section area is A_p = pi a^2   and for prolates A_p = pi a c. In the P3 scheme we assume that particles are oblates and   compute the aspect ratio based on the P3 m(r) and a(r) relationships.","category":"section"},{"location":"TerminalVelocity/#Example-figures","page":"Terminal Velocity","title":"Example figures","text":"In the top row of the figure below, we show different particle terminal velocities   in cloud (left panel) and precipitation (middle panel) size range. In the top right panel, we also show the snow particle aspect ratio. In the bottom row, we show the group sedimentation velocities for cloud condensate (left panel)   and precipitation (right panel).\n\ninclude(\"plots/TerminalVelocity.jl\")\n\n(Image: )","category":"section"},{"location":"P3Scheme/#P3-Scheme","page":"P3 Scheme","title":"P3 Scheme","text":"The P3Scheme.jl module implements the predicted particle properties (P3) scheme for ice-phase microphysics developed by    [23]. The P3 scheme is a 2-moment, bulk scheme involving a single ice-phase category with 4    degrees of freedom: total ice content, rime content, rime volume, and number concentration. Traditionally, cloud ice    microphysics schemes use various predefined categories (such as ice, graupel, or hail) to represent ice modes, but the    P3 scheme sidesteps the problem of prescribing transitions between ice categories by adopting a single ice category and    evolving its properties. This simplification aids in attempts to constrain the scheme's free parameters.\n\nThe prognostic variables are:\n\nVariable Units Description\nN_mathrmice m^-3 number concentration\nL_mathrmice kg m^-3 total ice particle mass content\nL_mathrmrim kg m^-3 rime mass content\nB_mathrmrim m^3 m^-3 rime volume (volume of rime per total air volume)\n\nFrom these, we derive the following rime quantities:\n\nF_rim = fracL_rimL_ice, the rime mass fraction,\nρ_rim = fracL_rimB_rim, the rime density.\n\nnote: Change of symbol convention\nThe original paper [23] uses the symbol q to denote the mass of a tracer per volume of air  (named mass mixing ratio). In our documentation of the 1-moment and 2-moment schemes we used q to denote the mass  of a tracer per mass of air (specific content). To keep the notation consistent between the 1,2-moment schemes  and P3, and to highlight the difference between normalizing by air mass or volume, we denote the mass of a tracer per  volume of air as L (named content).","category":"section"},{"location":"P3Scheme/#Assumed-particle-size-relationships","page":"P3 Scheme","title":"Assumed particle size relationships","text":"The mass m and projected area A of particles as a function of maximum particle dimension D are piecewise    functions with variable thresholds described by the following table,\n\nParticle properties Size condition Rime condition m(D) relation A(D) relation\nsmall, spherical ice D  D_th  fracπ6 ρ_i D^3 fracπ4 D^2\nlarge, unrimed ice D_th  D L_rim = 0 α_va D^β_va γ D^σ\ndense nonspherical ice D_th  D  D_gr L_rim  0 α_va D^β_va γ D^σ\ngraupel (completely rimed, spherical) D_gr  D  D_cr L_rim  0 fracπ6 ρ_g D^3 fracπ4 D^2\npartially rimed ice D_cr  D L_rim  0 fracα_va1-F_rim D^β_va F_rim fracπ4 D^2 + (1-F_rim)γ  D^σ\n\nwhere D_th, D_gr, D_cr, and ρ_g are determined by relations below; ρ_i, β_va, α_va, γ, and σ are fixed.\n\ndetails: Symbol definitions\nSymbol Value Units Description\nD_th  textm small, spherical ice threshold\nD_gr  textm graupel threshold\nD_cr  textm partially rimed ice threshold\nρ_i 916.7 textkg m^-3 cloud ice density\nρ_g  textkg m^-3 bulk density of graupel\nρ_rim  textkg m^-3 rime density\nρ_d  textkg m^-3 bulk density of unrimed ice\nF_rim  – rime mass fraction\nβ_va 1.9 – dimensionless parameter from [24] (based on measurements of vapor diffusion and aggregation in midlatitude cirrus)\nα_va 738  10^-11  10^6 β_va - 3 textkg m^-β_va parameter modified for units from [24] in base SI units (also based on measurements of vapor diffusion and aggregation in midlatitude cirrus)\nγ 0.2285 textm^2-σ parameter fit from aggregates of side planes, columns, bullets, and planar polycrystals; see Table 1 in [25]\nσ 1.88 – dimensionless parameter fit from aggregates of side planes, columns, bullets, and planar polycrystals; see Table 1 in [25]\n\nThe first threshold, D_th, is solely determined by the free parameters:\n\nD_th = left( fracπ ρ_i6α_va right)^frac1β_va - 3\n\nThe remaining thresholds: D_gr, D_cr, as well as the bulk density of graupel ρ_g, and the bulk density of the unrimed part ρ_d form a system of equations:\n\nbeginalign*\n  D_gr  = left( frac6α_vaπ ρ_g right)^frac13 - β_va \n  D_cr  = left left(frac11-F_rim right) frac6 α_vaπ ρ_g right^frac13 - β_va \n  ρ_g     = ρ_rim F_rim + (1 - F_rim) ρ_d \n  ρ_d     = frac6α_va(D_cr^β_va - 2 - D_gr^β_va - 2)π  (β_va - 2)(D_cr-D_gr)\nendalign*\n\nUnlike (REFS), which solve the system of equations with iterative methods, we here derive an analytical solution for ρ_d in terms of ρ_rim and F_rim.\n\ndetails: Click here to see the derivation\nTo derive the expression for ρ_d we first observe that D_cr is proportional to D_gr,D_cr \n  = (1 - F_rim)^-1(3 - β_va) left( frac6 α_vaπ ρ_g right)^1(3 - β_va)\n  = (1 - F_rim)^-1(3 - β_va) D_gr \n   k D_grwhere we define k  (1 - F_rim)^-1(3 - β_va). This implies k^β_va - 2 = (1 - F_rim)k.  It can also be shown thatfrac6α_vaπD_gr^β_va - 2 = ρ_g D_grWe now rewrite terms in the numerator and denominator of the expression for ρ_d,beginalign*\nD_cr - D_gr = (k - 1) D_gr \n \nfrac6α_vaπ left D_cr^β_va - 2 - D_gr^β_va - 2 right\n  = frac6α_vaπ left (k^β_va - 2 - 1) D_gr^β_va - 2 right\n   = ((1 - F_rim)k - 1) ρ_g D_gr\nendalign*Then, we substitute these expressions into the equation for ρ_d (above), to obtain,beginalign*\nρ_d = frac((1 - F_rim) k - 1) ρ_g D_gr(β_va - 2)(k - 1)D_gr \n  = frac((1 - F_rim) k - 1)(β_va - 2)(k - 1) ( ρ_rim F_rim + (1 - F_rim) ρ_d )\nendalign*and rearrange to obtain the expression for ρ_d below.\n\nWe obtain the following expression for ρ_d\n\nρ_d = frac\n  ρ_rim F_rim\n\n  frac(β_va - 2)(k - 1)(1 - F_rim) k - 1 - (1 - F_rim)\n\n\nGiven ρ_d, we can obtain ρ_g, D_gr, and D_cr using the expressions above. Depending on the value of ρ_rim and F_rim,    these thresholds and densities obtain a range of values, as shown in the plot below.\n\ninclude(\"plots/P3Thresholds.jl\")\n\nnothing # hide\n\n(Image: )\n\nBelow we show the m(D) and A(D) regimes replicating Figures 1 (a) and (b) from [23]. We also show the density as a function of D. Note that because graupel is completely filled with rime, the density (ρ_g) is independent of D between D_gr and D_cr. Following [23], for nonspherical particles ρ_ice is assumed to be equal to the mass of the particle   divided by the volume of a sphere with the same particle size.\n\ninclude(\"plots/P3SchemePlots.jl\")\n\nnothing # hide\n\n(Image: )","category":"section"},{"location":"P3Scheme/#Assumed-particle-size-distribution","page":"P3 Scheme","title":"Assumed particle size distribution","text":"Following [23], the scheme assumes a gamma distribution for the concentration of ice particles   per unit volume based on particle size measurements obtained by [26] in tropical and midlatitude   ice clouds and implemented by [27]:\n\nN(D) = N_0 D^μ e^-λ D\n\nwhere:\n\nN   [m^-4]    is the number concentration,\nD  [m]       is the maximum particle dimension,\nN_0  [m^-5 - μ]    is the intercept parameter,\nμ [–]      is the shape parameter,\nλ [m^-1]    is the slope parameter.\n\nThe model predicted ice number concentration, N_mathrmice, and ice content, L_mathrmice, are defined as\n\nbeginalign*\nN_mathrmice = int_0^      N(D) mathrmdD \nL_mathrmice = int_0^ m(D) N(D) mathrmdD\nendalign*\n\nTo close the system of equations, it has been customary (e.g. [23]) to assume μ to be a function of λ, μ = μ(λ).","category":"section"},{"location":"P3Scheme/#Calculating-shape-parameters","page":"P3 Scheme","title":"Calculating shape parameters","text":"Given the system\n\nbegincases\n    N_mathrmice = N_0 _0^      D^μ e^-λD mathrmdD \n    L_mathrmice = N_0 _0^ m(D) D^μ e^-λD mathrmdD \n     μ = 000191 λ^08 - 2     \nendcases\n\nwe seek to solve for N_0 and λ. This is most conveniently achieved by first solving for λ, then obtain N_0 by    rewriting the first equation. For numerical stability, we compute log left( L_mathrmice big N_mathrmice right)    and solve for λ using a root-finding algorithm for the expression:\n\n0\n = logleft(frac\n     _0^ m(D) D^μ e^-λD mathrmdD\n     _0^ D^μ e^-λD mathrmdD\n right)\n - logleft(fracL_mathrmiceN_mathrmiceright) \n= logleft( _0^ m(D) D^μ e^-λD mathrmdD right)\n- logleft( _0^ D^μ e^-λD mathrmdD right)\n- logleft(fracL_mathrmiceN_mathrmiceright) \n\ndetails: Computing Distribution Integrals Using Gamma Functions\nThe integrals presented above can be evaluated analytically using the Gamma function family. Here we present the key    formulas and their numerical implementation.Core DefinitionsThe Gamma function is defined asΓ(a) = _0^ t^a-1 e^-t mathrmdtFor partial intervals, we use the upper incomplete Gamma function,Γ(ax) = _x^ t^a-1 e^-t mathrmdtAnalytical SolutionsGiven a power law mass-diameter relationship m(D), the key integrals resolve tobeginalign*\n_0^ D^μ e^-λD mathrmdD = fracΓ(μ+1)λ^μ+1 \n_0^ (aD^b) D^μ e^-λD mathrmdD = a fracΓ(b+μ+1)λ^b+μ+1 \n_D_1^D_2 (aD^b) D^μ e^-λD mathrmdD = fracaλ^b+μ+1 Big( Γ(b+μ+1λD_1) - Γ(b+μ+1λD_2) Big)\nendalign*Numerical ImplementationFor numerical stability, we compute these integrals in log space. The regularized Gamma functions    p(ax)=frac1Γ(a)int_0^x t^a-1 e^-t mathrmdt and q(ax)=1-p(ax) help us evaluate the incomplete Gamma functions:beginalign*\nlogleft( _0^ D^μ e^-λD mathrmdD right) = logBig( Γ(μ+1λx) Big) - (μ+1)log(λ) \nlogleft( _D_1^D_2 (aD^b) D^μ e^-λD mathrmdD right) = log(a) - (b+μ+1)log(λ) + logBig(Γ(b+μ+1)Big) \nquad + logBig( q(b+μ+1λD_1) - q(b+μ+1λD_2) Big)\nendalign*We define this latter integral asG(D_1D_2abμλ)  logleft( _D_1^D_2 (aD^b) D^μ e^-λD mathrmdD right)The integral of m(D) N(D) can be computed using the following function definitions, G_i:Particle properties Size condition Rime condition m(D) relation G_i definition\nsmall, spherical ice D  D_th  fracπ6 ρ_i D^3 G_1 = Gleft(0D_thfracπ6 ρ_i3μλright)\nlarge, unrimed ice D_th  D L_rim = 0 α_va D^β_va G_2 = Gleft(D_thα_vaβ_vaμλright)\ndense nonspherical ice D_th  D  D_gr L_rim  0 α_va D^β_va G_3 = Gleft(D_thD_grα_vaβ_vaμλright)\ngraupel (completely rimed, spherical) D_gr  D  D_cr L_rim  0 fracπ6 ρ_g D^3 G_4 = Gleft(D_grD_crfracπ6 ρ_g3μλright)\npartially rimed ice D_cr  D L_rim  0 fracα_va1-F_rim D^β_va G_5 = Gleft(D_crfracα_va1-F_rimβ_vaμλright)Let LSE denote the log-sum-exp operation: mathrmLSE(x_1ldotsx_n) = logsum_i=1^n exp(x_i). Then,If L_mathrmrim = 0:log _0^ m(D) D^μ e^-λD mathrmdD = mathrmLSE(G_1 G_2)If L_mathrmrim  0:log _0^ m(D) D^μ e^-λD mathrmdD = mathrmLSE(G_1 G_3 G_4 G_5)The LSE operation is computed in a numerically stable manner using the logsumexp function from the LogExpFunctions.jl package.","category":"section"},{"location":"P3Scheme/#Parameterizations-for-the-slope-parameter-μ","page":"P3 Scheme","title":"Parameterizations for the slope parameter μ","text":"","category":"section"},{"location":"P3Scheme/#μ-as-a-power-law-in-λ","page":"P3 Scheme","title":"μ as a power law in λ","text":"The de-facto standard parameterization for μ as a function of λ is a power law on the form\n\nμ = a λ^b - c\n\ntypically with lower and upper limiters. In [23], the following coefficients and limiting behavior are used:\n\nμ = begincases\n    0  textif  μ  0 \n    000191 λ^08 - 2  textif  0  μ  6 \n    6  textif  μ  6\nendcases\n\nwhich looks like this:\n\ninclude(\"plots/P3SlopeParameterizations.jl\")\n\nnothing # hide\n\n(Image: )\n\nWith this choice, it appears that some values of log(LN) gives rise to multiple solutions for λ, as seen in the plot below. Each vertical line shows a different solution for λ for a given value of log(LN). The right panel shows the number concentration distribution N(D) for the different solutions.\n\n(Image: )","category":"section"},{"location":"P3Scheme/#μ-as-a-constant","page":"P3 Scheme","title":"μ as a constant","text":"An alternative parameterization for μ is a constant value:\n\nμ = μ_const","category":"section"},{"location":"P3Scheme/#Terminal-Velocity","page":"P3 Scheme","title":"Terminal Velocity","text":"We use the Chen et al. [12] velocity parameterization,   see here for details.\n\nThe figure below shows the implied aspect ratio for different particle size regimes. Note that ϕ = 1 corresponds to spherical particles (small spherical ice (D  D_th) and graupel (D_gr  D  D_cr)).\n\ninclude(\"plots/P3AspectRatioPlot.jl\")\n\nnothing # hide\n\n(Image: )\n\nThe mass-weighted fall speed (V_m) and the number-weighted fall speed (V_n) are calculated as\n\nbeginalign*\nV_m = fracint_0^ V(D) m(D) N(D) mathrmdDint_0^ m(D) N(D) mathrmdD \nV_n = fracint_0^ V(D)      N(D) mathrmdDint_0^      N(D) mathrmdD\nendalign*\n\nWe also plot the mass-weighted mean particle size D_m which is given by:\n\nD_m = fracint_0^ D m(D) N(D) mathrmdDint_0^ m(D) N(D) mathrmdD\n\nBelow we provide plots of these relationships for small, medium, and large D_m:   the first row highlights the particle size regime,   the second displays D_m of the particles,   the third shows the aspect ratio ϕ (D_m),   the fourth shows V_m without using aspect ratio in the computation (i.e. ϕ = 1),   and the final row exhibits V_m, computed using ϕ(D). They can be compared with Figure 2 from [23].\n\ninclude(\"plots/P3TerminalVelocityPlots.jl\")\n\nnothing # hide\n\n(Image: )","category":"section"},{"location":"P3Scheme/#Liquid-Fraction","page":"P3 Scheme","title":"Liquid Fraction","text":"todo: TODO: Update code to include liquid fraction\n\n\nCurrently, the code doesn't work with liquid fraction. So ignore the following section.\n\nTo allow for the modeling of mixed-phase particles with P3, a new prognostic variable can be introduced:   L_liq, the content of liquid on mixed-phase particles. As described in [28],   this addition to the framework of P3 opens the door to tracking the gradual melting (and refreezing) of a   particle population. Here, we describe the characteristics of the scheme with the addition of L_liq.\n\nLiquid fraction, analogous to F_rim for rime, is defined F_liq = fracL_liqL_p3 tot   where L_p3 tot = L_ice + L_liq and where L_ice is the solid ice mass content which includes   rime mass content and mass grown by vapor deposition. This is important notably for   F_rim = fracL_rimL_ice — which differs now from F_rim = fracL_rimL_p3 tot   because we want to normalize only by solid ice mass content for F_rim.\n\nBased on Fig. 1 from [28], we can expect the accumulation of liquid on an ice core to increase   velocities of small particles for all F_rim values. Below, we reproduce this figure with rho_r = 900 kg m^-3,   and, notably, we continue to use the terminal velocity parameterizations from [12]   (described here for rain),    whereas [28] uses [29] for snow and ice and [30]    for rain. Despite these different choices, we reproduce similar behavior with, and we include a dashed line for the    velocity computed without aspect ratio. This dashed line mimics velocity with F_rim = 1, since both phi = 1    and F_rim = 1 shift us into a spherical particle regime.\n\nnothing\n# include(\"plots/Cholette2019_fig1.jl\")\n# ![](Choletteetal2019_fig1.svg)\n\nThe addition of the liquid fraction does not change the thresholds D_th, D_gr, D_cr,   since the threshold regime depends only on ice core properties.\n\nHowever, the assumed particle properties become F_liq-weighted averages of particles' solid and liquid components:\n\nbeginalign*\nm(D F_liq) = (1 - F_liq) m(D F_liq = 0) + F_liq m_liq(D) \nA(D F_liq) = (1 - F_liq) A(D F_liq = 0) + F_liq A_liq(D)\nendalign*\n\nwhere m_liq(D) = fracπ6 ρ_liq D^3 and A_liq(D) = π D^2.\n\nWhen calculating shape parameters and integrating over the particle size distribution (PSD), it is important to   keep in mind whether the desired moment of the PSD is tied only to ice (in which case we concern ourselves with the   ice core diameter D_core) or to the whole mixed-phase particle (in which case we need D_p). If calculating   the ice core parameters, F_liq = 0 is passed into the solver framework as indicated in the code.\n\nFor the above particle properties and for terminal velocity, we use the PSD corresponding to the whole mixed-phase particle,   so our terminal velocity of a mixed-phase particle is:\n\nV(D_p F_liq) = (1 - F_liq) V_ice(D_p) + F_liq V_rain(D_p)\n\nTo continue with the same plotting format as we see above for terminal velocity, below, we show terminal velocity with   F_liq = 00 05 09 using the mass-weighted terminal velocity with aspect ratio. Clearly, the velocity increases   with F_liq and becomes decreasingly dependent on F_rim and rho_r as we shrink the size of the ice core.   Of note relating to our calculation of terminal velocity with liquid fraction, we let F_liq = 0 in our calculation of   phi. This is because we want V_ice(D_p) (velocity of a mixed-phase particle treating it as an ice particle   with the same D).\n\nnothing\n# include(\"plots/P3TerminalVelocityPlots_WithFliq.jl\")\n# ![](MorrisonandMilbrandtFig2_with_F_liq.svg)\n\nVisualizing mass-weighted terminal velocity as a function of F_liq, F_rim with ρ_rim = 900 kg m^-3 for small,   medium, and large particles, we have mostly graupel (D_gr  D  D_cr) for small D_m and mostly partially rimed ice   (D  D_cr) for medium and large D_m. Thus, we can attribute the non-monotonic behavior of velocity with F_liq in the   medium and large D_m plots to the variations in ϕ caused by nonspherical particle shape, whereas the small D_m plot   confirms a more monotonic change in V_m for spherical ice. The L and N values used to generate small, medium, and large D_m   are the same as in the plot above.\n\nnothing\n# include(\"plots/P3TerminalVelocity_F_liq_rim.jl\")\n# ![](P3TerminalVelocity_F_liq_rim.svg)\n\nWhen modifying process rates, we now need to consider whether they are concerned with the ice core or the whole particle,    in addition to whether they become sources and sinks of different prognostic variables with the inclusion of F_liq.   With the addition of liquid fraction, too, come new process rates.","category":"section"},{"location":"P3Scheme/#Microphysical-Process-Rates","page":"P3 Scheme","title":"Microphysical Process Rates","text":"At a high level, we can categorize the microphysical process rates that affect the P3 prognostic variables into the following categories:\n\nSymbol Description\ntextcolormagentatextsfNUC Ice nucleation, including homogeneous and heterogeneous freezing\ntextcolorbrowntextsfCOL Collision/collection between liquid and ice, including wet growth and shedding\ntextcolorlimetextsfDEPSUB Ice deposition/sublimation\ntextcolorpinktextsfMLT Melting of ice\ntextcolororangetextsfSLF Self-collection of ice\n\nThe scheme is coupled to the 2-moment Morrison & Milbrandt (2015) warm rain microphysics scheme with non-equilibrium moisture. Some of the \"P3 processes\" naturally affect the 2-moment prognostic variables, and will be described in the following sections. At a high level, the processes enter as sources and sinks of the prognostic variables, as follows:\n\nLiquid phase:\n\nS_x = textcolorpink    textMLT \n      textcolorbrown - textCOL\n      qquad x  q_c q_r N_c N_r\n\nIce phase:\n\nbeginalignat*6\n  S_L_rim =  NUC + COL + F_rim (- SUB - MLT)\n                              textcolormagentatextNUC\n                            textcolorbrown + textCOL\n             + F_rim (    \n                              textcolorlime  - textSUB\n                            textcolorpink  - textMLT\n                         )\n     \n    \n  S_L_ice =  NUC + COL - SUB - MLT + DEP\n                              textcolormagentatextNUC\n                            textcolorbrown+ textCOL\n    phantom + F_rim ( \n                              textcolorlime  - textSUB\n                            textcolorpink - textMLT\n                          )\n                            textcolorlime+ textDEP\n     \n  S_N_ice =  NUC - SUB\n                              textcolormagentatextNUC \n    phantom               textcolorbrown+ textCOL \n    phantom + F_rim (  \n                              textcolorlime - textSUB\n     \n  S_B_rim =\n                              textcolormagentatextNUC\n                            textcolorbrown + textCOL\n             + F_rim (    \n                              textcolorlime  - textSUB\n                            textcolorpink  - textMLT\n                         )\n     \n    \n               NUC + COL + F_rim (- SUB - MLT)\nendalignat*\n\nnote: Differences with Morrison & Milbrandt (2015)\nThere are numerous differences between the P3 scheme in Morrison & Milbrandt (2015) and the P3 scheme in this package:the maximum freezing rate (wet growth limit) is computed at the particle level, instead of as a bulk process\nchanges in rime volume due to (dry) collisions with cloud and rain are computed at the particle level, with a local rime density evaluated as a function of both the liquid and ice particle diameters\nin the wet growth regime, the densification process is computed as a rapidly adjusting bulk process, instead of instantenous particle-level densification. We also scale by the fraction of the mass rate that undergoes wet growth.\n\nBelow, we describe the different processes in more detail.","category":"section"},{"location":"P3Scheme/#Collisions-with-liquid-droplets-(\\textcolor{brown}{\\textsf{COL}})","page":"P3 Scheme","title":"Collisions with liquid droplets (textcolorbrowntextsfCOL)","text":"At a high level, collisions between liquid droplets (cloud or rain) and ice particles lead to sources and sinks of the form:\n\nLiquid phase:\n\nbeginalign*\n  S_q_c = fractextcolorbrown - textQCFRZ - textQCSHDρ_a\n          \n  S_q_r = fractextcolorbrown - textQRFRZ + textQCSHDρ_a\n          \n  S_N_c = textcolorbrown - textNCCOL \n          \n  S_N_r = textcolorbrown - textNRCOL + textNRSHD \n          \nendalign*\n\nIce phase:\n\nbeginalign*\n  S_L_rim = textcolorbrowntextQCFRZ + textQRFRZ + textQIWET\n              \n  S_L_ice = textcolorbrowntextQCFRZ + textQRFRZ\n              \n  S_N_ice = 0\n              \n  S_B_rim = textcolorbrowntextBCFRZ + textBRFRZ + textBIWET \n              \nendalign*\n\nwhere textcolorbrowntextCOL is the collision rate between liquid droplets and ice particles, textcolorbrowntextFRZ is the component of the collisions that freezes, and textcolorbrowntextSHD is the component of the collisions that lead to droplet shedding (shedding + freezing = collisions). The first letter of the prefix Q, N, and B specifies that the process rates affect the mass, number, and bulk rime volume of the ice particle, respectively. The second letter, C, R, and I, specify that the process rates affect the cloud, rain, and ice particles, respectively. For multispecies interactions, the reduced species determine the second letter.\n\nCollisions between liquid droplets (cloud or rain) and ice particles are parameterized   by integrating the volumetric collision rate _tmathcalV [textm^3texts]   over the particle size distributions. The volumetric collision rate is on the form\n\n_tmathcalV_l(D_i D_l) = E(D_i D_l) K(D_i D_l) v_i(D_i) - v_l(D_l)\n\nwhere l  c r denotes cloud or rain, \n\nE(D_i D_l) is the collision efficiency (which we assume to be 1), \nK(D_i D_l) = π (r_i + D_l2)^2 is the collision cross section, \nr_i is the effective radius of the ice particle, which is the radius of a circle with the same cross-sectional area as the (in general, non-spherical) ice particle,\nv_i(D_i) and v_l(D_l) are the terminal velocities of the ice particle and the liquid droplet, respectively.\n\nnote: Number of collisions per unit time\nIf we multiply _tmathcalV_l(D_i D_l) by the liquid droplet size distribution N_l(D_l), we obtain the kernel_tmathcalV_l(D_i D_l) N_l(D_l)which represents the number of liquid droplets of size D_l colliding with an ice particle of size D_i per unit time. If we know, say, the mass of each liquid droplet, and integrate the mass-kernel over all liquid drop sizes, we get the total mass of the collected liquid droplets by an ice particle of size D_i.\n\nThe quantity _tmathcalN_textcoll(D_i) [texts^-1],\n\n_tmathcalN_textcoll(D_i) = _0^ _tmathcalV_l(D_i D_l) N_l(D_l) mathrmdD_l\n\nquantifies how many liquid droplets collide with an ice particle of size D_i per unit time.\n\nnote: Bulk loss of liquid droplets\nThe bulk loss of liquid droplets is then given bytextcolorbrowntextNCCOL = _0^ _tmathcalN_textcoll(D_i) N_i(D_i) mathrmdD_i\nquad\ntextcolorbrowntextNRCOL = _0^ _tmathcalN_textcolr(D_i) N_i(D_i) mathrmdD_i\n\nThe total mass of the collected liquid droplets _tmathcalM_coll(D_i) [textkgs] can be expressed as\n\n_tmathcalM_textcoll(D_i) \n  = _0^ _tmathcalV_l(D_i D_l) N_l(D_l) m_l(D_l) mathrmdD_l\n\nWhen liquid droplets collide with ice particles, we assume that they can either freeze or be shed as  rain particles. Above freezing, all particles are shed. In subfreezing temperatures, normally all particles are frozen. However,  close to the freezing temperature, there may not be enough time for all particles to freeze.  We refer to this as the wet growth regime. In this case, the particles that are not frozen are shed as rain.  The wet growth regime is determined by comparing the freezing rate to the collection rate.\n\nThe maximum freezing rate is based on Musil (1970) [31],  which considers the heat transfer rate for a spherical wet hailstone.  The maximum freezing rate [kg/s] is computed as\n\n_tmathcalM_textmax(D_i) \n  = 2π D_i F_v(D_i) frac- K_t ΔT + L_v D_v Δρ_vtextsatL_f + C_p ΔT\n\nwhere the first term in the numerator is the heat transfer rate to the air surrounding the hailstone,  and the second term is evaporative cooling. The denominator is the heat that must be dissipated by the hailstone.\n\ndetails: Symbol definitions\nSymbol Units Description\nD_i textm diameter of the ice particle\nF_v(D_i) - ventilation factor\nK_t textW(m K) thermal conductivity\nΔT textK temperature difference between the surface of the ice particle and the surrounding air\nL_v textJkg latent heat of vaporization\nD_v textm^2texts vapor diffusivity\nΔρ_vtextsat textkgtextm^3 difference in saturation vapor density over ice, between the surface of the ice particle and the surrounding air\nL_f textJkg latent heat of fusion\nC_p textJ(kg K) specific heat capacity of water\n\nFor collisions with ice particles of size D_i, the freezing (riming) rate _tmathcalM_textfrz [textkgs] is thus\n\n_tmathcalM_textfrz = min left( _tmathcalM_textcol _tmathcalM_textmax right) \nquad textsfwhere quad\n_tmathcalM_textcol = _tmathcalM_textcolc + _tmathcalM_textcolr\n\nwhere _tmathcalM_col is the total mass of the collected liquid droplets. The fraction of the collected liquid that freezes is given by\n\nf_textfrz(D_i) \n  = frac_t mathcalM_textfrz(D_i)_t mathcalM_textcol(D_i)\n\nnote: Bulk freezing rates\nThe bulk freezing rates are obtained by integrating the per-particle freezing rates over the ice particle size distribution,textcolorbrowntextQCFRZ \n  = _0^ _tmathcalM_textcolc(D_i) f_textfrz(D_i) N_i(D_i) mathrmdD_i\nquad\ntextcolorbrowntextQRFRZ \n  = _0^ _tmathcalM_textcolr(D_i) f_textfrz(D_i) N_i(D_i) mathrmdD_i which can be combined to give the bulk liquid freezing ratetextcolorbrowntextQCFRZ + textQRFRZ \n  = _0^ _t mathcalM_textfrz(D_i)                   N_i(D_i) mathrmdD_i \n  = _0^ _t mathcalM_textcol(D_i) f_textfrz(D_i) N_i(D_i) mathrmdD_i\n\nAny excess mass _tmathcalM_shd [textkgs] is shed as rain, where\n\n_tmathcalM_textshd = _tmathcalM_col - _tmathcalM_textfrz\n\nWe assume that all shed droplets are shed at some fixed diameter D_textshd.    Following [23], we set D_textshd = 1 text mm.    This implies that the number of shed droplets is\n\n_tmathcalN_textshd = frac_tmathcalM_textshdm(D_textshd)\n\nnote: Bulk source to rain mass and number\nThe corresponding bulk source to rain mass and number isbeginalign*\ntextcolorbrowntextQRSHD \n= _0^                           _tmathcalM_textshd(D_i) N_i(D_i) mathrmdD_i\n= _0^ (1 - f_textfrz(D_i)) _tmathcalM_textcol(D_i) N_i(D_i) mathrmdD_i \n= _0^ _tmathcalM_textcol(D_i) N_i(D_i) mathrmdD_i - (textcolorbrowntextQCFRZ + textQRFRZ)\n\ntextcolorbrowntextNRSHD = _0^ _tmathcalN_textshd N_i(D_i) mathrmdD_i\n= _0^ frac_tmathcalM_textshdm(D_textshd)          N_i(D_i) mathrmdD_i\n= fractextcolorbrowntextQRSHDm(D_textshd)\nendalign*Note that because we assume that any shed droplets are rain, the shedding process does not affect the rain mass.\n\nFinally, how does this affect the rime volume? \n\nCollisions with rain, cloud, and shedded wet growth all contribute to the rime volume.\n\nThe change in rime volume is given by the change in mass divided by some rime density.\n\nnote: Local rime density parameterization\nFollowing [23], we apply the Cober & List (1993) [32] parameterization to calculate the local rime density for each collision pair.  For an ice particle of size D_i colliding with a liquid droplet of size D_l (where l  c r for cloud or rain), the rime density is given bybeginalign\nV_textterm(D_i D_l) = v_i(D_i) - v_l(D_l) \n\nR_i(D_i D_l) = fracD_l  V_textterm(D_i D_l)2 T - T_textfreeze\n\nρ_rim(R_i) = \nbegincases\n  a_textCL + b_textCL R_i + c_textCL R_i^2          textif  1  R_i  8 \n  \n  (1 - fracR_i-812-8) ρ_rim(8) + fracR_i-812-8 ρ^*  textif  8  R_i  12\nendcases\nendalignwhere ρ^* = 900 kg/m³ is the density of solid bulk ice, and a_textCL b_textCL c_textCL are the coefficients for the Cober & List (1993) parameterization [32]. The R_i quantity is limited to the range 1  R_i  12. Their values are a_textCL = 51, b_textCL = 114, and c_textCL = -55.\n\nThe change in rime volume at some diameter D_i is then given by\n\n_tmathcalB_textriml(D_i) \n  = _0^ frac_tmathcalV_l(D_i D_l) m_l(D_l)ρ_rim(R_i(D_i D_l)) N_l(D_l) mathrmdD_l\n\nnote: Bulk rime volume change from collisions\nThe bulk rate of rime volume change is limited by the fraction of mass that freezes, and is then given bytextcolorbrowntextBCCOL + textBRCOL \n  = sum_l  c r _0^ _tmathcalB_textriml(D_i) f_textfrz(D_i) N_i(D_i) mathrmdD_i\n\nIn the wet growth regime, the rime compacts, rapidly relaxing towards the solid bulk ice density of 9167 kg/m³. Because the P3 scheme only tracks the bulk rime volume B_textrim, the densification rate is applied to the bulk rime volume. As a measure of the \"intensity\" of wet growth, we use the fraction of the total liquid collection that occurs by particles in wet growth regime,\n\nbeginalign*\nf_textwet \n= frac\n  _0^ mathbb1_textwet(D_i)  _t mathcalM_col(D_i) N(D_i) mathrmdD_i\n_0^ _t mathcalM_textcol(D_i) N(D_i) mathrmdD_i\n \n= frac\n  _0^ mathbb1_textwet(D_i)  _t mathcalM_col(D_i) N(D_i) mathrmdD_i\ntextcolorbrowntextQCCOL + textQRCOL + textQRSHD\n\nendalign*\n\nwhere mathbb1_textwet(D_i) is the indicator function for particles in the wet growth regime.\n\nnote: Bulk rime volume change from wet growth\nThe bulk rate of rime volume change is then given bybeginalign*\ntextcolorbrowntextQIWET\n  = f_textwet  frac1τ_textwet (L_textice - L_textrim)\n  = f_textwet  frac1τ_textwet  L_textice (1 - F_rim)\n\ntextcolorbrowntextBIWET\n  = f_textwet  frac1τ_textwet left(fracL_texticeρ^* - B_textrimright) \nendalign*","category":"section"},{"location":"P3Scheme/#Heterogeneous-Freezing","page":"P3 Scheme","title":"Heterogeneous Freezing","text":"Immersion freezing is parameterized based on water activity and follows the ABIFM   parameterization from [33]. See also the derivation notes about different   ice nucleation parameterizations. The immersion freezing nucleation rate is computed by numerically integrating   over the distribution of cloud droplets given by the 2-moment warm rain   microphysics scheme from [10]. The rate is limited by the available cloud droplet number concentration   and water content.\n\nfracdNdt = int_0^D_textrmmax  J_textrmABIFM A_a(D) N(D) mathrmdD\n\nfracdQdt = int_0^D_textrmmax  J_textrmABIFM A_a(D) N(D) m(D) mathrmdD\n\nwhere\n\nJ_textrmABIFM - is the immersion freezing nucleation rate,\nA_a(D) - is the assumed surface area of insoluble ice nucleating particles,\nN(D) - number distribution of cloud droplets,\nm(D) - assumed mass of a cloud droplet as a function of its diameter.\n\ninclude(\"plots/P3ImmersionFreezing.jl\")\n\n(Image: )","category":"section"},{"location":"P3Scheme/#Melting","page":"P3 Scheme","title":"Melting","text":"Melting rate is derived in the same way as in the   1-moment scheme. We assume the same ventilation factor parameterization as in [10],   and use the terminal velocity parameterization from [12]. The dmdD derivative is computed for each P3 size regime. The bulk melting rate is computed by numerically integrating over the particle size distribution:\n\nleft fracdLdt right_mathrmmelt \n= frac4  K_mathrmthermoL_f left(T - T_mathrmfreezeright)\n  int_0^infty fracdm(D)dD fracF_v(D) N(D)D mathrmdD\n\nThe melting rate for number concentration is assumed to be proportional to the ice content melting rate.\n\nleft fracdNdt right_mathrmmelt = fracNL left fracdLdt right_mathrmmelt\n\nBoth rates are limited by the total available ice content and number concentration divided by model time step length.\n\ninclude(\"plots/P3Melting.jl\")\n\n(Image: )","category":"section"},{"location":"P3Scheme/#Acknowledgments","page":"P3 Scheme","title":"Acknowledgments","text":"Click on the P3 mascot duck to be taken to the repository   in which the authors of [23] and others   have implemented the P3 scheme in Fortran!\n\n(Image: P3 mascot)","category":"section"},{"location":"IceNucleationBox0D/#0-dimensional-Box-Model","page":"Box Model","title":"0-dimensional Box Model","text":"This model solves for number concentration of ice crystals     produced via water-activity based immersion freezing     in a 0-dimensional setup with a prescribed constant cooling rate. It is used to validate the immersion freezing parameterization   and is based on Figure 4 from [64].\n\nNote that because the cooling rate is prescribed, the temperature change does not    depend on the freezing rate and the associated latent heat release. The production rate of ice is given by\n\nbeginequation\nfracdN_idt = J  N_l  A_d\nendequation\n\nwhere\n\nJ - is the immersion freezing rate coefficient,\nN_l - is number of liquid droplets,\nA_d - is the surface area available for freezing for a single droplet.\n\nA_d is currently assumed to be either constant among all droplets or sampled from a lognormal distribution with user defined mean and width.\n\nIn the plots below, we first reproduce Fig. 4 from [64]   by computing the apparent and actual nucleation rates based on the paper defined   frozen fraction. As as second step we run the box model for constant and variable A_d   and compare the results. Note that the variable A_d scenario is closer to what is observed, while   constant A_d is closer to what we can currently implement in our   bulk microphysics scheme for ESM.\n\ninclude(\"../../box/Alpert_Knopf_2016_backward.jl\")\ninclude(\"../../box/Alpert_Knopf_2016_forward.jl\")\n\n(Image: ) (Image: )","category":"section"},{"location":"Thermodynamics/#Thermodynamics-Interface","page":"Thermodynamics interface","title":"Thermodynamics Interface","text":"The CloudMicrophysics.jl library is designed to be flexible and agnostic   to the specific thermodynamics of the model it is coupled with. It requires certain functions and free parameters to be provided by the host model,   such as, for example, the formula to compute the saturation vapor pressure.","category":"section"},{"location":"Thermodynamics/#Assumptions-about-water-categories","page":"Thermodynamics interface","title":"Assumptions about water categories","text":"The different parameterizations available within the CloudMicrophysics.jl library   do make different assumptions about the partitioning of cloud condensate. It is crucial to understand those assumptions when choosing a parameterization   best suited for your model, and coupling it in a thermodynamics-consistent way.\n\n1-moment scheme splits condensed water into cloud liquid q_lcl, cloud ice q_icl, rain q_rai and snow q_sno.\n2-moment scheme only considers liquid phase and divides the condensed water into cloud liquid q_lcl and rain q_rai.\nP3 scheme only considers ice phase and has one category for all condensed species q_ice","category":"section"},{"location":"Thermodynamics/#Additional-functions-and-parameters","page":"Thermodynamics interface","title":"Additional functions and parameters","text":"Needed by the CloudMIcrophysics.jl library:\n\nGas constants for dry air and water vapor\nGas constant for moist air\nLatent heats of vaporization, fusion and sublimation\nSpecific heat capacity under constant pressure for moist air\nSaturation vapor pressure and supersaturation over liquid and ice\nWater vapor specific content\nSpecific content from partial pressure and partial pressure from specific content\n\nNeeded in tests and examples shown in the documentation\n\nGravitational constant (only used in the adiabatic parcel example)\nAir density (only used in tests)","category":"section"},{"location":"DevelopersGuide/#Developer's-Guide","page":"Developer's Guide","title":"Developer's Guide","text":"This doc is meant to guide any beginner developers with organization   and common surprises associated with contributing to CloudMicrophysics.jl.","category":"section"},{"location":"DevelopersGuide/#GitHub-workflow","page":"Developer's Guide","title":"GitHub workflow","text":"We work on branches of the main repository, rather than personal forks. Each branch name should ideally start with your initials, followed by short   name relevant to what will be added in that branch. It is considered a good practice to open an issue that describes the planned work   before starting the implementation. This allows you to get feedback from other developers and advertise the planned work to the group. When the implemented code is ready for review, create a pull request (PR) on GitHub   and tag the issue it is addressing. In the PR you can describe which parts of the relevant issue are solved and what needs to   be done to reach that goal. After creating a PR on GitHub, you will find that every following commit & push you make   will go through continuous integration (CI) checks:\n\nThe, ci runs the tests on Ubuntu, Windows and OSX machines using GitHub Actions. The tests include some unit tests and very simple performance tests. It may happen that the tests pass on your local machine, but fail on one of the machines provided in the cloud for the CI. This is especially true for the performance tests, as the execution times may vary a lot depending on the machine. The CI is the source of truth over local tests, and all tests must pass in the CI before code can be merged. See the Tests section below for debugging tips.\nCloudMicrophysics.jl has a small set of tests that are run on the GPUs using buildkite. They are triggered automatically when trying to merge a PR. If the GPU tests fail, check first for use of any \"out of place\" functions (for example, @warn will not work on GPU).\nThe Documentation / docbuild builds the documentation. Most common errors in the docbuild are related to missing docstrings, see the Documentation section for hints. This check may fail if the source code itself is not compiling, so please handle the compilation errors first. If the documentation build was successful, the documenter/deploy will display the documentation page based on the PR (click on the details).\nThe JuliaFormatter / format ensures consistent formatting throughout the repository. If this check fails, you can click on details to see which files are not following the formatting rules. You can apply the formatter by adding JuliaFormatter to your base environment, and running julia -e 'import JuliaFormatter; JuliaFormatter.format_file(\".\")'  from the root directory, in the terminal. The formatter might break if the code does not compile, so make sure you handle the compilation errors first.\nThe codecov shows what percentage of source code lines are exercised inside the tests. We strive to keep the test coverage high, but this test is not strictly required to pass before merging a PR.\n\nOnce the PR is opened, you can request reviewers to look over and approve your work. To keep things tidy, we want PRs to have few (ideally only one) commit   before merging to the main branch. You can squash and rebase multiple commits into one   in your favorite editor (VS Code, Vim etc). In case of doubt, see Git tutorials on how to squash and rebase   or reach out to other developers in our team. The first couple of times it pays off to create a \"backup branch\" before starting your rebase,   and then comparing afterwards if the rebased and backup branches are identical. If the main branch has been updated after your branch was created, you will need to rebase onto the main branch. To do this, run git rebase origin/main and solve any conflicts manually. This is done more easily if you only have one commit. You can merge the PR if all the tests are passing   and the PR branch is up to date with the main branch.\n\nThe easiest way to use the new additions in the main branch of CloudMicrophysics.jl   from another package is to do a package release. To do that, you need to change the package version in the Project.toml. We do a patch release if the API did not change (for example 0.11.1 -> 0.11.2)   and a minor version release if it did (for example 0.11.1 -> 0.12.0). We use the JuliaRegistrator bot to register new versions in the Julia package ecosystem,   by commenting @JuliaRegistrator register under the merged PR that changes the package version. You can also use specific branches from the repository,   if you are working with commits that were not yet merged into main. See Pkg.jl docs   for more details.","category":"section"},{"location":"DevelopersGuide/#New-contributions","page":"Developer's Guide","title":"New contributions","text":"CloudMicrophysics.jl is a collection of point-wise functions grouped   in different modules depending on which aspect of aerosol and cloud microphysics   they address.","category":"section"},{"location":"DevelopersGuide/#Functions","page":"Developer's Guide","title":"Functions","text":"When adding a new function, decide if a new module is required, or add to the existing one. If the added function will be used in other modules, export the function. Avoid exporting functions that are only used within the module it is defined in   or functions that have the same name as a function already in the API. Avoid shortening words or phrases when naming new functions. The name of the function should be self-explanatory yet brief. All functions should have docstrings describing the API, as well as   documentation focusing on the scientific aspects of what they do. All functions should have their own unit, performance and GPU tests.","category":"section"},{"location":"DevelopersGuide/#Free-Parameters","page":"Developer's Guide","title":"Free Parameters","text":"All free parameters should be stored in ClimaParams. It is usually faster to prototype defining the free parameters locally,   and move them to ClimaParams at a last step.","category":"section"},{"location":"DevelopersGuide/#Artifacts","page":"Developer's Guide","title":"Artifacts","text":"Data used in calibrations and other scripts may be used in the form of artifacts.     ClimaArtifactsHelper is used in creating the artifacts. A copy of the data is     stored on the Caltech box. More information on the data and where it was sourced     from can be found in the README.md file within the artifact folder. An example can be found in the papers > ice_nucleation_2024 > AIDA_data_artifact folder.     If making a new artifact, copy the create_AIDA_artifacts.jl file and follow instructions     as needed. Remember to update the Artifacts.toml and API.md files as well. All artifacts should have a corresponding calling function.","category":"section"},{"location":"DevelopersGuide/#Notable-Files","page":"Developer's Guide","title":"Notable Files","text":"Other files that may require editing after you make a new function are:\n\nCloudMicrophysics.jl (found in src folder) if you need to include a new source file,\nindex.md (found in docs/src folder) if you want to mention the new additions in the main documentation page,\nmake.jl (found in docs folder) if you are adding a new file to the documentation,\nAPI.md (found in docs/src folder) if you are adding functions (see Documentation section for more details),\nruntests.jl (found in test folder) if you are adding new test file for unit tests.","category":"section"},{"location":"DevelopersGuide/#Documentation","page":"Developer's Guide","title":"Documentation","text":"Each new addition to the library should be accompanied by a documentation page   summarizing the derivation/assumptions and it's potential uses. If possible, it's really appreciated to also add short code snippets that reproduce   results from the literature. Those code snippets are executed every time documentation is build and provide   great examples on how different available parameterizations work. In some cases, it may be useful to add simple usage examples to the docstrings.   This achieved by using the jldoctest environment described in the   Documenter.jl docs.   These examples should be self-contained and executable. If they contain output   from calculations, it is best to generate the output using the doctest function   described here.   This will ensure that the examples are always up to date. If the output differs,   building the documentation will fail.\n\nAdditionally, each function in the source code is required to have a docstring   and should be added to the API documentation page. The docstring formatting is pretty strict:   (i) no empty lines between the docstring and the function/module,   (ii) docstring starts and ends with a line consisting of three quotation marks,   (iii) the second line has the function's name preceded by exactly 4 spaces. Examples can be found in the source files. Be sure to add the function to API.md in the docs folder. Missing docstrings and functions in the API cause the documentation build to break.\n\nTo build and work the documentation locally, you can use LiveServer.jl. This will compile the documentation to a local server that is updated whenever you make changes. Alternatively, you can save the documentation to a static webpage: julia --project=docs docs/make.jl. The index page will be saved in docs/build folder.","category":"section"},{"location":"DevelopersGuide/#Tests","page":"Developer's Guide","title":"Tests","text":"","category":"section"},{"location":"DevelopersGuide/#Unit-Tests","page":"Developer's Guide","title":"Unit Tests","text":"Unit tests aim to ensure that parameterizations make physical sense. They can be found in the test folder under files named after corresponding source files. If you create a new function, please also create a new test that checks it. If creating a new file for unit tests, make sure you import Test and any other necessary libraries. There is some boilerplate code needed to create the sets with free parameters   based on the default toml file from ClimaParams.\n\nSome possible tests include checking if the returned values agree with values   in the literature, if something is smaller/greater at warmer/cooler   temperatures, if assertion errors are returned when a function is used outside its   valid range of parameters, or if a function is zero at certain input values. In general, writing good tests is difficult and we are always on the lookout for new good candidates. We strive to exercise all functions in some way in tests,   so that at minimum we can catch changes in the API.\n\nYou can run the tests locally: julia --project=test test/runtests.jl.","category":"section"},{"location":"DevelopersGuide/#Performance-Tests","page":"Developer's Guide","title":"Performance Tests","text":"Performance tests check the memory allocations (there should be none) and execution times   of some of the functions. They are found in the test folder under a single file named performance_tests.jl.\n\nYou can add performance tests for your new functions in the benchmark_test(FT) function. Parameters are listed at the start of the function. Next, add your performance tests under the comment with the file name which your   new function is in. This is done by calling bench_press(function_name, (Parameter1, Parameter2), min_time). The last argument is an estimate of the minimum run-time of the function. It may take some trial and error to find a number   that will satisfy the ci tests that are run on different operating systems   and for different floating-point precision. You can identify which specific performance test is failing on GitHub   by clicking on details next to a failed check from one of the ci / ci 1.8.1 checks. Adjust the estimated minimum run-time appropriately.","category":"section"},{"location":"DevelopersGuide/#GPU-Tests","page":"Developer's Guide","title":"GPU Tests","text":"Graphic Processing Unit (GPU) tests check that CloudMicrophysics.jl functions are able to run on GPU. They are as simple as checking that a certain input returns a known value. Right now, we do not test the whole library on the GPUs,   so the support is limited. GPU tests can be found in the test folder under a single file named gpu_tests.jl. There are two things to add: a kernel for your function and the actual test.\n\nKernels are added at the top half of the file using @kernel. The naming convention follows test_<function name>_kernel!. Within the kernel, use @inbounds to place any outputs into an output array.\n\nThe test itself should be added in the test_gpu(FT) function. The test starts with defining data_length and ends after an @test macro. data_length corresponds to the number of outputs your function has. Add an array for each input required by your function. For example, if you want to test at temperature of 230K,   you can add T = ArrayType([FT(230)]). Add a comment of what you are testing and use @test to create your test. The GPU tests are ran twice: for Float64 and Float32. Similar as with performance tests, some trial and error is needed   to find good tolerances for both options.","category":"section"},{"location":"ArtifactCalling/#Artifact-Calling","page":"Artifact Calling","title":"Artifact Calling","text":"","category":"section"},{"location":"ArtifactCalling/#Using-Artifacts","page":"Artifact Calling","title":"Using Artifacts","text":"Calling the artifact needs to be done in the CloudMicrophysics source code so that the      Artifact.toml file can be seen. The file containing the list of artifacts is     ArtifactCalling.jl. To call an artifact in a certain file outside of the src folder,     simply call the calling function just as you would other functions in the source code.     For example:\n\nimport CloudMicrophysics as CM\n\ndata_file_name = \"in05_17_aida.edf\"\nCM.ArtifactCalling.AIDA_ice_nucleation(data_file_name)\n\nThis will automatically download the in05_17_aida.edf file from the Caltech box,     if not already available, and output the filepath.","category":"section"},{"location":"ArtifactCalling/#More-information","page":"Artifact Calling","title":"More information","text":"For more information about artifacts, visit the ClimaArtifacts repo on GitHub.","category":"section"},{"location":"guides/literated/SimpleModel/#Simple-Model","page":"Building a model","title":"Simple Model","text":"This guide shows how to build a simple model using CloudMicrophysics.jl parameterizations and OrdinaryDiffEq.jl solver.\n\nWe start by importing the needed external packages and CloudMicrophysics.jl modules.\n\nimport OrdinaryDiffEq as ODE\nimport UnicodePlots as UP\nimport CloudMicrophysics.Parameters as CMP\nimport CloudMicrophysics.Microphysics1M as CM1\n\nnothing #hide\n\nWe define the problem for the ordinary differential equations solver. The dY and Y are the tendencies and the state vector of the solved problem, p stores the additional parameters of the simulation and t is the simulation time. See the OrdinaryDiffEq.jl for more details about the solver interface.\n\nfunction rain_formation(dY, Y, p, t)\n    FT = eltype(Y) # Floating point precision type\n    (; ρₐ, rain, liquid, ce, v_term) = p # Additional parameters passed through p\n\n    qₗ = Y[1] # Cloud water specific content\n    qᵣ = Y[2] # Rain water specific content\n\n    acnv = CM1.conv_q_lcl_to_q_rai(rain.acnv1M, qₗ) # Rain autoconversion rate\n    accr = CM1.accretion(liquid, rain, v_term.rain, ce, qₗ, qᵣ, ρₐ) # Rain accretion rate\n\n    dY[1] = -acnv - accr # Add the tendecies for cloud water\n    dY[2] = acnv + accr  # and rain\nend\n\nnothing #hide\n\nWe choose the simulation precision type and grab the default values of simulation parameters. We store the simulation parameters in the named tuple p.\n\nFT = Float32\n\nrain = CMP.Rain(FT) # Rain drop parameters for the 1-moment scheme\nliquid = CMP.CloudLiquid(FT) # Cloud droplet parameters for the 1-moment scheme\nce = CMP.CollisionEff(FT) # Collision efficiencies\nv_term = CMP.Blk1MVelType(FT) # Terminal velocity parameters\nρₐ = FT(1) # Air density\np = (; ρₐ, rain, liquid, ce, v_term)\n\nnothing #hide\n\nFinally we define the simulation time and initial conditions for cloud and rain water specific contents. We define the ODE problem, pass it to the solver, and visualize the results.\n\nt₀ = FT(0)\nt_end = FT(10 * 60)\nTS = (t₀, t_end)\n\nqₗ0 = FT(5e-3)\nqᵣ0 = FT(0)\nIC = [FT(qₗ0), FT(qᵣ0)]\n\nproblem = ODE.ODEProblem(rain_formation, IC, TS, p)\nsol = ODE.solve(problem, ODE.Tsit5(), reltol = eps(FT), abstol = eps(FT))\n\nplt = UP.lineplot(\n    sol.t,\n    sol[1, :] .* 1e3,\n    name = \"cloud\",\n    xlabel = \"time [s]\",\n    ylabel = \"q [g/kg]\",\n)\nUP.lineplot!(plt, sol.t, sol[2, :] .* 1e3, name = \"rain\")\n\n\n\nThis page was generated using Literate.jl.","category":"section"},{"location":"Microphysics1M/#Microphysics-1M","page":"1-moment precipitation microphysics","title":"Microphysics 1M","text":"The Microphysics1M.jl module describes a 1-moment bulk parameterization of   cloud microphysical processes. The module is based on the ideas of   [1],   [2]   and [3].\n\nThe cloud microphysics variables are expressed as specific contents:\n\nq_tot - total water specific content,\nq_vap - water vapor specific content (i.e., specific humidity),\nq_lcl - cloud water specific content,\nq_icl - cloud ice specific content,\nq_rai - rain specific content,\nq_sno - snow specific content.","category":"section"},{"location":"Microphysics1M/#Assumed-particle-size-relationships","page":"1-moment precipitation microphysics","title":"Assumed particle size relationships","text":"Particles are assumed to follow power-law relationships involving the mass(radius), denoted by m(r), the cross section(radius), denoted by a(r), and the terminal velocity(radius), denoted by v_term(r), respectively. See terminal velocity section for more details on the available terminal velocity options. The coefficients are defined in the   ClimaParams.jl package   and are shown in the table below. For rain and ice they correspond to spherical liquid water drops   and ice particles, respectively. There is no assumed particle shape for snow, and the relationships are   empirical.\n\nm(r) = chi_m  m_0 left(fracrr_0right)^m_e + Delta_m\n\na(r) = chi_a  a_0 left(fracrr_0right)^a_e + Delta_a\n\nwhere:\n\nr is the particle radius,\nr_0 is the typical particle radius used to nondimensionalize,\nm_0  m_e  a_0  a_e are the default  coefficients,\nchi_m, Delta_m, chi_a, Delta_a  are the coefficients that can be used during model calibration to expand  around the default values.  Without calibration all chi parameters are set to 1  and all Delta parameters are set to 0.\n\nThe above coefficients, similarly to all other microphysics parameters,   are not hardcoded in the final microphysics parameterizations. The goal is to allow easy flexibility when calibrating the scheme. With that said, the assumption about the shape of the particles is used three   times when deriving the microphysics formulae:\n\nThe mass transfer equation (\\ref{eq:mass_rate}) used in snow autoconversion,  rain evaporation, snow sublimation and snow melt rates is derived assuming  spherical particle shapes. To correct for non-spherical shape it should be  multiplied by a function of the particle aspect ratio.\nThe geometric collision kernel used for deriving rain-snow accretion rate  assumes that both colliding particles are spherical.  It does not take into account the reduced cross-section of snow particles  that is used when modeling snow - cloud liquid water  and snow - cloud ice accretion.\nIn the definition of the Reynolds number that is used when computing  ventilation factors.\n\nsymbol definition units default value reference\nr_0^rai typical rain drop radius m 10^-3 \nm_0^rai coefficient in m(r) for rain kg frac43  pi  rho_water  r_0^3 \nm_e^rai exponent in m(r) for rain - 3 \na_0^rai coefficient in a(r) for rain m^2 pi  r_0^2 \na_e^rai exponent in a(r) for rain - 2 \n    \nr_0^ice typical ice crystal radius m 10^-5 \nm_0^ice coefficient in m(r) for ice kg frac43  pi  rho_ice  r_0^3 \nm_e^ice exponent in m(r) for ice - 3 \n    \nr_0^sno typical snow crystal radius m 10^-3 \nm_0^sno coefficient in m(r) for snow kg 01   r_0^2 eq (6b) [2]\nm_e^sno exponent in m(r) for snow - 2 eq (6b) [2]\na_0^sno coefficient in a(r) for snow m^2 03 pi  r_0^2 alpha in eq(16b) [2].\na_e^sno exponent in a(r) for snow - 2 \n\nwhere:\n\nrho_water is the density of water,\nrho_ice is the density of ice.","category":"section"},{"location":"Microphysics1M/#Assumed-particle-size-distributions","page":"1-moment precipitation microphysics","title":"Assumed particle size distributions","text":"The particle size distributions are assumed to follow   Marshall-Palmer distribution   [4]   eq. 1:\n\nbeginequation\n  n(r) = n_0 expleft(- lambda  r right)\nendequation\n\nwhere:\n\nn_0 and lambda are the Marshall-Palmer distribution parameters.\n\nThe n_0 for rain and ice is assumed constant. The n_0 for snow is defined as\n\nbeginequation\n  n_0^sno = mu^sno left(fracrhorho_0 q_snoright)^nu^sno\nendequation\n\nwhere:\n\nmu^sno and nu^sno are the coefficients\nrho_0 is the typical air density used to nondimensionalize the equation  and is equal to 1  kgm^3\n\nThe coefficients are defined in   ClimaParams.jl package and are shown in the table below.\n\nsymbol definition units default value reference\nn_0^rai rain drop size distribution parameter frac1m^4 16 cdot 10^6 eq (2) [4]\nn_0^ice cloud ice size distribution parameter frac1m^4 2 cdot 10^7 bottom of page 4396 [3]\nmu^sno snow size distribution parameter coefficient frac1m^4 436 cdot 10^9  rho_0^nu^sno eq (A1) [3]\nnu^sno snow size distribution parameter exponent - 063 eq (A1) [3]\n\nThe lambda parameter is defined as\n\nbeginequation\nlambda =\n  left(\n    frac Gamma(m_e + Delta_m + 1)  chi_m  m_0  n_0\n         q  rho  (r_0)^m_e + Delta_m\n  right)^frac1m_e + Delta_m + 1\nendequation\n\nwhere:\n\nq is rain, snow or ice specific content\nchi_m, m_0, m_e, Delta_m, r_0, and n_0  are the corresponding mass(radius) and size distribution parameters\nGamma() is the gamma function\n\nThe cloud-ice size distribution is used   when computing snow autoconversion rate and rain sink due to accretion. In other derivations cloud ice, similar to cloud liquid water,   is treated as continuous.\n\nnote: Note\nDo we want to keep the n_0 for rain constant and n_0 for snow empirical?\nDo we want to test different size distributions?\n\nHere we plot the Marshall-Palmer particle size distribution for 4 different values for the rain specific content (q_rai).\n\ninclude(\"plots/MarshallPalmer_distribution.jl\")\n\n(Image: )","category":"section"},{"location":"Microphysics1M/#Parameterized-processes","page":"1-moment precipitation microphysics","title":"Parameterized processes","text":"Parameterized processes include:\n\nautoconversion of rain and snow,\naccretion,\nevaporation of rain water,\nsublimation, vapor deposition and melting of snow,\nsedimentation of rain and snow with mass weighted average terminal velocity   (cloud water and cloud ice are part of the working fluid and   do not sediment).\n\nParameters used in the parameterization are defined in   ClimaParams.jl package. They consist of:\n\nsymbol definition units default value reference\ntau_acnv_rain cloud liquid to rain water autoconversion timescale s 10^3 eq (5a) [5]\ntau_acnv_snow cloud ice to snow autoconversion timescale s 10^2 \nq_lcl_threshold cloud liquid to rain water autoconversion threshold - 5 cdot 10^-4 eq (5a) [5]\nq_icl_threshold cloud ice snow autoconversion threshold - 1 cdot 10^-6 \nr_is threshold particle radius between ice and snow m 625 cdot 10^-6 abstract [6]\nE_lr collision efficiency between rain drops and cloud droplets - 08 eq (16a) [2]\nE_ls collision efficiency between snow and cloud droplets - 01 Appendix B [7]\nE_ir collision efficiency between rain drops and cloud ice - 1 Appendix B [8]\nE_is collision efficiency between snow and cloud ice - 01 bottom page 3649 [9]\nE_rs collision efficiency between rain drops and snow - 1 top page 3650 [9]\na_vent^rai b_vent^rai rain drop ventilation factor coefficients - 15 , 053 chosen such that at q_tot=15 gkg and T=288K the evap. rate is close to empirical evap. rate in [5]\na_vent^sno b_vent^sno snow ventilation factor coefficients - 065 , 044 eq (A19) [3]\nK_therm thermal conductivity of air fracJm  s  K 24 cdot 10^-2 \nnu_air kinematic viscosity of air fracm^2s 16 cdot 10^-5 \nD_vapor diffusivity of water vapor fracm^2s 226 cdot 10^-5 ","category":"section"},{"location":"Microphysics1M/#Ventilation-factor","page":"1-moment precipitation microphysics","title":"Ventilation factor","text":"The ventilation factor parameterizes the increase in the mass and heat exchange   for falling particles. Following [10]   eq. 24  the ventilation factor is defined as:\n\nbeginequation\n  F(r) = a_vent + b_vent  N_Sc^13 N_Re(r)^12\nlabeleqventil_factor\nendequation\n\nwhere:\n\na_vent, b_vent are coefficients,\nN_Sc is the Schmidt number,\nN_Re is the Reynolds number of a falling particle.\n\nThe Schmidt number is assumed constant:\n\nN_Sc = fracnu_airD_vapor\n\nwhere:\n\nnu_air is the kinematic viscosity of air,\nD_vapor is the diffusivity of water.\n\nThe Reynolds number of a spherical drop is defined as:\n\nN_Re = frac2  r  v_term(r)nu_air\n\nApplying the terminal velocity(radius) relationship results in\n\nbeginequation\nF(r) = a_vent +\n       b_vent \n       left(fracnu_airD_vaporright)^frac13 \n       left(frac2  chi_v  v_0\n                  r_0^v_e + Delta_v  nu_airright)^frac12 \n       r^fracv_e + Delta_v + 12\nlabeleqvent_factor\nendequation","category":"section"},{"location":"Microphysics1M/#Terminal-velocity","page":"1-moment precipitation microphysics","title":"Terminal velocity","text":"The mass weighted terminal velocity v_t (following [11]) is:\n\nbeginequation\n  v_t = fracint_0^infty n(r)  m(r)  v_term(r)  dr\n             int_0^infty n(r)  m(r)  dr\nlabeleqvt\nendequation\n\nSee here   for discussion of the different parameterizations of v_term. Integrating the 1-moment m(r) and power-law v_term(r) relationships     over the assumed Marshall-Palmer distribution results in group terminal velocity:\n\nbeginequation\n  v_t = chi_v  v_0  left(frac1r_0  lambdaright)^v_e + Delta_v\n        fracGamma(m_e + v_e + Delta_m + Delta_v + 1)\n             Gamma(m_e + Delta_m + 1)\nendequation\n\nIntegrating the Chen et al. [12] formulae over the assumed Marshall-Palmer size distribution   results in the group terminal velocity (eq. 20 in [12]):\n\nbeginequation\n  v_t = phi_avg^kappa sum_i=1^j fraca_i lambda^delta Gamma(b_i + delta)(lambda + c_i)^b_i + delta  Gamma(delta)\nendequation\n\nwhere delta = 4 for the case of an exponential size distribution and the mass-weighted mean. For snow, for simplicity, we first compute the   mass-weighted mean aspect ratio over the size distribution of particles phi_avg   and then treat this as constant when computing the group terminal velocity.\n\nnote: Note\nFor snow, we only use the B4 coefficients from [12]. We should switch to doing partial integrals and include also the B2 coefficients.","category":"section"},{"location":"Microphysics1M/#Rain-autoconversion","page":"1-moment precipitation microphysics","title":"Rain autoconversion","text":"Rain autoconversion defines the rate of conversion form cloud liquid water   to rain water due to collisions between cloud droplets. It is parameterized following   [1]:\n\nbeginequation\n  left fracd  q_raidt right_acnv =\n    fracmax(0 q_lcl - q_lcl_threshold)tau_acnv_rain\nendequation\n\nwhere:\n\nq_lcl - cloud liquid water specific content,\ntau_acnv_rain - timescale,\nq_lcl_threshold - autoconversion threshold.\n\nnote: Note\nThis is the simplest possible autoconversion parameterization. It would be great to implement others and test the impact on precipitation. See for example [13] Table 1 for other simple choices.","category":"section"},{"location":"Microphysics1M/#Snow-autoconversion","page":"1-moment precipitation microphysics","title":"Snow autoconversion","text":"Snow autoconversion defines the rate of conversion form cloud ice to snow due   the growth of cloud ice by water vapor deposition. It is defined as the change of mass of cloud ice for cloud ice particles   larger than threshold r_is. See [6]   for derivation.\n\nbeginequation\n  left fracd  q_snodt right_acnv =\n  frac1rho fracddt\n    left( int_r_is^infty m(r) n(r) dr right) =\n    left frac1rho fracdrdt right_r=r_is m(r_is) n(r_is)\n    + frac1rho int_r_is^infty fracdmdt n(r) dr\nendequation\n\nThe fracdmdt is obtained by solving the water vapor diffusion equation   in spherical coordinates and linking the changes in temperature at the drop   surface to the changes in saturated vapor pressure via the Clausius-Clapeyron   equation, following   [14].\n\nFor the simplest case of spherical particles and not taking into account   ventilation effects:\n\nbeginequation\nfracdmdt = 4 pi  r  (S - 1)  G(T)\nlabeleqmass_rate\nendequation\n\nwhere:\n\nS(q_vap q_vap^sat) = fracq_vapq_vap^sat is saturation,\nq_vap^sat    is the saturation vapor specific humidity (over ice in this case),\nG(T) = left(fracL_sKT left(fracL_sR_v T - 1 right) + fracR_v Tp_vap^sat D right)^-1    combines the effects of thermal conductivity and water diffusivity.\nL_s is the latent heat of sublimation,\nK_thermo is the thermal conductivity of air,\nR_v is the gas constant of water vapor,\nD_vapor is the diffusivity of water vapor\n\nUsing eq. (\\ref{eq:mass_rate}) and the assumed m(r) relationship we obtain\n\nbeginequation\nfracdrdt = frac4 pi  (S - 1)chi_m  (m_e + Delta_m)\n   left( fracr_0r right)^m_e + Delta_m\n   fracG(T)  r^2m_0\nlabeleqr_rate\nendequation\n\nFinally the snow autoconversion rate is computed as\n\nbeginequation\n  left fracd  q_snodt right_acnv =\n   frac1rho 4 pi  (S-1)  G(T) \n   n_0^ice  exp(-lambda_ice r_is)\n   left( fracr_is^2m_e^ice + Delta_m^ice +\n   fracr_is lambda_ice +1lambda_ice^2 right)\nendequation\n\nnote: Note\nWe should include ventilation effects.For non-spherical particles the mass rate of growth should be multiplied by a function depending on the particle aspect ratio. For functions proposed for different crystal habitats see [6] Appendix B.\n\nWe also have a simplified version of snow autoconversion rate,   to be used in modeling configurations that   don't allow supersaturation to be present in the computational domain. It is formulated similarly to the rain autoconversion:\n\nbeginequation\n  left fracd  q_snodt right_acnv =\n    fracmax(0 q_icl - q_icl_threshold)tau_acnv_snow\nendequation\n\nwhere:\n\nq_icl - cloud ice specific content,\ntau_acnv_snow - timescale,\nq_icl_threshold - autoconversion threshold.","category":"section"},{"location":"Microphysics1M/#Accretion","page":"1-moment precipitation microphysics","title":"Accretion","text":"Accretion defines the rates of conversion between different categories due to   collisions between particles.\n\nFor the case of collisions between cloud water (liquid water or ice)   and precipitation (rain or snow) the sink of cloud water is defined as:\n\nbeginequation\nleft fracd  q_cdt right_accr =\n  - int_0^infty n_p(r)  a^p(r)  v_term(r)  E_cp  q_c  dr\nlabeleqaccr_1\nendequation\n\nwhere:\n\nc subscript indicates cloud water category (cloud liquid water or ice)\np subscript indicates precipitation category (rain or snow)\nE_cp is the collision efficiency.\n\nIntegrating over the distribution yields:\n\nbeginequation\nleft fracd  q_cdt right_accr =\n  - n_0^p  Pi_a v^p  q_c  E_cp \n    Gamma(Sigma_a v^p + 1) \n    frac1lambda^p \n    left( frac1r_0^p lambda^p\n    right)^Sigma_a v^p\nlabeleqaccrfin\nendequation\n\nwhere:\n\nPi_a v^p = a_0^p  v_0^p  chi_a^p  chi_v^p\nSigma_a v^p = a_e^p + v_e^p + Delta_a^p + Delta_v^p\n\nFor the case of cloud liquid water and rain and cloud ice and snow collisions,   the sink of cloud water becomes simply the source for precipitation. For the case of cloud liquid water and snow collisions   for temperatures below freezing, the sink of cloud liquid water is   a source for snow. For temperatures above freezing, the accreted cloud droplets   along with some melted snow are converted to rain. In this case eq. (\\ref{eq:accrfin}) describes the sink of cloud liquid water. The sink of snow is proportional to the sink of cloud liquid water with   the coefficient fracc_vlL_f(T - T_freeze),   where c_vl is the isochoric specific heat of liquid water,  L_f is the latent heat of freezing,   and T_freeze is the freezing temperature.\n\nThe collisions between cloud ice and rain create snow. The source of snow in this case is a sum of sinks from cloud ice and rain. The sink of cloud ice is defined by eq. (\\ref{eq:accrfin}). The sink of rain is defined as:\n\nbeginequation\nleft fracd  q_raidt right_accr_ri =\n  - int_0^infty int_0^infty\n  frac1rho  E_ir  n_i(r_i)  n_r(r_r)  a_r(r_r)  m_r(r_r)\n   v_term(r_r)  d r_i d r_r\nlabeleqaccr_ir\nendequation\n\nwhere:\n\nE_ir is the collision efficiency between rain and cloud ice\nn_i and n_r are the cloud ice and rain size distributions\nm_r, a_r and v_term are the mass(radius),    cross section(radius) and terminal velocity(radius) relations for rain\nr_i and r_r mark integration over cloud ice and rain size    distributions\n\nIntegrating eq.(\\ref{eq:accr_ir}) yields:\n\nbeginequation\nleft fracd  q_raidt right_accr_ri =\n  - frac1rho  E_ir  n_0^rai  n_0^ice \n  Pi_m a v^rai\n  Gamma(Sigma_m a v^rai + 1) \n  frac1lambda^ice  lambda^rai \n  left( frac1r_0^rai  lambda^rai\n  right)^Sigma_m a v^rai\nendequation\n\nwhere:\n\nPi_m a v^rai =  m_0^rai  a_0^rai  v_0^rai  chi_m^rai  chi_a^rai  chi_v^rai\nSigma_m a v^rai = m_e^rai + a_e^rai + v_e^rai + Delta_m^rai + Delta_a^rai + Delta_v^rai\n\nCollisions between rain and snow result in snow in temperatures below freezing   and in rain in temperatures above freezing. The source term is defined as:\n\nbeginequation\nleft fracd  q_idt right_accr =\n    int_0^infty int_0^infty frac1rho\n    n_i(r_i)  n_j(r_j)  a(r_i r_j)  m_j(r_j)  E_ij \n    leftv_term(r_i) - v_term(r_j)right  dr_i dr_j\nlabeleqaccr_sr1\nendequation\n\nwhere\n\ni stands for rain (TT_freezing) or snow (TT_freezing)\nj stands for snow (TT_freezing) or rain (TT_freezing)\na(r_i r_j) is the crossection of the two colliding particles\n\nThere are two additional assumptions that we make to integrate   eq.(\\ref{eq:accr_sr1}):\n\nWe approximate the terminal velocity difference for each particle pair with a velocity dispersion correction that accounts for the distribution of fall velocities:\nDelta v_eff = sqrt(v_ti - v_tj)^2 + c_disp (v_ti^2 + v_tj^2)\nwhere v_ti and v_tj are the mass-weighted mean terminal velocities, and c_disp is the velocity dispersion coefficient (default 0.2). This formulation assumes that fall velocity standard deviations are proportional to the mean fall velocities. The effective velocity difference Delta v_eff is then moved outside of the integral. See the discussion in Ikawa and Saito (1991)[1] on page 88.\nWe assume that a(r_i r_j) = pi (r_i + r_j)^2. This corresponds to a geometric formulation of the collision kernel, aka cylindrical formulation, see [15] for discussion.\n\n[1]: Ikawa and Saito (1991)    is section B of a full technical report    called \"Description of a Nonhydrostatic Model Developed at the Forecast Research Department of the MRI\".\n\nThe eq.(\\ref{eq:accr_sr1}) can then be integrated as:\n\nbeginalign\nleft fracd  q_idt right_accr  =\n    frac1rho  pi  n_0^i  n_0^j \n    m_0^j  chi_m^j  left(frac1r_0^jright)^m_e^j + Delta_m^j\n     E_ij left v_ti - v_tj right\n    int_0^infty int_0^infty\n    (r_i + r_j)^2\n    r_j^m_e^j + Delta_m^j \n    exp(- lambda_j r_j) \n    exp(- lambda_i r_i) \n    dr_i dr_j \n     =\n    frac1rho  pi  n_0^i  n_0^j  m_0^j  chi_m^j \n    E_ij Delta v_eff \n    left( frac1r_0^j right)^m_e^j + Delta_m^j\n    left(\n        frac2 Gamma(m_e^j + Delta_m^j + 1)lambda_i^3 lambda_j^m_e^j + Delta_m^j + 1\n        + frac2 Gamma(m_e^j + Delta_m^j + 2) lambda_i^2 lambda_j^m_e^j + Delta_m^j + 2\n        + fracGamma(m_e^j + Delta_m^j + 3)lambda_i lambda_j^m_e^j + Delta_m^j + 3\n    right)\nendalign\n\nnote: Note\nThe two assumptions used to integrate the snow-rain accretion rate could be revisited:The velocity dispersion correction (with coefficient c_disp) provides a simple approximation for the distribution of fall velocities. More sophisticated treatments could account for the full velocity distribution. The discussion on page 88 in Ikawa and Saito (1991) suggests alternative approximations. See also Mizuno [16].The (r_i + r_j)^2 assumption for the crossection is inconsistent with the snow crossection used when modelling collisions with cloud water and cloud ice.\n\nSimilarly to cloud ice and snow collisions, there is additional melting term    when snow collides with rain in temperatures warmer than freezing. This term is proportional to fracc_vlL_f(T - T_freeze).","category":"section"},{"location":"Microphysics1M/#Rain-evaporation-and-snow-sublimation","page":"1-moment precipitation microphysics","title":"Rain evaporation and snow sublimation","text":"We start from a similar equation as when computing snow autoconversion rate but integrate it from 0 to infty.\n\nbeginequation\n  left fracdqdt right_evap_subl =\n    frac1rho int_0^infty fracdm(r)dt n(r) dr\nendequation\n\nIn contrast to eq.(\\ref{eq:mass_rate}), now we are taking into account   ventilation effects:\n\nbeginequation\n  fracdmdt = 4 pi  r  (S - 1)  G(T)  F(r)\nlabeleqmass_rate2\nendequation\n\nwhere:\n\nF(r) is the rain drop ventilation factor  defined in (\\ref{eq:ventil_factor})\nsaturation S is computed over water or ice\n\nThe final integral is:\n\nbeginalign\nleft fracdqdt right_evap_subl  =\n    frac4 pi n_0rho (S - 1) G(T)\n    int_0^infty\n    left(\n       a_vent +\n       b_vent \n         left(fracnu_airD_vapor right)^frac13 \n         left(fracrr_0 right)^fracv_e + Delta_v2 \n         left(frac2  chi_v  v_0  rnu_air right)^frac12\n    right)\n    r  exp(-lambda r) dr \n     =\n    frac4 pi n_0rho (S - 1) G(T) lambda^-2\n    left(\n       a_vent +\n       b_vent \n         left(fracnu_airD_vapor right)^frac13 \n         left(frac1r_0  lambda right)^fracv_e + Delta_v2 \n         left(frac2  chi_v  v_0nu_air  lambda right)^frac12 \n         Gammaleft( fracv_e + Delta_v + 52 right)\n    right)\nendalign\n\nFor the case of rain we only consider evaporation (S - 1  0). For the case of snow we consider both the source term due to vapor deposition  on snow (S - 1  0) and the sink due to vapor sublimation (S - 1  0).\n\nnote: Note\nWe should take into account the non-spherical snow shape. Modify the Reynolds number and growth equation.","category":"section"},{"location":"Microphysics1M/#Snow-melt","page":"1-moment precipitation microphysics","title":"Snow melt","text":"If snow occurs in temperatures above freezing it is melting into rain. The sink for snow is parameterized again as\n\nbeginequation\n  left fracdqdt right_melt =\n    frac1rho int_0^infty fracdm(r)dt n(r) dr\nendequation\n\nFor snow melt\n\nbeginequation\n  fracdmdt = 4 pi  r  fracK_thermoL_f (T - T_freeze)  F(r)\nlabeleqmass_rate3\nendequation\n\nwhere:\n\nF(r) is the ventilation factor defined in (\\ref{eq:ventil_factor})\nL_f is the latent heat of freezing.\n\nIf T  T_freeze:\n\nbeginequation\nleft fracdqdt right_evap_subl =\n    frac4 pi  n_0  K_thermorho  L_f (T - T_freeze) lambda^-2\n    left(\n       a_vent +\n       b_vent \n         left( fracnu_airD_vapor right)^frac13 \n         left( frac1r_0  lambda right)^fracv_e + Delta_v2 \n         left( frac2  chi_v  v_0nu_air  lambda right)^frac12 \n         Gamma left( fracv_e + Delta_v + 52 right)\n    right)\nendequation","category":"section"},{"location":"Microphysics1M/#Example-figures","page":"1-moment precipitation microphysics","title":"Example figures","text":"include(\"plots/Microphysics1M_plots.jl\")\n\n(Image: ) (Image: ) (Image: ) (Image: ) (Image: ) (Image: ) (Image: ) (Image: )","category":"section"},{"location":"WaterActivity/#Water-Activity","page":"Water Activity","title":"Water Activity","text":"The Common.jl module includes   a parameterization for difference in water activity between a H2SO4   solution droplet and ice. This can be used in immersion and homogeneous   freezing parameterizations of nucleation rate coefficient, J.   The parameterization is based on [41], [42],   and [43].\n\nand the water activity of ice at the same temperature, a_wice(T). When the   droplet is in equilibrium with its surroundings, a_w is equivalent to relative   humidity. Otherwise, a parameterization can be found in the Common.jl file and   comes from [44],\n\nbeginequation\n  a_w = fracp_solp_sat\nendequation\n\nbeginequation\n  a_wice = fracp_isatp_sat\nendequation\n\nwhere p_sol is saturated vapor pressure of water above solution, p_sat   is saturated vapor pressure above pure liquid water, and p_isat is saturated   vapor pressure above ice. p_sol is determined in mbar using a parameterization   for supercooled, binary H_2SO_4H_2O solution from [43] which is only   valid for 185K  T  235K:\n\nbeginequation\n  ln(p_sol) = 23306 - 53465x + 12xw_h - 819xw_h^2 + frac1T(-5814 + 9289x - 18767xw_h)\nendequation\n\nwhere x is the weight fraction of sulphuric acid in the droplets   (i.e. if droplets are 10% sulphuric acid by mass, x = 01), w_h = 14408x,   and temperature is in Kelvins. Note that x should vary as the size of the droplet   changes.\n\nnote: Note\nThere is a need to find a parameterization for p_{sol} at temperatures warmer than 235K for mixed phase clouds.\n\nFor now, the equation used to find water activity of a droplet at equilibrium at   temperatures warmer than 235K is taken from [41] equation 4:\n\nbeginequation\n  a_w = S_i fracp_isat(T)p_sat(T)\nendequation\n\nS_i is water vapor saturation raito with respect to ice and defined by\n\nbeginequation\n  S_i = fracp_vp_isat(T)\nendequation\n\nwhere p_v is the ambient partial pressure of water vapor.\n\nnote: Note\nOnly use the above parameterization for Si in the application that it is not available. i.e. for a parcel model, use the Si calculated in the parcel model.\n\np_sat is currently defined using the Thermodynamics.jl library.   An alternative is using the parameterization for p_sol and setting   x = 0. We choose to use the Thermodynamics.jl to keep saturated vapor   pressure of pure water consistent throughout CloudMicrophysic.jl.\n\nSimilarly, p_isat is defined through the Thermodynamics.jl library. It is   possible to calculate it using chemical potential as done in [42], however,   we will use the current parameterization for consistency since they give similar results.\n\nTo verify that our parameterizations for p_isat and p_sat from     Thermodynamics.jl are valid at cold temperatures, we can compare to various     other vapor pressure parameterizations as found in [41].     Here, CM refers to CloudMicrophysics.jl and all dashed curves are different     implementations of p_isat and p_sat (p_sat labelled as     p_liq to emphasize ice vs liquid phase of the pure water).\n\ninclude(\"plots/Baumgartner2022_fig5.jl\")\n\n(Image: )\n\nTo verify that our parameterizations for water activty using Thermodynamics.jl     is ok, we plot critical water activity (water activtiy at which freezing occurs)     against the other variations found in [41]. Though not     matching exactly, our parameterization is relatively close to the other parameterizations. (Image: ) Shown in red is the water activity over ice using our parameterization. With these two lines   plotted (critical water activity of the droplet and ice water activity), we create a phase   diagram. Under the red line is liquid, above the critical water activity is ice, and between   the two curves is supercooled liquid.\n\nAnother plot to test if our parameterization is reasonable is plotting against other parameterizations   of water activity (as opposed to critical water activity) as a function of temperature. Plotted in   green are various ways to compute water activity over ice. using p(0T) refers to how the denominator,   a_w, is calculated. By default, this is parameterized assuming a pure liquid droplet with   Thermodynamics.jl. using p(0T) implies that the parameterization of vapor pressure of a solution   droplet is used but setting concentration of H2SO4 to zero. using mu refers to the parameterization   used in [42] where water activity is dependent on chemical potential.\n\ninclude(\"plots/T_vs_wateractivity.jl\")\n\n(Image: ) Taking the difference between any pair of blue and green lines will give a Delta a_w(T).   Since all the blue lines are similar and all the green lines are similar, we can   assume that our parameterization of pure liquid and ice water activities are reasonable.","category":"section"},{"location":"IceNucleation/#Ice-Nucleation","page":"Ice Nucleation","title":"Ice Nucleation","text":"Ice nucleation describes the process of forming ice crystals   from aerosol particles and/or liquid droplets. The IceNucleation.jl module includes:\n\nthe parameterization of activation of dust aerosol particles into ice crystals via deposition of water vapor,\nwater activity based parameterization of immersion freezing,\nwater activity based parameterization of homogeneous freezing,\nparametrization of temperature-dependent aerosol-independent ice nucleating particles concentration for immersion freezing.\n\nThe parameterization for deposition on dust particles is an implementation of   the empirical formulae from [45]   and is valid for two types of dust particles:   Arizona Test Dust and desert dust from Sahara.   The parameterization for immersion freezing is an implementation of [33]   and is valid for droplets containing sulphuric acid.   The parameterization for homogeneous freezing is an implementation of [42].   The parametrization for ice nucleating particles concentration for immersion freezing is an implementation of [36].\n\nnote: Note\nFuture work includes refining the homogeneous freezing parameterization and modeling the competition between freezing modes.","category":"section"},{"location":"IceNucleation/#Activated-fraction-for-deposition-freezing-on-dust","page":"Ice Nucleation","title":"Activated fraction for deposition freezing on dust","text":"There are 2 parameterizations from [45] available: one   which calculates the activated fraction and one which calculates nucleation   rate. The activated fraction parameterization follows eq. (3) in the paper.\n\nbeginequation\nf_i(S_i) = expa(S_i - S_0) - 1\nendequation\n\nwhere\n\nf_i is the activated fraction  (the ratio of aerosol particles acting as ice nuclei to the total number of aerosol particles),\na is a scaling parameter dependent on aerosol properties and temperature,\nS_i is the ice saturation ratio,\nS_0 is an empirically derived threshold ice saturation ratio.\n\nThe other parameterization models the nucleation rate of ice   as an empirical function of ice saturation ratio,   see eq. (5) in [45].\n\nbeginequation\nfracdn_icldt = N_aer a fracdS_idt\nendequation\n\nwhere:\n\nN_aer is the number of available aerosol/ice nuclei,\na is a scaling parameter dependent on aerosol properties and temperature,\nS_i is the ice saturation ratio (the ratio of water vapor partial pressure and the water vapor partial pressure at saturation over ice).\n\nLimited experimental values for the free parameters a and S_0 can be found in [45]. These   free parameters are strongly dependent on aerosol properties and temperature.\n\nnote: Note\nFor f_i values above 0.08 or S_i between 1.35 and 1.5, freezing occurs in a different ice nucleation mode (either a second deposition or other condensation type mode).","category":"section"},{"location":"IceNucleation/#Water-Activity-Based-Deposition-Nucleation","page":"Ice Nucleation","title":"Water Activity Based Deposition Nucleation","text":"The water activity based deposition nucleation model is analagous to ABIFM   for immersion freezing (see ABIFM for Sulphuric Acid Containing Droplets   section below). It calculates a nucleation rate coefficient, J, which   describes the number of ice nuclei formed per unit area of INP per unit time   dependent on the water activity criterion, Delta  a_w, and aerosol type.   The form of this empirical parameterization is taken from [33].   Currently, we have parameters for kaolinite, feldspar, and ferrihydrite derived   from [46] and [47].\n\nbeginequation\n  log_10J_deposition = m Delta a_w + c\nendequation\n\nwhere J is in units of cm^-2s^-1. Note that our source code returns   J in SI units. m and c are aerosol dependent coefficients. They will   have different values than those for ABIFM.","category":"section"},{"location":"IceNucleation/#Water-activity-based-deposition-nucleation-plot","page":"Ice Nucleation","title":"Water activity based deposition nucleation plot","text":"The following plot shows J as a function of Delta a_w as compared to   figure 6 in Alpert et al 2013 and figure S5 in supplementary material of China et al 2017. Intent of this   plot is to prove that J is correctly parameterized as a function   of Delta a_w, with no implications of whether Delta a_w is properly   parameterized. For more on water activity, please see above section.\n\ninclude(\"plots/activity_based_deposition.jl\")\n\n(Image: )","category":"section"},{"location":"IceNucleation/#Cooper-(1986)-Ice-Crystal-Number","page":"Ice Nucleation","title":"Cooper (1986) Ice Crystal Number","text":"The P3 scheme as described in [23] follows   the implementation of [48] where a parameterization from   Cooper 1986 was used. Number of ice crystals formed is derived from   ambient temperature.\n\nbeginequation\n  N_i = 0005 exp0304(T_0 - T)\nendequation\n\nWhere T_0 = 27315K and T is the ambient temperature. Because the parameterization is prone to overpredict at low temperatures,   N_i = N_i(T = 233K) for all values of N_i at which T  233K.","category":"section"},{"location":"IceNucleation/#Immersion-Freezing","page":"Ice Nucleation","title":"Immersion Freezing","text":"","category":"section"},{"location":"IceNucleation/#ABIFM-for-Sulphuric-Acid-Containing-Droplets","page":"Ice Nucleation","title":"ABIFM for Sulphuric Acid Containing Droplets","text":"Water Activity-Based Immersion Freezing Model (ABFIM)   is a method of parameterizing immersion freezing inspired by the time-dependent   classical nucleation theory (CNT). More on CNT can be found in [49].   The nucleation rate coefficient, J, describes the number of ice nuclei formed per unit area   per unit time and can be determined by the water activity, a_w. This parameterization follows   [33]. In this model, aerosols are assumed to contain an insoluble and   soluble material. When immersed in water, the soluble material diffuses into the liquid water   to create a sulphuric acid solution.\n\nUsing empirical coefficients, m and c, from [33],   the heterogeneous nucleation rate coefficient in units of cm^-2s^-1   can be determined by the linear equation\n\nbeginequation\n  log_10J_ABIFM = m Delta a_w + c\nendequation\n\nA parameterization for Delta a_w can be found in Common.jl. More information on   it can be found in the Water Activity section. m and c here are different   from the m and c parameters for deposition nucleation.\n\nnote: Note\nOur source code for the nucleation rate coefficient returns J in base SI units.\n\nOnce J_ABIFM is calculated, it can be used to determine the ice production rate, P_ice, per second via immersion freezing.\n\nbeginequation\n  P_ice = J_ABIFMA(N_aer - N_icl)\nendequation\n\nwhere A is surface area of an individual ice nuclei, N_aer is total number   of ice nuclei, and N_icl is number of ice crystals already in the system.","category":"section"},{"location":"IceNucleation/#ABIFM-Example-Figures","page":"Ice Nucleation","title":"ABIFM Example Figures","text":"The following plot shows J as a function of Delta a_w as compared to   figure 1 in Knopf & Alpert 2013. Solution droplets were assumed to contain   a constant 10% wt. sulphuric acid. Changing the concentration will simply   shift the line, following Knopf & Alpert's parameterization. As such, this   plot is just to prove that J is correctly parameterized as a function   of Delta a_w, with no implications of whether Delta a_w is properly   parameterized. For more on water activity, please see above section.\n\ninclude(\"plots/KnopfAlpert2013_fig1.jl\")\n\n(Image: )\n\nThe following plot shows J as a function of temperature as compared to figure 5a in Knopf & Alpert 2013.\n\ninclude(\"plots/KnopfAlpert2013_fig5.jl\")\n\n(Image: ) Note that water activity of the droplet was assumed equal to relative humidity so that:\n\nbeginequation\n  a_w = fracp_sat(T = T_dew)p_sat(T)\nendequation\n\nwhere T_dew is the dewpoint (in this example, it is constant at -45C).\n\nnote: Note\nFor the same figure in Knopf & Alpert, the mixed-phase cloud uses T{dew} = T. We are unsure when to use constant T{dew} or set it equal to T.\n\nIt is also important to note that this plot is reflective of cirrus clouds   and shows only a very small temperature range. The two curves are slightly   off because of small differences in parameterizations for vapor pressures.","category":"section"},{"location":"IceNucleation/#Bigg-(1953)-Volume-and-Time-Dependent-Heterogeneous-Freezing","page":"Ice Nucleation","title":"Bigg (1953) Volume and Time Dependent Heterogeneous Freezing","text":"Heterogeneous freezing in the P3 scheme as described in [23]   follows the parameterization from [50] with parameters from   [51]. The number of ice nucleated in a timestep via   heterogeneous freezing is determined by\n\nbeginequation\n  N_icl = N_lcl left 1 - exp(-B V_l Delta t exp(aT_s)) right\nendequation\n\nwhere a and B are parameters taken from [51] for   rainwater as 0.65 and 2e-4 respectively. T_s is the difference between   273.15K and ambient temperature. V_l is the volume of droplets to be   frozen and \\Delta t is timestep in which freezing occurs.","category":"section"},{"location":"IceNucleation/#Homogeneous-Freezing","page":"Ice Nucleation","title":"Homogeneous Freezing","text":"","category":"section"},{"location":"IceNucleation/#Homogeneous-Freezing-for-Sulphuric-Acid-Containing-Droplets","page":"Ice Nucleation","title":"Homogeneous Freezing for Sulphuric Acid Containing Droplets","text":"Homogeneous freezing occurs when supercooled liquid droplets freeze on their own.   Closly based off [42], this parameterization determines a homoegneous nucleation   rate coefficient, J_hom, using water activity. The change in water activity,   Delta a_w(cTP), can be found in Common.jl and is described in the   Water Activity section. It is then used to empirically calculate J_hom(Delta a_w)   with units of cm^-3s^-1.\n\nThe nucleation rate coefficient is determined with the cubic function from [42]\n\nbeginequation\n  logJ_hom = -9067 + 8502 Delta a_w - 26924(Delta a_w)^2 + 29180(Delta a_w)^3\nendequation\n\nThis parameterization is valid only when 026  Delta a_w  036 and 185K  T  235K.","category":"section"},{"location":"IceNucleation/#Homogeneous-Freezing-Example-Figures","page":"Ice Nucleation","title":"Homogeneous Freezing Example Figures","text":"Here is a comparison of our parameterization of J_hom compared to Koop 2000 as   plotted in figure 1 of [52]. Our parameterization differs in the calculation   of Delta a_w. We define water activity to be a ratio of saturated vapor pressures whereas   Koop 2000 uses the difference in chemical potential.\n\ninclude(\"plots/HomFreezingPlots.jl\")\n\n(Image: )\n\nIt should be noted that the Koop 2000   parameterization is only valid for temperatures up to 240K and a temperature-dependent max   pressure. The max valid pressure becomes negative around 237K, so the Koop 2000 parameterizaiton   should not be valid beyond 237K. For this reason, we limit the curve from [52]   to 237K.\n\nMultiple sulphuric acid concentrations, x,   are plotted since the actual concentration used in literature values is unspecified.\n\nnote: Note\nSpichtinger plot may be under the condition that x = 0 (pure liquid droplets). The current parameterization in CloudMicrophysics.jl is not valid for \\Delta a_w values that are obtained from pure water droplets. Though CliMA lines look far from the Spichtinger 2023 line, the lines seem to move closer as x approaches 0.","category":"section"},{"location":"IceNucleation/#Linear-fit-homogeneous-freezing","page":"Ice Nucleation","title":"Linear fit homogeneous freezing","text":"To avoid complications in extrapolating the Koop 2000 parameterization outside of the valide temperature range, a linear fit was created.\n\ninclude(\"plots/linear_HOM_J.jl\")\n\n(Image: )","category":"section"},{"location":"IceNucleation/#Water-Activity-Based-vs-P3-Ice-Nucleation-Parameterizations","page":"Ice Nucleation","title":"Water Activity Based vs P3 Ice Nucleation Parameterizations","text":"The water activity based models are compared with P3 ice nucleation parameterizations as described   in [23] using an adiabatic parcel model with depositional growth. The   first row of plots shows deposition nucleation; the second row shows heterogeneous freezing; the   last row shows homogeneous freezing.\n\ninclude(\"../../parcel/Example_P3_vs_activitybased.jl\")\n\n(Image: )\n\nFor the activity based deposition ice nucleation model (ABDINM):\n\nGreen corresponds to feldspar,\nOrange corresponds to ferrihydrite,\nMagenta corresponds to kaolinite.\n\nWe note that the P3 deposition parameterization shows a significantly greater ICNC at all times in   the simulation. This is expected because the parameterization does not account for the number of   available INP.\n\nFor the activity based immersion freezing model (ABIFM):\n\nGreen corresponds to desert dust,\nOrange corresponds to illite,\nMagenta corresponds to kaolinite.\n\nThe P3 heterogeneous parameterization also shows much more ICNC than any of the ABIFM runs. It   should be noted that the P3 parameterization does not distinguish between immersion freezing,   contact freezing, etc.\n\nThe P3 scheme allows homogeneous freezing to freeze all droplets at temperatures equal to or less than 233.15K. No homogeneous freezing occurs at warmer temperatures.","category":"section"},{"location":"IceNucleation/#INP-Concentration-Frequency","page":"Ice Nucleation","title":"INP Concentration Frequency","text":"With this parametrization, the concentration of ice nucleating particles (INPs) is found based on the relative frequency distribution, which depends on the temperature, but does not depend on aerosol types. It is based on [36] and is derived from measurements, for marine data sets. It is a lognormal distribution, described by\n\nbeginequation\n  D(mu sigma^2) = frac1sqrt2 pi sigma exp left(- fracln(a cdot INPC) - mu(T)^22 sigma^2 right)\nendequation\n\nwhere T is the temperature in degrees Celsius, INPC is the INP concentration in m^-3 and the temperature-dependent mean mu(T) is given by\n\nbeginequation\n  mu(T) = ln(-(b cdot T)^9 times 10^-9)\nendequation\n\nsigma^2 is the variance, a and b are coefficients. The parameters defined in [36] for marine data sets are sigma=137, a=1 m^3, b=1/C.\n\nnote: Note\nOur implementation uses base SI units and takes T in Kelvin.\n\nThe following plot shows the relative frequency distribution for INPCs, as a function of temperature (the same as figure 1 in [36]).\n\ninclude(\"plots/Frostenberg_fig1.jl\")\n\n(Image: )\n\nThe following plot shows the relative frequency distribution for INPCs at the temperature T=-16 C.\n\n(Image: )","category":"section"},{"location":"guides/literated/GettingStarted/#Getting-started","page":"Getting started","title":"Getting started","text":"This guide shows how to call a function from CloudMicrophysics.jl package. Please consult our README for the CloudMicrophysics.jl installation instructions.\n\nIn this guide will call the accretion function that parameterizes the growth of rain drops through collisions with cloud droples. Check the API documentation and the parameterization documentation for more details.\n\nWe start by defining the single precision floating point type that will be used in the computations. We import the Microphysics2M module in which the accretion function is defined and the Parameters module in which we store the default values of free parameters.\n\nFT = Float32\n\nimport CloudMicrophysics.Microphysics2M as CM2\nimport CloudMicrophysics.Parameters as CMP\n\nnothing #hide\n\nWe grab the parameters needed by the accretion function from the parameters module and define the example input values. Note that both the free parameters and the input values are of the same floating point type. All values are defined in base SI units.\n\nconst SB2006 = CMP.SB2006(FT)\nqₗ = FT(1e-3)  # Cloud liquid water specific content\nqᵣ = FT(5e-4)  # Rain water specific content\nρₐ = FT(1)     # Air density\nNₗ = FT(1e8)   # Cloud droplet number concentration\n\nnothing #hide\n\nFinally, we call accretion, which will return the accretion rates for cloud and rain water specific contents, as well as cloud and rain water number concentrations.\n\n(; dq_rai_dt, dq_lcl_dt, dN_rai_dt, dN_lcl_dt) =\n    CM2.accretion(SB2006, qₗ, qᵣ, ρₐ, Nₗ)\n@info(\"Accretion rates: \", dq_rai_dt, dq_lcl_dt, dN_rai_dt, dN_lcl_dt)\n\n\n\nThis page was generated using Literate.jl.","category":"section"},{"location":"AerosolNucleation/#Aerosol-Nucleation","page":"Aerosol Nucleation","title":"Aerosol Nucleation","text":"Homogeneous aerosol nucleation describes the formation of aerosol particles from trace gases. The process occurs when the collisions and clustering   of individual trace gas molecules outpace the cluster evaporation rate. It typically involves sulfuric acid,   and is a significant source of ultrafine aerosol particles.\n\nThe Nucleation.jl module contains parameterizations of different nucleation paths:\n\nbinary sulfuric acid - water nucleation, from [53],\nternary sulfuric acid - water - ammonia nucleation, from [53],\npure organic nucleation, from [54],\norganic with sulfuric acid nucleation, from [55].\n\nThe parameterizations are based on the CLOUD   experiments at CERN and return nucleation rates for 1.7nm particles\n\nnote: Note\nIn the below documentation we show the rates as described in the original papers  with concentrations in units of cm^-3 (or additionally normalized by reference concentrations)  and the nucleation rates in units of cm^-3 s^-1.  Our actual implementation uses only base SI units.\n\nnote: Note\nOne of the highlights of CLOUD measurements is the incorporation of ion-induced nucleation.  We can assume ion concentration is a prescribed function of height,  but we still need to learn what would make a good prescribed profile.","category":"section"},{"location":"AerosolNucleation/#Binary-and-ternary-sulfuric-acid-nucleation","page":"Aerosol Nucleation","title":"Binary and ternary sulfuric acid nucleation","text":"This is an implementation of [53], see Appendix sections 8-10 for details. J_H_2SO_4 is the binary H_2SO_4-H_2O nucleation rate     and J_H_2SO_4NH_3 is the ternary H_2SO_4-NH_3-H_2O nucleation rate:\n\nJ_H_2SO_4 =\n    k_bn(T)  H_2SO_4^p_bn\n    +\n    k_bi(T)  H_2SO_4^p_bi  n_-\n\nJ_H_2SO_4NH_3 =\n    k_tn(T)  f(H_2SO_4NH_3)  H_2SO_4^p_tn\n    +\n    k_ti(T)  f(H_2SO_4NH_3)  H_2SO_4^p_ti  n_-\n\nwhere:\n\ncdot denotes the concentration,\nk_xy is an empirical function of temperature T,\nf_y is an empirical function of H_2SO_4 and NH_3.\n\nln  k_xy(T) = u_xy - expleft(v_xyleftfracT1000-w_xyrightright)\n\nf_y(H_2SO_4NH_3) = fracNH_3a_y + fracH_2SO_4^p_tyNH_3^p_Ay\n\nThe values of free parameters p, u, v, w, and a are defined in [53].","category":"section"},{"location":"AerosolNucleation/#Example-plots","page":"Aerosol Nucleation","title":"Example plots","text":"Below figure reproduces results from [53] without negative ion concentrations.\n\ninclude(\"plots/CLOUD_Nucleation_Plots.jl\")\n\n(Image: )\n\n[56] is a commonly used parameterization of binary H_2SO_4-H_2O nucleation. The parameterization is a fit to the theoretical nucleation rate   and includes the effects of relative humidity. Below we show a comparison between the Vehkamaki et al 2002 parameterization   and the Dunne et al 2016 parameterization for two relative humidities.\n\ninclude(\"plots/compare_vehkamaki_CLOUD_nucleation.jl\")\n\n(Image: ) (Image: )","category":"section"},{"location":"AerosolNucleation/#Pure-organic-nucleation","page":"Aerosol Nucleation","title":"Pure organic nucleation","text":"Pure organic nucleation is parameterized based on [54]. The J_org is the organic nucleation rate given by:\n\nJ_org =\n    J_norg + J_iorg =\n    a_1  HOM^a_2 + a_5HOM\n    +\n    a_3  HOM^a_4 + a_5HOM  n_pm\n\nwhere:\n\nHOM is the concentration of highly oxygenated organic molecules from monoterpene (MT) oxidation,\nn_pmis the ion concentration.\n\nThe HOM is parameterized as:\n\nHOM =\n    fracY_MTO_3  k_MTO_3  MT  O_3\n    +\n    Y_MTOH  k_MTOH  MT  OH \n    CS\n\nwhere:\n\nY_MTO_3, Y_MTOH are the HOM yields from MT oxidation with O_3 and OH radicals in the CLOUD chamber respectively,\nMT is the monoterpene concentration,\nCS is the condensation sink (s^-1).\n\nThe k_MTO_3 k_MTOH are functions of temperature T given by:\n\nk_MTO_3 = 805  10^-16  exp(444T)\n\nk_MTOH = 12  10^-11  exp(444T)","category":"section"},{"location":"AerosolNucleation/#Example-plots-2","page":"Aerosol Nucleation","title":"Example plots","text":"include(\"plots/Kirkby_organic_nucleation_plots.jl\")\n\n(Image: )","category":"section"},{"location":"AerosolNucleation/#Nucleation-of-organics-with-sulfuric-acid","page":"Aerosol Nucleation","title":"Nucleation of organics with sulfuric acid","text":"This parameterization is given by [55]. The nucleation rate J_H_2SO_4org is given by:\n\nJ_H_2SO_4org= 05  k_H_2SO_4org  H_2SO_4^2  BioOxOrg\n\nwhere:\n\n[H2SO4] is the sulfuric acid concentration,\n[BioOxOrg] is the concentration of highly oxygenated organic molecules.\n\nBioOxOrg is a proxy for HOM, but represents a different group of compounds from HOM,   due to different measurement techniques. An empirical derivation is given by:\n\nBioOxOrg = frack_MTOH  MT  OHCS","category":"section"},{"location":"AerosolNucleation/#Example-plots-3","page":"Aerosol Nucleation","title":"Example plots","text":"Below is a plot reproducing the results from [55], with a constant H_2SO_4 concentration of `2.6e6 cm\\^{-3}.\n\ninclude(\"plots/Riccobono_mixed_nucleation_plots.jl\")\n\n(Image: )","category":"section"},{"location":"AerosolNucleation/#Apparent-nucleation-rate","page":"Aerosol Nucleation","title":"Apparent nucleation rate","text":"It can happen that the parameterized nucleation rate is   defined for aerosol particles that are too small to be represented in an aerosol module. The apparent nucleation rate parameterization takes into account the   growth rate due to condensation, and sink terms to coagulation   and outputs the nucleation rate at a larger aerosol particle size. The parameterization is based on [57].\n\nThe apparent nucleation rate J_x at diameter d_x is given by:\n\nJ_x = J_1  expleft(-gamma  d_1  fracCG(d_1)GRright)\n\nwhere:\n\nJ_1 is the nucleation rate at diameter d_1,\nCG(d_1) is the coagulation rate at diameter d_1,\nGR is the growth rate by condensation.\n\nThe parameter gamma is parameterized as:\n\ngamma = frac1m + 1  leftleft(fracd_xd_1right)^(m + 1) - 1right\n\nwhere:\n\nm can be prescribed as a constant value between -1.5 and -1.9 or computed as\n\nm = fraclog(CG(d_x)  CG(d_1))(log(d_x  d_1)","category":"section"},{"location":"AerosolNucleation/#Example-plots-4","page":"Aerosol Nucleation","title":"Example plots","text":"include(\"plots/lehtinen_apparent_nucleation_rate.jl\")\n\n(Image: )","category":"section"},{"location":"IceNucleationParcel0D/#0-dimensional-adiabatic-parcel-model","page":"Adiabatic parcel model","title":"0-dimensional adiabatic parcel model","text":"The model solves for saturation ratio in a 0-dimensional   adiabatic parcel raising with constant velocity. It is based on [40], as well as the cirrus box model   [60], [61] and   is meant as a sandbox for testing different nucleation schemes.\n\nWe define liquid saturation ratio S_l\n\nbeginequation\nS_l = fracee_sl\nendequation\n\nwhere:\n\ne - is the partial pressure of water vapor,\ne_sl - is the partial pressure of water vapor at saturation over liquid water.\n\nNote that some models, for example [40], denote S_l   to be supersaturation fracee_sl - 1.\n\nThe change in saturation ratio can be described as\n\nbeginequation\nfracdS_ldt = frac1e_sl fracdedt - fracee_sl^2 fracde_sldt\nendequation\n\nFrom ideal gas law the partial pressure of water vapor can be written as\n\nbeginequation\ne = q_v p fracR_vR_a\nendequation\n\nwhere:\n\nq_v is the specific humidity\np is the air pressure\nR_v, R_a are the gas constants for water vapor and air.\n\nThe change in partial pressure can be written as\n\nbeginequation\nfracdedt = fracdq_vdt p fracR_vR_a + q_v fracdpdtfracR_vR_a\nendequation\n\nFrom the Clausius–Clapeyron relation\n\nbeginequation\nfracde_sldt = fracL_v e_slR_v T^2 fracdTdt\nendequation\n\nwhere:\n\nL_v is the latent heat of vaporization,\nT is the temperature.\n\nFrom the moist adiabatic assumption\n\nbeginequation\nfracdTdt = fracR_a Tc_p p fracdpdt + fracL_vc_p fracdq_lvapdt + fracL_sc_p fracd q_isubldt + fracL_fc_p fracd q_ifusdt\nendequation\n\nwhere:\n\nq_lvap is the cloud liquid water specific content from vaporization/condensation,\nq_isubl is the cloud ice specific content from sublimation/deposition,\nq_ifus is the cloud ice specific content from melting/freezing,\nL_s is the latent heat of sublimation,\nL_f is the latent heat of fusion.\n\nFrom hydrostatic balance and assuming constant vertical velocity:\n\nbeginequation\nfracdpdt = -fracp gR_a T w\nendequation\n\nwhere:\n\ng is the gravitational acceleration\nw is the constant vertical velocity.\n\nAccounting for conservation of water, i.e. fracdq_vdt = - fracdq_lvapdt - fracdq_isubldt, and rearranging the terms\n\nbeginequation\nfracdS_ldt = a_1 w S_l - left(a_2 + a_3 right)S_l  fracdq_lvapdt - left(a_2 + a_4 right) S_l fracdq_isubldt - a_5 S_l fracdq_ifusdt\nendequation\n\nwhere:\n\nbeginequation\na_1 = fracL_v gc_p T^2 R_v - fracgR_a T\nendequation\n\nbeginequation\na_2 = frac1q_v\nendequation\n\nbeginequation\na_3 = fracL_v^2R_v T^2 c_p\nendequation\n\nbeginequation\na_4 = fracL_v L_sR_v T^2 c_p\nendequation\n\nbeginequation\na_5 = fracL_v L_fR_v T^2 c_p\nendequation\n\nSaturation ratio over ice can then be related to S_l by the relation\n\nbeginequation\n  S_i = xi S_l\n  labeleqsupersat_relation\nendequation\n\nwhere xi = frace_sle_si is the ratio of saturation vapor pressure over liquid and saturation vapor pressure over ice.\n\nThe crux of the problem is modeling the fracdq_ldt and fracdq_idt   for different homogeneous and heterogeneous ice nucleation paths.","category":"section"},{"location":"IceNucleationParcel0D/#Supported-size-distributions","page":"Adiabatic parcel model","title":"Supported size distributions","text":"Currently, the parcel model supports monodisperse and gamma size distributions of cloud droplets and ice crystals, and solves prognostic equations for the cloud water and cloud ice specific contents (q_l, q_i) and number concentrations (N_l, N_i). Additionally, a monodisperseMix option is now supported for cloud liquid droplets. This allows representing the droplet population as a mixture of two monodisperse modes: one corresponding to an initial set of preexisting droplets, and the other representing droplets formed through activation during the simulation. This feature enables more realistic treatment of scenarios involving preexisting hydrometeors.\n\nFor a monodisperse size distribution of cloud droplets or ice crystals\n\nbeginequation\n  n(r) = N delta(r-barr)\nendequation\n\nand assuming spherical shape, the mean radius is defined as\n\nbeginequation\n  barr = left( frac3 rho_a q4 pi rho N right)^13\nendequation\n\nwhere:\n\nrho_a is the air density,\nrho  is the cloud water or cloud ice density.\n\nFor a gamma distribution of cloud droplets\n\nbeginequation\n  n(r) = N_0  r  exp(-lambda r)\nendequation\n\nwhere:\n\nlambda and N_0 are the free parameters.\n\nbeginequation\n  N = int_0^infty  n(r)  dr \n  q = frac1rho_aint_0^infty  frac43 pi rho r^3 n(r)  dr\nendequation\n\nAs a result\n\nbeginequation\n  lambda = left(frac32 pi N rhoq rho_aright)^13 \n  N_0 = N lambda^2\nendequation","category":"section"},{"location":"IceNucleationParcel0D/#Supported-source-terms","page":"Adiabatic parcel model","title":"Supported source terms","text":"","category":"section"},{"location":"IceNucleationParcel0D/#Aerosol-Activation","page":"Adiabatic parcel model","title":"Aerosol Activation","text":"Aerosol activation is described by (see discussion). It is inherently assumed that the aerosols have a lognormal size distribution. For simplicity, the parcel accepts one mode and one aerosol type at a time, therefore, internal mixing is not needed. The maxiumum supersaturation as described in the above mentioned documentation is replaced by the liquid supersaturation in the parcel as it evolves over time.\n\nnote: Note\nThe standard deviation and r_textmean of the aerosol size distribution represent the initial (pre-activation) aerosol population and are assumed to remain fixed throughout the simulation. They do not evolve as aerosols activate.","category":"section"},{"location":"IceNucleationParcel0D/#Condensation-growth","page":"Adiabatic parcel model","title":"Condensation growth","text":"There are both equilibrium and non-equilibrium options for condensation. The non-equilibrium equations are described in the non-equilibrium documentation (here).\n\nFor the equilibrium formulation, the diffusional growth of individual cloud droplet is described by (see discussion),\n\nbeginequation\n  r_l fracdr_ldt = frac1rho_l  (S_l - 1)  G_l(T)\nendequation\n\nwhere:\n\nr_l is the droplet radius\nrho_l is the water density\nG_l(T) = left(fracL_vKT left(fracL_vR_v T - 1 right) + fracR_v Te_sl D right)^-1   combines the effects of thermal conductivity and water diffusivity,\nK is the thermal conductivity of air,\nD is the diffusivity of water vapor.\n\nnote: Note\nSome formulations don't consider the -1 term in the denominator of G(T)\n\nAssuming spherical water droplets, the change in droplet mass m_l can be described as\n\nbeginequation\n  fracdm_ldt = 4 pi rho_l r^2 fracdr_ldt = 4 pi r_l (S_l - 1) G_l(T)\nendequation\n\nIntegrating over the assumed size distribution of droplets\n\nbeginequation\n   fracdq_ldt = frac1V frac1rho_a 4 pi (S_l - 1) G_l(T) int_0^infty n(r) r dr =\n                                 frac1rho_a 4 pi (S_l - 1) G_l(T) N_tot barr\nendequation\n\nwhere:\n\nN_tot is the total number concentration of droplets per volume of air V\nbarr is their mean radius\nrho_a is the density of air.","category":"section"},{"location":"IceNucleationParcel0D/#Deposition-growth","page":"Adiabatic parcel model","title":"Deposition growth","text":"Again, there are both equilibrium and non-equilibrium options for deposition. The non-equilibrium equations are described in the non-equilibrium documentation (here).\n\nFor the equilibrium formulation, we use a similar process as with condensation. For a case of a spherical ice particle growing through water vapor deposition\n\nbeginequation\n  fracdm_idt = 4 pi  r_i  alpha_m  (S_i - 1)  G_i(T)\n  labeleqmassratesphere\nendequation\n\nwhere:\n\nr_i is the ice particle radius,\nalpha_m is the accommodation coefficient that takes into account the fact that not all water vapor molecules   that arrive at the particle surface will join the growing crystal,\nG_i(T) = left(fracL_sKT left(fracL_sR_v T - 1 right) + fracR_v Te_si D right)^-1   combines the effects of thermal conductivity and water diffusivity,\n\nnote: Note\nThe r_i in eq. (\\ref{eq:massratesphere}) should be replaced by the capacitance C, when considering non-spherical particles. For a sphere C=r, for a circular disc C=2rpi.\n\nIt follows that\n\nbeginequation\n  fracdq_idt = frac1rho_a alpha_m 4 pi (S_i - 1) G_i(T) N_act barr\nendequation\n\nwhere:\n\nN_act is the number of activated ice particles.","category":"section"},{"location":"IceNucleationParcel0D/#Deposition-Nucleation-on-dust-particles","page":"Adiabatic parcel model","title":"Deposition Nucleation on dust particles","text":"There are multiple ways of running deposition nucleation in the parcel.   \"MohlerAF_Deposition\" will trigger an activated fraction approach   from [45]. \"MohlerRate_Deposition\" will trigger a   nucleation rate approach from [45]. For both approaches,   there is no nucleation if saturation over ice exceeds 1.35 as conditions   above this value will result in nucleation in a different mode.   \"ActivityBasedDeposition\" will trigger a water activity based approach   from [47]. In this approach, ice production rate P_ice depo   is calculated from\n\nbeginequation\n  P_ice depo = left fracdN_idt right_depo = J_depoA_aeroN_aero\n  labeleqActivityBasedDeposition_P_ice\nendequation\n\nwhere N_areo is total number of unactiviated ice nucleating particles and   A_aero is surface area of those INP. The deposition nucleation methods are parameterized as described in   Ice Nucleation.","category":"section"},{"location":"IceNucleationParcel0D/#Immersion-Freezing","page":"Adiabatic parcel model","title":"Immersion Freezing","text":"Following the water activity based immersion freezing model (ABIFM), the ABIFM derived   nucleation rate coefficient, J_immer, can be determined. The ice production rate,P_ice immer,   per second via immersion freezing can then be calculating using\n\nbeginequation\n  P_ice immer = left fracdN_idt right_immer = J_immerA_aero(N_lcl)\n  labeleqABIFM_P_ice\nendequation\n\nwhere N_lcl is total number of ice nuclei containing droplets and   A_aero is surface area of the ice nucleating particle.","category":"section"},{"location":"IceNucleationParcel0D/#Homogeneous-Freezing","page":"Adiabatic parcel model","title":"Homogeneous Freezing","text":"Homogeneous freezing follows the water-activity based model described in the   Ice Nucleation section which gives a nucleation rate coefficient of   units cm^-3s^-1. The ice production rate from homogeneous freezing can then be determined:\n\nbeginequation\n  P_ice hom = left fracdN_idt right_hom = J_homV(N_lcl)\n  labeleqhom_P_ice\nendequation\n\nwhere N_lcl is total number of ice nuclei containing droplets and   V is the volume of those droplets.","category":"section"},{"location":"IceNucleationParcel0D/#P3-Ice-Nucleation-Parameterizations","page":"Adiabatic parcel model","title":"P3 Ice Nucleation Parameterizations","text":"The parcel also includes ice nucleation parameterizations used in   the P3 scheme as described in [23].   Deposition nucleation is based on the ice crystal number parameterization   from Cooper (1986). The heterogeneous freezing parameterization, which   follows Bigg(1953) with parameters from Barklie aand Gokhale (1959), is   treated as immersion freezing in the parcel. Homogeneous freezing happens   instantaneously at 233.15K.","category":"section"},{"location":"IceNucleationParcel0D/#Frostenberg-et-al.-2023-Immersion-Freezing","page":"Adiabatic parcel model","title":"Frostenberg et al. 2023 Immersion Freezing","text":"An immersion freezing parameterization based on [36] is also available. The concentration of ice nucleating particles (INPC) depends only on air temperature,   and is based on a lognormal relative frequency distribution. New ice crystals are created if the INPC exceeds the existing concentration of ice crystals,   provided there are sufficient numbers of cloud liquid droplets to freeze.\n\nThree different implementations of this parametrization are used in the parcel model:\n\nmean - in which INPC is equal to its mean value defined in [36].\nrandom - in which INPC is sampled randomly from the distribution defined in [36]. The number of model time steps between sampling is set by sampling_interval.\nstochastic - in which INPC is solved for as a stochastic process, with the mean and standard deviation defined in [36]. The inverse timescale of the process is set by gamma.\n\nThe stochastic implementation is based on the Ornstein-Uhlenbeck process, in which the variable x is a mean-reverting process perturbed by Gaussian random noise (i.e. increments of the Wiener process W):\n\nbeginequation\n  dx = - gamma(x - mu)dt + sqrt2gamma sigma dW quadquad   dW sim N(0 dt)\nendequation\n\nwhere N is a zero-mean normal distribution with variance dt. For constant gamma and sigma, and given some initial condition x(0)=x_0, x has the analytical solution:\n\nbeginequation\n  x(t) =\n      x_0 e^-gamma t + mu (1 - e^-gamma t)\n    + sqrt2gamma sigma int_0^t e^-gamma(t-s) dW\nendequation\n\nwhere tau equiv 1  gamma is the assumed timescale of the process. The process mean is x_0 e^-gamma t + mu (1 - e^-gamma t). We can calculate the variance mathbbV(t) as,\n\nbeginequation\n  mathbbV(t)\n  = 2gamma sigma^2 int_0^t e^-2gamma(t-s) ds\n  = fracg^22gamma left( 1 - e^-2gamma t right)\nendequation\n\nWe use this process to model x=log(textINPC), which tends toward a temperature-dependent mean value mu(T). The equation for log(textINPC) is then,\n\nbeginequation\n  dlog(textINPC) =\n    - fraclog(textINPC) - μtau dt\n    + sigma sqrtfrac2tau dW\nendequation\n\nThis equation is currently implemented with the simple Euler-Maruyama method, which is the stochastic analog of the forward Euler method for (deterministic) ordinary differential equations, so that\n\nbeginequation\n  log(textINPC)_t+dt = log(textINPC)_t\n    - gammaleft(log(textINPC)_t - μ(T_t)right) dt\n    + sigma sqrt2gamma dt z_t\nendequation\n\nwhere z_t sim N(01) is a standard normal random variable.","category":"section"},{"location":"IceNucleationParcel0D/#Example-figures","page":"Adiabatic parcel model","title":"Example figures","text":"Here we show various example simulation results from the adiabatic parcel   model. This includes examples with deposition nucleation on dust,   liquid processes only, immersion freezing with condensation and deposition growth,   and homogeneous freezing with deposition growth.\n\nFirst, we check that aerosol activation works reasonably within the parcel.\n\n    include(\"../../parcel/Example_AerosolActivation.jl\")\n\n(Image: )\n\nThe following examples show ice nucleation, starting with deposition   freezing on dust. The model is run three times using the \"MohlerAF_Deposition\" approach   for 30 minutes simulation time, (shown by three different colors on the plot). Between each run the specific humidity is changed,   while keeping all other state variables the same as at the last time step   of the previous run. The prescribed vertical velocity is equal to 3.5 cm/s.\n\nSupersaturation is plotted for both liquid (solid lines) and ice (dashed lines). The pale blue line uses the \"MohlerRate_Deposition\" approach.   We only run it for the first GCM timestep because the rate approach requires   the change in ice saturation over time. With the discontinuous jump in saturation,   the parameterization is unable to determine a proper nucleation rate. When we force   the initial ice crystal number concentration for this simulation to match   that in the \"MohlerAF_Deposition\" approach, we obtain the same results as   in the \"MohlerAF_Deposition\" approach for the first GCM timestep.\n\nusing Suppressor: @suppress #hide\n  @suppress begin #hide\n     include(\"../../parcel/Example_Tully_et_al_2023.jl\")\nend # hide\n\n(Image: )\n\nThe water activity based parameterization for deposition nucleation shows   similar outcomes when compared to the \"MohlerRate_Deposition\" approach.   Here, we run the parcel for 100 secs for all available aerosol types. The   solid lines correspond to the \"MohlerRate_Deposition\" approach while the   dashed lines correspond to \"ActivityBasedDeposition\". Note that there   is no common aerosol type between the two parameterizations.\n\n  include(\"../../parcel/Example_Deposition_Nucleation.jl\")\n\n(Image: )\n\nIn the plots below, the parcel model is ran with only condensation (no ice or freezing)   assuming either a monodisperse or a gamma distribution of droplets. It is compared to [62]. This is to ensure the parcel can run with liquid phase and different size distributions without issues.\n\n  include(\"../../parcel/Example_Liquid_only.jl\")\n\n(Image: )\n\nThe following plots show the parcel model running with homogeneous freezing and   depositional growth assuming a lognormal distribution of aerosols.   It is compared against [63]. Note that running with the initial   conditions described in [63] results in a Delta a_w smaller   than the minimum valid value for the J_hom parameterization. We have forced   the Delta a_w to be equal to the minimum valid value in this example only   for demonstrative purposes.\n\n  include(\"../../parcel/Example_Jensen_et_al_2022.jl\")\n\n(Image: )\n\nShown below are three separate parcel simulations for deposition nucleation,   immersion freezing, and homogeneous freezing as parameterized in the P3 scheme.   Note that initial temperature varies for each run. The deposition nucleation   run does not conserve INP number, while the other two freezing modes do.   Updraft velocity is set to 0.5 m/s.\n\n  include(\"../../parcel/Example_P3_ice_nuc.jl\")\n\n(Image: )\n\nThe results of the immersion freezing parameterization from Frostenberg et al. 2023 are shown below. The following plot shows resuls of the parcel model with the mean (black line), random (dotted lines) and stochastic (solid lines) parameterization options. We show results for two sampling intervals Delta t (random), two process time scales tau (stochastic), and two model time steps dt.\n\n  include(\"../../parcel/Example_Frostenberg_Immersion_Freezing.jl\")\n\n(Image: )\n\nBelow, we show how the non-equilibrium formulation is able to represent the Wegener-Bergeron-Findeisen (WBF) regime in the parcel model. These plots show the liquid supersaturation, ice supersaturation, temperature, specific humidity q_{vap}, specific content of cloud liquid q_{lcl}, and specific content of cloud ice q_{icl} over time. When the supersaturation is negative evaporation/sublimation occurs, and when it is positive condensation/deposition occurs. In the example below, the water vapor pressure is smaller than the saturation water vapor pressure of liquid but larger than that of ice, and as a result liquid water evaporates while ice grows.\n\n  include(\"../../parcel/Example_NonEq.jl\")\n\n(Image: )","category":"section"},{"location":"Glossary/#1-moment-scheme","page":"Glossary","title":"1-moment scheme","text":"A scheme that predicts one moment of the particle size distribution (PSD). Typically it's the 3rd moment of PSD. The scheme's prognostic variable is the specific content (mass fraction)   of water in each category, which is proportional to the 3rd moment of PSD.","category":"section"},{"location":"Glossary/#2-moment-scheme","page":"Glossary","title":"2-moment scheme","text":"A scheme that predicts two moments of the particle size distribution (PSD). Typically those are the 3rd and the 0th moments of PSD. The scheme's prognostic variables are the specific content (mass fraction)   and number concentration of particles in each category,   which are proportional to the 3rd and 0th moment of (PSD)","category":"section"},{"location":"Glossary/#Aerosol-activation-scheme","page":"Glossary","title":"Aerosol activation scheme","text":"Aerosol particles serve as condensation nuclei for forming cloud droplets. An aerosol activation scheme predicts the number concentrations   of newly formed cloud droplets for a given population of aerosol particles. The scheme is needed when using 2-moment microphysics.","category":"section"},{"location":"Glossary/#Ice-nucleation-scheme","page":"Glossary","title":"Ice nucleation scheme","text":"Aerosol particles and cloud droplets serve as nuclei for forming ice crystals. The pathways include water vapor deposition on dust, heterogeneous and   homogeneous freezing of water droplets. Ice nucleation schemes are needed to predict the number concentrations   of newly formed ice crystals. The schemes are needed when using 2-moment microphysics scheme.","category":"section"},{"location":"MicrophysicsNonEq/#Microphysics-NonEquilibrium","page":"Non-equilibrium cloud formation","title":"Microphysics NonEquilibrium","text":"The MicrophysicsNonEq.jl module describes a bulk parameterization of   diffusion of water vapor on cloud droplets and cloud ice crystals   modeled as a relaxation to equilibrium.\n\nThe cloud microphysics variables are expressed as specific contents:\n\nq_tot - total water specific content,\nq_vap - water vapor specific content (i.e., specific humidity),\nq_lcl - cloud water specific content,\nq_icl - cloud ice specific content,\n\nParameters used in the parameterization are defined in   ClimaParams.jl package. They consist of:\n\nsymbol definition units default value\ntau_l cloud water condensation/evaporation timescale s 10\ntau_i cloud ice deposition/sublimation timescale s 10","category":"section"},{"location":"MicrophysicsNonEq/#Simple-condensation/evaporation-and-deposition/sublimation","page":"Non-equilibrium cloud formation","title":"Simple condensation/evaporation and deposition/sublimation","text":"Condensation/evaporation of cloud liquid water and deposition/sublimation of cloud ice are parameterized   as a relaxation to equilibrium value at the current time step. The equilibrium value is obtained based on a prescribed phase partition function   that divides the available excess water vapor between liquid and ice   (based on temperature).\n\nbeginequation\n  left fracd  q_lcldt right_cond evap = fracq^eq_lcl - q_lcltau_l \n  left fracd  q_icldt right_dep sub   = fracq^eq_icl - q_icltau_i\nendequation\n\nwhere:\n\nq^eq_lcl q^eq_icl - liquid and ice water specific content in equilibrium at current temperature and assuming some phase partition function based on temperature\nq_lcl q_icl - current liquid water and ice specific content,\ntau_l tau_i - relaxation timescales.\n\nnote: Note\nBoth tau_l and tau_i are assumed to be constant. It would be great to make the relaxation time a function of available condensation nuclei, turbulence intensity, etc. See works by prof Raymond Shaw for hints. In particular, [34].","category":"section"},{"location":"MicrophysicsNonEq/#Condensation/evaporation-and-deposition/sublimation-from-Morrison-and-Milbrandt-2015","page":"Non-equilibrium cloud formation","title":"Condensation/evaporation and deposition/sublimation from Morrison and Milbrandt 2015","text":"Condensation/evaporation and deposition/sublimation rates are based on   the difference between the specific humidity and the   specific humidity at saturation over liquid and ice at the current temperature. The process is modeled as a relaxation with a constant timescale. This formulation is derived from [35]   and [23], but without imposing exponential time integrators.\n\nnote: Note\nThe [35] and [23] papers use mass mixing ratios, not specific contents. Additionally, in their formulations they consider two different categories for liquid: cloud water and rain. For now we only consider cloud water and use a single relaxation timescale tau_l (liquid) rather than separate tau_c (cloud) and tau_r (rain) values.\n\nbeginequation\n   left fracd  q_lcldt right_cond evap = fracq_vap - q_sltau_l Gamma_l \n   left fracd  q_icldt right_dep sub   = fracq_vap - q_sitau_i Gamma_i\nendequation\n\nwhere:\n\nq_vap is the specific humidity\nq_sl, q_si is the specific humidity at saturation over liquid and ice\ntau_l, tau_i is the liquid and ice relaxation timescale\nGamma_l, Gamma_i is a psychometric correction due to latent heating/cooling:\n\nbeginequation\n    Gamma_l = 1 + fracL_vc_p fracdq_sldT \n    Gamma_i = 1 + fracL_sc_p fracdq_sidT\nendequation\n\nbeginequation\n    fracdq_sldT = q_sl left(fracL_vR_v  T^2 - frac1T right) \n    fracdq_sidT = q_si left(fracL_sR_v  T^2 - frac1T right)\nendequation\n\nwhere:\n\nT is the temperature,\nc_p is the specific heat of air at constant pressure,\nR_v is the gas constant of water vapor,\nL_v and L_s is the latent heat of vaporization and sublimation.\n\nNote that these forms of condensation/sublimation and deposition/sublimation   are equivalent to those described in the adiabatic parcel model with some rearrangements and assumptions. To see this, it is necessary to use the definitions of tau, q_sl, and the thermal diffusivity D_v:\n\nbeginequation\n  tau = left( 4 pi N_tot barr right)^-1 \n  q_sl = frace_slrho R_v T \n  D_v = fracKrho c_p\nendequation\n\nIf we then assume that the supersaturation S can be approximated by the specific contents (this is only exactly true for mass mixing ratios):\n\nbeginequation\n    S_l = fracq_vapq_sl\nendequation\n\nwe can write\n\nbeginequation\n  q_vap - q_sl = q_sl(S_l - 1)\nendequation\n\nGamma_l and Gamma_i then are equivalent to the G function used in our parcel model and parameterizations.\n\ninclude(\"plots/NonEqCondEvapRate.jl\")\n\n(Image: )","category":"section"},{"location":"MicrophysicsNonEq/#Deposition/sublimation-from-Morrison-and-Milbrandt-2015-and-Frostenberg-2023","page":"Non-equilibrium cloud formation","title":"Deposition/sublimation from Morrison and Milbrandt 2015 and Frostenberg 2023","text":"We offer an alternative to the deposition/sublimation rates from [35] and [23] that calculates the ice relaxation timescale as a function of temperature. Specifically, we approximate the concentration of ice cloud droplets as equal to the mean amount of ice nucleating particles for a given temperature using [36].\n\nbeginequation\ntau_i = A left( 4 pi D_v N_i(T) barr_i right)^-1\nendequation\n\nFor some constant A and the ice number concentration from temperature, N_i(T) from [36]:\n\nN_i(T) = ln(-(b cdot T)^9 times 10^-9)\n\nsigma^2 is the variance, a and b are coefficients. The parameters defined in [36] for marine data sets are sigma=137, a=1 m^3, b=1/C.\n\nWe approximate the average radius of ice cloud droplets from the mass, number concentration, and ice density:\n\nbeginequation\nbarr_i = left( frac3q_i4 π N_i(T) rho_i right)^13 \nendequation\n\nHere we show an example of how tau_i changes with temperature for a set q_icl=1e-6:\n\ninclude(\"plots/NonEqFrostenberg.jl\")\n\n(Image: )","category":"section"},{"location":"MicrophysicsNonEq/#Cloud-condensate-sedimentation","page":"Non-equilibrium cloud formation","title":"Cloud condensate sedimentation","text":"We use the Chen et al. [12] parameterization for cloud liquid and cloud ice sedimentation velocities. In the 1-moment precipitation scheme, we assume that cloud condensate is a continuous field   and doesn't introduce an explicit particle size distribution. For simplicity, we assume a monodisperse size distribution   and compute the group terminal velocity based on the volume radius   and prescribed number concentration:\n\nbeginequation\n  D_vol = fracrho_air qN rho\nendequation\n\nwhere:\n\nrho_air is the air density,\nq is the cloud liquid or cloud ice specific content,\nN is the prescribed number concentration (500cm^3 by default),\nrho is the cloud water or cloud ice density.\n\nThe sedimentation velocity then is\n\nbeginequation\n  v_t = v_term(D_vol)\nendequation\n\nnote: Note\nWe are using the B1 coefficients from Chen et al. [12] to compute the cloud condensate velocities. They were fitted for larger particle sizes. To mitigate the resulting errors, we multiply by a correction factor. We should instead find a parameterization that was designed for the cloud droplet size range.","category":"section"},{"location":"References/#References","page":"References","title":"References","text":"E. Kessler. On the continuity and distribution of water substance in atmospheric circulations. Atmospheric research 38, 109–145 (1995).\n\n\n\nW. W. Grabowski. Toward cloud resolving modeling of large-scale tropical circulations: A simple cloud microphysics parameterization. Journal of the Atmospheric Sciences 55, 3283–3298 (1998).\n\n\n\nC. M. Kaul, J. Teixeira and K. Suzuki. Sensitivities in large-eddy simulations of mixed-phase Arctic stratocumulus clouds using a simple microphysics approach. Monthly Weather Review 143, 4393–4421 (2015).\n\n\n\nJ. S. Marshall and W. Palmer. The distribution of raindrops with size. Journal of meteorology 5, 165–166 (1948).\n\n\n\nW. W. Grabowski and P. K. Smolarkiewicz. Two-time-level semi-Lagrangian modeling of precipitating clouds. Monthly weather review 124, 487–497 (1996).\n\n\n\nJ. Y. Harrington, M. P. Meyers, R. L. Walko and W. R. Cotton. Parameterization of ice crystal conversion processes due to vapor deposition for mesoscale models using double-moment basis functions. Part I: Basic formulation and parcel model results. Journal of the atmospheric sciences 52, 4344–4366 (1995).\n\n\n\nS. A. Rutledge and P. V. Hobbs. The mesoscale and microscale structure and organization of clouds and precipitation in midlatitude cyclones. VIII: A model for the “seeder-feeder” process in warm-frontal rainbands. Journal of the Atmospheric Sciences 40, 1185–1206 (1983).\n\n\n\nS. A. Rutledge and P. V. Hobbs. The mesoscale and microscale structure and organization of clouds and precipitation in midlatitude cyclones. XII: A diagnostic modeling study of precipitation development in narrow cold-frontal rainbands. Journal of the Atmospheric Sciences 41, 2949–2972 (1984).\n\n\n\nH. Morrison and A. Gettelman. A new two-moment bulk stratiform cloud microphysics scheme in the Community Atmosphere Model, version 3 (CAM3). Part I: Description and numerical tests. Journal of Climate 21, 3642–3659 (2008).\n\n\n\nA. Seifert and K. D. Beheng. A two-moment cloud microphysics parameterization for mixed-phase clouds. Part 1: Model description. Meteorology and atmospheric physics 92, 45–66 (2006).\n\n\n\nY. Ogura and T. Takahashi. Numerical simulation of the life cycle of a thunderstorm cell. Mon. Wea. Rev 99, 895–911 (1971).\n\n\n\nJ.-P. Chen, T.-W. Hsieh, C.-Y. Lin and C.-K. Yu. Accurate parameterization of precipitation particles' fall speeds for bulk cloud microphysics schemes. Atmospheric Research 293 (2022).\n\n\n\nR. Wood. Drizzle in stratiform boundary layer clouds. Part II: Microphysical aspects. Journal of the atmospheric sciences 62, 3034–3050 (2005).\n\n\n\nB. J. Mason. Physics of clouds (Clarendon Press, 2010).\n\n\n\nL.-P. Wang, C. N. Franklin, O. Ayala and W. W. Grabowski. Probability distributions of angle of approach and relative velocity for colliding droplets in a turbulent flow. Journal of the atmospheric sciences 63, 881–900 (2006).\n\n\n\nH. Mizuno. Parameterization of the accretion process between different precipitation elements. Journal of the Meteorological Society of Japan. Ser. II 68, 395–398 (1990).\n\n\n\nM. Khairoutdinov and Y. Kogan. A New Cloud Physics Parameterization in a Large-Eddy Simulation Model of Marine Stratocumulus. Monthly Weather Review 128, 229–243 (2000).\n\n\n\nK. Beheng. A parameterization of warm cloud microphysical conversion processes. Atmospheric Research 33, 193–206 (1994).\n\n\n\nG. Tripoli and W. Cotton. A Numerical Investigation of Several Factors Contributing to the Observed Variable Intensity of Deep Convection over South Florida. Journal of Applied Meteorology and Climatology 19, 1037–1063 (1980).\n\n\n\nY. Liu and P. Daum. Parameterization of the Autoconversion Process.Part I: Analytical Formulation of the Kessler-Type Parameterizations. Journal of the Atmospheric Sciences 61, 1539–1548 (2004).\n\n\n\nU. Wacker and A. Seifert. Evolution of rain water profiles resulting from pure sedimentation: Spectral vs. parameterized description. Atmospheric Research 58, 19–39 (2001).\n\n\n\nS. Horn. ASAMgpu V1. 0–a moist fully compressible atmospheric model using graphics processing units (GPUs). Geoscientific Model Development Discussions 4, 2635–2660 (2011).\n\n\n\nH. Morrison and J. A. Milbrandt. Parameterization of Cloud Microphysics Based on the Prediction of Bulk Ice Particle Properties. Part I: Scheme Description and Idealized Tests. Journal of the Atmospheric Sciences 72, 287–311 (2015).\n\n\n\nP. R. Brown and P. N. Francis. Improved Measurements of the Ice Water Content in Cirrus Using a Total-Water Probe. Journal of Atmospheric and Oceanic Technology 12, 410–414 (1995).\n\n\n\nD. L. Mitchell. Use of mass- and area-dimensional power laws for determining precipitation particle terminal velocities. Journal of the Atmospheric Sciences 53, 1710–1723 (1996).\n\n\n\nA. J. Heymsfield. Properties of Tropical and Midlatitude Ice Cloud Particle Ensembles. Part II: Applications for Mesoscale and Climate Models. Journal of the Atmospheric Sciences 60, 2592–2611 (2003).\n\n\n\nH. Morrison and W. W. Grabowski. A Novel Approach for Representing Ice Microphysics in Models: Description and Tests Using a Kinematic Framework. Journal of the Atmospheric Sciences 65, 1528–1548 (2008).\n\n\n\nM. Cholette, H. Morrison, J. A. Milbrandt and J. M. Thériault. Parameterization of the Bulk Liquid Fraction on Mixed-Phase Particles in the Predicted Particle Properties (P3) Scheme: Description and Idealized Simulations. Journal of the Atmospheric Sciences 76, 561–582 (2019).\n\n\n\nD. L. Mitchell and A. J. Heymsfield. Refinements in the Treatment of Ice Particle Terminal Velocities, Highlighting Aggregates. Journal of the Atmospheric Sciences 62, 1637–1644 (2005).\n\n\n\nM. Simmel, T. Trautmann and G. Tetzlaff. Numerical solution of the stochastic collection equation—comparison of the Linear Discrete Method with other methods. Atmoshperic Research 61 (2002).\n\n\n\nD. J. Musil. Computer Modeling of Hailstone Growth in Feeder Clouds. Journal of the Atmospheric Sciences 27, 474–482 (1970).\n\n\n\nS. G. Cober and R. List. Measurements of the Heat and Mass Transfer Parameters Characterizing Conical Graupel Growth. Journal of the Atmospheric Sciences 50, 1591–1609 (1993).\n\n\n\nD. A. Knopf and P. A. Alpert. A water activity based model of heterogeneous ice nucleation kinetics for freezing of water and aqueous solution droplets. Faraday Discuss. 165, 513–534 (2013).\n\n\n\nN. Desai, K. Chandrakar, G. Kinney, W. Cantrell and R. Shaw. Aerosol-Mediated Glaciation of Mixed-Phase Clouds: Steady-State Laboratory Measurements. Geophysical Research Letters 46, 9154–9162 (2019).\n\n\n\nH. Morrison and W. W. Grabowski. Modeling Supersaturation and Subgrid-Scale Mixing with Two-Moment Bulk Warm Microphysics. Journal of the Atmospheric Sciences 65, 792–812 (2008).\n\n\n\nH. C. Frostenberg, A. Welti, M. Luhr, J. Savre, E. S. Thomson and L. Ickes. The chance of freezing – a conceptional study to parameterize temperature-dependent freezing by including randomness of ice-nucleating particle concentrations. Atmospheric Chemistry and Physics 23, 10883–10900 (2023).\n\n\n\nH. Abdul-Razzak, S. J. Ghan and C. Rivera-Carpio. A parameterization of aerosol activation: 1. Single aerosol type. Journal of Geophysical Research: Atmospheres 103, 6123–6131 (1998).\n\n\n\nH. Abdul-Razzak and S. J. Ghan. A parameterization of aerosol activation: 2. Multiple aerosol types. Journal of Geophysical Research: Atmospheres 105, 6837–6844 (2000).\n\n\n\nM. D. Petters and S. M. Kreidenweis. A single parameter representation of hygroscopic growth and cloud condensation nucleus activity. Atmospheric Chemistry and Physics 7, 1961–1971 (2007).\n\n\n\nA. V. Korolev and I. P. Mazin. Supersaturation of Water Vapor in Clouds. Journal of the Atmospheric Sciences 60, 2957–2974 (2003).\n\n\n\nM. Baumgartner, C. Rolf, J.-U. Grooß, J. Schneider, T. Schorr, O. Möhler, P. Spichtinger and M. Krämer. New investigations on homogeneous ice nucleation: the effects of water activity and water saturation formulations. Atmospheric Chemistry and Physics 22, 65–91 (2022).\n\n\n\nT. Koop, B. Luo, A. Tsias and T. Peter. Water activity as the determinant for homogeneous ice nucleation in aqueous solutions. Nature 406, 611–614 (2000).\n\n\n\nB. Luo, K. S. Carslaw, T. Peter and S. L. Clegg, vapour pressures of H2SO4/HNO3/HCl/HBr/H2O solutions to low stratospheric temperatures. Geophysical Research Letters 22, 247–250 (1995).\n\n\n\nT. Koop. The Water Activity of Aqueous Solutions in Equilibrium with Ice. Bulletin of the Chemical Society of Japan 75, 2587–2588 (2002).\n\n\n\nO. Möhler, P. R. Field, P. Connolly, S. Benz, H. Saathoff, M. Schnaiter, R. Wagner, R. Cotton, M. Krämer, A. Mangold and A. J. Heymsfield. Efficiency of the deposition mode ice nucleation on mineral dust particles. Atmospheric Chemistry and Physics 6, 3007–3021 (2006).\n\n\n\nS. China, P. A. Alpert, B. Zhang, S. Schum, K. Dzepina, K. Wright, R. C. Owen, P. Fialho, L. R. Mazzoleni, C. Mazzoleni and D. A. Knopf. Ice cloud formation potential by free tropospheric particles from long-range transport over the Northern Atlantic Ocean. Journal of Geophysical Research: Atmospheres 122, 3065–3079 (2017).\n\n\n\nP. A. Alpert, A. Boucly, S. Yang, H. Yang, K. Kilchhofer, Z. Luo, C. Padeste, S. Finizio, M. Ammann and B. Watts. Ice nucleation imaged with X-ray spectro-microscopy.  Environ. Sci.: Atmos. 2, 335–351 (2022).\n\n\n\nG. Thompson, R. M. Rasmussen and K. Manning. Explicit Forecasts of Winter Precipitation Using an Improved Bulk Microphysics Scheme. Part I: Description and Sensitivity Analysis. Monthly Weather Review 132, 519–542 (2004).\n\n\n\nS. Karthika, T. K. Radhakrishnan and P. Kalaichelvi. A Review of Classical and Nonclassical Nucleation Theories. Crystal Growth & Design 16, 6663–6681 (2016).\n\n\n\nE. Bigg. The supercooling of water. Proc. Phys. Soc. 66B, 688–694 (1953).\n\n\n\nR. H. Barklie and N. R. Gokhale. The freezing of supercooled wter drops. Alberta hal, 1958, and related studies. McGill University Stormy Weather Group Sci. Rep. MW-30, 43–64 (1959).\n\n\n\nP. Spichtinger, P. Marschalik and M. Baumgartner. Impact of formulations of the homogeneous nucleation rate on ice nucleation events in cirrus. Atmospheric Chemistry and Physics 23, 2035–2060 (2023).\n\n\n\nE. M. Dunne, H. Gordon, A. Kürten, J. Almeida, J. Duplissy, C. Williamson, I. K. Ortega, K. J. Pringle, A. Adamov, U. Baltensperger, P. Barmet, F. Benduhn, F. Bianchi, M. Breitenlechner, A. Clarke, J. Curtius, J. Dommen, N. M. Donahue, S. Ehrhart, R. C. Flagan, A. Franchin, R. Guida, J. Hakala, A. Hansel, M. Heinritzi, T. Jokinen, J. Kangasluoma, J. Kirkby, M. Kulmala, A. Kupc, M. J. Lawler, K. Lehtipalo, V. Makhmutov, G. Mann, S. Mathot, J. Merikanto, P. Miettinen, A. Nenes, A. Onnela, A. Rap, C. L. Reddington, F. Riccobono, N. A. Richards, M. P. Rissanen, L. Rondo, N. Sarnela, S. Schobesberger, K. Sengupta, M. Simon, M. Sipilä, J. N. Smith, Y. Stozkhov, A. Tomé, J. Tröstl, P. E. Wagner, D. Wimmer, P. M. Winkler, D. R. Worsnop and K. S. Carslaw. Global atmospheric particle formation from CERN CLOUD measurements. Science 354, 1119–1124 (2016).\n\n\n\nJ. Kirkby, J. Duplissy, K. Sengupta, C. Frege, H. Gordon, C. Williamson, M. Heinritzi, M. Simon, C. Yan, J. Almeida, J. Tröstl, T. Nieminen, I. K. Ortega, R. Wagner, A. Adamov, A. Amorim, A.-K. Bernhammer, F. Bianchi, M. Breitenlechner, S. Brilke, X. Chen, J. Craven, A. Dias, S. Ehrhart, R. C. Flagan, A. Franchin, C. Fuchs, R. Guida, J. Hakala, C. R. Hoyle, T. Jokinen, H. Junninen, J. Kangasluoma, J. Kim, M. Krapf, A. Kürten, A. Laaksonen, K. Lehtipalo, V. Makhmutov, S. Mathot, U. Molteni, A. Onnela, O. Peräkylä, F. Piel, T. Petäjä, A. P. Praplan, K. Pringle, A. Rap, N. A. Richards, I. Riipinen, M. P. Rissanen, L. Rondo, N. Sarnela, S. Schobesberger, C. E. Scott, J. H. Seinfeld, M. Sipilä, G. Steiner, Y. Stozhkov, F. Stratmann, A. Tomé, A. Virtanen, A. L. Vogel, A. C. Wagner, P. E. Wagner, E. Weingartner, D. Wimmer, P. M. Winkler, P. Ye, X. Zhang, A. Hansel, J. Dommen, N. M. Donahue, D. R. Worsnop, U. Baltensperger, M. Kulmala, K. S. Carslaw and J. Curtius. Ion-induced nucleation of pure biogenic particles. Nature 533, 521–526 (2016).\n\n\n\nF. Riccobono, S. Schobesberger, C. E. Scott, J. Dommen, I. K. Ortega, L. Rondo, J. Almeida, A. Amorim, F. Bianchi, M. Breitenlechner, A. David, A. Downard, E. M. Dunne, J. Duplissy, S. Ehrhart, R. C. Flagan, A. Franchin, A. Hansel, H. Junninen, M. Kajos, H. Keskinen, A. Kups, A. Kürten, A. N. Kvashin, A. Laaksonen, K. Lehtipalo, V. Makhmutov, S. Mathot, T. Nieminen, A. Onnela, T. Petäjä, A. P. Praplan, F. D. Santos, S. Schallhart, J. H. Seinfeld, M. Sipilä, D. V. Spracklen, Y. Stozhkov, F. Stratmann, A. Tomé, G. Tsagkogeorgas, P. Vaattovaara, Y. Viisanen, A. Vrtala, P. E. Wagner, E. Weingartner, H. Wex, D. Wimmer, K. S. Carslaw, J. Curtius, N. M. Donahue, J. Kirkby, M. Kulmala, D. R. Worsnop and U. Baltensperger. Oxidation Products of Biogenic Emissions Contribute to Nucleation of Atmospheric Particles. Science 344, 717–721 (2014).\n\n\n\nH. Vehkamäki, M. Kulmala, I. Napari, K. E. Lehtinen, C. Timmreck, M. Noppel and A. Laaksonen. An improved parameterization for sulfuric acid–water nucleation rates for tropospheric and stratospheric conditions. Journal of Geophysical Research: Atmospheres 107 (2002).\n\n\n\nK. E. Lehtinen, M. Dal Maso, M. Kulmala and V.-M. Kerminen. Estimating nucleation rates from apparent particle formation rates and vice versa: Revised formulation of the Kerminen–Kulmala equation. Journal of Aerosol Science 38, 988–994 (2007).\n\n\n\nY. Liu and J. Hallett. The ‘1/3’ power law between effective radius and liquid-water content. Quarterly Journal of the Royal Meteorological Society 123, 1789–1795 (1997).\n\n\n\nF. Glassmeier and U. Lohmann. Constraining Precipitation Susceptibility of Warm-, Ice-, and Mixed-Phase Clouds with Microphysical Equations. Journal of the Atmospheric Sciences 73, 5003–5023 (2016).\n\n\n\nB. Kärcher, J. Hendricks and U. Lohmann. Physically based parameterization of cirrus cloud formation for use in global atmospheric models. Journal of Geophysical Research: Atmospheres 111 (2006).\n\n\n\nC. Tully, D. Neubauer and U. Lohmann. Assessing predicted cirrus ice properties between two deterministic ice formation parameterizations. Geoscientific Model Development 16, 2957–2973 (2023).\n\n\n\nR. Rogers. An elementary parcel model with explicit condensation and supersaturation. Atmosphere 13, 192–204 (1975).\n\n\n\nE. J. Jensen, G. S. Diskin, J. DiGangi, S. Woods, R. P. Lawson and T. V. Bui. Homogeneous Freezing Events Sampled in the Tropical Tropopause Layer. Journal of Geophysical Research: Atmospheres 127, e2022JD036535 (2022), e2022JD036535 2022JD036535.\n\n\n\nP. A. Alpert and D. A. Knopf. Analysis of isothermal and cooling-rate-dependent immersion freezing by a unifying stochastic ice nucleation model. Atmos. Chem. Phys. 16, 2083–2107 (2016).\n\n\n\nH. Pruppacher and J. Klett. Microphysics of Clouds and Precipitation. Vol. 18 of Atmospheric and Oceanographic Sciences Library (Springer Netherlands, 2010).\n\n\n\n","category":"section"},{"location":"Microphysics2M/#Microphysics-2M","page":"2-moment precipitation microphysics","title":"Microphysics 2M","text":"The Microphysics2M.jl module provides 2-moment warm rain bulk parameterization of cloud microphysical processes including autoconversion, accretion, cloud droplets and raindrops self-collection, raindrops breakup, mean terminal velocity and rain evaporation. Autoconversion defines the rate of transfer from cloud liquid water to rain water due to collisions between cloud droplets. Accretion defines the rate of transfer from cloud liquid water to rain water due to collisions between cloud droplets and rain drops. Cloud self-collection defines the rate of change of cloud droplets number density due to collisions between cloud droplets, and similarly, rain self-collection defines the rate of change of raindrops number density due to collsions between raindrops. Rain drops breakup defines the rate of new raindrops production due to the disintegration of larger raindrops. Mean terminal velocity represents the mean fall speed of raindrops, and rain evaporation describes the rate of the transformation of rainwater to water vapor. Specifically, Microphysics2M.jl implements:\n\nthe double-moment [10] parametrization, which includes autoconversion, accretion, cloud and rain self-collection rates, breakup, terminal velocity and evaporation;\nand other double-moment autoconversion and accretions schemes from [13] based on the works of [17], [18], [19] and [20].\n\nThe microphysics variables are expressed as specific contents [kg substance / kg air] and number densities [1 / m^3 air]:\n\nq_lcl - cloud water specific content,\nq_rai - rain specific content,\nN_lcl - cloud droplets number density,\nN_rai - raindrops number density.\n\nThe default values of free parameters are defined in   ClimaParams   and can be overwritten using the toml files.","category":"section"},{"location":"Microphysics2M/#The-Seifert-and-Beheng-(2006)-parametrization","page":"2-moment precipitation microphysics","title":"The Seifert and Beheng (2006) parametrization","text":"The [10] parametrization provides process rates for autoconversion, accretion, self-collection of cloud droplets and raindrops, raindrops breakup, raindrops mean fall speed, and rain evaporation. This parametrization is directly derived from the stochastic collection equation (SCE) with a piecewise polynomial collsion kernel. It assumes\n\na generalized gamma distribution for cloud droplets (as a function of mass)\nan exponential distribution for raindrops (as a function of diameter)\n\nThe piece-wise polynomial collection kernel, used for the derivation of the parametrization, is given by:\n\nbeginalign\n    K(xy) =\n    begincases\n    k_cc(x^2+y^2) quad  xwedge y  x^*\n    k_cr(x+y) quad  xoplus y geq x^*\n    k_rr(x+y)exp-kappa_rr (x^13 + y^13) quad  xwedge y geq x^*\n    endcases\nendalign\n\nwhere x [kg] and y [kg] are drop masses and x^* [kg] is the mass threshold chosen to separate the cloud and rain portions of the mass distribution. K has units of m^3 s^-1, and the constants are:\n\nsymbol default value\nk_cc 444  10^9 m^3 kg^-2 s^-1\nk_cr 525 m^3 kg^-1 s^-1\nk_rr 712 m^3 kg^-1 s^-1\nκ_rr 607 kg^-13\nx^* 654  10^-11 kg\n\nAssuming spherical raindrops, the mass x is related to the drop radius r by x = frac4π3ρ_w r^3, then the default value of x^*=654times 10^-11 kg corresponds to the drop radius r^*  25 μm.","category":"section"},{"location":"Microphysics2M/#Assumed-size-distributions","page":"2-moment precipitation microphysics","title":"Assumed size distributions","text":"In this section, we describe the assumed size distributions for cloud droplets and raindrops. We use the symbol f to denote the number distribution as a function of mass, x [kg], and the symbol n to denote the number distribution as a function of diameter, D [m]. We will show how to convert between the two representations. Symbols related to cloud droplets and raindrops are denoted with the subscript c and r, respectively (e.g. f_c(x) and f_r(D)).","category":"section"},{"location":"Microphysics2M/#Cloud-droplets","page":"2-moment precipitation microphysics","title":"Cloud droplets","text":"The cloud droplet number distribution, as a function of mass x [kg], is assumed to follow a generalized Gamma distribution[1]\n\n[1]: c.f. Eq. (79) in [10], but using the symbol B instead of λ\n\ntodo: Form of size distribution parameters\nIt would simplify math (and intuition?) if we instead defined the size distribution parameters in the form:f(x) = fracNx  left(fracxxright)^ν  A  expleft(- left(Bfracxxright)^μright)whereA = fracμ  B^ν+1Γ(fracν + 1μ) qquad\nB = fracΓ(fracν + 2μ)Γ(fracν + 1μ)At least, it would imply that x is always normalized by x, and that A and B are non-dimensional.\n\nbeginalign\n    f_c(x) = A_c x^ν_c expleft(-B_c x^μ_c right)\nendalign\n\nWe assume that ν_c and μ_c are fixed constants. Our default choice for these parameters are ν_c = 1 and μ_c = 1.\n\nThe free parameters for cloud droplets (A_c, B_c) can be found analytically by integrating over the assumed mass distribution to find the prognostic variables\n\nbeginalign\n    N_c = _0^ f_c(x) dx quad  L_c = ρ_a q_c = _0^ x  f_c(x) dx\nendalign\n\nwhere L_c = ρ_a q_c [kg / m^3] is the cloud liquid water content, ρ_a [kg / m^3] is the air density, and overlinex_c = tfracL_cN_c [kg] is the mean droplet mass.\n\ndetails: Derivation of the expressions for ``A_c`` and ``B_c``\nTODO: Add derivation\n\nThen[2],\n\nbeginalign\n    B_c = left(overlinex_c  fracΓleft(fracν_c+1μ_cright)Γleft(fracν_c+2μ_cright)right)^-μ_c qquad\n    A_c = fracμ_c  N_c  Γleft(fracν_c+1μ_cright)  B_c^fracν_c+1μ_c\nendalign\n\n[2]: c.f. Eq. (80) in [10]","category":"section"},{"location":"Microphysics2M/#Interactions-with-the-P3-scheme","page":"2-moment precipitation microphysics","title":"Interactions with the P3 scheme","text":"For interactions (e.g. collisions) with frozen particles, as parameterized in the P3 scheme, bulk rates are computed by integrating over diameter instead of mass.\n\ndetails: Change of variables between mass (x) and diameter (D)\nAssuming spherical raindrops, the raindrop mass x is related to the raindrop diameter D byx = k_m D^3= fracπ6 ρ_w D^3where k_m = tfracρ_w π6, and ρ_w is the density of water. In terms of x, we have D = k_m^-13 x^13. To do a change of variable from x to D, we need to consider the transformation of dx to dD, which would appear in an integral against f. We can calculate tfracdxdD = 3k_m D^2 and thus dx = 3k_m D^2 dD. Thus, an integral expression with f(x)dx becomesf(x)dx rightarrow f(x(D)) 3k_m D^2 dDSimilarly, starting from an integral expression n(D)dD, in terms of x we have dD = tfrac13 k_m^-13 x^-23 dx, son(D)dD rightarrow n(D(x)) frac13 k_m^-13 x^-23 dxWe remark that if the integration bounds are at 0 and ,  then they remain unchanged by the change of variable. For any other bounds, we would need to consider the transformation of the bounds.\n\nThe resulting cloud droplet distribution in terms of diameter is\n\nbeginalign\n    n_c(D)\n    = f_c(x(D)) fracρ_w π2 D^2\n    = A_c x(D)^nu_c expleft(-B_c x(D)^mu_c right) 3k_m D^2\nendalign\n\nwhere x(D) = k_m D^3 = tfracπ6 ρ_w D^3, and ρ_w is the density of water. Explicitly written out, we have\n\nbeginalign\n    n_c(D) = 3 A_c k_m^ν_c + 1 D^3ν_c + 2 expleft(-B_c k_m^μ_c D^3μ_c right)\nendalign\n\nnote: Undeveloped cloud droplet spectrum\nIn the derivation of the parametrization, it is assumed that the cloud droplet distribution f_c(x) does not contain a significant number of droplets with masses almost equal or larger than x^*. This is reffered to as the undeveloped cloud droplet spectrum assumption. Similarly the raindrop distribution does not contain a significant number of rain drops with masses almost equal or smaller than x^*. These assumptions allow us to simplify the calculation of moments of the distributions by integrating from zero to infinity.","category":"section"},{"location":"Microphysics2M/#Raindrops","page":"2-moment precipitation microphysics","title":"Raindrops","text":"todo: Notation fixes\nThis section describes the psd in terms of λ_r. In the code, we use D_mean ≡ 1/λ_r. Once this change has percolated through the code, we should use D_mean consistently, including in the equations below.\n\nThe raindrop number distribution, as a function of diameter D [m], is assumed to follow an exponential distribution\n\nbeginalign\n    n_r(D) = N_0 expleft(- fracDoverlineD_r right)\nendalign\n\nTo find the free parameters N_0 and overlineD_r, we write the expressions for the raindrop number density and the raindrop liquid water content:\n\nbeginalign\n    N_r = _0^ n_r(D) dD quad\n    L_r = ρ_a q_r = k_m _0^ D^3  n_r(D) dD\nendalign\n\nwhere L_r [kg / m^3] is the raindrop content. The second expression comes from integrating the raindrop distribution against the raindrop mass x(D) = k_m D^3 = tfracρ_w π6 D^3.\n\ndetails: Derivation of the expressions for N₀ and D̄ᵣ\nThe moments of the exponential distribution are given byM^k =_0^ D^k n_r(D) dD = N_0 _0^ D^k expleft(- fracDoverlineD_r right) dD = N_0 Γ(k+1) overlineD_r^k+1for any k-1, overlineD_r  0. This allows us to solve the integrals above for N_0 and overlineD_r:N_r = N_0 overlineD_r quad\nL_r = k_m N_0 Γ(4) overlineD_r^4\n    = 6 k_m N_r overlineD_r^3where the last equality uses N_0 = N_r  overlineD_r. This implies that    N_0            = fracN_roverlineD_r quad\n    overlineD_r = left( fracL_r6 k_m N_r right)^13\n                   = left( fracoverlinex_r6 k_m right)^13\n                   = left( fracoverlinex_rρ_w π right)^13\n\nwe find\n\nbeginalign\n    overlineD_r\n      = left( fracoverlinex_r6 k_m right)^13\n      = left( fracoverlinex_rπ ρ_w right)^frac13 qquad\n    N_0 = fracN_roverlineD_r\nendalign\n\nwhere overlinex_r = L_r  N_r is the mean raindrop mass. This implies a relation between the mean mass and mean diameter\n\nbeginalign\n    overlinex_r = 6 k_m overlineD_r^3 = ρ_w π overlineD_r^3\nendalign\n\ndetails: Raindrop distribution in terms of mass\nTo express the raindrop distribution in terms of mass, we use the change of variable machinery from the previous section, noting in particular D = k_m^-13 x^13 where k_m = tfracρ_w π6, and dD = tfrac13 k_m^-13 x^-23 dx. In terms of mass, the distribution is given bybeginalign*\n    f_r(x)\n    = n(D(x)) frac13 k_m^-13 x^-23 \n    = fracN_0 k_m^-133 x^-23 expleft(- frack_m^-13 x^13overlineD_rright) \n    = fracN_r k_m^-133overlineD_r x^-23 expleft(- frack_m^-13 x^13overlineD_rright) \nendalign*We identify B_r by B_r = tfrack_m^-13overlineD_r = left(tfracoverlinex_r6right)^-13. This implies that A_r = fracN_r3B_r.\n\nIn the model code, we provide two options for calculating the raindrop number distribution parameters N_0 and overlineD_r. One option is to use the expressions above. The other option, described below, limits the range of overlinex_r, N_0 and overlineD_r to avoid numerical artifacts.","category":"section"},{"location":"Microphysics2M/#Limiting-the-range-of-Dᵣ","page":"2-moment precipitation microphysics","title":"Limiting the range of D̄ᵣ","text":"todo: Comment on the limiting procedure\nGiven that each step limits the range of a \"problematic\" quantity, which is then used in the next limiting step, it is odd that we need to consider additional limits in subsequent steps. We should check whether the subsequent limiting steps are reached, and thus whether those limits are needed at all.\n\n[21] showed that every one- or two-moment scheme may experience numerical artifacts, especially as N0 and L0, which results in overlinex_r = L_r  N_r being ill-defined. This manifests, for example, in the bulk rates for sedimentation and evaporation. To avoid this, [10] proposed limiting the range of λ_r  tfrac1overlineD_r, N_0, and overlinex_r by a sequence of steps.\n\nFirst, compute a limited mean mass by\n\nbeginalign\n    tildex_r  overlinex_r textmin  fracL_rN_r  overlinex_r textmax\nendalign\n\nThen, limit N_0 to be consistent with the limited mean mass\n\ndetails: Derivation of the limit on N₀\nSubstitute the expression overlineD_r = left(tfracoverlinex_rρ_w πright)^13 into the expression for N_0:N_0 = fracN_roverlineD_r = N_r left(fracπ ρ_wtildex_rright)^frac13\n\nThe resulting expression is\n\nbeginalign\n    N_0  N_0 textmin  N_r left(fracπ ρ_wtildex_rright)^frac13  N_0 textmax\nendalign\n\nWith the limited N_0, we then limit λ_r  tfrac1overlineD_r.\n\ndetails: Derivation of the limit on λᵣ\ntodo: TODO: Change from limiting λᵣ to limiting D̄ᵣ\nThe limit on λ_r is what is proposed in [10]. However, we use overlineD_r in the code, so we should limit overlineD_r instead. This requires a change to the ClimaParams parameters.Next, limit λ_r by considering the integral expression for L_r:beginalign*\n    L_r = k_m _0^ D^3 n_r(D) dD \n        = k_m N_0 _0^ D^3 expleft(-λ_r Dright) dD \n        = k_m N_0 fracΓ(3+1)λ_r^3+1\n         = frac6 k_m N_0λ_r^4\nendalign*which impliesλ_r = left( frac6 k_m N_0L_r right)^frac14\n    = left( fracρ_w π N_0L_r right)^frac14\n\nThe resulting expression is\n\nbeginalign\n    λ_r  λ_r textmin  left( fracρ_w π N_0L_r right)^frac14  λ_r textmax\nendalign\n\nFinally, we obtain the limited mean mass overlinex_r from the relation N_0 = λ_r N_r = λ_r tfracL_roverlinex_r, which is consistent with the limited N_0 and λ_r:\n\nbeginalign\n    overlinex_r  overlinex_r textmin  fracλ_r L_rN_0  overlinex_r textmax\nendalign\n\nWe obtain the limited overlineD_r by overlineD_r = tfrac1λ_r.","category":"section"},{"location":"Microphysics2M/#Autoconversion","page":"2-moment precipitation microphysics","title":"Autoconversion","text":"The autoconversion rate can be estimated by looking at variations in the second moment of the particle mass spectrum. Specifically, the sum of variations in the second moment of the cloud droplets and raindrops spectrum equals the variations in the second moment of the particle mass spectrum:\n\nbeginalign\nfracpartial Zpartial t = fracpartial Z_cpartial t + fracpartial Z_rpartial t\nendalign\n\nwhere Z represents the second moment, and c and r subscripts denote cloud and rain categories respectively. In the early stages of rain evolution, an estimate of the variations in the second moment of the particle mass spectrum is obtained from the stochastic collection equation: tfracZt  2k_c L_c M_c^(3), where M_c^(3) is the third moment of the cloud droplets spectrum. Using these equations, along with computing Z_c, M_c^(3), Z_r directly by integrating the distribution functions, allows us to derive an equation for the autoconversion rate. To simplify the derivation, we assume that in the initial stage of the rain evolution raindrops have sizes of the order of x^* and the mean radius of cloud droplets is much less than x^*. This approach yields an approximation of the autoconversion rate in the early stages of rain evolution. The early stage rain evolution assumption is then relaxed by means of a universal function that depends on a process time scale.\n\nThe rate of change of rain specific content by autoconversion is finally expressed as\n\nbeginequation\n  left fracq_rait right_textacnv\n  = frack_cc20  x^*  ρ frac(ν+2)(ν+4)(ν+1)^2 (q_lcl ρ)^2 overlinex_c^2 left(1+fracϕ_textacnv(τ)1-τ^2right)fracρ_0ρ\nendequation\n\nwhere:\n\nq_lcl is the cloud liquid water specific content,\nρ is the moist air density,\nρ_0 = 1225 [kg / m^3] is the air density at surface conditions,\nk_cc is the cloud-cloud collection kernel constant,\nν is the cloud droplet gamma distribution parameter,\nx^* is the drop mass separating the cloud and rain categories\noverlinex_c = (q_lcl ρ)  N_lcl is the cloud droplet mean mass with N_lcl denoting the cloud droplet number density. Here, to ensure numerical stability, we limit overlinex_c by the upper bound of x^*.\n\nThe function ϕ_textacnv(τ) is used to correct the autoconversion rate for the undeveloped cloud droplet spectrum and the early stage rain evolution assumptions. This is a universal function which is obtained by fitting to numerical results of the SCE:\n\nbeginequation\n  ϕ_textacnv(τ) = A τ^a(1-τ^a)^b\nendequation\n\nwhere\n\nτ = 1 - tfracq_lclq_lcl + q_rai is a dimensionless internal time scale with q_rai being the cloud liquid water specific content.\n\nThe default free parameter values are:\n\nsymbol default value\nν 1\nA 400\na 07\nb 3\n\nThe rate of change of raindrops number density is\n\nbeginequation\n  left fracN_rait right_textacnv\n  = fracρx^* left fracd  q_raidt right_textacnv\nendequation\n\nand the rate of change of liquid water specific content and cloud droplets number density are\n\nbeginalign\n  left fracq_lclt right_acnv\n    = - left fracq_rait right_acnv\n  left fracN_lclt right_acnv\n    = -2 left fracN_rait right_acnv\nendalign\n\nnote: Note\nThe Seifert and Beheng parametrization is formulated for the rate of change of liquid water content L = ρ q. Here, we assume constant ρ and divide the rates by ρ to derive the equations for the rate of change of specific contents.","category":"section"},{"location":"Microphysics2M/#Accretion","page":"2-moment precipitation microphysics","title":"Accretion","text":"An approximation for the accretion rate is obtained by directly evaluating the integral:\n\nbeginalign\n    left fracq_rait right_textaccr = frac1ρ _x=0^ _y=0^ f_c(x) f_r(y) K(xy) x dy dx\nendalign\n\nSimilar to the autoconversion rate, the accretion rate is modified by a universal function. Thus, the rate of change of rain specific content by accretion becomes\n\nbeginalign\n  left frac q_rait right_textaccr =  frack_crρ (q_lcl ρ) (q_rai ρ) ϕ_textaccr(τ)nonumber\n   =  k_r ρ q_lcl q_rai ϕ_textaccr(τ) left(fracρ_0ρright)^12\nendalign\n\nwhere:\n\nq_lcl is the cloud liquid water specific content,\nq_rai is the rain liquid water specific content,\nρ is the moist air density,\nρ_0 is the air density at surface conditions,\nk_cr is the cloud-rain collection kernel constant.\n\nThe universal function ϕ_textaccr(τ) is used to correct the accretion rate for the assumption of collsion efficiency being one. Fitting to numerical solutions of the SCE obtains:\n\nbeginequation\n  ϕ_textaccr(τ) = left(fracττ+τ_0right)^c\nendequation\n\nwhere\n\nτ = 1 - tfracq_lclq_lcl + q_rai is a dimensionless internal time scale.\n\nThe default free parameter values are:\n\nsymbol default value\nτ_0 5  10^-5\nc 4\n\nThe rate of change of raindrops number density by accretion is zero, and the rate of change of liquid water specific content and cloud droplets number density are\n\nbeginalign\n  left fracq_lclt right_textaccr = - left fracq_rait right_textaccr\n  left fracN_lclt right_textaccr = fracρoverlinex_c left fracq_lclt right_textaccr\nendalign\n\nwhere overlinex_c = tfracq_lclN_lcl is the cloud droplet mean mass.","category":"section"},{"location":"Microphysics2M/#Cloud-droplet-self-collection","page":"2-moment precipitation microphysics","title":"Cloud droplet self-collection","text":"An approximation for the self-collection rate of cloud droplets is obtained by the following equation:\n\nbeginalign\n   left fracN_lclt right_textsc\n     = left fracN_lclt right_textacnv sc\n      - left fracq_rait right_textacnvnonumber\n     = - frac12_x=0^_y=0^ f_c(x) f_c(y) K(xy) dy dx\n        - left fracd  q_raidt right_textacnv\nendalign\n\nDirect evaluation of the integral results in the following approximation of the rate of change of cloud droplets number density due to self-collection\n\nbeginequation\n  left fracN_lclt right_textsc\n    = -k_cc fracν + 2ν + 1 fracρ_0ρ (q_lcl ρ)^2\n    - left fracN_lclt right_textacnv\nendequation\n\nwhere:\n\nq_lcl is the cloud liquid water specific content,\nρ is the moist air density,\nρ_0 is the air density at surface conditions,\nk_cc is the Long's collection kernel constant,\nν is the cloud droplet gamma distribution parameter,\nleft fracd  N_lcldt right_textacnv is the rate of change of cloud droplets number density by autoconversion.","category":"section"},{"location":"Microphysics2M/#Raindrop-self-collection","page":"2-moment precipitation microphysics","title":"Raindrop self-collection","text":"An approximation for rate of change of raindrops number density due to self-collection is obtained by directly evaluating the integral:\n\nbeginalign\n    left fracN_rait right_textsc= -frac12 _x=0^ _y=0^ f_r(x) f_r(y) K(xy) dy dx\nendalign\n\nThis yields,\n\nbeginequation\n  left fracN_rait right_textsc = -k_rr N_rai (q_rai ρ) left(1+fracκ_rrB_r right)^d left(fracρ_0ρright)^12\nendequation\n\nwhere:\n\nq_rai is the rain water specific content,\nρ is the moist air density,\nρ_0 is the air density at surface conditions,\nN_rai is the raindrops number density,\nk_rr and κ_rr are the rain-rain collection kernel constants.\nB_r is the raindrops mass distribution parameter B_r = left(frac6overlinex_rright)^13.\n\nThe default constant value is:\n\nsymbol default value\nd -5\n\nnote: Note\nIn the paper d=-9 which seems to be a mistake! Evaluating the integral for derving the self-collection rate results in d=-5.\n\nnote: Note\nFor the same numerical instabilities which in the paper are mentioned for terminal velocity and evaporation, here for rain self-collection, the value of lambda_r is bounded within a range. In fact we first compute the bounded lambda_r based on drop diameter by the algorithm given in the paper and then convert it to lambda_r based on mass (the conversion can be done by multiplying to a constant value).","category":"section"},{"location":"Microphysics2M/#Raindrops-breakup","page":"2-moment precipitation microphysics","title":"Raindrops breakup","text":"Raindrops breakup is modeled by assuming that in a precipitation event coalescence and breakup ultimately reach an equilibrium with a self-similar equilibrium size distribution. As a result, the breakup process can be coupled to raindrops self-collection by the following parameterization\n\nbeginequation\n  left fracpartial N_raipartial t right_br = -Phi_br(Delta overlineD_r) + 1 left fracpartial N_raipartial t right_sc\nendequation\n\nwhere Delta overlineD_r = overlineD_r - overlineD_eq with overlineD_r denoting the mean volume raindrop diameter and overlineD_eq being the equilibrium mean diameter. The function Phi_br(Delta overlineD_r) is given by\n\n  beginalign\n    Phi_br(Delta overlineD_r) =\n    begincases\n    -1 quad  overlineD_r  overlineD_threshold\n    k_br Delta overlineD_r quad  overlineD_threshold  overlineD_r  overlineD_eq\n    2 (exp(kappa_br Delta overlineD_r) -1) quad  overlineD_eq  overlineD_r\n    endcases\n  endalign\n\nThe default free parameter values are:\n\nsymbol default value\nk_br 1000  m^-1\nkappa_br 2300  m^-1\noverlineD_threshold 035 times 10^-3   m\noverlineD_eq 09 times 10^-3   m\n\nnote: Note\nIn the paper for overlineD_eq  overlineD_r the equation Phi_br(Delta overlineD_r) = 2 exp(kappa_br Delta overlineD_r) -1 is given. This equations seems to be missing parentheses as the equation must be continuous at Delta overlineD_r = 0 as shown in Fig. 2 of the paper.","category":"section"},{"location":"Microphysics2M/#Rain-evaporation","page":"2-moment precipitation microphysics","title":"Rain evaporation","text":"The parametrization of rain evaporation is obtained by considering the time scale of evaporation of individual raindrops:\n\nbeginequation\n  tau_eva = fracx_rfracdx_rdtbigg_eva = fracx_r2 pi G_lv(T p) S D_r(x_r) F_v(x_r)\nendequation\n\nwhere\n\nbeginequation\n  G_lv(T p) = leftfracR_v Tp_lv(T) D_v + fracL_lvK_T T left(fracL_lvR_v T-1right)right^-1\nendequation\n\nwith temperature T, thermal conductivity K_T, diffucivity of water vapor D_v, specific gas constant for water vapor R_v, latent heat of evaporation L_lv and liquid-vapor saturation pressure p_lv. The ventilation factor is given by F_v(x_r) = a_v + b_v N_Sc^13 N_Re(x_r)^12 where N_Sc = nu_air  D_v is the Schmidt number and N_Re(x_r) = fracv_r (x_r) D_r (x_r)nu_air is the Reynolds number with kinematic viscosity of air nu_air. The average evaporation rates are obtained from the following integral:\n\nbeginequation\n  fracpartial M_r^kpartial tbigg_eva = int_0^infty fracx^k f_r(x)tau_eva dx = 2 pi G_lv(T p) S int_0^infty D_r(x) F_v(x) f_r(x) x^k-1 dx\nendequation\n\nwhere the superscript k indicates the moment number, k=0 for number-weighted and k=1 for mass-weighted average. Here in the computation of the evaporation rate, a power-law fall speed is assumed: v_r(x) cong alpha_r x^beta_r left(fracrho_0rhoright)^frac12. Evaluating the integral results in:\n\nbeginequation\n  fracpartial M_r^kpartial tbigg_eva = 2 pi G_lv(T p) S N_rai D_r(overlinex_r) overlineF_v k(overlinex_r) overlinex_r^k-1\nendequation\n\nwhere overlineF_v k is an average ventilation factor for the k-th moment:\n\nbeginequation\noverlineF_v k(overlinex_r) = a_vent k + b_vent k N_Sc^13 N_Re(overlinex_r)^12\nendequation\n\nwith\n\nbeginalign\n  a_vent k = a_v 6^23-k Gamma(3k-1)\n  b_vent k = b_v 6^12-beta_r2-k Gamma(3k-12+3beta_r2)\nendalign\n\nnote: Note\nFor k = 0 the integral for computing the mean evaporation rate does not converge. In this case it is reasonable to change the lower bound of the integral to x=x^*. The results remain the same except that the Gamma functions in the equations for a_vent 0 and b_vent 0, which are Gamma(-1) and Gamma(-12+3beta_r2), are replaced by the upper incomplete gamma function Gamma(-1 (6 x^*  overlinex_r)^13) and Gamma(-12+3beta_r2 (6 x^*  overlinex_r)^13), respectively. This issue and the suggested workaround are not mentioned in the paper.\n\nThe two-moment parametrization of evaporation suffers from the similar numerical instability issues as the sedimentation scheme. Thus, the same limiting algorithm as the sedimentation scheme is applied here to bound size distribution parameters. These limited parameters are then used to compute the mean raindrop mass by the following equation:\n\nbeginequation\n  overlinex_r = max left(overlinex_r min  min left(overlinex_r max  fracrho q_rai lambda_rN_0right)right)\nendequation\n\nThis mean mass is used for computing the evaporation rate.\n\nThe default free parameter values are:\n\nsymbol default value\na_v 078\nb_v 0308\nalpha_r 159  m cdot s^-1 cdot kg^-beta_r\nalpha_r 0266\n\nnote: Note\nIn our implementation we approximate the incomplete gamma function in order to get good performance on the GPU. Below we show the evaporation rates for the number concnetration and mass using both the exact and approximated gamma function\n\ninclude(\"plots/RainEvapoartionSB2006.jl\")\n\n(Image: )","category":"section"},{"location":"Microphysics2M/#Terminal-velocity","page":"2-moment precipitation microphysics","title":"Terminal velocity","text":"The number- and mass-weighted terminal velocities for rain water are obtained by calculating the following integral:\n\nbeginequation\n  overlinev_r k = frac1M_r^k int_0^infty x^k f_r(x) v(x) dx\nendequation\n\nwhere the superscript k indicates the moment number,  with k=0 for number density and k=1 for mass.\n\nThe individual terminal velocity of particles is approximated by\n\nv(D) = left(rho_0rhoright)^frac12 a_R - b_R exp(-c_R D)\n\nwhere a_R, b_R and c_R are free parameters and D is the particle diameter. Evaluating the integral results in\n\nbeginequation\n  overlinev_r k = left(fracrho_0rhoright)^frac12lefta_R - b_R left(1+fracc_Rlambda_rright)^-(3k+1)right\nlabeleqSBTerminalVelocity\nendequation\n\nwhere lambda_r is the raindrop size distribution parameter (based on diameter): lambda_r = (phi rho_woverlinex_r)^13. To avoid numerical instabilities, especially when N_rai rightarrow 0 and q_rai rightarrow 0, lambda_r is bounded. The limiting algorithm is as follows:\n\nbeginalign\nwidetildex_r = max left overlinex_r min  min left(overlinex_r max  fracrho q_raiN_rairight)right \nN_0 = max left N_0 min  min left(N_0 max  N_raileft(fracpi rho_wwidetildex_rright)^frac13right)right\nlambda_r = max left lambda_min  min left(lambda_max  left(fracpi rho_w N_0rho q_rairight)^frac14right)right\nendalign\n\nWhen the limiting algorithm is not applied, the terminal velocity given by eq. (\\ref{eq:SBTerminalVelocity}) can become negative for small mean radius values. This occurs because the equation for the individual particle's terminal velocity may predict negative values for small particles. To avoid negative terminal velocities (or a sudden transition to zero velocity if we return zero instead of negative values), we need to adjust the integration bounds. Specifically, the integrals should be evaluated from the radius at which the individual terminal velocity is zero to infinity. This adjustment leads to the following equation for the terminal velocity:\n\nbeginalign\n  overlinev_r k = frac1M_r^k int_r_c^infty x^k f_r(x) v(x) dx nonumber\n  = left(fracrho_0rhoright)^frac12lefta_R fracGamma(3k+1 2r_clambda_r)Gamma(3k+1) - b_R fracGamma(3k+1 2r_c(lambda_r + c_R))Gamma(3k+1) left(1+fracc_Rlambda_rright)^-(3k+1)right\nlabeleqSBModifiedTerminalVelocity\nendalign\n\nwhere r_c = -ln(a_R  b_R)(2c_R).\n\nThe default parameter values are:\n\nsymbol default value\na_R 965  m cdot s^-1\nb_R 103  m cdot s^-1\nc_R 600  m^-1\noverlinex_r min 654 times 10^-11  m\noverlinex_r max 5 times 10^-6   m\nN_0 min 35 times 10^5   m^-4\nN_0 max 2 times 10^10   m^-4\nlambda_min 1 times 10^3   m^-1\nlambda_max 4 times 10^4   m^-1\n\nBelow we compare number-weighted (left) and mass-weighted (right) terminal velocities   for the original parameterization of SB2006 [10]   and the modifed parameterzation given by eq. (\\ref{eq:SBModifiedTerminalVelocity}),   without the limiting distribution shape factor lambda_r.\n\ninclude(\"plots/TerminalVelocity2M.jl\")\n\n(Image: )\n\nFor cloud liquid droplets in two-moment microphysics schemes, we use the analytical Stokes-regime expression for the terminal velocity of an individual spherical particle:\n\nv(r) = frac29 frac(rho_water - rho_air) gmu_air r^2\n\nwith mu_air = rho_air  nu_air and assuming constant kinematic viscosity nu_air in our parameterization. When droplet sizes follow a gamma distribution (as in Seifert & Beheng 2006), integrating this equation over the size spectrum yields the number- and mass-weighted mean terminal velocities:\n\nbeginalign*\n  overlinev_c k = frac29 left(frac34 pi rho_waterright)^23 left(fracrho_waterrho_air-1right) fracgnu_air fracM_k+23M_k\nendalign*\n\nwhere\n\nM_i is the i-th moment of the droplet size distribution.\nk is the weighting moment: k=0 for number-mean velocity, k=1 for mass-mean velocity.\n\nFor a gamma distribution with shape parameters nu_c and mu_c, the mean terminal velocities can be written analytically as:\n\nbeginalign*\n  overlinev_c k = fracGamma(frack+23+nu_c+1mu_c)Gamma(frack+nu_c+1mu_c)leftfracGamma(fracnu_c+1mu_c)Gamma(fracnu_c+2mu_c)right^23 v_c k(overliner)\nendalign*\n\nwhere v_c k(overliner) is the fall speed of a particle with mean radius overliner.\n\nFor the Chen et al. [12] terminal velocity parameterization,   the number- and mass-weighted group terminal velocities are:\n\nbeginequation\n  overlinev_k = fracint_0^infty v(D)  D^k  n(D)  dD\n             int_0^infty D^k  n(D)  dD\n             = (phi)^kappa Sigma_i fraca_i lambda^delta Gamma(b_i + delta)\n             (lambda + c_i)^b_i + delta  Gamma(delta)\nendequation\n\nwhere Gamma is the gamma function, delta = k + 1, and lambda is the size distribution parameter. The velocity overlinev_k is the number-weighted mean terminal velocity when k = 0, and the mass-weighted mean terminal velocity when k = 3.","category":"section"},{"location":"Microphysics2M/#Additional-2-moment-microphysics-options","page":"2-moment precipitation microphysics","title":"Additional 2-moment microphysics options","text":"The other autoconversion and accretion rates in the Microphysics2M.jl module   are implemented after Table 1 from [13] and are based on the works of   [17],   [18],   [19] and   [20] respectively. From the above works:   (i) the [17] parameterisation is based   on a fit to drop spectrum resolving scheme and designed to work   for stratocumulus topped boundary layers,   (ii) the [18] parameterisation is based on a fit   to stochastic collection equation,   (iii) the [19] parameterisation is developed   for a deep convective case, and   (iv) the [20] parameterisation is derived to   include the effects of relative dispersion   of the cloud droplet size distribution on precipitation formation rates   and assumes a modified gamma distribution.","category":"section"},{"location":"Microphysics2M/#Autoconversion-2","page":"2-moment precipitation microphysics","title":"Autoconversion","text":"","category":"section"},{"location":"Microphysics2M/#Khairoutdinov-and-Kogan-(2000)","page":"2-moment precipitation microphysics","title":"Khairoutdinov and Kogan (2000)","text":"beginequation\n  left fracd  q_raidt right_acnv = A  q_lcl^a  N_d^b  rho^c\nendequation\n\nwhere:\n\nq_lcl is the cloud liquid water specific content,\nN_d is the cloud droplet concentration,\nrho is the air density,\n\nand the default free parameter values are:\n\nsymbol default value\nA 742 times 10^13\na 247\nb -179\nc -147","category":"section"},{"location":"Microphysics2M/#Beheng-(1994)","page":"2-moment precipitation microphysics","title":"Beheng (1994)","text":"beginequation\n  left fracd  q_raidt right_acnv = fracC  d^a  (q_lcl rho)^b  N_d^crho\nendequation\n\nwhere:\n\nq_lcl is the cloud liquid water specific content,\nN_d is the cloud droplet number concentration,\n\nand the default free parameter values are:\n\nsymbol default value\nC 3 times 10^34\na -17\nb 47\nc -33\nd 99 for N_d  200 cm^-3,  39 for N_d  200 cm ^-3","category":"section"},{"location":"Microphysics2M/#Tripoli-and-Cotton-(1980)","page":"2-moment precipitation microphysics","title":"Tripoli and Cotton (1980)","text":"beginequation\n  left fracd  q_raidt right_acnv =\n    D  q_lcl^a  N_d^b  mathrmH(q_lcl - q_lcl_threshold)\nendequation\n\nwhere:\n\nq_lcl is the cloud liquid water specific content,\nq_lcl_threshold is the cloud liquid to rain water threshold,\nN_d is the cloud droplet number concentration,\nmathrmH(x) is the Heaviside step function.\n\nThe cloud liquid to rain water autoconversion threshold is defined   assuming spherical liquid water drops of radius equal to 7 mu m:\n\nbeginequation\n  q_lcl_threshold = frac43 pi rho_w N_d r_cm^3\nendequation\n\nwhere:\n\nrho_w is the liquid water density,\n\nand the default free parameter values are:\n\nsymbol default value\nD 3268\na frac73\nb frac-13\nr_cm 7 times 10^-6 m","category":"section"},{"location":"Microphysics2M/#Liu-and-Daum-(2004)","page":"2-moment precipitation microphysics","title":"Liu and Daum (2004)","text":"beginequation\n  left fracd  q_raidt right_acnv =\n    fracE  (q_lcl  rho)^3  mathrmH(R_6 - R_6C)N_d  rho\nendequation\n\nwhere:\n\nq_lcl is the cloud liquid water specific content,\nN_d is the cloud droplet number concentration,\nrho is the air density.\n\nThe parameterisation is formulated using mean volume radius   r_vol expressed in mu m which we compute as\n\nbeginequation\n    r_vol = left(fracrho q_lcl43 pi  rho_w  N_dright)^13 10^6\nendequation\n\nwhere:\n\nrho_w is the liquid water density.\n\nThen the R_6 and R_6C are defined as\n\nR_6 = beta_6  r_vol\nR_6C = fracR_C0(q_lcl rho)^16 R_6^12\nbeta_6 = left( fracr_vol + 3r_vol right)^13\nE = E_0 beta_6^6\n\nsymbol default value\nR_C0 75\nE_0 108 times 10^10","category":"section"},{"location":"Microphysics2M/#Auto-conversion-with-time-scale-depending-on-number-density","page":"2-moment precipitation microphysics","title":"Auto-conversion with time scale depending on number density","text":"beginequation\n  left fracd  q_raidt right_acnv =\n    fracq_lcltau_acnv 0 left(fracN_d100 cm^-3right)^alpha_acnv\nendequation\n\nwhere:\n\nq_lcl is the cloud liquid water specific content,\nN_d is the cloud droplet number concentration,\ntau_acnv 0 is the auto-conversion time scale at N_d = 100 cm^-3.\n\nThe default free parameter values are:\n\nsymbol default value\ntau_acnv 0 1000 s\nalpha_acnv 1","category":"section"},{"location":"Microphysics2M/#Accretion-2","page":"2-moment precipitation microphysics","title":"Accretion","text":"","category":"section"},{"location":"Microphysics2M/#Khairoutdinov-and-Kogan-(2000)-2","page":"2-moment precipitation microphysics","title":"Khairoutdinov and Kogan (2000)","text":"beginequation\n  left fracd  q_raidt right_accr = A  (q_lcl q_rai)^a  rho^b\nendequation\n\nwhere:\n\nq_lcl is the cloud liquid water specific content,\nq_rai is the rain water specific content,\nrho    is the air density,\n\nand the default free parameter values are:\n\nsymbol default value\nA 67\na 115\nb -13","category":"section"},{"location":"Microphysics2M/#Beheng-(1994)-2","page":"2-moment precipitation microphysics","title":"Beheng (1994)","text":"beginequation\n  left fracd  q_raidt right_accr = A  q_lcl  q_rai  rho\nendequation\n\nwhere:\n\nq_lcl is the cloud liquid water specific content,\nq_rai is the rain specific content,\nrho    is the air density,\n\nand the default free parameter values are:\n\nsymbol default value\nA 6","category":"section"},{"location":"Microphysics2M/#Tripoli-and-Cotton-(1980)-2","page":"2-moment precipitation microphysics","title":"Tripoli and Cotton (1980)","text":"beginequation\n  left fracd  q_raidt right_accr = A  q_lcl  q_rai\nendequation\n\nwhere:\n\nq_lcl is cloud liquid water specific content\nq_rai is rain specific content\n\nand the default free parameter values are:\n\nsymbol default value\nA 47","category":"section"},{"location":"Microphysics2M/#Number-concentration-adjustment-(Horn-2012)","page":"2-moment precipitation microphysics","title":"Number concentration adjustment (Horn 2012)","text":"To ensure that the number concentration N remains physically consistent with the mass mixing ratio q, the Microphysics2M.jl module provides a pair of relaxation tendencies that bound the implied mean particle mass x = rho q  N within user-defined limits x_min x_max. This is useful in two-moment schemes to prevent unphysical droplet masses and improve numerical stability.\n\nThe tendencies are applied over a relaxation timescale tau, following the method described in [22]. The total tendency can be written as:\n\nfracpartial Npartial t = frac1tauleftmaxleft(0 fracrho qx_max-Nright) + minleft(0 fracrho qx_min-Nright)right\n\nThis correction increases N when droplets are too heavy (i.e., x  x_max) and decreases N when they are too light (x  x_min), while applying no correction when x lies within bounds.\n\nThis formulation is implemented as two separate functions:\n\nnumber_increase_for_mass_limit: returns the rate needed to increase N when particles are too heavy (x > x_{max}).\nnumber_decrease_for_mass_limit: returns the rate needed to decrease N when particles are too light (x < x_{min}).\n\nNo correction is applied when x lies within bounds. The default parameter value is\n\nsymbol default value\ntau 100  s\n\nThe adjustment is assumed to exchange number concentration with a background reservoir of cloud condensation nuclei (CCN), so that any increase in droplet number is accompanied by a corresponding decrease in CCN number, and vice versa:\n\nfracpartial N_CCNpartial t = -fracpartial Npartial t\n\nnote: Note\nIn the reference paper, this approach is given for the number concentration of cloud droplets; however, the same formulation can also be used for raindrops.","category":"section"},{"location":"Microphysics2M/#Example-figures","page":"2-moment precipitation microphysics","title":"Example figures","text":"include(\"plots/Microphysics2M_plots.jl\")\n\n(Image: )","category":"section"},{"location":"guides/literated/Parameters/#Handling-parameters","page":"Handling parameters","title":"Handling parameters","text":"This guide shows how to overwrite the default free parameters values and how to dispatch between different parameterization options based on parameters types.","category":"section"},{"location":"guides/literated/Parameters/#Overwriting-parameters","page":"Handling parameters","title":"Overwriting parameters","text":"CloudMicrophysics.jl is designed to allow easy parameter calibrations. As a result, free parameters are not hard-coded in the source code but are instead passed as arguments to functions. The default values are stored in a separate repository ClimaParams.jl in a toml file.\n\nWe start by importing the ClimaParams package and the needed CloudMicrophysics.jl modules. We define the precision type.\n\nimport ClimaParams as CP\nimport CloudMicrophysics.Parameters as CMP\nimport CloudMicrophysics.Microphysics1M as CM1\nimport CloudMicrophysics.Microphysics2M as CM2\nimport CloudMicrophysics.HetIceNucleation as CMI_het\n\nFT = Float32\n\nnothing #hide\n\nWe define the default parameters struct using the default toml file via the constructor provided in the CloudMicrophysics.jl Parameters module. Additionally, we create a toml file in which we save the name, value and type of the parameter we are changing. In a typical application, this step would be done via the calibration algorithm searching for optimal parameters values. We create a second struct with changed parameters based on the override_dict.toml file.\n\nconst default = CMP.Rain(FT)\n\noverride_file = joinpath(\"override_dict.toml\")\nopen(override_file, \"w\") do io\n    println(io, \"[rain_autoconversion_timescale]\")\n    println(io, \"value = \" * string(1))\n    println(io, \"type = \\\"float\\\"\")\nend\ntoml_dict = CP.create_toml_dict(FT; override_file)\nisfile(override_file) && rm(override_file; force = true)\nconst overwrite = CMP.Rain(toml_dict)\n\nnothing #hide\n\nOverwriting the parameters can also be done using dictionaries instead of toml files. As an example we create a dictionary were we define a different value of the rain autoconversion time scale and create another parameter struct based on it.\n\noverride_file = Dict(\n    \"rain_autoconversion_timescale\" =>\n        Dict(\"value\" => 13, \"type\" => \"float\"),\n)\ntoml_dict2 = CP.create_toml_dict(FT; override_file)\nconst overwrite2 = CMP.Rain(toml_dict2)\n\nnothing #hide\n\nFinally we check the values of the rain autoconversion timescales and the corresponding rain formation rates.\n\nqₗ = FT(1e-3)\ndefault_acnv = CM1.conv_q_lcl_to_q_rai(default.acnv1M, qₗ) # Rain autoconversion rate\noverwrite_acnv = CM1.conv_q_lcl_to_q_rai(overwrite.acnv1M, qₗ) # Rain autoconversion rate\noverwrite_acnv2 = CM1.conv_q_lcl_to_q_rai(overwrite2.acnv1M, qₗ) # Rain autoconversion rate\n\n@info(\"Default:\", default.acnv1M.τ, default_acnv)\n@info(\"Overwrite:\", overwrite.acnv1M.τ, overwrite_acnv)\n@info(\"Overwrite from dict:\", overwrite2.acnv1M.τ, overwrite_acnv2)","category":"section"},{"location":"guides/literated/Parameters/#Dispatching-over-parameter-types","page":"Handling parameters","title":"Dispatching over parameter types","text":"CloudMicrophysics.jl Parameters module introduces type hierarchy that is used to dispatch over different parameterization options and inputs. For example ABIFM_J accepts Illite or Kaolinite as input type and will return immersion freezing nucleation rate coefficient that corresponds to the two different aerosol types.\n\nconst aerosol1 = CMP.Illite(FT)\nconst aerosol2 = CMP.Kaolinite(FT)\n\nΔa_w = FT(0.28)\nJ1 = CMI_het.ABIFM_J(aerosol1, Δa_w)\nJ2 = CMI_het.ABIFM_J(aerosol2, Δa_w)\n\n@info(\"ABIFM derived J: \", J1, J2)\n\nSimilarily, the 2 moment microphysics offers different rain autoconversion formulations based on parameterizations from the literature. We can chose between them based on the free parameters type that is passed in as argument.\n\nconst KK2000 = CMP.KK2000(FT)  # Khairoutdinov and Kogan (2000)\nconst B1994 = CMP.B1994(FT)    # Beheng (1994)\nconst TC1980 = CMP.TC1980(FT)  # Tripoli and Cotton (1980)\nconst LD2004 = CMP.LD2004(FT)  # Liu and Daum (2004)\n\nqₗ = FT(1e-3)\nρₐ = FT(1)\nN = FT(1e8)\nKK2000_rate = CM2.conv_q_lcl_to_q_rai(KK2000, qₗ, ρₐ, N)\nTC1980_rate = CM2.conv_q_lcl_to_q_rai(TC1980, qₗ, ρₐ, N)\nLD2004_rate = CM2.conv_q_lcl_to_q_rai(LD2004, qₗ, ρₐ, N)\nB1994_rate = CM2.conv_q_lcl_to_q_rai(B1994, qₗ, ρₐ, N)\n\n@info(\"Autoconversion: \", KK2000_rate, B1994_rate, TC1980_rate, LD2004_rate)\n\n\n\nThis page was generated using Literate.jl.","category":"section"},{"location":"PrecipitationSusceptibility/#Precipitation-Susceptibility","page":"Precipitation Susceptibility","title":"Precipitation Susceptibility","text":"The PrecipitationSusceptibility.jl module contains functions for determining the precipitation susceptibility rates due to various processes for 2-moment microphysics schemes, as described in [59].\n\nThe precipitation susceptibility describes the rate of change of precipitation production due to some moment of the particle size distribution:\n\nFor some partial moment X, such as q_lcl, q_rai, N_lcl, or N_rai and some process rate of precipitation production r, such as autoconversion, accretion, etc, this is defined as:\n\nfracpartial ln rpartial ln X\n\nThe total precipitation susceptibility, then, is\n\nfracpartial ln PPpartial ln X = sum_r in R\n    fracrPP fracpartial ln rpartial ln X\n\nWhere R is the set of all process rates that contribute to precipitation production.\n\nExample reproducing Fig. 2 From [59]:\n\ninclude(\"plots/PrecipitationSusceptibilityPlots.jl\")\n\n(Image: )","category":"section"},{"location":"ThresholdsTransition/#Smooth-transition-at-thresholds","page":"Smooth transition at thresholds","title":"Smooth transition at thresholds","text":"To avoid abrupt change of values at thresholds we can use the logistic function to make the transition smooth. The logistic function is defined as\n\nf(t k) = frac11+e^-kt\n\nwhere\n\nt is the independent parameter,\nand k is the growth rate of the curve characterizing the steepness of the transition.\n\nThe value of the logistic function changes from zero at t rightarrow -infty to one at t rightarrow infty with the majority of the change happening around t = 0. In our microphysics applications, the independent parameter (typically specific humidities) takes only non-negative values, and when this parameter is zero the function should return zero. Thus, we use the change of variable t = xx_0 - x_0x, where x_0 is the threshold value of x. Therefore, the logistic function for smooth transitioning from f(x) = 0, for x  x_0, to f(x)=1, for x  x_0, is defined as\n\nf(x x_0 k) = frac11+e^-k(xx_0 - x_0x)\n\nNote that when both x and x_0 are zero the value given by the above equation is undefined. In this case we return a zero value instead.","category":"section"},{"location":"ThresholdsTransition/#Smooth-transition-of-derivative-at-thresholds","page":"Smooth transition at thresholds","title":"Smooth transition of derivative at thresholds","text":"When the function itself is continuous but its derivative changes abruptly at a threshold we can use the indefinite integral of the logistic function for smooth transitioning. In this case, the following function can be used\n\nf(x x_0 k) = fracx_0k lnleft(1+e^k(xx_0 - 1 + a_trnslt) right) - a_trnslt x_0\n\nwhere a is a fixed value that is defined to enforce zero at x=0:\n\na_trnslt = -frac1klnleft(1 - e^-kright)\n\nThe curve defined by the above equation smoothly transition from f(x) = 0, for x  x_0, to f(x)=x-x_0, for x  x_0. Note that when both x and x_0 are zero the value of the function is undefined. In this case we return a zero value instead.","category":"section"},{"location":"ThresholdsTransition/#Example-figures","page":"Smooth transition at thresholds","title":"Example figures","text":"include(\"plots/Thersholds_transitions.jl\")\n\n(Image: ) (Image: ) (Image: )","category":"section"},{"location":"API/#","page":"API","title":"","text":"","category":"section"},{"location":"API/#Non-equilibrium-cloud-formation","page":"API","title":"Non-equilibrium cloud formation","text":"","category":"section"},{"location":"API/#0-moment-precipitation-microphysics","page":"API","title":"0-moment precipitation microphysics","text":"","category":"section"},{"location":"API/#1-moment-precipitation-microphysics","page":"API","title":"1-moment precipitation microphysics","text":"","category":"section"},{"location":"API/#2-moment-precipitation-microphysics","page":"API","title":"2-moment precipitation microphysics","text":"","category":"section"},{"location":"API/#Size-distributions","page":"API","title":"Size distributions","text":"","category":"section"},{"location":"API/#Parameters","page":"API","title":"Parameters","text":"","category":"section"},{"location":"API/#Size-distributions-2","page":"API","title":"Size distributions","text":"","category":"section"},{"location":"API/#Rates","page":"API","title":"Rates","text":"","category":"section"},{"location":"API/#Distribution-tools-for-2-moment-microphysics","page":"API","title":"Distribution tools for 2-moment microphysics","text":"","category":"section"},{"location":"API/#Bulk-microphysics-tendencies","page":"API","title":"Bulk microphysics tendencies","text":"Fused tendency functions for 0-moment, 1-moment, 2-moment, and P3 microphysics schemes.","category":"section"},{"location":"API/#P3-scheme","page":"API","title":"P3 scheme","text":"","category":"section"},{"location":"API/#Construct-parameterization-set","page":"API","title":"Construct parameterization set","text":"","category":"section"},{"location":"API/#Sub-parameterizations","page":"API","title":"Sub-parameterizations","text":"","category":"section"},{"location":"API/#Obtain-particle-state","page":"API","title":"Obtain particle state","text":"","category":"section"},{"location":"API/#State-relationships","page":"API","title":"State relationships","text":"","category":"section"},{"location":"API/#Derived-quantities","page":"API","title":"Derived quantities","text":"","category":"section"},{"location":"API/#Main-particle-methods","page":"API","title":"Main particle methods","text":"These methods are a function of the particle diameter, D.","category":"section"},{"location":"API/#Distribution-parameters","page":"API","title":"Distribution parameters","text":"","category":"section"},{"location":"API/#Distribution-relationships","page":"API","title":"Distribution relationships","text":"","category":"section"},{"location":"API/#Derived-integral-quantities","page":"API","title":"Derived integral quantities","text":"These methods integrate over the particle size distribution.","category":"section"},{"location":"API/#Processes","page":"API","title":"Processes","text":"","category":"section"},{"location":"API/#Heterogeneous-ice-nucleation","page":"API","title":"Heterogeneous ice nucleation","text":"","category":"section"},{"location":"API/#Ice-melting","page":"API","title":"Ice melting","text":"","category":"section"},{"location":"API/#Collisions-with-liquid-droplets","page":"API","title":"Collisions with liquid droplets","text":"Supporting methods:","category":"section"},{"location":"API/#Supporting-integral-methods","page":"API","title":"Supporting integral methods","text":"","category":"section"},{"location":"API/#Aerosol-model","page":"API","title":"Aerosol model","text":"","category":"section"},{"location":"API/#Aerosol-activation","page":"API","title":"Aerosol activation","text":"","category":"section"},{"location":"API/#Artifact-calling","page":"API","title":"Artifact calling","text":"","category":"section"},{"location":"API/#Heterogeneous-ice-nucleation-2","page":"API","title":"Heterogeneous ice nucleation","text":"","category":"section"},{"location":"API/#Homogeneous-ice-nucleation","page":"API","title":"Homogeneous ice nucleation","text":"","category":"section"},{"location":"API/#Cloud-diagnostics","page":"API","title":"Cloud diagnostics","text":"","category":"section"},{"location":"API/#Utilities","page":"API","title":"Utilities","text":"Lightweight numerical utility functions shared across modules.","category":"section"},{"location":"API/#Common-utility-functions","page":"API","title":"Common utility functions","text":"","category":"section"},{"location":"API/#Parameters-2","page":"API","title":"Parameters","text":"","category":"section"},{"location":"API/#Precipitation-susceptibility","page":"API","title":"Precipitation susceptibility","text":"","category":"section"},{"location":"API/#CloudMicrophysics.MicrophysicsNonEq","page":"API","title":"CloudMicrophysics.MicrophysicsNonEq","text":"Non-equilibrium bulk microphysics scheme for cloud condensate formation.\n\nImplements relaxation-to-equilibrium approach for:\n\nCondensation and evaporation of cloud liquid water\nDeposition and sublimation of cloud ice\n\nSee also: Microphysics1M for precipitating hydrometeor processes.\n\n\n\n\n\n","category":"module"},{"location":"API/#CloudMicrophysics.MicrophysicsNonEq.τ_relax","page":"API","title":"CloudMicrophysics.MicrophysicsNonEq.τ_relax","text":"τ_relax(liquid::CloudLiquid)\nτ_relax(ice::CloudIce)\n\nReturns the relaxation timescale for phase change processes.\n\nArguments\n\nliquid::CloudLiquid or ice::CloudIce - cloud condensate parameters struct\n\nReturns\n\nRelaxation timescale [s] for condensation/evaporation (liquid) or deposition/sublimation (ice)\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.MicrophysicsNonEq.conv_q_vap_to_q_lcl_icl","page":"API","title":"CloudMicrophysics.MicrophysicsNonEq.conv_q_vap_to_q_lcl_icl","text":"conv_q_vap_to_q_lcl_icl(params::CloudLiquid, q_sat_liq, q_lcl)\nconv_q_vap_to_q_lcl_icl(params::CloudIce, q_sat_ice, q_icl)\n\nComputes the tendency of cloud condensate specific content using a simple relaxation-to-equilibrium formulation with a constant timescale.\n\nArguments\n\nparams - cloud liquid or ice parameters struct containing τ_relax\nq_sat_liq or q_sat_ice - saturation specific humidity [kg/kg]\nq_lcl or q_icl - cloud liquid water or ice specific content [kg/kg]\n\nReturns\n\nCloud condensate tendency in kg/kg/s, positive for condensation/deposition, negative for evaporation/sublimation\n\nThe tendency is computed as:\n\nfracdqdt = fracq_sat - qtau_relax\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.MicrophysicsNonEq.conv_q_vap_to_q_lcl_icl_MM2015","page":"API","title":"CloudMicrophysics.MicrophysicsNonEq.conv_q_vap_to_q_lcl_icl_MM2015","text":"conv_q_vap_to_q_lcl_icl_MM2015(params, tps, q_tot, q_lcl, q_icl, q_rai, q_sno, ρ, T)\n\nComputes cloud condensate tendency using the formulation from Morrison & Grabowski (2008), https://doi.org/10.1175/2007JAS2374.1, and Morrison & Milbrandt (2015), https://doi.org/10.1175/JAS-D-14-0065.1.\n\nThis formulation includes a thermodynamic adjustment factor Γ that accounts for latent heat release modifying the saturation state.\n\nArguments\n\nparams - cloud liquid or ice parameters struct containing τ_relax\ntps - thermodynamics parameters struct\nq_tot - total water specific content [kg/kg]\nq_lcl - cloud liquid water specific content [kg/kg]\nq_icl - cloud ice specific content [kg/kg]\nq_rai - rain specific content [kg/kg]\nq_sno - snow specific content [kg/kg]\nρ - air density [kg/m³]\nT - air temperature [K]\n\nReturns\n\nCloud condensate tendency [kg/kg/s]\n\nNotes\n\nThis function does NOT apply limiters for small or negative specific humidities. Users should apply appropriate bounds checking when integrating in a model.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.MicrophysicsNonEq.terminal_velocity","page":"API","title":"CloudMicrophysics.MicrophysicsNonEq.terminal_velocity","text":"terminal_velocity(sediment::CloudLiquid, vel::StokesRegimeVelType, ρₐ, q)\nterminal_velocity(sediment::CloudIce, vel::Chen2022VelTypeSmallIce, ρₐ, q)\n\nComputes mass-weighted average terminal velocity for cloud droplets or ice crystals assuming a monodisperse size distribution.\n\nCloud Liquid: Uses Stokes Law (v ∝ D²), valid for small droplets (Re < 1).\nCloud Ice: Uses Chen et al. (2022) parameterization, DOI: 10.1016/j.atmosres.2022.106171\n\nArguments\n\nsediment - cloud liquid or ice parameters struct (provides density and N_0)\nvel - velocity parameters (StokesRegimeVelType for liquid, Chen2022VelTypeSmallIce for ice)\nρₐ - air density [kg/m³]\nq - cloud liquid water or ice specific content [kg/kg]\n\nReturns\n\nMass-weighted terminal velocity [m/s]\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics0M","page":"API","title":"CloudMicrophysics.Microphysics0M","text":"Microphysics0M\n\nZero-moment bulk microphysics scheme that removes cloud condensate  above a threshold, equivalent to instantaneous conversion to precipitation  with infinite terminal velocity.\n\n\n\n\n\n","category":"module"},{"location":"API/#CloudMicrophysics.Microphysics0M.remove_precipitation","page":"API","title":"CloudMicrophysics.Microphysics0M.remove_precipitation","text":"remove_precipitation(params_0M::Parameters0M, q_lcl, q_icl)\nremove_precipitation(params_0M::Parameters0M, q_lcl, q_icl, q_vap_sat)\n\nCompute the total water tendency due to precipitation removal.\n\nThe tendency assumes relaxation with constant timescale to a state  with condensate above a threshold removed. The threshold is defined  by either fixed condensate specific humidity (qc_0) or fixed  supersaturation (S_0), along with the relaxation timescale,  specified in the Parameters0M struct.\n\nArguments\n\nparams_0M: 0-moment microphysics parameters (contains τ_precip and either qc_0 or S_0)\nq_lcl: cloud liquid water specific humidity (kg/kg)\nq_icl: cloud ice specific humidity (kg/kg)\nq_vap_sat: (second method only) saturation specific humidity (kg/kg)\n\nReturns\n\nTotal water (q_tot) tendency (kg/kg/s)\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics1M","page":"API","title":"CloudMicrophysics.Microphysics1M","text":"Microphysics1M\n\nOne-moment bulk microphysics scheme, which includes:\n\nterminal velocity of precipitation\nautoconversion of cloud liquid water into rain and of cloud ice into snow\naccretion due to collisions between categories of condensed species\nevaporation and sublimation of hydrometeors\nmelting of snow into rain\n\nMathematical Approach\n\nParticle size distributions are assumed to follow the Marshall-Palmer exponential distribution. Microphysical process rates are derived by integrating particle-scale physics (terminal velocities, collision kernels, mass transfer) over these assumed distributions.\n\nBased on:\n\nKessler (1995) - https://doi.org/10.1016/0169-8095(94)00090-Z\nGrabowski (1998) - https://doi.org/10.1175/1520-0469(1998)055<3283:TCRMOL>2.0.CO;2\nKaul et al. (2015) - https://doi.org/10.1175/MWR-D-14-00319.1\n\n\n\n\n\n","category":"module"},{"location":"API/#CloudMicrophysics.Microphysics1M.get_v0","page":"API","title":"CloudMicrophysics.Microphysics1M.get_v0","text":"get_v0(vel::Blk1MVelTypeRain, ρ)\nget_v0(vel::Blk1MVelTypeSnow, args...)\n\nReturns the proportionality coefficient in terminal velocity(r/r0).\n\nGuards against unphysical density ratios (ρ > ρw) that would cause sqrt of negative.\n\nArguments\n\nvel: terminal velocity parameters (contains C_drag, ρw, grav, r0, gamma_term for rain; v0, gamma_term for snow)\nρ: air density (rain only)\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics1M.get_n0","page":"API","title":"CloudMicrophysics.Microphysics1M.get_n0","text":"get_n0(pdf::ParticlePDFSnow, q_sno, ρ)\nget_n0(pdf::ParticlePDFIceRain, args...)\n\nReturns the intercept parameter of the assumed Marshall-Palmer distribution (Marshall and Palmer, 1948).\n\nArguments\n\npdf: size distribution parameters (contains ν, μ for snow; n0 for rain/ice)\nq_sno: snow specific content (snow only)\nρ: air density (snow only)\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics1M.lambda_inverse","page":"API","title":"CloudMicrophysics.Microphysics1M.lambda_inverse","text":"lambda_inverse(pdf, mass::ParticleMass, q, ρ)\n\nReturns the inverse of the rate parameter (λ⁻¹) of the assumed Marshall-Palmer size distribution of particles (rain drops, ice crystals, snow crystals).\n\nThe rate parameter λ is related to the mean particle size: larger λ means smaller average particles. The value is clipped at r0 * 1e-5 to prevent numerical issues.\n\nArguments\n\npdf: size distribution parameters (ParticlePDFIceRain or ParticlePDFSnow)\nmass: mass(radius) parameters (contains r0, m0, me, Δm, χm, gamma_coeff)\nq: specific content of rain, cloud ice, or snow [kg/kg]\nρ: air density [kg/m³]\n\nReturns\n\nλ⁻¹: inverse rate parameter [m]\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics1M.terminal_velocity","page":"API","title":"CloudMicrophysics.Microphysics1M.terminal_velocity","text":"terminal_velocity(precip::Rain, vel::Blk1MVelTypeRain, ρ, q)\nterminal_velocity(precip::Snow, vel::Blk1MVelTypeSnow, ρ, q)\nterminal_velocity(precip::Rain, vel::Chen2022VelTypeRain, ρ, q)\nterminal_velocity(precip::Snow, vel::Chen2022VelTypeLargeIce, ρ, q)\nterminal_velocity(precip::Snow, vel::Chen2022VelTypeLargeIce, ρ, q, snow_shape)\n\nReturns the mass-weighted average terminal velocity assuming a Marshall-Palmer distribution of particles (Ogura and Takahashi, 1971).\n\nThe mass-weighted average velocity is computed by integrating the product of particle mass, terminal velocity, and size distribution, then dividing by the total mass. This represents the sedimentation velocity of the bulk hydrometeor field.\n\nFall velocity of individual particles is parameterized:\n\nusing empirical power-law relations for Blk1MVelType\nfollowing Chen et al. (2022), https://doi.org/10.1016/j.atmosres.2022.106171, for Chen2022VelType\n\nArguments\n\nprecip: precipitation parameters (Rain or Snow, contains pdf, mass, and for snow: area, ρᵢ, aspr)\nvel: terminal velocity parameterization parameters\nρ: air density [kg/m³]\nq: rain or snow specific content [kg/kg]\nsnow_shape: (optional) assumed snow shape (Oblate or Prolate)\n\nReturns\n\nMass-weighted terminal velocity [m/s]\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics1M.conv_q_lcl_to_q_rai","page":"API","title":"CloudMicrophysics.Microphysics1M.conv_q_lcl_to_q_rai","text":"conv_q_lcl_to_q_rai(acnv::Acnv1M, q_lcl, smooth_transition)\n\nReturns the rain tendency due to collisions between cloud droplets (autoconversion), parameterized following Kessler (1995), https://doi.org/10.1016/0169-8095(94)00090-Z.\n\nWhen smooth_transition = false, uses a step function at the threshold. When smooth_transition = true, uses a logistic function to smooth the transition over the threshold, avoiding discontinuities in the tendency.\n\nArguments\n\nacnv: autoconversion parameters (contains τ, q_threshold, k)\nq_lcl: cloud liquid water specific content [kg/kg]\nsmooth_transition: flag to switch on smoothing\n\nReturns\n\nRain autoconversion rate [kg/kg/s]\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics1M.conv_q_icl_to_q_sno_no_supersat","page":"API","title":"CloudMicrophysics.Microphysics1M.conv_q_icl_to_q_sno_no_supersat","text":"conv_q_icl_to_q_sno_no_supersat(acnv::Acnv1M, q_icl, smooth_transition)\n\nReturns the snow tendency due to autoconversion from cloud ice. This is a simplified version for use in simulations without supersaturation (e.g., with saturation adjustment).\n\nArguments\n\nacnv: autoconversion parameters (contains τ, q_threshold, k)\nq_icl: cloud ice specific content\nsmooth_transition: flag to switch on smoothing\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics1M.conv_q_icl_to_q_sno","page":"API","title":"CloudMicrophysics.Microphysics1M.conv_q_icl_to_q_sno","text":"conv_q_icl_to_q_sno(ice::CloudIce, aps, tps, q_tot, q_lcl, q_icl, q_rai, q_sno, ρ, T)\n\nReturns the snow tendency due to autoconversion from ice. Parameterized following:\n\nHarrington et al. (1995), https://doi.org/10.1175/1520-0469(1995)052<4344:POICCP>2.0.CO;2\nKaul et al. (2015), https://doi.org/10.1175/MWR-D-14-00319.1\n\nArguments\n\nice: ice parameters (contains r_ice_snow, pdf, mass)\naps: air properties struct\ntps: thermodynamics parameters struct\nq_tot: total water specific content [kg/kg]\nq_lcl: cloud liquid water specific content [kg/kg]\nq_icl: cloud ice specific content [kg/kg]\nq_rai: rain specific content [kg/kg]\nq_sno: snow specific content [kg/kg]\nρ: air density [kg/m³]\nT: air temperature [K]\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics1M.accretion","page":"API","title":"CloudMicrophysics.Microphysics1M.accretion","text":"accretion(cloud::CloudCondensateType, precip::PrecipitationType, vel, ce, q_clo, q_pre, ρ)\n\nReturns the source of precipitating water (rain or snow) due to collisions with cloud water (liquid or ice).\n\nArguments\n\ncloud: type for cloud water or cloud ice\nprecip: type for rain or snow\nvel: terminal velocity parameters (Blk1MVelTypeRain or Blk1MVelTypeSnow, contains gamma_accr)\nce: collision efficiency parameters\nq_clo: cloud liquid water or cloud ice specific content\nq_pre: rain or snow specific content\nρ: air density\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics1M.accretion_rain_sink","page":"API","title":"CloudMicrophysics.Microphysics1M.accretion_rain_sink","text":"accretion_rain_sink(rain::Rain, ice::CloudIce, vel::Blk1MVelTypeRain, ce, q_icl, q_rai, ρ)\n\nReturns the sink of rain water (partial source of snow) due to collisions with cloud ice.\n\nArguments\n\nrain: rain type parameters\nice: ice type parameters\nvel: terminal velocity parameters for rain\nce: collision efficiency parameters\nq_icl: cloud ice specific content\nq_rai: rain water specific content\nρ: air density\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics1M.accretion_snow_rain","page":"API","title":"CloudMicrophysics.Microphysics1M.accretion_snow_rain","text":"accretion_snow_rain(type_i::PrecipitationType, type_j::PrecipitationType, blk1mveltype_ti, blk1mveltype_tj, ce, q_i, q_j, ρ)\n\nReturns the accretion rate when rain and snow collide. Collisions result in snow for T < Tfreeze and rain for T > Tfreeze.\n\nUses geometric collision kernel assumption: a(ri, rj) = π(ri + rj)², with a velocity dispersion correction that assumes that fall velocity standard  deviations are proportional to the mean fall velocities, with coefficient ce.coeff_disp.\n\nArguments\n\ntype_i: snow (T < Tfreeze) or rain (T > Tfreeze)\ntype_j: rain (T < Tfreeze) or snow (T > Tfreeze)  \nblk1mveltype_ti, blk1mveltype_tj: 1M terminal velocity parameters\nce: collision efficiency parameters (contains e_rai_sno, coeff_disp)\nq_i, q_j: specific contents of snow or rain [kg/kg]\nρ: air density [kg/m³]\n\nReturns\n\nAccretion rate [kg/kg/s]\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics1M.evaporation_sublimation","page":"API","title":"CloudMicrophysics.Microphysics1M.evaporation_sublimation","text":"evaporation_sublimation(rain::Rain, vel::Blk1MVelTypeRain, aps, tps, q_tot, q_lcl, q_icl, q_rai, q_sno, ρ, T)\nevaporation_sublimation(snow::Snow, vel::Blk1MVelTypeSnow, aps, tps, q_tot, q_lcl, q_icl, q_rai, q_sno, ρ, T)\n\nReturns the tendency due to rain evaporation or snow sublimation/deposition. Ventilation factor parameterization follows Seifert and Beheng (2006), https://doi.org/10.1007/s00703-005-0112-4.\n\nRain: Only evaporation is considered (S < 0), result is clamped to be ≤ 0. Snow: Both sublimation (S < 0) and deposition (S > 0) are considered.\n\nArguments\n\nrain or snow: particle parameters (contains pdf, mass, vent)\nvel: terminal velocity parameters (Blk1MVelTypeRain or Blk1MVelTypeSnow)\naps: air properties struct\ntps: thermodynamics parameters struct\nq_tot: total water specific content [kg/kg]\nq_lcl: cloud liquid water specific content [kg/kg]\nq_icl: cloud ice specific content [kg/kg]\nq_rai: rain specific content [kg/kg]\nq_sno: snow specific content [kg/kg]\nρ: air density [kg/m³]\nT: air temperature [K]\n\nReturns\n\nEvaporation/sublimation/deposition rate [kg/kg/s]\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics1M.snow_melt","page":"API","title":"CloudMicrophysics.Microphysics1M.snow_melt","text":"snow_melt(snow::Snow, vel::Blk1MVelTypeSnow, aps, tps, q_sno, ρ, T)\n\nReturns the tendency due to snow melt.\n\nArguments\n\nsnow: snow parameters (contains T_freeze, pdf, mass, vent)\nvel: terminal velocity parameters\naps: air properties struct\ntps: thermodynamics parameters struct\nq_sno: snow water specific content\nρ: air density\nT: air temperature\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics2M","page":"API","title":"CloudMicrophysics.Microphysics2M","text":"Double-moment bulk microphysics parametrizations including:\n\nautoconversion, accretion, self-collection, breakup, mean terminal velocity of raindrops,  and rain evaporation rates from Seifert and Beheng 2006.\nnumber concentration adjustment from Horn 2012.\nadditional double-moment bulk microphysics autoconversion and accretion rates from: Khairoutdinov and Kogan 2000, Beheng 1994, Tripoli and Cotton 1980, and Liu and Daum 2004.\n\n\n\n\n\n","category":"module"},{"location":"API/#CloudMicrophysics.Microphysics2M.pdf_cloud_parameters","page":"API","title":"CloudMicrophysics.Microphysics2M.pdf_cloud_parameters","text":"pdf_cloud_parameters(pdf_c, q, ρₐ, N)\n\nReturn the parameters of the size distribution of cloud particles in terms of diameter.\n\nThe size distribution is given by:\n\nn(D) = N₀c * D^νcD * exp(-λc * D^μcD)\n\nwhere\n\nνcD = 3νc + 2\nμcD = 3μc\n\nArguments\n\npdf_c: Size distribution parameters for cloud droplets, CMP.CloudParticlePDF_SB2006\nq: Liquid mass content [kg/kg]\nρₐ: Air density [kg/m³]\nN: Number concentration of the particle [1/m³]\n\nReturns\n\n(logN₀c, λc, νcD, μcD): Parameters of the generalized gamma distribution in terms of diameter\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics2M.pdf_rain_parameters","page":"API","title":"CloudMicrophysics.Microphysics2M.pdf_rain_parameters","text":"pdf_rain_parameters(pdf_r, qᵣ, ρₐ, Nᵣ)\n\nReturn the parameters of the rain drop diameter distribution\n\nn_r(D) = N_0 * exp(- D / Dr_mean)\n\nwhere\n\nD is the diameter of the raindrop,\nN_0 [1/m³] is the number concentration of raindrops,\nDr_mean [m] is the mean diameter of the raindrops.\n\nNote: in SB2006, Eq. (83) the distribution is given as:\n\nf(D) = N_0 * exp(- λ_r D)\n\nwhere λ_r ≡ 1 / Dr_mean [1/m] is the inverse of the mean diameter of the raindrops.\n\nArguments\n\npdf_r: struct containing size distribution parameters for rain.      Can either be CMP.RainParticlePDF_SB2006_notlimited or CMP.RainParticlePDF_SB2006_limited.      For the latter, the values for N_0, Dr_mean, and xr_mean are limited to be within provided ranges.\nqᵣ: mass of rain water [kg]\nρₐ: air density [kg/m³]\nNᵣ: number of rain drops [1/m³]\n\nReturns\n\nA NamedTuple with the fields (; N₀r, Dr_mean, xr_mean)\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics2M.pdf_cloud_parameters_mass","page":"API","title":"CloudMicrophysics.Microphysics2M.pdf_cloud_parameters_mass","text":"pdf_cloud_parameters_mass(pdf_c, q, ρₐ, N)\n\nReturn the parameters of the size distribution of cloud particles in terms of mass.\n\nSee log_pdf_cloud_parameters_mass for more details.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics2M.pdf_rain_parameters_mass","page":"API","title":"CloudMicrophysics.Microphysics2M.pdf_rain_parameters_mass","text":"pdf_rain_parameters_mass(pdf_r::CMP.RainParticlePDF_SB2006, qᵣ, ρₐ, Nᵣ)\n\nReturn the parameters of the rain drop diameter distribution in terms of mass.\n\nAs a function of diameter, the size distribution is given by:\n\nn(D) = N₀r * exp(-D / Dr_mean)\n\nIn terms of mass (x), the size distribution is given by:\n\nf(x) = n(D(x)) * ∂D∂x(x)\n     = N₀ * exp(-D(x) / Dr_mean) * 2 / (π * ρw) * x^(-2/3)\n     = N₀ * 2 / (π * ρw) * x^(-2/3) * exp(- (6 / (π * ρw))^(1/3) / Dr_mean * x^(1/3))\n\nwhere\n\nD(x) = (6x / (π * ρw))^(1/3) is the diameter of a raindrop of mass x.\n∂D∂x(x) = (6 / (π * ρw))^(1/3) * x^(-2/3) is the derivative of the diameter with respect to the mass.\n\nIf we write the general form of the size distribution as:\n\nf(x) = A * x^ν * exp(-B * x^μ)\n\nthen we have that:\n\nA = N₀ * 2 / (π * ρw)\nB = (6 / (π * ρw))^(1/3) / Dr_mean\nν = -2/3\nμ = 1/3\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics2M.log_pdf_cloud_parameters_mass","page":"API","title":"CloudMicrophysics.Microphysics2M.log_pdf_cloud_parameters_mass","text":"log_pdf_cloud_parameters_mass(pdf_c, q, ρₐ, N)\n\nReturn the log of the parameters of the generalized gamma distribution of the form\n\nf(x) = A * x^ν * exp(-B * x^μ),  [Eq. (79) in Seifert and Beheng 2006, but using the symbol `B` instead of `λ`]\n\nwhere\n\nB = [  x̄ Γ(z₁) / Γ(z₂) ]^(-μ)\nA = μ N B^(z₁) / Γ(z₁)\nz₁ = (ν + 1) / μ\nz₂ = (ν + 2) / μ\n\nThat is,\n\nlog(B) = - μ [ log(x̄) + logΓ(z₁) - logΓ(z₂) ]\nlog(A) = log(μ) + log(N) + z₁ * log(B) - logΓ(z₁)\n\nArguments\n\npdf_c: Size distribution parameters for cloud droplets, CMP.CloudParticlePDF_SB2006\nq: Liquid mass content [kg/kg]\nρₐ: Air density [kg/m³]\nN: Number concentration of the particle [1/m³]\n\nReturns\n\n(logA, logB): Log of the parameters of the generalized gamma distribution\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.DistributionTools.size_distribution-Tuple{CloudMicrophysics.Parameters.RainParticlePDF_SB2006, Any, Any, Any}","page":"API","title":"CloudMicrophysics.DistributionTools.size_distribution","text":"size_distribution(pdf::CMP.RainParticlePDF_SB2006, q, ρₐ, N)\n\nReturn n(D), a function that computes the size distribution for rain particles at diameter D\n\nArguments\n\npdf: Rain size distribution parameters, CMP.RainParticlePDF_SB2006\nq: Rain water specific content [kg/kg]\nρₐ: Density of air [kg/m³]\nN: Rain water number concentration [1/m³]\n\n\n\n\n\n","category":"method"},{"location":"API/#CloudMicrophysics.DistributionTools.size_distribution-Tuple{CloudMicrophysics.Parameters.CloudParticlePDF_SB2006, Any, Any, Any}","page":"API","title":"CloudMicrophysics.DistributionTools.size_distribution","text":"size_distribution(pdf::CMP.CloudParticlePDF_SB2006, q, ρₐ, N)\n\nReturn n(D), a function that computes the size distribution for cloud particles at diameter D\n\nThe size distribution is given by:\n\nn(D) = N₀c * D^(3νc + 2) * exp(-λc * D^(3μc))\n\nArguments\n\npdf: Cloud size distribution parameters, CMP.CloudParticlePDF_SB2006\nq: Cloud water specific content [kg/kg]\nρₐ: Density of air [kg/m³]\nN: Cloud water number concentration [1/m³]\n\n\n\n\n\n","category":"method"},{"location":"API/#CloudMicrophysics.Microphysics2M.size_distribution_value","page":"API","title":"CloudMicrophysics.Microphysics2M.size_distribution_value","text":"size_distribution_value(pdf, q, ρₐ, N, D)\n\nReturn the size distribution value for a cloud or rain particle of diameter D.\n\nSee size_distribution for more details.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics2M.get_size_distribution_bounds","page":"API","title":"CloudMicrophysics.Microphysics2M.get_size_distribution_bounds","text":"get_size_distribution_bounds(pdf, q, ρₐ, N, p)\n\nReturn the minimum and maximum diameters of a cloud or rain particle such that the size distribution is within (1 - p) to (p) probability of the true size distribution.\n\nArguments\n\npdf: Size distribution parameters for cloud or rain,  CMP.RainParticlePDF_SB2006 or CMP.CloudParticlePDF_SB2006\nq: mass mixing ratio of cloud or rain water\nρₐ: density of air\nN: number mixing ratio of cloud or rain\np: probability level (0 ≤ p ≤ 1)\n\nReturns\n\nD_min, D_max: minimum and maximum diameters of a cloud or rain particle such that  the size distribution is within (1 - p) to (p) probability of the true size distribution.  All inputs and output diameters are in base SI units.  The bounds are calculated through quantile functions of the size distribution.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics2M.LclRaiRates","page":"API","title":"CloudMicrophysics.Microphysics2M.LclRaiRates","text":"A structure containing the rates of change of the specific contents and number densities of cloud liquid water and rain water.\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Microphysics2M.autoconversion","page":"API","title":"CloudMicrophysics.Microphysics2M.autoconversion","text":"autoconversion(acnv, pdf_c, q_lcl, q_rai, ρ, N_lcl)\n\nCompute autoconversion rates\n\nArguments\n\nacnv: Autoconversion parameters, CMP.AcnvSB2006\npdf_c: Cloud size distribution parameters, CMP.CloudParticlePDF_SB2006\nq_lcl: Cloud liquid water specific content [kg/kg]\nq_rai: Rain water specific content [kg/kg]\nρ: Air density [kg/m³]\nN_lcl: Cloud droplet number density [1/m³]\n\nReturns\n\nLclRaiRates with q_lcl, N_lcl, q_rai, N_rai tendencies due to  collisions between cloud droplets (autoconversion)\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics2M.accretion","page":"API","title":"CloudMicrophysics.Microphysics2M.accretion","text":"accretion(accr, q_lcl, q_rai, ρ, N_lcl)\n\nCompute accretion rate\n\nArguments\n\naccr: Accretion parameters, CMP.AccrSB2006\nq_lcl: Cloud liquid water specific content [kg/kg]\nq_rai: Rain water specific content [kg/kg]\nρ: Air density [kg/m³]\nN_lcl: Cloud droplet number density [1/m³]\n\nReturns\n\nLclRaiRates with q_lcl, N_lcl, q_rai, N_rai tendencies due to  collisions between raindrops and cloud droplets (accretion)\n\n\n\n\n\naccretion(accretion_scheme, q_lcl, q_rai, ρ)\n\naccretion_scheme - type for 2-moment rain accretion parameterization\nq_lcl - cloud liquid water specific content\nq_rai - rain water specific content\nρ - air density (for KK2000Type and Beheng1994Type)\n\nReturns the accretion rate of rain, parametrized following\n\nKhairoutdinov and Kogan (2000) for scheme == KK2000Type\nBeheng (1994) for scheme == B1994Type\nTripoli and Cotton (1980) for scheme == TC1980Type\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics2M.cloud_liquid_self_collection","page":"API","title":"CloudMicrophysics.Microphysics2M.cloud_liquid_self_collection","text":"cloud_liquid_self_collection(acnv, pdf_c, q_lcl, ρ, dN_lcl_dt_au)\n\nCompute cloud liquid self-collection rate\n\nArguments\n\nacnv: 2-moment autoconversion parameterization, CMP.AcnvSB2006\npdf_c: Cloud size distribution parameters, CMP.CloudParticlePDF_SB2006\nq_lcl: Cloud liquid water specific content [kg/kg]\nρ: Air density [kg/m³]\ndN_lcl_dt_au: Rate of change of cloud droplets number density due to autoconversion [1/m³/s]\n\nReturns\n\nThe cloud droplets number density tendency due to collisions of cloud droplets  that produce larger cloud droplets (self-collection)\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics2M.autoconversion_and_cloud_liquid_self_collection","page":"API","title":"CloudMicrophysics.Microphysics2M.autoconversion_and_cloud_liquid_self_collection","text":"autoconversion_and_cloud_liquid_self_collection(scheme, q_lcl, q_rai, ρ, N_lcl)\n\nCompute autoconversion and cloud liquid self-collection rates\n\nArguments\n\nscheme: 2-moment rain autoconversion parameterization, CMP.SB2006\nq_lcl: Cloud liquid water specific content [kg/kg]\nq_rai: Rain water specific content [kg/kg]\nρ: Air density [kg/m³]\nN_lcl: Cloud droplet number density [1/m³]\n\nReturns\n\n(au, sc): A NamedTuple containing the autoconversion rate and the  cloud liquid self-collection rate.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics2M.rain_self_collection","page":"API","title":"CloudMicrophysics.Microphysics2M.rain_self_collection","text":"rain_self_collection(pdf, self, q_rai, ρ, N_rai)\n\nCompute the rain self-collection rate\n\nArguments\n\npdf: Rain size distribution parameters, CMP.RainParticlePDF_SB2006\nself: Rain self-collection parameters, CMP.SelfColSB2006\nq_rai: Rain water specific content [kg/kg]\nρ: Air density [kg/m³]\nN_rai: Raindrops number density [1/m³]\n\nReturns\n\nThe raindrops number density tendency due to collisions of raindrops that  produce larger raindrops (self-collection).\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics2M.rain_breakup","page":"API","title":"CloudMicrophysics.Microphysics2M.rain_breakup","text":"rain_breakup(pdf, brek, q_rai, ρ, N_rai, dN_rai_dt_sc)\n\nCompute the raindrops number density tendency due to breakup of raindrops\n\nArguments\n\npdf: Rain size distribution parameters, CMP.RainParticlePDF_SB2006\nbrek: Rain breakup parameters, CMP.BreakupSB2006\nq_rai: Rain water specific content\nρ: Air density\nN_rai: Raindrops number density\ndN_rai_dt_sc: Rate of change of raindrops number density due to self-collection\n\nReturns\n\nThe raindrops number density tendency due to breakup of raindrops that produce  smaller raindrops\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics2M.rain_self_collection_and_breakup","page":"API","title":"CloudMicrophysics.Microphysics2M.rain_self_collection_and_breakup","text":"rain_self_collection_and_breakup(params, q_rai, ρ, N_rai)\n\nCompute the raindrops self-collection and breakup rates.\n\nArguments\n\nparams: 2-moment rain size distribution parameters, CMP.SB2006  including raindrop size distribution, self collection, and breakup parameters\nq_rai: Rain water specific content\nρ: Air density\nN_rai: Raindrops number density\n\nReturns\n\n(sc, br): A NamedTuple containing the raindrops self-collection and breakup rates, respectively.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics2M.rain_terminal_velocity","page":"API","title":"CloudMicrophysics.Microphysics2M.rain_terminal_velocity","text":"rain_terminal_velocity(SB2006, vel, q_rai, ρ, N_rai)\n\nCompute the raindrops terminal velocity.\n\nArguments\n\npdf_r: Rain size distribution parameters, CMP.RainParticlePDF_SB2006\nvel: Terminal velocity parameters, CMP.Chen2022VelTypeRain\nq_rai: Rain water specific content\nρ: Air density\nN_rai: Raindrops number density\n\nReturns\n\nA tuple containing the number and mass weigthed mean fall velocities of raindrops in [m/s]. Assuming an exponential size distribution from Seifert and Beheng 2006 for scheme == SB2006Type Fall velocity of individual rain drops is parameterized:\n\nassuming an empirical relation similar to Rogers (1993) for velo_scheme == SB2006VelType\nfollowing Chen et. al 2022, DOI: 10.1016/j.atmosres.2022.106171 for velo_scheme == Chen2022Type\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics2M.rain_evaporation","page":"API","title":"CloudMicrophysics.Microphysics2M.rain_evaporation","text":"rain_evaporation(evap, aps, tps, q_tot, q_lcl, q_icl, q_rai, q_sno, ρ, N_rai, T)\n\nevap - evaporation parameterization scheme\naps - air properties\ntps - thermodynamics parameters\nq_tot, q_lcl, q_icl, q_rai, q_sno - total water,  cloud liquid water, cloud ice, rain and snow specific contents,\nρ - air density\nN_rai - raindrops number density\nT - air temperature\n\nReturns a named tuple containing the tendency of raindrops number density and rain water specific content due to rain rain_evaporation, assuming a power law velocity relation for fall velocity of individual drops and an exponential size distribution, for scheme == SB2006Type\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics2M.conv_q_lcl_to_q_rai","page":"API","title":"CloudMicrophysics.Microphysics2M.conv_q_lcl_to_q_rai","text":"conv_q_lcl_to_q_rai(acnv, q_lcl, ρ, N_d; smooth_transition)\n\nacnv - 2-moment rain autoconversion parameterization\nq_lcl - cloud liquid water specific content\nρ - air density\nN_d - prescribed cloud droplet number concentration\n\nReturns the q_rai tendency due to collisions between cloud droplets (autoconversion), parametrized following:\n\nKhairoutdinov and Kogan (2000) for scheme == KK2000Type\nBeheng (1994) for scheme == B1994Type\nTripoli and Cotton (1980) for scheme == TC1980Type\nLiu and Daum (2004) for scheme ==LD2004Type\n\nThe Beheng1994Type, TC1980Type and LD2004Type of schemes additionally accept smooth_transition flag that smoothes their thershold behaviour if set to true. The default value is false.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics2M.number_increase_for_mass_limit","page":"API","title":"CloudMicrophysics.Microphysics2M.number_increase_for_mass_limit","text":"number_increase_for_mass_limit(numadj, x_max, q, ρ, N)\n\nCompute the tendency (rate of change) of number concentration N required to ensure that the mean particle mass x = ρq / N does not exceed the upper limit x_max. Returns a positive tendency when the mean mass is too high (x > x_max), and zero otherwise. The method is based on Horn (2012, DOI: 10.5194/gmd-5-345-2012).\n\nArguments\n\nnumadj: Number concentration adjustment parameters (CMP.NumberAdjustmentHorn2012)\nq: Mass mixing ratio [kg/kg]\nρ: Air density [kg/m³]\nN: Number concentration [1/m³]\nx_max: Maximum allowed mean particle mass [kg]\n\nReturns\n\nThe rate of change of number concentration [1/(m³·s)] needed to bring the mean mass within the upper bound.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Microphysics2M.number_decrease_for_mass_limit","page":"API","title":"CloudMicrophysics.Microphysics2M.number_decrease_for_mass_limit","text":"number_decrease_for_mass_limit(numadj, x_min, q, ρ, N)\n\nCompute the tendency (rate of change) of number concentration N required to ensure that the mean particle mass x = ρq / N does not fall below the lower limit x_min. Returns a negative tendency when the mean mass is too low (x < x_min), and zero otherwise. The method is based on Horn (2012, DOI: 10.5194/gmd-5-345-2012).\n\nArguments\n\nnumadj: Number concentration adjustment parameters (CMP.NumberAdjustmentHorn2012)\nq: Mass mixing ratio [kg/kg]\nρ: Air density [kg/m³]\nN: Number concentration [1/m³]\nx_min: Minimum allowed mean particle mass [kg]\n\nReturns\n\nThe rate of change of number concentration [1/(m³·s)] needed to bring the mean mass within the lower bound.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.DistributionTools","page":"API","title":"CloudMicrophysics.DistributionTools","text":"DistributionTools\n\nA module containing tools for working with size distributions.\n\nCurrently, it contains tools for working with the generalized gamma distribution and the exponential distribution.\n\nMostly used for the 2-moment microphysics.\n\n\n\n\n\n","category":"module"},{"location":"API/#CloudMicrophysics.DistributionTools.generalized_gamma_quantile","page":"API","title":"CloudMicrophysics.DistributionTools.generalized_gamma_quantile","text":"generalized_gamma_quantile(ν, μ, B, Y)\n\nCalculate the quantile (inverse cumulative distribution function) for a     generalized gamma distribution parameterized in the form:\n\ng(x) = A ⋅ x^ν ⋅ exp(-B ⋅ x^μ)\n\nArguments\n\nν, μ, B: The PDF parameters\nY: The probability level (0 ≤ Y ≤ 1) for which to compute the quantile\n\nReturns\n\nx: The value x such that P(X ≤ x) = Y\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.DistributionTools.generalized_gamma_cdf","page":"API","title":"CloudMicrophysics.DistributionTools.generalized_gamma_cdf","text":"generalized_gamma_cdf(ν, μ, B, x)\n\nCalculate the cumulative distribution function (CDF) for a generalized gamma distribution parameterized in the form:\n\ng(x) = A * x^ν * exp(-B * x^μ)\n\nThe CDF gives the probability P(X ≤ x).\n\nArguments\n\nν, μ, B: The PDF parameters\nx: The value at which to evaluate the CDF\n\nReturns\n\np: The probability P(X ≤ x)\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.DistributionTools.exponential_cdf","page":"API","title":"CloudMicrophysics.DistributionTools.exponential_cdf","text":"exponentialcdf(Dmean, D)\n\nCalculate the cumulative distribution function (CDF) for an exponential distribution parameterized in the form:\n\nn(D) = N₀ * exp(-D / D_mean)\n\nwhere N₀ is a normalizing constant such that the total probability is 1.\n\nArguments\n\nD_mean: The mean value of the distribution\nD: The point at which to evaluate the CDF (must be ≥ 0)\n\nReturns\n\np: The probability P(X ≤ D)\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.DistributionTools.exponential_quantile","page":"API","title":"CloudMicrophysics.DistributionTools.exponential_quantile","text":"exponential_quantile(D_mean, Y)\n\nCalculate the quantile (inverse cumulative distribution function) for an exponential distribution parameterized in the form:\n\nn(D) = N₀ * exp(-D / D_mean)\n\nwhere N₀ is a normalizing constant such that the total probability is 1.\n\nArguments\n\nY: The probability level (0 ≤ Y ≤ 1) for which to compute the quantile\nD_mean: The mean value of the distribution\n\nReturns\n\nD: The value D such that P(X ≤ D) = Y\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.BulkMicrophysicsTendencies","page":"API","title":"CloudMicrophysics.BulkMicrophysicsTendencies","text":"BulkMicrophysicsTendencies\n\nFused bulk microphysics source terms for atmospheric models.\n\nProvides a dispatch-based API to compute all microphysics tendencies in a single function call, enabling:\n\nSimplified integration in atmospheric models\nPoint-evaluation suitable for quadrature over subgrid-scale fluctuations\nGPU-friendly pure function design\n\nUsage\n\nusing CloudMicrophysics.BulkMicrophysicsTendencies\n\n# For 1-moment microphysics\ntendencies = bulk_microphysics_tendencies(\n    Microphysics1Moment(),\n    lcl, icl, rai, sno, ce, aps, vel,\n    tps, ρ, T, q_tot, q_lcl, q_icl, q_rai, q_sno\n)\n(; dq_lcl_dt, dq_icl_dt, dq_rai_dt, dq_sno_dt) = tendencies\n\n\n\n\n\n","category":"module"},{"location":"API/#CloudMicrophysics.BulkMicrophysicsTendencies.MicrophysicsScheme","page":"API","title":"CloudMicrophysics.BulkMicrophysicsTendencies.MicrophysicsScheme","text":"MicrophysicsScheme\n\nAbstract type for microphysics scheme dispatch.\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.BulkMicrophysicsTendencies.Microphysics0Moment","page":"API","title":"CloudMicrophysics.BulkMicrophysicsTendencies.Microphysics0Moment","text":"Microphysics0Moment <: MicrophysicsScheme\n\nSingleton type for 0-moment microphysics scheme dispatch.\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.BulkMicrophysicsTendencies.Microphysics1Moment","page":"API","title":"CloudMicrophysics.BulkMicrophysicsTendencies.Microphysics1Moment","text":"Microphysics1Moment <: MicrophysicsScheme\n\nSingleton type for 1-moment microphysics scheme dispatch.\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.BulkMicrophysicsTendencies.Microphysics2Moment","page":"API","title":"CloudMicrophysics.BulkMicrophysicsTendencies.Microphysics2Moment","text":"Microphysics2Moment <: MicrophysicsScheme\n\nSingleton type for 2-moment microphysics scheme dispatch.\n\nThis unified scheme handles:\n\nWarm rain only (Seifert-Beheng 2006) when ice parameters are not provided\nWarm rain + P3 ice when ice state is provided\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.BulkMicrophysicsTendencies.bulk_microphysics_tendencies","page":"API","title":"CloudMicrophysics.BulkMicrophysicsTendencies.bulk_microphysics_tendencies","text":"bulk_microphysics_tendencies(\n    ::Microphysics1Moment,\n    mp,\n    tps,\n    ρ,\n    T,\n    q_tot,\n    q_lcl,\n    q_icl,\n    q_rai,\n    q_sno,\n)\n\nCompute all 1-moment microphysics tendencies in one fused call.\n\nReturns a NamedTuple with all source/sink terms for hydrometeor species. This is a pure function of local thermodynamic state, suitable for:\n\nPoint quadrature over subgrid-scale (T, q_tot) distributions\nGPU kernel evaluation\nUnit testing in isolation\n\nArguments\n\nmp: NamedTuple of microphysics parameters with fields:\nlcl: CloudLiquid parameters\nicl: CloudIce parameters\nrai: Rain parameters\nsno: Snow parameters\nce: CollisionEff parameters\naps: AirProperties parameters\nvel: Blk1MVelType parameters\nvar: VarTimescaleAcnv parameters (optional, for 2M autoconversion)\ntps: Thermodynamics parameters\nρ: Air density [kg/m³]\nT: Temperature [K]\nq_tot: Total water specific content [kg/kg]\nq_lcl: Cloud liquid water specific content [kg/kg]\nq_icl: Cloud ice specific content [kg/kg]\nq_rai: Rain specific content [kg/kg]\nq_sno: Snow specific content [kg/kg]\nN_lcl: Cloud droplet number concentration [1/m³], optional, default=0 When N_lcl > 0, uses 2M autoconversion; otherwise uses 1M\n\nReturns\n\nNamedTuple with fields:\n\ndq_lcl_dt: Cloud liquid tendency [kg/kg/s]\ndq_icl_dt: Cloud ice tendency [kg/kg/s]\ndq_rai_dt: Rain tendency [kg/kg/s]\ndq_sno_dt: Snow tendency [kg/kg/s]\n\nInput Validation\n\nNegative specific contents are clamped to zero for robustness against numerical errors.\n\nNotes\n\nThis function does NOT apply timestep-dependent limiters to prevent negative concentrations. Limiters depend on timestep dt and should be applied by the caller after computing tendencies.\n\n\n\n\n\nbulk_microphysics_tendencies(\n    ::Microphysics0Moment,\n    mp,\n    tps,\n    T,\n    q_lcl,\n    q_icl,\n)\n\nCompute 0-moment microphysics tendencies in one fused call.\n\nReturns a NamedTuple with:\n\ndq_tot_dt: Total water tendency from precipitation removal [kg/kg/s]\ne_int_precip: Internal energy of removed condensate [J/kg]\n\nCaller adds geopotential Φ for energy tendency: e_tot = dq_tot_dt * (e_int_precip + Φ)\n\nArguments\n\nmp: NamedTuple with microphysics parameters:\nparams_0M: Parameters0M struct (contains τprecip, qc0 or S_0)\ntps: Thermodynamics parameters\nT: Temperature [K]\nq_lcl: Cloud liquid specific content [kg/kg]\nq_icl: Cloud ice specific content [kg/kg]\n\nNotes\n\nDoes NOT apply limiters (caller applies based on timestep)\nDoes NOT include geopotential (caller adds Φ for energy tendency)\n\n\n\n\n\nbulk_microphysics_tendencies(\n    ::Microphysics2Moment,\n    mp::Microphysics2MParams{FT, WR, Nothing},\n    ...\n)\n\nCompute 2-moment warm rain only microphysics tendencies (Seifert-Beheng 2006).\n\nThis method is type-stable and GPU-optimized for warm rain processes only. For warm rain + P3 ice, see the method that accepts Microphysics2MParams{FT, WR, <:P3IceParams}.\n\nArguments\n\nmp: Microphysics2MParams with mp.ice == nothing (warm rain only)\ntps: Thermodynamics parameters\nρ: Air density (kg/m³)\nT: Temperature (K)\nq_tot: Total water specific content (kg/kg)\nq_lcl: Cloud liquid specific content (kg/kg)\nn_lcl: Cloud droplet number per kg air (1/kg)\nq_rai: Rain specific content (kg/kg)\nn_rai: Rain number per kg air (1/kg)\n\nReturns\n\nNamedTuple with warm rain tendency fields:\n\ndq_lcl_dt: Cloud liquid tendency (kg/kg/s)\ndn_lcl_dt: Cloud number tendency (1/kg/s)\ndq_rai_dt: Rain tendency (kg/kg/s)\ndn_rai_dt: Rain number tendency (1/kg/s)\ndq_ice_dt: Ice tendency (always zero for warm-only)\ndq_rim_dt: Rime mass tendency (always zero for warm-only)\ndb_rim_dt: Rime volume tendency (always zero for warm-only)\n\n\n\n\n\nbulk_microphysics_tendencies(\n    ::Microphysics2Moment,\n    mp::Microphysics2MParams{FT, WR, <:P3IceParams},\n    ...\n)\n\nCompute 2-moment warm rain + P3 ice microphysics tendencies.\n\nThis method is type-stable and GPU-optimized. The P3 ice parameters are guaranteed to be non-Nothing, eliminating runtime type checks and dynamic dispatch.\n\nArguments\n\nRequired\n\nmp: Microphysics2MParams with P3 ice parameters present\ntps: Thermodynamics parameters\nρ: Air density (kg/m³)\nT: Temperature (K)\nq_tot: Total water specific content (kg/kg) \nq_lcl: Cloud liquid specific content (kg/kg)\nn_lcl: Cloud droplet number per kg air (1/kg)\nq_rai: Rain specific content (kg/kg)\nn_rai: Rain number per kg air (1/kg)\n\nOptional (P3 ice state)\n\nq_ice: Ice specific content (kg/kg), default = 0\nn_ice: Ice number per kg air (1/kg), default = 0\nq_rim: Rime mass (kg/kg), default = 0\nb_rim: Rime volume (m³/kg), default = 0\nlogλ: Log of P3 distribution slope parameter, log(1/m), default = 0\n\nReturns\n\nNamedTuple with all tendency fields:\n\ndq_lcl_dt: Cloud liquid tendency (kg/kg/s)\ndn_lcl_dt: Cloud number tendency (1/kg/s)\ndq_rai_dt: Rain tendency (kg/kg/s)\ndn_rai_dt: Rain number tendency (1/kg/s)\ndq_ice_dt: Ice tendency (kg/kg/s)\ndq_rim_dt: Rime mass tendency (kg/kg/s)\ndb_rim_dt: Rime volume tendency (m³/kg/s)\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme","page":"API","title":"CloudMicrophysics.P3Scheme","text":"Predicted particle properties scheme P3 for ice [23].\n\nSee online docs for more information.\n\n\n\n\n\n","category":"module"},{"location":"API/#CloudMicrophysics.Parameters.ParametersP3","page":"API","title":"CloudMicrophysics.Parameters.ParametersP3","text":"ParametersP3{FT}\n\nParameters for P3 bulk microphysics scheme.\n\nFrom Morrison and Milbrandt (2015) [23]\n\nFields\n\nmass: Mass-size relation, e.g. MassPowerLaw\narea: Area-size relation, e.g. AreaPowerLaw\nslope: Slope relation, e.g. SlopePowerLaw or SlopeConstant\nvent: Ventilation relation, e.g. VentilationFactor\nρ_rim_local: Local rime density, e.g. LocalRimeDensity\nτ_wet: Wet growth time scale [s]\nρ_i: Cloud ice density [kg m⁻³]\nρ_l: Cloud liquid water density [kg m⁻³]\nT_freeze: Water freeze temperature [K]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.ParametersP3-Tuple{Float64}","page":"API","title":"CloudMicrophysics.Parameters.ParametersP3","text":"ParametersP3(FT)\n\nCreate a ParametersP3 object from a floating point type FT.\n\nExamples\n\njulia> import CloudMicrophysics.Parameters as CMP\n\njulia> CMP.ParametersP3(Float64)\nParametersP3{Float64}\n├── mass: MassPowerLaw\n│   ├── α_va = 0.018537721864540644 [kg μm^(-β_va)]\n│   └── β_va = 1.9 [-]\n├── area: AreaPowerLaw\n│   ├── γ = 0.2285 [μm^(2-σ)]\n│   └── σ = 1.88 [-]\n├── slope: SlopePowerLaw\n│   ├── a = 0.00191 [m^b]\n│   ├── b = 0.8 [-]\n│   ├── c = 2.0 [-]\n│   └── μ_max = 6.0 [-]\n├── vent: VentilationFactor\n│   ├── aᵥ = 0.78 [-]\n│   └── bᵥ = 0.308 [-]\n├── ρ_rim_local: LocalRimeDensity\n│   ├── a = 51.0 [m^b]\n│   ├── b = 114.0 [-]\n│   ├── c = -5.5 [-]\n│   └── ρ_ice = 916.7 [-]\n├── τ_wet = 100.0 [s]\n├── ρ_i = 916.7 [kg m⁻³]\n├── ρ_l = 1000.0 [kg m⁻³]\n└── T_freeze = 273.15 [K]\n\n\n\n\n\n","category":"method"},{"location":"API/#CloudMicrophysics.Parameters.ParametersP3-Tuple{ClimaParams.ParamDict}","page":"API","title":"CloudMicrophysics.Parameters.ParametersP3","text":"ParametersP3(toml_dict::CP.ParamDict; [slope_law = :powerlaw])\n\nCreate a ParametersP3 object from a ClimaParams TOML dictionary.\n\nArguments\n\ntoml_dict::CP.ParamDict: A ClimaParams TOML dictionary\nslope_law: Slope law to use (:constant or, by default, :powerlaw)\n\n\n\n\n\n","category":"method"},{"location":"API/#CloudMicrophysics.Parameters.MassPowerLaw","page":"API","title":"CloudMicrophysics.Parameters.MassPowerLaw","text":"MassPowerLaw{FT}\n\nParameters for mass(size) relation.\n\nFrom measurements of mass grown by vapor diffusion and aggregation in midlatitude cirrus by Brown and Francis (1995) [24]\n\nA part of the ParametersP3 parameter set.\n\nnote: Note\nThe BF1995_mass_coeff_alpha parameter is provided in units of [g μm^(-β_va)] but the α_va field is stored in SI-like units of [kg m^(-β_va)] for consistency with the rest of the code.\n\nFields\n\nα_va: Coefficient in mass(size) relation [kg m^(-β_va)]\nβ_va: Coefficient in mass(size) relation [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.AreaPowerLaw","page":"API","title":"CloudMicrophysics.Parameters.AreaPowerLaw","text":"AreaPowerLaw{FT}\n\nParameters for area(size) relation.\n\nA(D) = γ D^σ\n\nwhere γ and σ are coefficients in area(size) for ice side plane, column, bullet, and planar polycrystal aggregates. Values are from Mitchell (1996) [25]\n\nA part of the ParametersP3 parameter set.\n\nFields\n\nγ: Scale [μm^(2-σ)]\nσ: Power [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.SlopeLaw","page":"API","title":"CloudMicrophysics.Parameters.SlopeLaw","text":"SlopeLaw{FT}\n\nThe top-level super-type for slope parameterizations.\n\nSee SlopePowerLaw and SlopeConstant for concrete implementations.\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.SlopePowerLaw","page":"API","title":"CloudMicrophysics.Parameters.SlopePowerLaw","text":"SlopePowerLaw{FT}\n\nSlope parameter μ as a power law in shape parameter λ:\n\nμ(λ) = a λ^b - c\n\nand is limited to:\n\n0  μ  μ_max\n\nSee also Eq. 3 in Morrison and Milbrandt (2015) [23]\n\nA part of the ParametersP3 parameter set.\n\nFields\n\na: Scale [m^b]\nb: Power [-]\nc: Offset [-]\nμ_max: Upper limiter [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.SlopeConstant","page":"API","title":"CloudMicrophysics.Parameters.SlopeConstant","text":"SlopeConstant{FT}\n\nSlope parameter μ as a constant:\n\nμ(λ) = μ_const\n\nA part of the ParametersP3 parameter set.\n\nFields\n\nμ: Slope parameter μ [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.VentilationFactor","page":"API","title":"CloudMicrophysics.Parameters.VentilationFactor","text":"VentilationFactor{FT}\n\nParameters for ventilation factor:\n\nF(D) = a_v + b_v  N_Sc^13 N_Re(D)^12\n\nwhere N_{Sc} is the Schmidt number and N_{Re}(D) is the Reynolds number for a particle with diameter D.\n\nFrom Seifert and Beheng (2006) [10], see also Eq. (13-61) in Pruppacher and Klett (2010) [65]\n\nA part of the ParametersP3 parameter set.\n\nFields\n\naᵥ: Constant coefficient in ventilation factor [-]\nbᵥ: Linear coefficient in ventilation factor [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.LocalRimeDensity","page":"API","title":"CloudMicrophysics.Parameters.LocalRimeDensity","text":"LocalRimeDensity{FT}\n(ρ′_rim::LocalRimeDensity)(Rᵢ)\n\nLocal rime density parameterization based on Cober and List (1993) [32], Eq. 16 and 17.\n\nGiven an instance ρ′_rim::LocalRimeDensity, obtain the local rime density  for a given Rᵢ [m² s⁻¹ °C⁻¹] by calling ρ′_rim(Rᵢ).\n\nThe parameterization is given by:\n\nρ_rim = a + b R_i + c R_i^2 quad 1  R_i  8\n\nThe range is extended to R_i ≤ 12, by linearly interpolating between  ρ′_rim(8) and ρ_ice = 900 kg/m³. The latter is the solid bulk ice density.\n\nFor calculating Rᵢ, see compute_local_rime_density.\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.P3Scheme.P3State","page":"API","title":"CloudMicrophysics.P3Scheme.P3State","text":"P3State{FT}\n\nState of the P3 scheme.\n\nThis struct bundles the P3 parameterizations params, the provided rime state (F_rim, ρ_rim),     and the derived threshold variables (D_th, D_gr, D_cr, ρ_g).\n\nTo obtain a P3State object, use the get_state function.\n\nFields\n\nparams: CMP.ParametersP3 object\nL_ice: The ice mass concentration [kg/m³]\nN_ice: The ice number concentration [1/m³]\nF_rim: Rime mass fraction\nρ_rim: Rime density\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.P3Scheme.get_state","page":"API","title":"CloudMicrophysics.P3Scheme.get_state","text":"get_state(params; L_ice, N_ice, F_rim, ρ_rim)\n\nCreate a P3State from CMP.ParametersP3 and rime state parameters.\n\nArguments\n\nparams: CMP.ParametersP3 object\n\nKeyword arguments\n\nL_ice: ice mass concentration [kg/m³]\nN_ice: ice number concentration [1/m³]\nF_rim: rime mass fraction [-], F_rim = L_rim / L_ice\nρ_rim: rime density [kg/m³],   ρ_rim = L_rim / B_rim\n\nExamples\n\n```jldoctest  julia> import CloudMicrophysics.Parameters as CMP,                CloudMicrophysics.P3Scheme as P3\n\njulia> FT = Float32;\n\njulia> params = CMP.ParametersP3(FT);\n\njulia> state = P3.getstate(params; Frim = FT(0.5), ρrim = FT(916.7))  P3State{Float32}  ├── params = {MassPowerLaw, AreaPowerLaw, SlopePowerLaw, VentilationFactor}  ├── Frim = 0.5 [-]  └── ρ_rim = 916.7 [kg/m^3]  ```\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.get_thresholds_ρ_g","page":"API","title":"CloudMicrophysics.P3Scheme.get_thresholds_ρ_g","text":"get_thresholds_ρ_g(state::P3State)\nget_thresholds_ρ_g(params::CMP.ParametersP3, F_rim, ρ_rim)\n\nReturns\n\n(; D_th, D_gr, D_cr, ρ_g): The thresholds for the size distribution,   and the density of total (deposition + rime) ice mass for graupel [kg/m³]\n\nSee get_D_th, get_D_gr, get_D_cr, and get_ρ_g for more details.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.get_ρ_d","page":"API","title":"CloudMicrophysics.P3Scheme.get_ρ_d","text":"get_ρ_d(mass::MassPowerLaw, F_rim, ρ_rim)\nget_ρ_d(state::P3State)\n\nExact solution for the density of the unrimed portion of the particle as     function of the rime mass fraction F_rim, mass power law parameters mass,     and rime density ρ_rim.\n\nArguments\n\nmass: CMP.MassPowerLaw parameters\nF_rim: rime mass fraction\nρ_rim: rime density\n\nReturns\n\nρ_d: density of the unrimed portion of the particle [kg/m³]\n\nExamples\n\njulia> import CloudMicrophysics.Parameters as CMP,\n              ClimaParams as CP,\n              CloudMicrophysics.P3Scheme as P3\n\njulia> FT = Float64;\n\njulia> mass = CMP.MassPowerLaw(CP.create_toml_dict(FT));\n\njulia> F_rim, ρ_rim = FT(0.5), FT(916.7);\n\njulia> ρ_d = P3.get_ρ_d(mass, F_rim, ρ_rim)\n488.9120789986412\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.get_ρ_g","page":"API","title":"CloudMicrophysics.P3Scheme.get_ρ_g","text":"get_ρ_g(F_rim, ρ_rim, ρ_d)\nget_ρ_g(mass::MassPowerLaw, F_rim, ρ_rim)\n\nReturn the density of total (deposition + rime) ice mass for graupel [kg/m³]\n\nArguments\n\nF_rim: rime mass fraction (L_rim / L_ice) [-]\nρ_rim: rime density (L_rim / B_rim) [kg/m³]\nρ_d: density of the unrimed portion of the particle [kg/m³], see get_ρ_d\n\nReturns\n\nρ_g: density of total (deposition + rime) ice mass for graupel [kg/m³]\n\nNotes:\n\nSee Eq. 16 in [23].\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.get_D_th","page":"API","title":"CloudMicrophysics.P3Scheme.get_D_th","text":"get_D_th(mass::MassPowerLaw, ρ_i)\n\nReturn the critical size separating spherical and nonspherical ice [meters]\n\nSee Eq. 8 in [23].\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.get_D_gr","page":"API","title":"CloudMicrophysics.P3Scheme.get_D_gr","text":"get_D_gr(mass::MassPowerLaw, ρ_g)\n\nReturn the size of equal mass for graupel and unrimed ice [meters]\n\nSee Eq. 15 in [23].\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.get_D_cr","page":"API","title":"CloudMicrophysics.P3Scheme.get_D_cr","text":"get_D_cr(mass::MassPowerLaw, F_rim, ρ_g)\n\nReturn the size of equal mass for graupel and partially rimed ice [meters]\n\nSee Eq. 14 in [23].\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.ice_mass","page":"API","title":"CloudMicrophysics.P3Scheme.ice_mass","text":"ice_mass(state, D)\nice_mass(params, F_rim, ρ_rim, D)\n\nReturn the mass of a particle based on where it falls in the particle-size-based properties regime.\n\nArguments\n\nstate: The P3State, or\nparams, F_rim, ρ_rim: The CMP.ParametersP3, rime mass fraction, and rime density,\nD: maximum particle dimension [m]\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.ice_density","page":"API","title":"CloudMicrophysics.P3Scheme.ice_density","text":"ice_density(state::P3State, D)\nice_density(params::CMP.ParametersP3, F_rim, ρ_rim, D)\n\nReturn the density of a particle at diameter D\n\nArguments\n\nstate: The P3State, or\nparams, F_rim, ρ_rim: The CMP.ParametersP3, rime mass fraction, and rime density,\nD: maximum particle dimension [m]\n\nNotes:\n\nThe density of nonspherical particles is assumed to be the particle mass divided  by the volume of a sphere with the same D [23].  Needed for aspect ratio calculation, so we assume zero liquid fraction.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.∂ice_mass_∂D","page":"API","title":"CloudMicrophysics.P3Scheme.∂ice_mass_∂D","text":"∂ice_mass_∂D(state::P3State, D)\n∂ice_mass_∂D(params::CMP.ParametersP3, F_rim, ρ_rim, D)\n\nReturn the derivative of the ice mass with respect to the particle diameter.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.ice_area","page":"API","title":"CloudMicrophysics.P3Scheme.ice_area","text":"ice_area(state::P3State, D)\nice_area(params::CMP.ParametersP3, F_rim, ρ_rim, D)\n\nReturn the cross-sectional area of a particle based on where it falls in the     particle-size-based properties regime.\n\nArguments\n\nstate: P3State object, or\nparams, F_rim, ρ_rim: The CMP.ParametersP3, rime mass fraction, and rime density,\nD: maximum particle dimension [m]\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.ϕᵢ","page":"API","title":"CloudMicrophysics.P3Scheme.ϕᵢ","text":"ϕᵢ(state::P3State, D)\nϕᵢ(params::CMP.ParametersP3, F_rim, ρ_rim, D)\n\nReturns the aspect ratio (ϕ) for an ice particle\n\nArguments\n\nstate: The P3State, or\nparams, F_rim, ρ_rim: The CMP.ParametersP3, rime mass fraction, and rime density,\nD: maximum dimension of ice particle [m]\n\nNotes\n\nThe density of nonspherical particles is assumed to be equal to the particle mass  divided by the volume of a spherical particle with the same D_max [23].  Assuming zero liquid fraction and oblate shape.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.get_μ","page":"API","title":"CloudMicrophysics.P3Scheme.get_μ","text":"get_μ(slope::CMP.SlopeLaw, logλ)\nget_μ(state::P3State, logλ)\n\nCompute the slope parameter μ\n\nArguments\n\nslope: CMP.SlopeLaw object, or\nstate: P3State object, or\nparams: CMP.ParametersP3 object\nlogλ: The log of the slope parameter [log(1/m)]\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.get_logN₀","page":"API","title":"CloudMicrophysics.P3Scheme.get_logN₀","text":"get_logN₀(N_ice, μ, logλ)\n\nCompute log(N₀) given the state, N, and logλ,\n\n    N  = N₀ ∫ G(D) dD\nlog N₀ = log N - log(∫G(D) dD) \n       = log(N) - log( ∫D^μ e^{-λD} dD )\n       = log(N) - M⁰\n\nArguments\n\nN_ice: The number concentration [1/m³]\nμ: The shape parameter [-]\nlogλ: The log of the slope parameter [log(1/m)]\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.get_distribution_logλ","page":"API","title":"CloudMicrophysics.P3Scheme.get_distribution_logλ","text":"get_distribution_logλ(params, L_ice, N_ice, F_rim, ρ_rim; [logλ_min, logλ_max])\nget_distribution_logλ(state; [logλ_min, logλ_max])\n\nSolve for the distribution parameters given the state, and the mass (L) and number (N) concentrations.\n\nThe assumed distribution is of the form\n\nN(D) = N₀ D^μ e^-λD\n\nwhere N′(D) is the number concentration at diameter D and μ is the slope parameter.     The slope parameter is parameterized, e.g. CMP.SlopePowerLaw or CMP.SlopeConstant.\n\nThis algorithm solves for logλ = log(λ) and log_N₀ = log(N₀)      given L_ice and N_ice by solving the equations:\n\nbeginalign*\nlog(L) = log _0^ m(D) N(D) mathrmdD \nlog(N) = log _0^ N(D) mathrmdD \nendalign*\n\nwhere m(D) is the mass of a particle at diameter D (see ice_mass).     The procedure is decribed in detail in the P3 docs.\n\nArguments\n\nstate: P3State object\nparams: CMP.ParametersP3 object\nL_ice: The mass concentration [kg/m³]\nN_ice: The number concentration [1/m³]\nF_rim: The rime mass fraction\nρ_rim: The rime density\n\nKeyword arguments\n\nlogλ_min: The minimum value of the search bounds [log(1/m)], default is log(1e1)\nlogλ_max: The maximum value of the search bounds [log(1/m)], default is log(1e7)\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.logN′ice","page":"API","title":"CloudMicrophysics.P3Scheme.logN′ice","text":"logN′ice(state, logλ)\n\nCompute the log of the ice particle number concentration at diameter D given the distribution dist\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.DistributionTools.size_distribution-Tuple{CloudMicrophysics.P3Scheme.P3State, Any}","page":"API","title":"CloudMicrophysics.DistributionTools.size_distribution","text":"size_distribution(state::P3State, logλ)\n\nReturn n(D), a function that computes the size distribution for ice particles at diameter D\n\nArguments\n\nstate: The P3State\nlogλ: The log of the slope parameter [log(1/m)]\n\n\n\n\n\n","category":"method"},{"location":"API/#CloudMicrophysics.P3Scheme.loggamma_inc_moment","page":"API","title":"CloudMicrophysics.P3Scheme.loggamma_inc_moment","text":"loggamma_inc_moment(D₁, D₂, μ, logλ, [k = 0], [scale = 1])\n\nCompute log(Iᵏ) where Iᵏ is the following integral:\n\n``I^k = ∫_{D₁}^{D₂} G(D) D^k dD``\n\nG(D)  D^μ e^-λD is the (unnormalized) gamma kernel, and k is an arbitrary exponent.\n\nIf scale is provided, log(scale ⋅ Iᵏ) is returned.\n\nWith appropriate scaling, we can compute useful quantities like:\n\nthe k-th moment of the ice PSD,  M^k = N₀ I^k\ncombined power law and moment weighted integrals,  _D₁^D₂ (aD^b) D^n K(D) dD  a I^(b + n)\n\nArguments\n\nD₁: The minimum diameter [m]\nD₂: The maximum diameter [m]\nμ: The PSD shape parameter [-]\nlogλ: The log of the PSD slope parameter [log(1/m)]\nk: An arbitrary exponent [-], default is 0\nscale: The scale factor [-], default is 1\n\nExtended help\n\nImplementation details\n\nWe can write ∫_D₁^D₂ G(D) D^k dD, where G(D) = D^μ e^{-λD} as:     ∫_D₁^∞ G(D) D^k dD - ∫_D₂^∞ G(D) D^k dD  with the transformation x = λD, and z = μ+k+1, each term can be written as:     ∫_{Dᵢ}^∞ G(D) D^k dD = ∫_{λDᵢ}^∞ x^z e^{-x} dx / λ^z = Γ(z, λDᵢ) / λ^z  where Γ(z, λDᵢ) = q ⋅ Γ(z) and q is the incomplete gamma function ratio given by     (_, q) = SF.gamma_inc(z, x).  This means that the integral ∫_{Dᵢ}^∞ G(D) D^k dD is computed as:     Γ(z) ⋅ q / λ^z  The full integral from D₁ to D₂ is then:     Γ(z) ⋅ (q_D₁ - q_D₂) / λ^z  In log-space, this is:     - z log(λ) + logΓ(z) + log(q_D₁ - q_D₂)\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.loggamma_moment","page":"API","title":"CloudMicrophysics.P3Scheme.loggamma_moment","text":"loggamma_moment(μ, logλ; [k = 0], [scale = 1])\n\nCompute log(scale ⋅ ∫_0^∞ G(D) D^k dD),   where G(D) ≡ D^μ e^{-λD} is the (unnormalized) gamma kernel,   k is an arbitrary exponent, and scale is a scale factor.\n\nArguments\n\nμ: The PSD shape parameter [-]\nlogλ: The log of the PSD slope parameter [log(1/m)]\n\nKeyword arguments\n\nk: An arbitrary exponent [-], default is 0\nscale: The scale factor [-], default is 1.\n\nThe implementation follows the same logic as loggamma_inc_moment,     but with D₁ = 0 and D₂ = ∞, which implies q_D₁ = 1 and q_D₂ = 0.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.logmass_gamma_moment","page":"API","title":"CloudMicrophysics.P3Scheme.logmass_gamma_moment","text":"logmass_gamma_moment(state, logλ; [n=0])\n\nCompute log(∫_0^∞ Dⁿ m(D) N′(D) dD) given the state and logλ.     This is the log of the n-th moment of the mass-weighted PSD.\n\nArguments\n\nstate: P3State object\nμ: The shape parameter [-]\nlogλ: The log of the slope parameter [log(1/m)]\n\nKeyword arguments\n\nn: The order of the moment, default is 0\n\nNote:\n\nFor n = 0, this evaluates to log(L/N₀)\nFor n = 1, this evaluates to the (unnormalized) mass-weighted mean particle size, see D_m\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.logLdivN","page":"API","title":"CloudMicrophysics.P3Scheme.logLdivN","text":"logLdivN(state, logλ)\n\nCompute log(L/N) given the state and logλ\n\nArguments\n\nstate: P3State object\nlogλ: The log of the slope parameter [log(1/m)]\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.D_m","page":"API","title":"CloudMicrophysics.P3Scheme.D_m","text":"D_m(state::P3State, logλ)\n\nCompute the mass weighted mean particle size [m]\n\nParameters\n\nstate: P3State object\nlogλ: The log of the slope parameter [log(1/m)]\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.ice_particle_terminal_velocity","page":"API","title":"CloudMicrophysics.P3Scheme.ice_particle_terminal_velocity","text":"ice_particle_terminal_velocity(velocity_params, ρₐ, state::P3State; [use_aspect_ratio])\nice_particle_terminal_velocity(velocity_params, ρₐ, params::CMP.ParametersP3, F_rim, ρ_rim; [use_aspect_ratio])\n\nReturns the terminal velocity of a single ice particle as a function of its size     (maximum dimension, D) using the Chen 2022 parametrization.\n\nArguments\n\nstate: A P3State\nvelocity_params: A CMP.Chen2022VelType with terminal velocity parameters\nρₐ: Air density [kg/m³]\n\nKeyword arguments\n\nuse_aspect_ratio: Bool flag set to true if we want to consider the effects  of particle aspect ratio on its terminal velocity (default: true)\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.ice_terminal_velocity_number_weighted","page":"API","title":"CloudMicrophysics.P3Scheme.ice_terminal_velocity_number_weighted","text":"ice_terminal_velocity_number_weighted(\n    velocity_params::CMP.Chen2022VelType, ρₐ, state::P3State, logλ;\n    [use_aspect_ratio], [∫kwargs...],\n)\n\nReturn the terminal velocity of the number-weighted mean ice particle size.\n\nArguments\n\nvelocity_params: A CMP.Chen2022VelType with terminal velocity parameters\nρₐ: Air density [kg/m³]\nstate: A P3State\nlogλ: The log of the slope parameter [log(1/m)]\n\nKeyword arguments\n\nuse_aspect_ratio: Bool flag set to true if we want to consider the effects  of particle aspect ratio on its terminal velocity (default: true)\n∫kwargs...: Additional optional keyword arguments to pass to the quadrature rule\n\nSee also ice_terminal_velocity_mass_weighted\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.ice_terminal_velocity_mass_weighted","page":"API","title":"CloudMicrophysics.P3Scheme.ice_terminal_velocity_mass_weighted","text":"ice_terminal_velocity_mass_weighted(velocity_params::CMP.Chen2022VelType, ρₐ, state::P3State, logλ; [use_aspect_ratio], [∫kwargs...])\n\nReturn the terminal velocity of the mass-weighted mean ice particle size.\n\nArguments\n\nvelocity_params: A CMP.Chen2022VelType with terminal velocity parameters\nρₐ: Air density [kg/m³]\nstate: A P3State\nlogλ: The log of the slope parameter [log(1/m)]\n\nKeyword arguments\n\nuse_aspect_ratio: Bool flag set to true if we want to consider the effects  of particle aspect ratio on its terminal velocity (default: true)\n∫kwargs...: Keyword arguments passed to the quadrature rule\n\nSee also ice_terminal_velocity_number_weighted\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.het_ice_nucleation","page":"API","title":"CloudMicrophysics.P3Scheme.het_ice_nucleation","text":"het_ice_nucleation(pdf_c, p3, tps, q_lcl, N, T, ρₐ, p, aerosol)\n\naerosol - aerosol parameters (supported types: desert dust, illite, kaolinite)\ntps - thermodynamics parameters\nq_lcl - cloud liquid water specific content\nN_lcl - cloud droplet number concentration\nRH - relative humidity\nT - temperature\nρₐ - air density\ndt - model time step\n\nReturns a named tuple with ice number concentration and ice content hetergoeneous freezing rates from cloud droplets.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.ice_melt","page":"API","title":"CloudMicrophysics.P3Scheme.ice_melt","text":"ice_melt(velocity_params::CMP.Chen2022VelType, aps, tps, Tₐ, ρₐ, dt, state, logλ; ∫kwargs...)\n\nArguments\n\nvelocity_params: CMP.Chen2022VelType\naps: CMP.AirProperties\ntps: thermodynamics parameters\nTₐ: temperature (K)\nρₐ: air density\ndt: model time step (for limiting the tendnecy)\nstate: a P3State object\nlogλ: the log of the slope parameter [log(1/m)]\n\nKeyword arguments\n\n∫kwargs...: Additional keyword arguments passed to the quadrature rule\n\nReturns the melting rate of ice (QIMLT in Morrison and Mildbrandt (2015)).\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.bulk_liquid_ice_collision_sources","page":"API","title":"CloudMicrophysics.P3Scheme.bulk_liquid_ice_collision_sources","text":"bulk_liquid_ice_collision_sources(\n    params, logλ, L_ice, F_rim, ρ_rim,\n    psd_c, psd_r, L_c, N_c, L_r, N_r,\n    aps, tps, vel, ρₐ, T,\n)\n\nComputes the bulk rates for ice and liquid particle collisions.\n\nArguments\n\nparams: the CMP.ParametersP3\nlogλ: the log of the slope parameter [log(1/m)]\nL_ice: ice water content [kg/m³]\nF_rim: riming fraction\nρ_rim: rime density [kg/m³]\npsd_c: a CMP.CloudParticlePDF_SB2006\npsd_r: a CMP.RainParticlePDF_SB2006\nL_c: cloud liquid water content [kg/m³]\nN_c: cloud liquid water number concentration [1/m³]\nL_r: rain water content [kg/m³]\nN_r: rain number concentration [1/m³]\naps: CMP.AirProperties\ntps: thermodynamics parameters\nvel: the velocity parameterization, e.g. CMP.Chen2022VelType\nρₐ: air density [kg/m³]\nT: temperature [K]\n\nReturns\n\nA NamedTuple of (; ∂ₜq_c, ∂ₜq_r, ∂ₜN_c, ∂ₜN_r, ∂ₜL_rim, ∂ₜL_ice, ∂ₜB_rim), where:\n\n∂ₜq_c: cloud liquid water content tendency [kg/kg/s]\n∂ₜq_r: rain water content tendency [kg/kg/s]\n∂ₜN_c: cloud number concentration tendency [1/m³/s]\n∂ₜN_r: rain number concentration tendency [1/m³/s]\n∂ₜL_rim: riming mass tendency [kg/m³/s]\n∂ₜL_ice: ice water content tendency [kg/m³/s]\n∂ₜB_rim: rime volume tendency [m³/m³/s]\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.volumetric_collision_rate_integrand","page":"API","title":"CloudMicrophysics.P3Scheme.volumetric_collision_rate_integrand","text":"volumetric_collision_rate_integrand(state, velocity_params, ρₐ)\n\nReturns a function that computes the volumetric collision rate integrand for ice-liquid collisions [m³/s]. The returned function takes ice and liquid particle diameters as arguments.\n\nArguments\n\nstate: P3State\nvelocity_params: velocity parameterization, e.g. CMP.Chen2022VelType\nρₐ: air density\n\nReturns\n\nA function (D_ice, D_liq) -> E * K * |vᵢ - vₗ| where:\n\nD_ice and D_liq are the (maximum) diameters of the ice and liquid particles\nE is the collision efficiency\nK is the collision cross section\nvᵢ and vₗ are the terminal velocities of ice and liquid particles\n\nNote that E, K, vᵢ and vₗ are all, in general, functions of D_ice and D_liq.\n\nThis function is a component of integrals like\n\n  E * K * vᵢ - vₗ * N_i * N_l dD_i dD_l\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.compute_max_freeze_rate","page":"API","title":"CloudMicrophysics.P3Scheme.compute_max_freeze_rate","text":"compute_max_freeze_rate(aps, tps, velocity_params, ρₐ, Tₐ, state)\n\nReturns a function max_freeze_rate(Dᵢ) that returns the maximum possible freezing rate [kg/s]     for an ice particle of diameter Dᵢ [m]. Evaluates to 0 if T ≥ T_freeze.\n\nArguments\n\naps: CMP.AirProperties\ntps: TDP.ThermodynamicsParameters\nvelocity_params: velocity parameterization, e.g. CMP.Chen2022VelType\nρₐ: air density [kg/m³]\nTₐ: air temperature [K]\nstate: P3State\n\nThis rate represents the thermodynamic upper limit to collisional freezing, which occurs when the heat transfer from the ice particle to the environment is balanced by the latent heat of fusion.\n\nFrom Eq (A7) in Musil (1970), [31].\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.compute_local_rime_density","page":"API","title":"CloudMicrophysics.P3Scheme.compute_local_rime_density","text":"compute_local_rime_density(velocity_params, ρₐ, T, state)\n\nProvides a function ρ′_rim(Dᵢ, Dₗ) that computes the local rime density [kg/m³]     for a given ice particle diameter Dᵢ [m] and liquid particle diameter Dₗ [m].\n\nArguments\n\nvelocity_params: velocity parameterization, e.g. CMP.Chen2022VelType\nρₐ: air density [kg/m³]\nT: temperature [K]\nstate: P3State\n\nReturns\n\nA function that computes the local rime density [kg/m³] using the equation:\n\nρ_rim = a + b R_i + c R_i^2\n\nwhere\n\nR_i = frac 10^6  D_liq  v_liq - v_ice  2 T_sfc \n\nand T_sfc is the surface temperature [°C], D_liq is the liquid particle diameter [m], v_liqice is the particle terminal velocity [m/s]. So the units of R_i are [m² s⁻¹ °C⁻¹]. The units of ρ_rim are [kg/m³].\n\nWe assume for simplicity that T_sfc equals T, the ambient air temperature. For real graupel, T_sfc is slightly higher than T due to latent heat release of freezing liquid particles onto the ice particle. Morrison & Milbrandt (2013) found little sensitivity to \"realistic\" increases in T_sfc.\n\nSee also LocalRimeDensity.\n\nExtended help\n\nImplementation follows Cober and List (1993), Eq. 16 and 17.  See also the P3 fortran code, microphy_p3.f90, Line 3315-3323,  which extends the range of the calculation to R_i  12, the upper limit of which  then equals the solid bulk ice density, ρ_ice = 9167 kgm^3.\n\nNote that Morrison & Milbrandt (2015) [23] only uses this  parameterization for collisions with cloud droplets.  For rain drops, they use a value near the solid bulk ice density, ρ^* = 900 kgm^3.  We do not consider this distinction, and use this parameterization for all liquid particles.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.get_liquid_integrals","page":"API","title":"CloudMicrophysics.P3Scheme.get_liquid_integrals","text":"get_liquid_integrals(n, ∂ₜV, m_liq, ρ′_rim, liq_bounds; ∫kwargs...)\n\nReturns a function liquid_integrals(Dᵢ) that computes the liquid particle integrals     for a given ice particle diameter Dᵢ.\n\nArguments\n\nn: liquid particle size distribution function n(D)\n∂ₜV: volumetric collision rate integrand function ∂ₜV(Dᵢ, D)\nm_liq: liquid particle mass function m_liq(D)\nρ′_rim: local rime density function ρ′_rim(Dᵢ, D)\nliq_bounds: integration bounds for liquid particles\n\nKeyword arguments\n\n∫kwargs...: Additional keyword arguments passed to the quadrature rule\n\nNotes\n\nThe function liquid_integrals(Dᵢ) returns a tuple (∂ₜN_col, ∂ₜM_col, ∂ₜB_col)     of collision rates at Dᵢ, where:\n\n∂ₜN_col: number collision rate [1/s]\n∂ₜM_col: mass collision rate [kg/s]\n∂ₜB_col: rime volume collision rate [m³/s]\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.∫liquid_ice_collisions","page":"API","title":"CloudMicrophysics.P3Scheme.∫liquid_ice_collisions","text":"∫liquid_ice_collisions(\n    n_i, ∂ₜM_max, cloud_integrals, rain_integrals, ice_bounds; ∫kwargs...\n)\n\nComputes the bulk collision rate integrands between ice and liquid particles.\n\nArguments\n\nn_i: ice particle size distribution function n_i(D)\n∂ₜM_max: maximum freezing rate function ∂ₜM_max(Dᵢ)\ncloud_integrals: an instance of get_liquid_integrals for cloud particles\nrain_integrals: an instance of get_liquid_integrals for rain particles\nice_bounds: integration bounds for ice particles, from integral_bounds\n\nKeyword arguments\n\n∫kwargs...: Additional keyword arguments passed to the quadrature rule\n\nReturns\n\nA tuple of 8 integrands, see ∫liquid_ice_collisions for details.\n\n\n\n\n\n∫liquid_ice_collisions(\n    state, logλ, psd_c, psd_r, L_c, N_c, L_r, N_r,\n    aps, tps, vel, ρₐ, T, m_liq\n)\n\nCompute key liquid-ice collision rates and quantities. Used by bulk_liquid_ice_collision_sources.\n\nArguments\n\nstate: P3State\nlogλ: the log of the slope parameter [log(1/m)]\npsd_c: CMP.CloudParticlePDF_SB2006\npsd_r: CMP.RainParticlePDF_SB2006\nL_c: cloud liquid water content [kg/m³]\nN_c: cloud liquid water number concentration [1/m³]\nL_r: rain water content [kg/m³]\nN_r: rain number concentration [1/m³]\naps: CMP.AirProperties\ntps: TDP.ThermodynamicsParameters\nvel: velocity parameterization, e.g. CMP.Chen2022VelType\nρₐ: air density [kg/m³]\nT: temperature [K]\nm_liq: liquid particle mass function m_liq(D)\n\nReturns\n\nA tuple (QCFRZ, QCSHD, NCCOL, QRFRZ, QRSHD, NRCOL, ∫M_col, BCCOL, BRCOL, ∫𝟙_wet_M_col), where:\n\nQCFRZ - Cloud mass collision rate due to freezing [kg/s]\nQCSHD - Cloud mass collision rate due to shedding [kg/s]\nNCCOL - Cloud number collision rate [1/s]\nQRFRZ - Rain mass collision rate due to freezing [kg/s]\nQRSHD - Rain mass collision rate due to shedding [kg/s]\nNRCOL - Rain number collision rate [1/s]\n∫M_col - Total collision rate [kg/s]\nBCCOL - Cloud rime volume source [m³/m³/s]\nBRCOL - Rain rime volume source [m³/m³/s]\n∫𝟙_wet_M_col - Wet growth indicator [kg/s]\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.integrate","page":"API","title":"CloudMicrophysics.P3Scheme.integrate","text":"integrate(f, a, b, quad = ChebyshevGauss(100))\n\nApproximate the definite integral ∫ₐᵇ f(x) dx using Chebyshev-Gauss quadrature of the first kind.\n\nMathematical Background\n\nThis method transforms the integral to the standard interval [-1, 1] and applies   Chebyshev-Gauss quadrature. The transformation is:\n\n y = (2x - (a+b)) / (b-a)    →    x = (b-a)y/2 + (a+b)/2\n\nwith Jacobian dx/dy = (b-a)/2.\n\nThe integral becomes:\n\n ∫ₐᵇ f(x) dx = (b-a)/2 ∫₋₁¹ f(x(y)) dy\n\nUsing the Chebyshev-Gauss quadrature identity:\n\n ∫₋₁¹ g(y) dy = ∫₋₁¹ [g(y)√(1-y²)] / √(1-y²) dy ≈ (π/n) ∑ᵢ₌₁ⁿ g(yᵢ)√(1-yᵢ²)\n\nwhere yᵢ = cos((2i-1)π/(2n)) are the Chebyshev nodes of the first kind.\n\nFinal Formula\n\n ∫ₐᵇ f(x) dx ≈ (b-a)π/(2n) ∑ᵢ₌₁ⁿ f(xᵢ)√(1-yᵢ²)\n\nwhere:\n\nyᵢ = cos((2i-1)π/(2n)) for i = 1, ..., n\nxᵢ = (b-a)yᵢ/2 + (a+b)/2 \nAll quadrature weights are equal: π/n\n\nArguments\n\nf: Function to integrate\na, b: Integration bounds. Note: if a ≥ b, or a or b is NaN, zero(f(a)) is returned.\n\nKeyword arguments\n\nquad: Quadrature scheme, default: ChebyshevGauss(100)\n\nReturns\n\nApproximation to the definite integral ∫ₐᵇ f(x) dx\n\nNotes\n\nThis method achieves spectral convergence for smooth functions and is particularly   effective for analytic functions. The √(1-y²) weighting factor helps handle   functions with mild singularities at the interval endpoints.  Ref: https://en.wikipedia.org/wiki/Chebyshev–Gauss_quadrature\n\n\n\n\n\nintegrate(f, bnds...; quad = ChebyshevGauss(100))\n\nIntegrate the function f over each subinterval of the integration bounds, bnds.\n\nArguments\n\nf: Function to integrate\nbnds: A tuple of bounds, (a, b, c, d, ...)\nquad: Quadrature scheme, default: ChebyshevGauss(100)\n\nThe integral is computed as the sum of the integrals over each subinterval,  (a, b), (b, c), (c, d), ....\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.P3Scheme.ChebyshevGauss","page":"API","title":"CloudMicrophysics.P3Scheme.ChebyshevGauss","text":"ChebyshevGauss(n)\n\nQuadrature scheme for Chebyshev-Gauss quadrature of the first kind.\n\nArguments\n\nn: Number of quadrature points\n\nAvailable methods\n\nnode(::ChebyshevGauss, i::FT, n) where {FT}\nweight(::ChebyshevGauss, i::FT, n) where {FT}\ninv_weight_fun(::ChebyshevGauss, y)\n\nnode(quad, i, n): Return the i-th node of the n-point Chebyshev-Gauss quadrature scheme.\nweight(quad, i, n): Return the i-th weight of the n-point Chebyshev-Gauss quadrature scheme.\ninv_weight_fun(quad, y): Return the inverse of the weight function w(x).\n\nMathematical Background\n\nA method to approximate the value of integrals of the kind\n\n∫_{-1}^{1} f(x) w(x) dx ≈ ∑_1^n f(x_i) wᵢ(x_i)\n\nwhere w(x) = 1 / √(1 - x^2) is the weight function, x_i are the nodes, and wᵢ are the weights.\n\nIf we are interested in only the integral of f(x), we can instead integrate g(x) = f(x) / w(x),\n\n∫_{-1}^{1} g(x) w(x) dx ≈ ∑_1^n g(x_i) wᵢ(x_i) = ∑_1^n f(x_i) wᵢ(x_i) / w(x_i)\n\nReferences\n\nhttps://en.wikipedia.org/wiki/Chebyshev–Gauss_quadrature\nhttps://en.wikipedia.org/wiki/Gaussian_quadrature\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.P3Scheme.integral_bounds","page":"API","title":"CloudMicrophysics.P3Scheme.integral_bounds","text":"integral_bounds(state::P3State, logλ; p, moment_order = 0)\n\nCompute the integration bounds for the P3 size distribution,\n\nMⁿ = ∫_a^b Dⁿ * N′(D) dD = N₀ * ∫_a^b Dⁿ D^μ * exp(-λ * D) dD\n\nwhere Mⁿ is the n-th moment of the size distribution.  Here n ≡ moment_order and a and b are the integration bounds.  For a proper moment, a=0 and b=∞. For the numerical integration, a and b  are determined by this function.\n\nArguments\n\nstate: P3State object\nlogλ: The log of the slope parameter [log(1/m)]\np: The integration bounds are set to the p-th and 1-p-th quantiles of the size distribution.\nmoment_order: For integrands proportional to moments of the size distribution,    moment_order can be used to indicate the order of the moment.    May provide more accurate bounds; thus more accurate integration.   Default: moment_order = 0.\n\nReturns\n\nbnds: The integration bounds (a Tuple), for use in numerical integration (c.f. integrate).\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.AerosolModel","page":"API","title":"CloudMicrophysics.AerosolModel","text":"A container for information on aerosol size distribution\nand chemical properties.\n\nThe size distribution is a sum of lognormal internally mixed modes.\nThe chemical composition can be expressed using kappa parameter\nor hygroscopicity parameter B.\n\n\n\n\n\n","category":"module"},{"location":"API/#CloudMicrophysics.AerosolModel.Mode_B","page":"API","title":"CloudMicrophysics.AerosolModel.Mode_B","text":"Mode_B\n\nRepresents the sizes and chemical composition of aerosol particles in one size distribution mode. The mode is assumed to be made up of internally mixed components and follow a lognormal size distribution. The chemical composition of aerosol particles in this mode is described using the parameters from Abdul-Razzak and Ghan 2000.\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.AerosolModel.Mode_κ","page":"API","title":"CloudMicrophysics.AerosolModel.Mode_κ","text":"Mode_κ\n\nRepresents the sizes and chemical composition of aerosol particles in one size distribution mode. The mode is assumed to be made up of internally mixed components and follow a lognormal size distribution. The chemical composition of aerosol particles in this mode is described using the parameters from Petters and Kreidenweis 2007.\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.AerosolModel.AerosolDistribution","page":"API","title":"CloudMicrophysics.AerosolModel.AerosolDistribution","text":"AerosolDistribution\n\nRepresents the aerosol size distribution as a tuple with different modes. All modes have to either be of type ModeB (Abdul-Razzak and Ghan 2000) or of type Modeκ (Petters and Kreidenweis 2007).\n\nConstructors\n\nAerosolDistribution(modes::T)\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.AerosolActivation","page":"API","title":"CloudMicrophysics.AerosolActivation","text":"Aerosol activation scheme, which includes:\n\nmean hygroscopicity for each mode of the aerosol size distribution\ncritical supersaturation for each mode of the aerosol size distribution\nmaximum supersaturation\ntotal number of particles actived\ntotal mass of particles actived\n\n\n\n\n\n","category":"module"},{"location":"API/#CloudMicrophysics.AerosolActivation.mean_hygroscopicity_parameter","page":"API","title":"CloudMicrophysics.AerosolActivation.mean_hygroscopicity_parameter","text":"mean_hygroscopicity_parameter(ap, ad)\n\nap - a struct with aerosol activation parameters\nad - a struct with aerosol distribution (B or κ based)\n\nReturns a tuple of hygroscopicity parameters (one tuple element for each aerosol size distribution mode). The tuple is computed either as mass-weighted B parameters (Abdul-Razzak and Ghan 2000) or volume weighted kappa parameters (Petters and Kreidenweis 2007). Implemented via a dispatch based on aerosol distribution mode type.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.AerosolActivation.max_supersaturation","page":"API","title":"CloudMicrophysics.AerosolActivation.max_supersaturation","text":"max_supersaturation(ap, ad, aip, tps, T, p, w, q_tot, q_liq, q_ice, N_liq, N_ice)\n\nap  - a struct with aerosol activation parameters\nad  - a struct with aerosol distribution\naip - a struct with air parameters\ntps - a struct with thermodynamics parameters\nT   - air temperature\np   - air pressure\nw   - vertical velocity\nq_tot - total water specific content\nq_liq - liquid water specific content\nq_ice - ice water specific content\nN_liq - liquid water number concentration\nN_ice - ice water number concentration\n\nReturns the maximum supersaturation.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.AerosolActivation.N_activated_per_mode","page":"API","title":"CloudMicrophysics.AerosolActivation.N_activated_per_mode","text":"N_activated_per_mode(ap, ad, aip, tps, T, p, w, q_tot, q_liq, q_ice, N_liq, N_ice)\n\nap  - a struct with aerosol activation parameters\nad  - aerosol distribution struct\naip - a struct with air parameters\ntps - a struct with thermodynamics parameters\nT   - air temperature\np   - air pressure\nw   - vertical velocity\nq_tot - total water specific content\nq_liq - liquid water specific content\nq_ice - ice water specific content\nN_liq - liquid water number concentration\nN_ice - ice water number concentration\n\nReturns the number of activated aerosol particles in each aerosol size distribution mode.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.AerosolActivation.M_activated_per_mode","page":"API","title":"CloudMicrophysics.AerosolActivation.M_activated_per_mode","text":"M_activated_per_mode(ap, ad, aip, tps, T, p, w, q_tot, q_liq, q_ice, N_liq, N_ice)\n\nap  - a struct with aerosol activation parameters\nad  - a struct with aerosol distribution parameters\naip - a struct with air parameters\ntps - a struct with thermodynamics parameters\nT - air temperature\np - air pressure\nw - vertical velocity\nq_tot - total water specific content\nq_liq - liquid water specific content\nq_ice - ice water specific content\nN_liq - liquid water number concentration\nN_ice - ice water number concentration\n\nReturns the mass of activated aerosol particles per mode of the aerosol size distribution.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.AerosolActivation.total_N_activated","page":"API","title":"CloudMicrophysics.AerosolActivation.total_N_activated","text":"total_N_activated(ap, ad, aip, tps, T, p, w, q_tot, q_liq, q_ice, N_liq, N_ice)\n\nap - a struct with aerosol activation parameters\nad - aerosol distribution struct\naip - a struct with air properties\ntps - a struct with thermodynamics parameters\nT - air temperature\np - air pressure\nw - vertical velocity\nq_tot - total water specific content\nq_liq - liquid water specific content\nq_ice - ice water specific content\nN_liq - liquid water number concentration\nN_ice - ice water number concentration\n\nReturns the total number of activated aerosol particles.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.AerosolActivation.total_M_activated","page":"API","title":"CloudMicrophysics.AerosolActivation.total_M_activated","text":"total_M_activated(ap, ad, aip, tps, T, p, w, q_tot, q_liq, q_ice, N_liq, N_ice)\n\nap - a struct with aerosol activation parameters\nad - aerosol distribution struct\naip - a struct with air properties\ntps - a struct with thermodynamics parameters\nT - air temperature\np - air pressure\nw - vertical velocity\nq_tot - total water specific content\nq_liq - liquid water specific content\nq_ice - ice water specific content\nN_liq - liquid water number concentration\nN_ice - ice water number concentration\n\nReturns the total mass of activated aerosol particles.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.ArtifactCalling","page":"API","title":"CloudMicrophysics.ArtifactCalling","text":"Call artifacts from Artifacts.toml\n\n\n\n\n\n","category":"module"},{"location":"API/#CloudMicrophysics.ArtifactCalling.AIDA_ice_nucleation","page":"API","title":"CloudMicrophysics.ArtifactCalling.AIDA_ice_nucleation","text":"AIDA_ice_nucleation(data_file_name)\n\ndata_file_name - name of the data file on Caltech box.\n\nReturns the filepath of the data file in Caltech box.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.HetIceNucleation","page":"API","title":"CloudMicrophysics.HetIceNucleation","text":"Parameterization for heterogenous cloud ice nucleation.\n\n\n\n\n\n","category":"module"},{"location":"API/#CloudMicrophysics.HetIceNucleation.dust_activated_number_fraction","page":"API","title":"CloudMicrophysics.HetIceNucleation.dust_activated_number_fraction","text":"dust_activated_number_fraction(dust, ip, Si, T)\n\ndust - a struct with dust parameters\nip - a struct with cloud ice nucleation parameters\nSi - ice saturation ratio\nT - air temperature [K]\n\nReturns the number fraction of mineral dust particles acting as deposition nuclei (n ice nuclei / n dust particles). From Mohler et al 2006 Table 2 (averages from different measurements excluding those where a was not measured)\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.HetIceNucleation.MohlerDepositionRate","page":"API","title":"CloudMicrophysics.HetIceNucleation.MohlerDepositionRate","text":"MohlerDepositionRate(dust, ip, S_i, T, dSi_dt, N_aer)\n\ndust - a struct with dust parameters\nip - a struct with cloud ice nucleation parameters\nSi - ice saturation\nT - ambient temperature\ndSi_dt - change in ice saturation over time\nN_aer - number of unactivated aerosols\n\nReturns the cloud ice nucleation rate from deposition. From Mohler et al 2006 equation 5.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.HetIceNucleation.deposition_J","page":"API","title":"CloudMicrophysics.HetIceNucleation.deposition_J","text":"deposition_J(dust, Δa_w)\n\ndust - a struct with dust parameters\nΔa_w - change in water activity [unitless].\n\nReturns the deposition nucleation rate coefficient, J, in m^-2 s^-1 for different minerals in liquid droplets. The free parameters m and c are derived from China et al (2017) see DOI: 10.1002/2016JD025817 Returns zero for unsupported aerosol types.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.HetIceNucleation.ABIFM_J","page":"API","title":"CloudMicrophysics.HetIceNucleation.ABIFM_J","text":"ABIFM_J(dust, Δa_w)\n\ndust - a struct with dust parameters\nΔa_w - change in water activity [unitless].\n\nReturns the immersion freezing nucleation rate coefficient, J, in m^-2 s^-1 for different minerals in liquid droplets. The free parameters m and c are taken from Knopf & Alpert 2013 see DOI: 10.1039/C3FD00035D Returns zero for unsupported aerosol types.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.HetIceNucleation.P3_deposition_N_i","page":"API","title":"CloudMicrophysics.HetIceNucleation.P3_deposition_N_i","text":"P3_deposition_N_i(ip, T)\n\nip - a struct with ice nucleation parameters,\nT - air temperature [K].\n\nReturns the number of ice crystals nucleated via deposition nucleation with units of m^-3. From Thompson et al 2004 eqn 2 as used in Morrison & Milbrandt 2015.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.HetIceNucleation.P3_het_N_i","page":"API","title":"CloudMicrophysics.HetIceNucleation.P3_het_N_i","text":"P3_het_N_i(ip, T, N_l, B, V_l, a, Δt)\n\nip - a struct with ice nucleation parameters,\nT - air temperature [K],\nN_l - number of droplets [m^-3],\nB - water-type dependent parameter [cm^-3 s^-1],\nV_l - volume of droplets to be frozen [m^3],\na - empirical parameter [C^-1],\nΔt - timestep.\n\nReturns the number of ice nucleated within Δt via heterogeneous freezing with units of m^-3. From Pruppacher & Klett 1997 eqn (9-51) as used in Morrison & Milbrandt 2015.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.HetIceNucleation.INP_concentration_frequency","page":"API","title":"CloudMicrophysics.HetIceNucleation.INP_concentration_frequency","text":"INP_concentration_frequency(params,INPC,T)\n\nparams - a struct with INPC(T) distribution parameters\nINPC - concentration of ice nucleating particles [m^-3]\nT - air temperature [K]\n\nReturns the relative frequency of a given INP concentration, depending on the temperature. Based on Frostenberg et al., 2023. See DOI: 10.5194/acp-23-10883-2023\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.HetIceNucleation.INP_concentration_mean","page":"API","title":"CloudMicrophysics.HetIceNucleation.INP_concentration_mean","text":"INP_concentration_mean(params, T)\n\nparams - a struct with INPC(T) distribution parameters\nT - air temperature [K]\n\nReturns the logarithm of mean INP concentration (in m^-3), depending on the temperature. Based on the function μ(T) in Frostenberg et al., 2023. See DOI: 10.5194/acp-23-10883-2023\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.HomIceNucleation","page":"API","title":"CloudMicrophysics.HomIceNucleation","text":"Parameterization for homogeneous cloud ice nucleation\n\n\n\n\n\n","category":"module"},{"location":"API/#CloudMicrophysics.HomIceNucleation.homogeneous_J_cubic","page":"API","title":"CloudMicrophysics.HomIceNucleation.homogeneous_J_cubic","text":"homogeneous_J_cubic(ip, Δa_w)\n\nip - a struct with cloud ice nucleation parameters\nΔa_w - change in water activity [-].\n\nReturns the homogeneous freezing nucleation rate coefficient, J, in m^-3 s^-1 for sulphuric acid solutions. Parameterization based on Koop 2000, DOI: 10.1038/35020537.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.HomIceNucleation.homogeneous_J_linear","page":"API","title":"CloudMicrophysics.HomIceNucleation.homogeneous_J_linear","text":"homogeneous_J_linear(ip, Δa_w)\n\nip - a struct with ice nucleation parameters\nΔa_w - change in water activity [-].\n\nReturns the homogeneous freezing nucleation rate coefficient, J, in m^-3 s^-1 for sulphuric acid solutions. Parameterization derived from a linear fit of the Koop 2000 parameterization, DOI: 10.1038/35020537.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.CloudDiagnostics","page":"API","title":"CloudMicrophysics.CloudDiagnostics","text":"Cloud diagnostics\n\nradar reflectivity (1-moment and 2-moment)\neffective radius  (1-moment and 2-moment)\n\n\n\n\n\n","category":"module"},{"location":"API/#CloudMicrophysics.CloudDiagnostics.radar_reflectivity_1M","page":"API","title":"CloudMicrophysics.CloudDiagnostics.radar_reflectivity_1M","text":"radar_reflectivity_1M(precip, q, ρ)\n\nprecip - struct with 1-moment microphysics rain free parameters\nq - specific content of rain\nρ - air density\n\nReturns logarithmic radar reflectivity for the 1-moment microphysics based on the assumed rain particle size distribution. Normalized by the reflectivty of 1 millimiter drop in a volume of 1m3. The values are clipped at -150 dBZ.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.CloudDiagnostics.radar_reflectivity_2M","page":"API","title":"CloudMicrophysics.CloudDiagnostics.radar_reflectivity_2M","text":"radar_reflectivity_2M(structs, q_lcl, q_rai, N_lcl, N_rai, ρ_air)\n\n- `structs` - structs microphysics 2-moment with SB2006 cloud droplets\n              and raindrops size distributions parameters\n- `q_lcl` - cloud liquid water specific content\n- `q_rai` - rain water specific content\n- `N_lcl` - cloud droplet number density\n- `N_rai` - rain droplet number density\n- `ρ_air` - air density\n\nReturns logarithmic radar reflectivity for the 2-moment microphysics SB2006 based on the assumed cloud and rain particle size distribuions. Normalized by the reflectivty of 1 millimiter drop in a volume of 1m3. The values are clipped at -150 dBZ.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.CloudDiagnostics.effective_radius_const","page":"API","title":"CloudMicrophysics.CloudDiagnostics.effective_radius_const","text":"effective_radius_const(cloud_params)\n\ncloud_params - a struct with cloud liquid or cloud ice parameters\n\nReturns a constant assumed effective radius for clouds\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.CloudDiagnostics.effective_radius_Liu_Hallet_97","page":"API","title":"CloudMicrophysics.CloudDiagnostics.effective_radius_Liu_Hallet_97","text":"effective_radius_Liu_Hallet_97(q_lcl, q_rai, N_lcl, N_rai, ρ_air, ρ_w)\n\n- `q_lcl` - cloud water specific content\n- `q_rai` - rain water specific content\n- `N_lcl` - cloud droplet number density\n- `N_rai` - rain droplet number density\n- `ρ_air` - air density\n- `ρ_w` - water density\n\nReturns effective radius using the \"1/3\" power law from Liu and Hallett (1997). If not provided by the user, it is assumed that there is no rain present and that the cloud droplet number concentration is 100 1/cm3.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.CloudDiagnostics.effective_radius_2M","page":"API","title":"CloudMicrophysics.CloudDiagnostics.effective_radius_2M","text":"effective_radius_2M(structs, q_lcl, q_rai, N_lcl, N_rai, ρ_air)\n\n- `structs` - structs with SB2006 cloud droplets and raindrops\n            size distribution parameters\n- `q_lcl` - cloud liquid water specific content\n- `q_rai` - rain water specific content\n- `N_lcl` - cloud droplet number density\n- `N_rai` - rain droplet number density\n- `ρ_air` - air density\n\nReturns effective radius for the 2-moment microphysics scheme. Computed based on the assumed cloud and rain particle size distributions.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Utilities","page":"API","title":"CloudMicrophysics.Utilities","text":"Utilities\n\nLightweight numerical utility functions shared across CloudMicrophysics modules. Contains pure numerical operations with no physics dependencies.\n\n\n\n\n\n","category":"module"},{"location":"API/#CloudMicrophysics.Utilities.clamp_to_nonneg","page":"API","title":"CloudMicrophysics.Utilities.clamp_to_nonneg","text":"clamp_to_nonneg(x)\n\nClamp values to be non-negative in an automatic differentiation (AD) compatible way. Uses ifelse to preserve dual number types during AD.\n\nArguments\n\nx: value to clamp\n\nReturns\n\nx if x ≥ 0, otherwise 0*x (preserving the type of x)\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Utilities.ϵ_numerics","page":"API","title":"CloudMicrophysics.Utilities.ϵ_numerics","text":"ϵ_numerics(FT)\n\nSmallest number that is different than zero for the purpose of microphysics computations. Returns sqrt(floatmin(FT)) to avoid underflow issues.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Utilities.ϵ_numerics_2M_M","page":"API","title":"CloudMicrophysics.Utilities.ϵ_numerics_2M_M","text":"ϵ_numerics_2M_M(FT)\n\nNumerical epsilon for 2-moment mass calculations.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Utilities.ϵ_numerics_2M_N","page":"API","title":"CloudMicrophysics.Utilities.ϵ_numerics_2M_N","text":"ϵ_numerics_2M_N(FT)\n\nNumerical epsilon for 2-moment number calculations.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Common","page":"API","title":"CloudMicrophysics.Common","text":"Module for functions shared by different parameterizations.\n\n\n\n\n\n","category":"module"},{"location":"API/#CloudMicrophysics.Common.G_func_liquid","page":"API","title":"CloudMicrophysics.Common.G_func_liquid","text":"G_func_liquid(air_props, tps, T)\n\nUtility function combining thermal conductivity and vapor diffusivity effects for vapor to liquid phase change.\n\nIncludes guards against division by zero using ϵ_numerics thresholds for numerical robustness.\n\nArguments\n\nair_props: air parameters struct (contains K_therm, D_vapor)\ntps: thermodynamics parameters struct\nT: air temperature [K]\n\nReturns\n\nG function for liquid [kg/m²/s/Pa]\n\nNotes\n\nDivision by K_therm, D_vapor, and p_vs are guarded with max(value, UT.ϵ_numerics(FT))\nThis prevents NaN/Inf propagation from near-zero denominators\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Common.G_func_ice","page":"API","title":"CloudMicrophysics.Common.G_func_ice","text":"G_func_ice(air_props, tps, T)\n\nUtility function combining thermal conductivity and vapor diffusivity effects for vapor to ice phase change.\n\nIncludes guards against division by zero using ϵ_numerics thresholds for numerical robustness.\n\nArguments\n\nair_props: air parameters struct (contains K_therm, D_vapor)\ntps: thermodynamics parameters struct\nT: air temperature [K]\n\nReturns\n\nG function for ice [kg/m²/s/Pa]\n\nNotes\n\nDivision by K_therm, D_vapor, and p_vs are guarded with max(value, UT.ϵ_numerics(FT))\nThis prevents NaN/Inf propagation from near-zero denominators\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Common.logistic_function","page":"API","title":"CloudMicrophysics.Common.logistic_function","text":"logistic_function(x, x_0, k)\n\nReturns the value of the logistic function for smooth transitioning at thresholds. This is a normalized curve changing from 0 to 1 while x varies from 0 to Inf (for positive k).\n\nFor x < 0 the value at x = 0 is returned. For x_0 = 0, H(x) is returned.\n\nArguments\n\nx: independent variable\nx_0: threshold value for x\nk: growth rate of the curve, characterizing steepness of the transition\n\nReturns\n\nLogistic function value (dimensionless, range [0,1])\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Common.logistic_function_integral","page":"API","title":"CloudMicrophysics.Common.logistic_function_integral","text":"logistic_function_integral(x, x_0, k)\n\nReturns the value of the indefinite integral of the logistic function, for smooth transitioning of piecewise linear profiles at thresholds.\n\nThis curve smoothly transitions from y = 0 for 0 < x < x0 to y = x - x0 for x_0 < x.\n\nArguments\n\nx: independent variable\nx_0: threshold value for x\nk: growth rate of the logistic function, characterizing steepness of the transition\n\nReturns\n\nIntegral of logistic function (same units as x)\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Common.H2SO4_soln_saturation_vapor_pressure","page":"API","title":"CloudMicrophysics.Common.H2SO4_soln_saturation_vapor_pressure","text":"H2SO4_soln_saturation_vapor_pressure(prs, x, T)\n\nReturns the saturation vapor pressure above a sulphuric acid solution droplet.\n\nArguments\n\nprs: H2SO4 solution free parameters struct\nx: weight percent sulphuric acid (dimensionless, e.g., 0.1 for 10%)\nT: air temperature [K]\n\nReturns\n\nSaturation vapor pressure [Pa]\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Common.a_w_xT","page":"API","title":"CloudMicrophysics.Common.a_w_xT","text":"a_w_xT(H2SO4_prs, tps, x, T)\n\nReturns water activity of H2SO4 containing droplet.\n\nArguments\n\nH2SO4_prs: H2SO4 solution free parameters struct\ntps: thermodynamics parameters struct\nx: weight percent sulphuric acid (dimensionless, e.g., 0.1 for 10%)\nT: air temperature [K]\n\nReturns\n\nWater activity (dimensionless)\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Common.a_w_eT","page":"API","title":"CloudMicrophysics.Common.a_w_eT","text":"a_w_eT(tps, e, T)\n\nReturns water activity of pure water droplet. Valid when droplet is in equilibrium with surroundings.\n\nArguments\n\ntps: thermodynamics parameters struct\ne: partial pressure of water [Pa]\nT: air temperature [K]\n\nReturns\n\nWater activity (dimensionless, equivalent to relative humidity)\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Common.a_w_ice","page":"API","title":"CloudMicrophysics.Common.a_w_ice","text":"a_w_ice(tps, T)\n\nReturns water activity of ice.\n\nArguments\n\ntps: thermodynamics parameters struct\nT: air temperature [K]\n\nReturns\n\nWater activity of ice (dimensionless)\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Common.Chen2022_vel_coeffs","page":"API","title":"CloudMicrophysics.Common.Chen2022_vel_coeffs","text":"Chen2022_vel_coeffs(coeffs, ρₐ)\nChen2022_vel_coeffs(coeffs, ρₐ, ρᵢ)\n\nCompute the coefficients for the Chen 2022 terminal velocity parametrization.\n\nArguments\n\ncoeffs: a struct with terminal velocity free parameters\nCMP.Chen2022VelTypeRain: Fetch from Table B1\nCMP.Chen2022VelTypeSmallIce: Fetch from Table B2\nCMP.Chen2022VelTypeLargeIce: Fetch from Table B4\nρₐ: air density [kg/m³]\nρᵢ: apparent density of ice particles [kg/m³],  only used for CMP.Chen2022VelTypeSmallIce and CMP.Chen2022VelTypeLargeIce\n\nSee [12] for more details.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Common.Chen2022_monodisperse_pdf","page":"API","title":"CloudMicrophysics.Common.Chen2022_monodisperse_pdf","text":"Chen2022_monodisperse_pdf(a, b, c)\n\nArguments\n\na, b, c: free parameters defined in [12]\n\nReturns\n\npdf(D): The monodisperse particle distribution function as a function of diameter, D, in [m/s].\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Common.Chen2022_exponential_pdf","page":"API","title":"CloudMicrophysics.Common.Chen2022_exponential_pdf","text":"Chen2022_exponential_pdf(a, b, c, λ_inv, k)\n\nReturns the addends of the bulk fall speed of rain or ice particles following Chen et al. (2022), https://doi.org/10.1016/j.atmosres.2022.106171. Assumes exponential size distribution (μ=0).\n\nArguments\n\na, b, c: free parameters defined in Chen et al. (2022)\nλ_inv: inverse of the size distribution parameter [m]\nk: size distribution moment for which we compute the bulk fall speed\n\nReturns\n\nBulk fall speed component [m/s]\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Common.volume_sphere_D","page":"API","title":"CloudMicrophysics.Common.volume_sphere_D","text":"volume_sphere_D(D)\n\nCalculate the volume of a sphere with diameter D.\n\nV = D^3 * π  6\n\nSee also volume_sphere_R.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Common.volume_sphere_R","page":"API","title":"CloudMicrophysics.Common.volume_sphere_R","text":"volume_sphere_R(R)\n\nCalculate the volume of a sphere with radius R.\n\nV = (2R)^3 * π  6\n\nSee also volume_sphere_D.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Common.ventilation_factor","page":"API","title":"CloudMicrophysics.Common.ventilation_factor","text":"ventilation_factor(vent, aps, v_term)\n\nReturns a function that computes the ventilation factor for a particle as a function of its diameter.\n\nThe ventilation factor parameterizes the increase in the mass and heat exchange for falling particles. See e.g., Seifert and Beheng (2006), https://doi.org/10.1007/s00703-005-0112-4, Eq. (24).\n\nArguments\n\nvent: ventilation parameterization constants (contains aᵥ, bᵥ)\naps: air properties parameters (contains ν_air, D_vapor)\nv_term: function v_term(D) that returns terminal velocity [m/s] for diameter D [m]\n\nReturns\n\nF_v(D): ventilation factor function (dimensionless)\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.Parameters","page":"API","title":"CloudMicrophysics.Parameters","text":"Parameters\n\nA module for CloudMicrophysics.jl free parameters.\n\n\n\n\n\n","category":"module"},{"location":"API/#CloudMicrophysics.Parameters.ParametersType","page":"API","title":"CloudMicrophysics.Parameters.ParametersType","text":"ParametersType{FT}\n\nThe top-level super-type for all cloud microphysics parameters\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.AerosolType","page":"API","title":"CloudMicrophysics.Parameters.AerosolType","text":"AerosolType{FT}\n\nThe top-level super-type for all aerosol properties\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.AerosolDistributionType","page":"API","title":"CloudMicrophysics.Parameters.AerosolDistributionType","text":"AerosolDistributionType\n\nThe top-level super-type for all aerosol distribution types\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.CloudCondensateType","page":"API","title":"CloudMicrophysics.Parameters.CloudCondensateType","text":"CloudCondensateType{FT}\n\nThe top-level super-type for cloud condensate types (liquid and ice)\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.PrecipitationType","page":"API","title":"CloudMicrophysics.Parameters.PrecipitationType","text":"PrecipitationType{FT}\n\nThe top-level super-type for precipitation types (rain and snow)\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.TerminalVelocityType","page":"API","title":"CloudMicrophysics.Parameters.TerminalVelocityType","text":"TerminalVelocityType{FT}\n\nThe top-level super-type for terminal velocity parameterizations\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.Precipitation2MType","page":"API","title":"CloudMicrophysics.Parameters.Precipitation2MType","text":"Precipitation2MType\n\nThe top-level super-type for 2-moment precipitation parameterizations\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.AirProperties","page":"API","title":"CloudMicrophysics.Parameters.AirProperties","text":"AirProperties{FT}\n\nParameters with air properties.\n\nFields\n\nK_therm: thermal conductivity of air [w/m/K]\nD_vapor: diffusivity of water vapor [m2/s]\nν_air: kinematic viscosity of air [m2/s]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.WaterProperties","page":"API","title":"CloudMicrophysics.Parameters.WaterProperties","text":"WaterProperties{FT}\n\nParameters with water properties.\n\nFields\n\nρw: density of liquid water [kg/m3]\nρi: density of ice [kg/m3]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.ArizonaTestDust","page":"API","title":"CloudMicrophysics.Parameters.ArizonaTestDust","text":"ArizonaTestDust{FT}\n\nParameters for Arizona Test Dust from Mohler et al, 2006. DOI: 10.5194/acp-6-3007-2006\n\nFields\n\nS₀_warm: S₀ for T > T_thr [-]\nS₀_cold: S₀ for T < T_thr [-]\na_warm: a for T > T_thr [-]\na_cold: a for T < T_thr [-]\ndeposition_m: m coefficient for deposition nucleation J [-]\ndeposition_c: c coefficient for deposition nucleation J [-]\nABIFM_m: m coefficient for immersion freezing J [-]\nABIFM_c: c coefficient for immersion freezing J [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.DesertDust","page":"API","title":"CloudMicrophysics.Parameters.DesertDust","text":"DesertDust{FT}\n\nParameters for desert dust from Knopf and Alpert 2013 DOI: 10.1039/C3FD00035D and from Mohler et al, 2006 DOI: 10.5194/acp-6-3007-2006\n\nFields\n\nS₀_warm: S₀ for T > T_thr [-]\nS₀_cold: S₀ for T < T_thr [-]\na_warm: a for T > T_thr [-]\na_cold: a for T < T_thr [-]\nABIFM_m: m coefficient for immersion freezing J [-]\nABIFM_c: c coefficient for immersion freezing J [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.AsianDust","page":"API","title":"CloudMicrophysics.Parameters.AsianDust","text":"AsianDust{FT}\n\nParameters for Asian Dust\n\nFields\n\ndeposition_m: m coefficient for deposition nucleation J [-]\ndeposition_c: c coefficient for deposition nucleation J [-]\nABIFM_m: m coefficient for immersion freezing J [-]\nABIFM_c: c coefficient for immersion freezing J [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.MiddleEasternDust","page":"API","title":"CloudMicrophysics.Parameters.MiddleEasternDust","text":"MiddleEasternDust{FT}\n\nParameters for Middle Eastern Dust\n\nFields\n\nABIFM_m: m coefficient for immersion freezing J [-]\nABIFM_c: c coefficient for immersion freezing J [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.SaharanDust","page":"API","title":"CloudMicrophysics.Parameters.SaharanDust","text":"SaharanDust{FT}\n\nParameters for Saharan Dust\n\nFields\n\ndeposition_m: m coefficient for deposition nucleation J [-]\ndeposition_c: c coefficient for deposition nucleation J [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.Illite","page":"API","title":"CloudMicrophysics.Parameters.Illite","text":"Illite{FT}\n\nParameters for illite from Knopf and Alpert 2013 DOI: 10.1039/C3FD00035D\n\nFields\n\ndeposition_m: m coefficient for deposition nucleation J [-]\ndeposition_c: c coefficient for deposition nucleation J [-]\nABIFM_m: m coefficient for immersion freezing J [-]\nABIFM_c: c coefficient for immersion freezing J [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.Kaolinite","page":"API","title":"CloudMicrophysics.Parameters.Kaolinite","text":"Kaolinite{FT}\n\nParameters for kaolinite from Knopf and Alpert 2013 DOI: 10.1039/C3FD00035D and China et al 2017 DOI: 10.1002/2016JD025817\n\nFields\n\ndeposition_m: m coefficient for deposition nucleation J [-]\ndeposition_c: c coefficient for deposition nucleation J [-]\nABIFM_m: m coefficient for immersion freezing J [-]\nABIFM_c: c coefficient for immersion freezing J [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.Feldspar","page":"API","title":"CloudMicrophysics.Parameters.Feldspar","text":"Feldspar{FT}\n\nParameters for Feldspar from Alpert et al 2022 DOI: 10.1039/D1EA00077B\n\nFields\n\ndeposition_m: m coefficient for deposition nucleation J [-]\ndeposition_c: c coefficient for deposition nucleation J [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.Ferrihydrite","page":"API","title":"CloudMicrophysics.Parameters.Ferrihydrite","text":"Ferrihydrite{FT}\n\nParameters for Ferrihydrite from Alpert et al 2022 DOI: 10.1039/D1EA00077B\n\nFields\n\ndeposition_m: m coefficient for deposition nucleation J [-]\ndeposition_c: c coefficient for deposition nucleation J [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.Dust","page":"API","title":"CloudMicrophysics.Parameters.Dust","text":"Dust{FT}\n\nParameters for generic dust.\n\nFields\n\ndeposition_m: m coefficient for deposition nucleation J [-]\ndeposition_c: c coefficient for deposition nucleation J [-]\nABIFM_m: m coefficient for immersion freezing J [-]\nABIFM_c: c coefficient for immersion freezing J [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.Seasalt","page":"API","title":"CloudMicrophysics.Parameters.Seasalt","text":"Seasalt{FT}\n\nParameters for seasalt\n\nFields\n\nM: molar mass [kg/mol]\nρ: density [kg/m3]\nϕ: osmotic coefficient [-]\nν: ion number [-]\nϵ: water soluble mass fraction [-]\nκ: hygroscopicity parameter [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.Sulfate","page":"API","title":"CloudMicrophysics.Parameters.Sulfate","text":"Sulfate{FT}\n\nParameters for sulfate aerosol\n\nFields\n\nM: molar mass [kg/mol]\nρ: density [kg/m3]\nϕ: osmotic coefficient [-]\nν: ion number [-]\nϵ: water soluble mass fraction [-]\nκ: hygroscopicity parameter [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.AerosolActivationParameters","page":"API","title":"CloudMicrophysics.Parameters.AerosolActivationParameters","text":"AerosolActivationParameters{FT}\n\nParameters for Abdul-Razzak and Ghan 2000 aerosol activation scheme DOI: 10.1029/1999JD901161\n\nFields\n\nM_w: molar mass of water [kg/mol]\nR: gas constant [J/mol/K]\nρ_w: cloud water density [kg/m3]\nρ_i: cloud ice density [kg/m3]\nσ: surface tension of water [N/m]\ng: gravitational_acceleration [m/s2]\nf1: scaling coefficient in Abdul-Razzak and Ghan 2000 [-]\nf2: scaling coefficient in Abdul-Razzak and Ghan 2000 [-]\ng1: scaling coefficient in Abdul-Razzak and Ghan 2000 [-]\ng2: scaling coefficient in Abdul-Razzak and Ghan 2000 [-]\np1: power of (zeta / eta) in Abdul-Razzak and Ghan 2000 [-]\np2: power of (S_m^2 / (zeta + 3 * eta)) in Abdul-Razzak and Ghan 2000 [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.IceNucleationParameters","page":"API","title":"CloudMicrophysics.Parameters.IceNucleationParameters","text":"IceNucleationParameters{FT, DEP, HOM, P3_type}\n\nParameters for ice nucleation\n\nFields\n\ndeposition\nhomogeneous\np3\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.Frostenberg2023","page":"API","title":"CloudMicrophysics.Parameters.Frostenberg2023","text":"Frostenberg2023{FT}\n\nParameters for frequency distribution of INP concentration DOI: 10.5194/acp-23-10883-2023\n\nFields\n\nσ: standard deviation\na: coefficient\nb: coefficient\nT_freeze: freezing temperature [K]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.H2SO4SolutionParameters","page":"API","title":"CloudMicrophysics.Parameters.H2SO4SolutionParameters","text":"H2SO4SolutionParameters{FT}\n\nParameters for water activity of H2SO4 solutions from Luo et al 1995. DOI: 10.1029/94GL02988\n\nFields\n\nT_max: max temperature for which the parameterization is valid [K]\nT_min: min temperature for which the parameterization is valid [K]\nw_2: coefficient [-]\nc1: coefficient [-]\nc2: coefficient [-]\nc3: coefficient [-]\nc4: coefficient [-]\nc5: coefficient [-]\nc6: coefficient [-]\nc7: coefficient [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.Mohler2006","page":"API","title":"CloudMicrophysics.Parameters.Mohler2006","text":"Mohler2006{FT}\n\nParameters for ice nucleation from Mohler et al 2006 DOI: 10.5194/acp-6-3007-2006\n\nFields\n\nSᵢ_max: max allowed supersaturation [-]\nT_thr: threshold temperature [K]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.Koop2000","page":"API","title":"CloudMicrophysics.Parameters.Koop2000","text":"Koop2000{FT}\n\nParameters for ice nucleation from Koop et al 2000 DOI: 10.1038/35020537\n\nFields\n\nΔa_w_min: min Δaw [-]\nΔa_w_max: max Δaw [-]\nc₁: coefficient [-]\nc₂: coefficient [-]\nc₃: coefficient [-]\nc₄: coefficient [-]\nlinear_c₁: coefficient [-]\nlinear_c₂: coefficient [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.H2S04NucleationParameters","page":"API","title":"CloudMicrophysics.Parameters.H2S04NucleationParameters","text":"H2S04NucleationParameters{FT}\n\nParameters for pure sulfuric acid nucleation from Dunne et al 1016 DOI:10.1126/science.aaf2649\n\nFields\n\np_b_n\np_b_i\nu_b_n\nu_b_i\nv_b_n\nv_b_i\nw_b_n\nw_b_i\np_t_n\np_t_i\nu_t_n\nu_t_i\nv_t_n\nv_t_i\nw_t_n\nw_t_i\np_A_n\np_A_i\na_n\na_i\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.OrganicNucleationParameters","page":"API","title":"CloudMicrophysics.Parameters.OrganicNucleationParameters","text":"OrganicNucleationParameters{FT}\n\nParameters for pure organic nucleation from Kirkby 2016 DOI: 10.1038/nature17953\n\nFields\n\na_1\na_2\na_3\na_4\na_5\nY_MTO3\nY_MTOH\nk_MTO3\nk_MTOH\nexp_MTO3\nexp_MTOH\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.MixedNucleationParameters","page":"API","title":"CloudMicrophysics.Parameters.MixedNucleationParameters","text":"MixedNucleationParameters{FT}\n\nParameters for mixed organic and sulfuric acid nucleation from Riccobono et al 2014 DOI:10.1126/science.1243527\n\nFields\n\nk_H2SO4org\nk_MTOH\nexp_MTOH\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.Parameters0M","page":"API","title":"CloudMicrophysics.Parameters.Parameters0M","text":"Parameters0M{FT}\n\nParameters for zero-moment bulk microphysics scheme\n\nFields\n\nτ_precip: precipitation timescale [s]\nqc_0: condensate specific content precipitation threshold [-]\nS_0: supersaturation precipitation threshold [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.ParticlePDFSnow","page":"API","title":"CloudMicrophysics.Parameters.ParticlePDFSnow","text":"ParticlePDFSnow{FT}\n\nA struct with snow size distribution parameters\n\nFields\n\nμ: snow size distribution coefficient [1/m4]\nν: snow size distribution coefficient [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.ParticlePDFIceRain","page":"API","title":"CloudMicrophysics.Parameters.ParticlePDFIceRain","text":"ParticlePDFIceRain{FT}\n\nA struct with snow size distribution parameters\n\nFields\n\nn0: Size distribution coefficient [1/m4]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.ParticleMass","page":"API","title":"CloudMicrophysics.Parameters.ParticleMass","text":"ParticleMass{FT}\n\nA struct with coefficients of the assumed mass(size) relationship for particles\n\nm(r) = m0 χm (r/r0)^(me + Δm)\n\nFields\n\nr0: particle length scale [m]\nm0: mass size relation coefficient [kg]\nme: mass size relation coefficient [-]\nΔm: mass size relation coefficient [-]\nχm: mass size relation coefficient [-]\ngamma_coeff: pre-computed gamma(me + Δm + 1) for performance [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.ParticleArea","page":"API","title":"CloudMicrophysics.Parameters.ParticleArea","text":"ParticleArea{FT}\n\nA struct with coefficients of the assumed crosssectionarea(size) relationship for particles\n\na(r) = a0 χa (r/r0)^(ae + Δa)\n\nFields\n\na0: cross section size relation coefficient [m2]\nae: cross section size relation coefficient [-]\nΔa: cross section size relation coefficient [-]\nχa: cross section size relation coefficient [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.SnowAspectRatio","page":"API","title":"CloudMicrophysics.Parameters.SnowAspectRatio","text":"SnowAspectRatio{FT}\n\nA struct with aspect ratio coefficients\n\nFields\n\nϕ: aspect ratio [-]\nκ: power law coefficient in terminal velocity parameterization from Chen et al 2022 [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.Ventilation","page":"API","title":"CloudMicrophysics.Parameters.Ventilation","text":"Ventilation{FT}\n\nA struct with ventilation coefficients\n\nFields\n\na: ventilation coefficient a [-]\nb: ventilation coefficient b [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.Acnv1M","page":"API","title":"CloudMicrophysics.Parameters.Acnv1M","text":"Acnv1M{FT}\n\nA struct with autoconversion parameters\n\nFields\n\nτ: autoconversion timescale [s]\nq_threshold: condensate specific content autoconversion threshold [-]\nk: threshold smooth transition steepness [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.CloudLiquid","page":"API","title":"CloudMicrophysics.Parameters.CloudLiquid","text":"CloudLiquid{FT}\n\nThe parameters and type for cloud liquid water condensate\n\nFields\n\nτ_relax: condensation evaporation non_equil microphysics relaxation timescale [s]\nρw: water density [kg/m3]\nr_eff: effective radius [m]\nN_0: assumed number concentration for cloud sedimentation [1/m3]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.CloudIce","page":"API","title":"CloudMicrophysics.Parameters.CloudIce","text":"CloudIce{FT, MS}\n\nThe parameters and type for cloud ice condensate\n\nFields\n\npdf: a struct with size distribution parameters\nmass: a struct with mass size relation parameters\nr0: particle length scale [m]\nr_ice_snow: ice snow threshold radius [m]\nτ_relax: deposition sublimation non_equil microphysics relaxation timescale [s]\nρᵢ: cloud ice apparent density [kg/m3]\nr_eff: effective radius [m]\nN_0: assumed number concentration for cloud sedimentation [1/m3]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.Rain","page":"API","title":"CloudMicrophysics.Parameters.Rain","text":"Rain{FT, MS, AR, VT, AC}\n\nThe parameters and type for rain\n\nFields\n\npdf: a struct with size distribution parameters\nmass: a struct with mass size relation parameters\narea: a struct with cross section size relation parameers\nvent: a struct with ventilation coefficients\nacnv1M: a struct with cloud water to rain autoconversion parameters\nr0: particle length scale [m]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.Snow","page":"API","title":"CloudMicrophysics.Parameters.Snow","text":"Snow{FT, PD, MS, AR, VT, AP, AC}\n\nThe parameters and type for snow\n\nFields\n\npdf: a struct with size distribution parameters\nmass: a struct with mass size relation parameters\narea: a struct with cross section size relation parameers\nvent: a struct with ventilation coefficients\naspr: a struct with aspect ratio parameters\nacnv1M: a struct with ice to snow autoconversion parameters\nr0: particle length scale [m]\nT_freeze: freezing temperature of water [K]\nρᵢ: snow apparent density [kg/m3]\ngamma_aspect_oblate: pre-computed gamma(α+4)/6 for oblate aspect ratio [-]\ngamma_aspect_prolate: pre-computed gamma(α+4)/6 for prolate aspect ratio [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.CollisionEff","page":"API","title":"CloudMicrophysics.Parameters.CollisionEff","text":"CollisionEff{FT}\n\nCollision efficiency parameters for the 1-moment scheme\n\nFields\n\ne_lcl_rai: cloud liquid-rain collision efficiency [-]\ne_lcl_sno: cloud liquid-snow collision efficiency [-]\ne_icl_rai: cloud ice-rain collision efficiency [-]\ne_icl_sno: cloud ice-snow collision efficiency [-]\ne_rai_sno: rain-snow collision efficiency [-]\ncoeff_disp: rain-snow velocity dispersion coefficient [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.KK2000","page":"API","title":"CloudMicrophysics.Parameters.KK2000","text":"KK2000\n\nThe type and parameters for 2-moment precipitation formation by Khairoutdinov and Kogan (2000)\n\nDOI:10.1175/1520-0493(2000)128<0229:ANCPPI>2.0.CO;2\n\nFields\n\nacnv: Autoconversion parameters\naccr: Accretion parameters\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.AcnvKK2000","page":"API","title":"CloudMicrophysics.Parameters.AcnvKK2000","text":"AcnvKK2000\n\nKhairoutdinov and Kogan (2000) autoconversion parameters\n\nFields\n\nA: Autoconversion coefficient A\na: Autoconversion coefficient a\nb: Autoconversion coefficient b\nc: Autoconversion coefficient c\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.AccrKK2000","page":"API","title":"CloudMicrophysics.Parameters.AccrKK2000","text":"AccrKK2000\n\nKhairoutdinov and Kogan (2000) accretion parameters\n\nFields\n\nA: Accretion coefficient A\na: Accretion coefficient a\nb: Accretion coefficient b\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.B1994","page":"API","title":"CloudMicrophysics.Parameters.B1994","text":"B1994\n\nThe type and parameter for 2-moment precipitation formation by Beheng (1994) DOI: 10.1016/0169-8095(94)90020-5\n\nFields\n\nacnv: Autoconversion coeff C\naccr: Autoconversion coeff a\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.AcnvB1994","page":"API","title":"CloudMicrophysics.Parameters.AcnvB1994","text":"AcnvB1994\n\nBeheng (1994) autoconversion parameters\n\nFields\n\nC: Autoconversion coeff C\na: Autoconversion coeff a\nb: Autoconversion coeff b\nc: Autoconversion coeff c\nN_0: Autoconversion coeff N_0\nd_low: Autoconversion coeff d_low\nd_high: Autoconversion coeff d_high\nk: Threshold for smooth tranistion steepness\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.AccrB1994","page":"API","title":"CloudMicrophysics.Parameters.AccrB1994","text":"AccrB1994\n\nBeheng (1994) accretion parameters\n\nFields\n\nA: Accretion coefficient A\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.TC1980","page":"API","title":"CloudMicrophysics.Parameters.TC1980","text":"TC1980\n\nThe type and parameters for 2-moment precipitation formation by Tripoli and Cotton (1980)\n\nDOI: 10.1175/1520-0450(1980)019<1037:ANIOSF>2.0.CO;2\n\nFields\n\nacnv: Autoconversion parameters\naccr: Accretion parameters\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.AcnvTC1980","page":"API","title":"CloudMicrophysics.Parameters.AcnvTC1980","text":"AcnvTC1980\n\nTripoli and Cotton (1980) autoconversion parameters\n\nFields\n\na: Autoconversion coefficient a\nb: Autoconversion coefficient b\nD: Autoconversion coefficient D\nr_0: Autoconversion coefficient r_0\nme_liq: Autoconversion coefficient me_liq\nm0_liq_coeff: Autoconversion coefficient m0liqcoeff\nk: Threshold for smooth tranistion steepness\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.AccrTC1980","page":"API","title":"CloudMicrophysics.Parameters.AccrTC1980","text":"AccrTC1980\n\nTripoli and Cotton (1980) accretion parameters\n\nFields\n\nA: Accretion coefficient A\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.LD2004","page":"API","title":"CloudMicrophysics.Parameters.LD2004","text":"LD2004\n\nThe type and parameters for 2-moment precipitation formation by Liu and Daum (2004)\n\nDOI: 10.1175/1520-0469(2004)061<1539:POTAPI>2.0.CO;2\n\nFields\n\nR_6C_0: Autoconversion coefficient R6C0\nE_0: Autoconversion coefficient E_0\nρ_w: liquid water density [kg/m3]\nk: Threshold for smooth tranistion steepness\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.VarTimescaleAcnv","page":"API","title":"CloudMicrophysics.Parameters.VarTimescaleAcnv","text":"VarTimescaleAcnv\n\nThe type for 2-moment precipitation formation based on the 1-moment parameterization with variable time scale Azimi et al (2023)\n\nFields\n\nτ: Timescale [s]\nα: Powerlaw coefficient [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.SB2006","page":"API","title":"CloudMicrophysics.Parameters.SB2006","text":"SB2006\n\nThe type and parameters for 2-moment precipitation formation by Seifert and Beheng (2006). The pdf_r type choses between running with or without limiters on raindrop size distribution parameters\n\nDOI: 10.1007/s00703-005-0112-4\n\nFields\n\npdf_c: Cloud particle size distribution parameters\npdf_r: Rain particle size distribution parameters\nacnv: Autoconversion parameters\naccr: Accretion parameters\nself: Rain selfcollection parameters\nbrek: Rain breakup parameters\nevap: Rain evaporation parameters\nnumadj: Number concentration adjustment parameter\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.RainParticlePDF_SB2006","page":"API","title":"CloudMicrophysics.Parameters.RainParticlePDF_SB2006","text":"RainParticlePDF_SB2006\n\nAbstract type for the size distribution parameters of rain particles\n\nSee RainParticlePDF_SB2006_limited and RainParticlePDF_SB2006_notlimited for the concrete types.\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.RainParticlePDF_SB2006_limited","page":"API","title":"CloudMicrophysics.Parameters.RainParticlePDF_SB2006_limited","text":"RainParticlePDF_SB2006_limited\n\nRain size distribution parameters from SB2006 including the limiters on drop maximum mass and the size distribution coefficinets N0 and lambda\n\nFields\n\nνr: Raindrop size distribution coefficient νr\nμr: Raindrop size distribution coefficient μr\nxr_min: Raindrop minimal mass\nxr_max: Raindrop maximum mass\nN0_min: Raindrop size distribution coefficient N0 min\nN0_max: Raindrop size distribution coefficient N0 max\nλ_min: Raindrop size distribution coefficient lambda min\nλ_max: Raindrop size distribution coefficient lambda max\nρw: Cloud liquid water density [kg/m3]\nρ0: Reference air density [kg/m3]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.RainParticlePDF_SB2006_notlimited","page":"API","title":"CloudMicrophysics.Parameters.RainParticlePDF_SB2006_notlimited","text":"RainParticlePDF_SB2006\n\nRain size distribution parameters from SB2006 but without the limiters\n\nFields\n\nνr: Raindrop size distribution coefficient νr\nμr: Raindrop size distribution coefficient μr\nxr_min: Raindrop minimum mass\nxr_max: Raindrop maximum mass\nρw: Cloud liquid water density [kg/m3]\nρ0: Reference air density [kg/m3]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.CloudParticlePDF_SB2006","page":"API","title":"CloudMicrophysics.Parameters.CloudParticlePDF_SB2006","text":"CloudParticlePDF_SB2006\n\nCloud droplets size distribution parameters from SB2006\n\nFields\n\nνc: Cloud droplet size distribution coefficient νc\nμc: Cloud droplet size distribution coefficient μc\nxc_min: Cloud droplets minimum mass\nxc_max: Cloud droplets maximum mass\nρw: Cloud liquid water density [kg/m3]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.AcnvSB2006","page":"API","title":"CloudMicrophysics.Parameters.AcnvSB2006","text":"AcnvSB2006\n\nAutoconversion parameters from SB2006\n\nFields\n\nkcc: Collection kernel coefficient\nx_star: Minimum mass of rain droplets\nρ0: Reference air density [kg/m3]\nA: Autoconversion correcting function coeff A\na: Autoconversion correcting function coeff a\nb: Autoconversion correcting function coeff b\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.AccrSB2006","page":"API","title":"CloudMicrophysics.Parameters.AccrSB2006","text":"AccrSB2006\n\nAccretion parameters from SB2006\n\nFields\n\nkcr: Collection kernel coefficient Kcr\nτ0: Accretion correcting function coefficient τ_0\nρ0: Reference air density [kg/m3]\nc: Accretion correcting function coefficient c\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.SelfColSB2006","page":"API","title":"CloudMicrophysics.Parameters.SelfColSB2006","text":"SelfColSB2006\n\nRain selfcollection parameters from SB2006\n\nFields\n\nkrr: Collection kernel coefficient krr\nκrr: Collection kernel coefficient kappa rr\nd: Raindrop self collection coefficient d\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.BreakupSB2006","page":"API","title":"CloudMicrophysics.Parameters.BreakupSB2006","text":"BreakupSB2006\n\nRain breakup parameters from SB2006\n\nFields\n\nDeq: Raindrop equilibrium mean diamater\nDr_th: Raindrop breakup mean diamater threshold\nkbr: Raindrops breakup coefficient kbr\nκbr: Raindrops breakup coefficient kappa br\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.EvaporationSB2006","page":"API","title":"CloudMicrophysics.Parameters.EvaporationSB2006","text":"EvaporationSB2006\n\nRain evaporation parameters from SB2006\n\nFields\n\nav: Ventillation coefficient a\nbv: Ventillation coefficient b\nα: Rain evapoartion coefficient α\nβ: Rain evapoartion coefficient β\nρ0: Reference air density [kg/m3]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.NumberAdjustmentHorn2012","page":"API","title":"CloudMicrophysics.Parameters.NumberAdjustmentHorn2012","text":"NumberAdjustmentHorn2012\n\nNumber concentration adjustment parameter from Horn (2012, DOI: 10.5194/gmd-5-345-2012)\n\nFields\n\nτ: Number concentration adjustment timescale [s]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.Blk1MVelType","page":"API","title":"CloudMicrophysics.Parameters.Blk1MVelType","text":"Blk1MVelType\n\nThe type for precipitation terminal velocity from the simple 1-moment scheme (defined for rain and snow)\n\nFields\n\nrain\nsnow\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.Blk1MVelTypeRain","page":"API","title":"CloudMicrophysics.Parameters.Blk1MVelTypeRain","text":"Blk1MVelTypeRain\n\nThe type for precipitation terminal velocity from the simple 1-moment scheme for rain\n\nFields\n\nr0: particle length scale [m]\nve: rain terminal velocity size relation coefficient [-]\nΔv: rain terminal velocity size relation coefficient [-]\nχv: rain terminal velocity size relation coefficient [-]\nρw: cloud water density [kg/m3]\nC_drag: rain drop drag coefficient [-]\ngrav: gravitational acceleration [m/s2]\ngamma_vent: pre-computed gamma((ve + Δv + 5) / 2) for ventilation [-]\ngamma_term: pre-computed gamma(me + ve + Δm + Δv + 1) for terminal velocity [-]\ngamma_accr: pre-computed gamma(ae + ve + Δa + Δv + 1) for accretion [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.Blk1MVelTypeSnow","page":"API","title":"CloudMicrophysics.Parameters.Blk1MVelTypeSnow","text":"Blk1MVelTypeSnow\n\nThe type for precipitation terminal velocity from the simple 1-moment scheme for snow\n\nFields\n\nr0: particle length scale [m]\nve: snow terminal velocity size relation coefficient [-]\nΔv: snow terminal velocity size relation coefficient [-]\nχv: snow terminal velocity size relation coefficient [-]\nv0: snow terminal velocity size relation coefficient [m/s]\ngamma_vent: pre-computed gamma((ve + Δv + 5) / 2) for ventilation [-]\ngamma_term: pre-computed gamma(me + ve + Δm + Δv + 1) for terminal velocity [-]\ngamma_accr: pre-computed gamma(ae + ve + Δa + Δv + 1) for accretion [-]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.StokesRegimeVelType","page":"API","title":"CloudMicrophysics.Parameters.StokesRegimeVelType","text":"StokesRegimeVelType\n\nThe type for precipitation terminal velocity in the Stokes regime (Re < 1)\n\nFields\n\nρw\nν_air\ngrav\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.SB2006VelType","page":"API","title":"CloudMicrophysics.Parameters.SB2006VelType","text":"SB2006VelType\n\nThe type for precipitation terminal velocity from Seifert and Beheng 2006\n\nFields\n\nρ0\naR\nbR\ncR\nρw\nν_air\ngrav\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.Chen2022VelType","page":"API","title":"CloudMicrophysics.Parameters.Chen2022VelType","text":"Chen2022VelType\n\nThe type for precipitation terminal velocity from Chen et al 2022 DOI: 10.1016/j.atmosres.2022.106171 (defined for rain, snow and cloud ice)\n\nFields\n\nrain\nsmall_ice\nlarge_ice\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.Chen2022VelTypeSmallIce","page":"API","title":"CloudMicrophysics.Parameters.Chen2022VelTypeSmallIce","text":"Chen2022VelTypeSmallIce\n\nThe type for precipitation terminal velocity from Chen et al 2022 for small ice. See Table B3 for parameter definitions. DOI: 10.1016/j.atmosres.2022.106171\n\nFields\n\nA\nB\nC\nE\nF\nG\ncutoff: cutoff for small vs large ice particle dimension [m]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.Chen2022VelTypeLargeIce","page":"API","title":"CloudMicrophysics.Parameters.Chen2022VelTypeLargeIce","text":"Chen2022VelTypeLargeIce\n\nThe type for precipitation terminal velocity from Chen et al 2022 for large ice. See Table B4 for parameter definitions. DOI: 10.1016/j.atmosres.2022.106171\n\nFields\n\nA\nB\nC\nE\nF\nG\nH\ncutoff: cutoff for small vs large ice particle dimension [m]\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.Chen2022VelTypeRain","page":"API","title":"CloudMicrophysics.Parameters.Chen2022VelTypeRain","text":"Chen2022VelTypeRain\n\nThe type for precipitation terminal velocity from Chen et al 2022 for rain. See Table B1 for parameter definitions. DOI: 10.1016/j.atmosres.2022.106171\n\nFields\n\nρ0\na\na3_pow\nb\nb_ρ\nc\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.TerminalVelocityParams","page":"API","title":"CloudMicrophysics.Parameters.TerminalVelocityParams","text":"TerminalVelocityParams{FT, STOKES, CHEN, BLK1M}\n\nUnified container for all terminal velocity parameterizations used in CloudMicrophysics.\n\nThis struct consolidates terminal velocity parameters for sedimentation calculations across all microphysics schemes (0M, 1M, 2M, NonEq). It provides a single source of truth for velocity parameterizations, eliminating duplication and enabling flexible mixing of velocity types across schemes.\n\nFields\n\nstokes::STOKES: StokesRegimeVelType — terminal velocity for cloud liquid droplets (Stokes regime)\nchen2022::CHEN: Chen2022VelType — terminal velocity for rain and ice (Chen et al. 2022)\nblk1m::BLK1M: Blk1MVelType — terminal velocity for rain and snow (1-moment scheme)\n\nUsage\n\nTerminal velocities are used for sedimentation (advection of hydrometeors), not for microphysical process rates (which are handled by scheme-specific parameter structs).\n\nDifferent schemes use different velocity parameterizations:\n\nCloud liquid: stokes (all schemes)\nCloud ice: chen2022.small_ice (all schemes)\nRain (1M): blk1m.rain\nRain (2M): chen2022.rain\nSnow: blk1m.snow (used by both 1M and 2M)\n\nExample\n\nusing CloudMicrophysics.Parameters as CMP\nusing CloudMicrophysics.MicrophysicsNonEq as CMNe\nusing CloudMicrophysics.Microphysics1M as CM1\n\n# Create unified terminal velocity parameters\ntv = CMP.TerminalVelocityParams(Float64)\n\n# Cloud liquid sedimentation (Stokes regime)\nv_liq = CMNe.terminal_velocity(cloud_liquid, tv.stokes, ρ, q_liq)\n\n# Cloud ice sedimentation (Chen 2022)\nv_ice = CMNe.terminal_velocity(cloud_ice, tv.chen2022.small_ice, ρ, q_ice)\n\n# Rain sedimentation (1M scheme uses Blk1M)\nv_rain_1m = CM1.terminal_velocity(rain, tv.blk1m.rain, ρ, q_rai)\n\n# Snow sedimentation (shared by 1M and 2M)\nv_snow = CM1.terminal_velocity(snow, tv.blk1m.snow, ρ, q_sno)\n\nSee Also\n\nStokesRegimeVelType: Stokes regime terminal velocity\nChen2022VelType: Chen et al. (2022) terminal velocity\nBlk1MVelType: 1-moment bulk terminal velocity\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.Microphysics0MParams","page":"API","title":"CloudMicrophysics.Parameters.Microphysics0MParams","text":"Microphysics0MParams{FT, P}\n\nUnified parameter container for 0-moment microphysics.\n\nFields\n\nprecip::P: Parameters0M — precipitation removal parameters\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.CloudPhaseParams1M","page":"API","title":"CloudMicrophysics.Parameters.CloudPhaseParams1M","text":"CloudPhaseParams1M{FT, LCL, ICL}\n\nParameters for cloud-phase (non-precipitating) hydrometeors in 1-moment scheme.\n\nFields\n\nliquid::LCL: CloudLiquid — cloud liquid water parameters\nice::ICL: CloudIce — cloud ice parameters\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.PrecipPhaseParams1M","page":"API","title":"CloudMicrophysics.Parameters.PrecipPhaseParams1M","text":"PrecipPhaseParams1M{FT, RAI, SNO}\n\nParameters for precipitating hydrometeors in 1-moment scheme.\n\nFields\n\nrain::RAI: Rain — rain parameters (includes autoconversion)\nsnow::SNO: Snow — snow parameters (includes autoconversion)\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.Microphysics1MParams","page":"API","title":"CloudMicrophysics.Parameters.Microphysics1MParams","text":"Microphysics1MParams{FT, CP, PP, CE, AP, VL, VA}\n\nUnified parameter container for 1-moment bulk microphysics.\n\nFields\n\ncloud::CP: CloudPhaseParams1M — cloud liquid and ice parameters\nprecip::PP: PrecipPhaseParams1M — rain and snow parameters\ncollision::CE: CollisionEff — collision efficiencies between species\nair_properties::AP: AirProperties — air properties (diffusivities, thermal conductivity)\nterminal_velocity::VL: Blk1MVelType — terminal velocity parameters for rain and snow\nautoconv_2M::VA: VarTimescaleAcnv or Nothing — optional 2M autoconversion fallback\nprescribed_Nc::FT: Prescribed cloud droplet number concentration [1/m³]\n\nExample\n\nusing CloudMicrophysics.Parameters as CMP\n\n# Create 1M parameters with default settings\nmp = CMP.Microphysics1MParams(Float64)\n\n# Create with optional 2M autoconversion fallback\nmp_with_2M = CMP.Microphysics1MParams(Float64; with_2M_autoconv = true)\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.WarmRainParams2M","page":"API","title":"CloudMicrophysics.Parameters.WarmRainParams2M","text":"WarmRainParams2M{FT, SB, AP}\n\nParameters for 2-moment warm rain processes (Seifert-Beheng 2006).\n\nFields\n\nseifert_beheng::SB: SB2006 — all warm rain parameters (autoconversion, accretion, etc.)\nair_properties::AP: AirProperties — air properties for evaporation\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.P3IceParams","page":"API","title":"CloudMicrophysics.Parameters.P3IceParams","text":"P3IceParams{FT, P3, VL, PDc, PDr}\n\nParameters for P3 ice-phase processes (optional).\n\nFields\n\nscheme::P3: ParametersP3 — P3 scheme parameters\nterminal_velocity::VL: Chen2022VelType — terminal velocity for ice\ncloud_pdf::PDc: CloudParticlePDF_SB2006 — cloud droplet size distribution\nrain_pdf::PDr: RainParticlePDF_SB2006 — rain drop size distribution\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.Parameters.Microphysics2MParams","page":"API","title":"CloudMicrophysics.Parameters.Microphysics2MParams","text":"Microphysics2MParams{FT, WR, ICE}\n\nUnified parameter container for 2-moment microphysics.\n\nSupports:\n\nWarm rain only (SB2006): when ice is nothing\nWarm rain + P3 ice: when ice is P3IceParams\n\nFields\n\nwarm_rain::WR: WarmRainParams2M — SB2006 parameters + air properties\nice::ICE: P3IceParams or Nothing — optional P3 ice parameters\n\nExample\n\nusing CloudMicrophysics.Parameters as CMP\n\n# Warm rain only\nmp_warm = CMP.Microphysics2MParams(Float64; with_ice = false)\n\n# Warm rain + P3 ice\nmp_p3 = CMP.Microphysics2MParams(Float64; with_ice = true)\n\n\n\n\n\n","category":"type"},{"location":"API/#CloudMicrophysics.PrecipitationSusceptibility.precipitation_susceptibility_autoconversion","page":"API","title":"CloudMicrophysics.PrecipitationSusceptibility.precipitation_susceptibility_autoconversion","text":"precipitation_susceptibility_autoconversion(param_set, scheme, q_lcl, q_rai, ρ, N_lcl)\n\nscheme - type for 2-moment rain autoconversion parameterization\nq_lcl - cloud liquid water specific content\nq_rai - rain water specific content\nρ - air density\nN_lcl - cloud droplet number density\n\nReturns the precipitation susceptibility rates due to autoconversion as a precip_susceptibility_rates object, using automatic differentiation. Works for any 2-moment scheme, as long as autoconversion is defined for it.\n\n\n\n\n\n","category":"function"},{"location":"API/#CloudMicrophysics.PrecipitationSusceptibility.precipitation_susceptibility_accretion","page":"API","title":"CloudMicrophysics.PrecipitationSusceptibility.precipitation_susceptibility_accretion","text":"precipitation_susceptibility_accretion(param_set, scheme, q_lcl, q_rai, ρ, N_lcl)\n\nscheme - type for 2-moment rain autoconversion parameterization\nq_lcl - cloud liquid water specific content\nq_rai - rain water specific content\nρ - air density\nN_lcl - cloud droplet number density\n\nReturns the precipitation susceptibility rates due to accretion as a precip_susceptibility_rates object, using automatic differentiation. Works for any 2-moment scheme, as long as accretion is defined for it.\n\n\n\n\n\n","category":"function"},{"location":"AerosolActivation/#Aerosol-Activation","page":"Aerosol activation","title":"Aerosol Activation","text":"The AerosolActivation.jl module contains parameterization   of activation of aerosol particles into cloud droplets   via deposition of water vapor. Accompanying it, is the AerosolDistribution.jl module, which contains   information about the aerosol size distribution and chemical properties. The parameterization computes the total activated number and mass   from a given aerosol size distribution. It is based on Köhler theory   and assumes equilibrium thermodynamics. The modules are an implementation of the parameterization   from [37] and   [38]. The aerosol chemical composition can be expressed using the B parameter   from [38]   or the kappa parameter from [39].","category":"section"},{"location":"AerosolActivation/#Assumed-aerosol-size-distribution-and-properties","page":"Aerosol activation","title":"Assumed aerosol size distribution and properties","text":"Aerosol particles are assumed to follow a multi-mode lognormal   size distribution. Particles in each mode are assumed to be internally mixed. The following table lists the parameters defining the aerosol   physical and chemical properties using the B parameter. The r_dry, sigma, and N_tot are given for each mode. Other parameters are defined for each component in each mode.\n\nvariable name definition units\nr_dry geometric mean dry radius m\nsigma geometric standard deviation -\nN_tot total number concentration m^-3\nr component mass mixing ratio -\nepsilon mass fraction of water soluble material -\nphi osmotic coefficient -\nM_a molar mass kg  mol^-1\nnu number of ions the salt dissociates into in water -\nrho_a aerosol density kg  m^-3\n\nWhen using the kappa formulation, one has to specify fewer parameters.\n\nvariable name definition units\nr_dry geometric mean dry radius m\nsigma geometric standard deviation -\nN_tot total number concentration m^-3\nr_vol component volume mixing ratio -\nM_a molar mass kg  mol^-1\nkappa kappa parameter -\n\nnote: Note\nThe parameterization assumes that the solute is sufficiently soluble so that its concentration does not increase as the droplet grows. The effects of surfactants on surface tension are also not considered.","category":"section"},{"location":"AerosolActivation/#Mean-Hygroscopicity","page":"Aerosol activation","title":"Mean Hygroscopicity","text":"Hygroscopicity describes the impact of solute on aerosol efficiency in taking up   water vapor from the environment (i.e. the Raoult's law). The parametrization accepts two ways of describing it, either using the   B parameter or kappa parameter. The B parameter is defined in eq. (3) in [38]:\n\nB = fracnu  phi  M_w  rho_aM_a  rho_w\n\nwhere:\n\nnu  phi  M_a  rho_a are the aerosol properties defined in the above table,\nM_w is the molar mass of water,\nrho_w is the density of water.\n\nThe mean B parameter for internally mixed mode i   made up of j aerosol species is computed   according to eq. (4) in [38]:\n\nbeginequation\nbarB_i = fracM_w sum_j = 1^J fracr_ij  nu_ij  phi_ij  epsilon_ijM_aijrho_w sum_j = 1^J fracr_ijrho_aij\nendequation\n\nwhere:\n\ni = 1 2  I iterates over aerosol size distribution modes,\nj = 1 2  J iterates over aerosol components within a given mode,\nr_ij is the mass ratio of component j in mode i.\n\nThe kappa parameter values for different chemical compounds are provided   in Table 1 in  [39]. The mean kappa parameter for internally mixed mode i   made up of j aerosol species is computed as a volume weighted average:\n\nkappa_i = sum_j=1^J r_ij vol kappa_ij\n\nwhere:\n\nr_ij  vol is the volume ratio of component j in mode i.","category":"section"},{"location":"AerosolActivation/#Critical-supersaturation","page":"Aerosol activation","title":"Critical supersaturation","text":"Supersaturation S is the ratio of water vapor pressure to saturation vapor pressure. Köhler theory defines S at which the growing aerosol particle   is in equilibrium with the environment over a range of its sizes. It takes into account the curvature effects and the solute effects. Aerosol activation occurs when the threshold supersaturation,   named critical supersaturation S_c, is reached. After reaching S_c, even when S decreases,   as long as the conditions remain saturated,   the particle will continue to grow. The critical supersaturation is defined by the maximum of the   Köhler curve. For example, eq.(9) in [38] defines the   the critical supersaturation for a particle with   dry radius equal to the mean mode radius:\n\nbeginequation\nS_ci = frac2sqrtbarH_i bigg( fracA3  r_dry  i bigg)^32\nlabeleqScriti\nendequation\n\nwhere:\n\nH_i is either the B_i or the kappa_i hygroscopicity parameter\nA is the coefficient describing the curvature effects (i.e. Kelvin effect),\nr_dry  i is the mean dry radius for mode i.\n\nCoefficient A is defined as in equation (5) in [37].\n\nbeginequation\nA = frac2 tau M_wrho_w R T\nendequation\n\nwhere:\n\ntau is the surface tension of water,\nR is the universal gas constant,\nT is the temperature.","category":"section"},{"location":"AerosolActivation/#Maximum-Supersaturation","page":"Aerosol activation","title":"Maximum Supersaturation","text":"Maximum supersaturation reached by the system S_max governs what aerosol sizes are activated and what aren't. We estimate S_max by considering a parcel of air raising adiabatically with a constant velocity, see for example [40]. The time rate of change of S is given by eq (A11) in [40]\n\nbeginequation\n  fracdSdt = alpha w - gamma fracdchidt\n  labeleqSevolution\nendequation\n\nwhere:\n\nw is the vertical velocity,\ndchi  dt is the water condensation rate during aerosol activation and growth,\nalpha and gamma are coefficients that do not depend on aerosol properties.\n\nThe parameters alpha and gamma are defined similarly to eq. (11) and (12) in [37], but we follow the full formulation from [40] eq. (A11), without assuming S + 1  1. While the difference is often small, we retain the full expressions for completeness and consistency with our implementation. The parameters are:\n\nbeginequation\nalpha = fracp_vapp_vap^satleftfracL_v  gR_v  c_pm  T^2 - fracgR_m  Tright\nendequation\n\nbeginequation\ngamma = fracR_v Tp_vap^sat + fracp_vapp_vap^satfracR_m  L_v^2R_v  c_pm  T  p\nendequation\n\nwhere:\n\nL_v is the latent heat of vaporization,\ng is gravitational acceleration,\nR_v is the gas constant of vapor,\nR_m is the gas constant of air (dry air and moisture)\nc_pm is the specific heat of air (dry air and moisture),\np_vap is the vapor pressure,\np_vap^sat is the saturation vapor pressure,\np is the total air pressure.\n\nThe maximum supersaturation is estimated from eq. (\\ref{eq:Sevolution})   assuming steady a state solution dSdt = 0. [37] and [38]   show how to derive an approximate solution for S_max,   since analytical solution is in general not possible. They consider approximate solutions for very small and very large   critical supersaturation values relative to maximum supersaturation,   and combine them into a final expression for S_max. The final formula is presented in eq (6) in [38]\n\nbeginequation\nS_max = frac1Bigg sum_i=1^Ifrac1S_ci^2biggf_i Big( fraczetaeta_i Big)^frac32 + g_i Big(fracS_ci^2eta_i + 3zeta Big)^frac34bigg Bigg^frac12\nendequation\n\nwhere\n\nS_ci is the critical supersaturation for mode i defined in eq. (\\ref{eq:Scriti}),\nf_i, g_i, zeta, eta_i are the coefficients defined in eqs. (7, 8, 10 and 11) in  [38].\n\nbeginequation\nf_i  = 05  mathrmexp (25  mathrmln^2 sigma_i)\nendequation\n\nbeginequation\ng_i  = 1 + 025  mathrmln sigma_i\nendequation\n\nbeginequation\nzeta = frac2A3 bigg(fracalpha wGbigg)^frac12\nendequation\n\nbeginequation\neta_i = bigg(fracalpha wGbigg)^frac32 frac12 pi rho_w gamma N_i\nendequation\n\nwhere:\n\nG(T) = frac1rho_w  left(fracL_vKT left(fracL_vR_v T - 1 right) + fracR_v Tp_vap^sat D right)^-1   combines the effects of thermal conductivity K and water diffusivity D.","category":"section"},{"location":"AerosolActivation/#Number-and-mass-of-activated-particles","page":"Aerosol activation","title":"Number and mass of activated particles","text":"The total number N_act and mass M_act of activated aerosol particles   can be computed by integrating their size distribution   starting from the smallest activated size. Following the derivations of   [37] and [38]   this can be expressed in terms of critical supersaturations of each   size distribution mode S_ci and the maximum supersaturation S_max.\n\nbeginequation\nN_act = sum_i = 1^I N_ifrac12bigg1 - mathrmerf(u_i)bigg\nendequation\n\nbeginequation\nM_act = sum_i = 1^I M_ifrac12bigg1 - mathrmerfbigg(u_i - frac3 sqrt22 ln(sigma_i)bigg)bigg\nendequation\n\nwhere:\n\nM_i is the average molar mass of aerosol particles in mode i,\nu_i is given in equation (15) in [38].\n\nbeginequation\nu_i = frac23sqrt2  ln(sigma_i) lnbigg( fracS_ciS_max bigg)\nendequation\n\nwhere:\n\nS_ci is the mode critical supersaturation,\nS_max is the maximum supersaturation.","category":"section"},{"location":"AerosolActivation/#Example-of-Aerosol-Activation-from-ARG2000","page":"Aerosol activation","title":"Example of Aerosol Activation from ARG2000","text":"The figures below have been reproduced from [38] using the aerosol activation parameterization implemented in this project.\n\ninclude(\"plots/ARGplots_fig1.jl\")\n\n(Image: )\n\ninclude(\"plots/ARGplots.jl\")\nmake_ARG_figX(2)\nmake_ARG_figX(3)\nmake_ARG_figX(4)\nmake_ARG_figX(5)\n\n(Image: ) (Image: ) (Image: ) (Image: )","category":"section"},{"location":"AerosolActivation/#Aerosol-activation-prediction-with-ML-emulators-and-EKP-calibration","page":"Aerosol activation","title":"Aerosol activation prediction with ML emulators and EKP calibration","text":"The CloudMicrophysics package offers an advanced feature for predicting the aerosol activation fraction using machine-learned emulators. Users have access to a function that utilizes pre-trained models for the prediction of activation fraction. Additionally, the package includes tools for training machine learning models, tailored to specific datasets or needs. The training process can benefit from incorporating the ARG activation equation, enhancing the relevance of training data. Emulator training, covering neural networks, Gaussian processes, and EvoTrees, is showcased in test/aerosol_activation_emulators.jl.\n\nIn addition, we provide functionality and a demonstration for re-training the free parameters of the traditional ARG activation scheme using Ensemble Kalman Processes. This functionality is showcased in test/aerosol_activation_calibration.jl.\n\nUsing ML emulators or calibration with Ensemble Kalman Processes for predicting aerosol activation is provided through an extension to the main package. This extension will be loaded with CloudMicrophysics.jl if both MLJ.jl, DataFrames.jl, and EnsembleKalmanProcesses.jl are loaded by the user as well.","category":"section"},{"location":"AerosolActivation/#Modification-for-Local-Supersaturation-with-Preexisting-Hydrometeors","page":"Aerosol activation","title":"Modification for Local Supersaturation with Preexisting Hydrometeors","text":"The original ARG activation scheme assumes adiabatic ascent with no preexisting cloud or ice particles, which is a valid approximation near cloud base. As a result, the ARG formulation is traditionally applied only at cloud base, where no vapor has yet condensed and no hydrometeors exist to affect the supersaturation evolution.\n\nHowever, in many applications—such as large-eddy simulations or cloud-resolving models—it is desirable to apply the activation scheme locally, throughout the vertical extent of the cloud. In such cases, preexisting cloud droplets and ice crystals act as persistent vapor sinks, suppressing supersaturation and inhibiting further activation.\n\nTo relax the cloud-base-only constraint and extend ARG into a local operator, we propose modifying the supersaturation tendency equation by incorporating the effects of these preexisting hydrometeors. When coupling this approach to a full model, additional clipping may be needed: the modified ARG should only be applied when the local supersaturation does not exceed the predicted maximum, and when the number concentration of hydrometeors remains below the potential activation of aerosols.","category":"section"},{"location":"AerosolActivation/#Modified-Supersaturation-Budget","page":"Aerosol activation","title":"Modified Supersaturation Budget","text":"We modify the supersaturation tendency equation to include additional vapor sink terms:\n\nfracdSdt = alpha w - gamma fracdchidt_textactivation - gamma fracdchidt_textliquid - gamma_i fracdchidt_textice\n\nwhere the thermodynamic coefficient gamma_i is defined as\n\nbeginequation\ngamma_i = fracR_v Tp_vap^sat + fracp_vapp_vap^satfracR_m  L_v L_sR_v  c_pm  T  p\nendequation\n\nwhere L_s is the latent heat of sublimation. The new sink terms are:\n\nLiquid sink:\n\nfracdchidt_textliquid = 4 pi rho_w N_l r_l G_l S\n\nIce sink:\n\nfracdchidt_textice = 4 pi rho_i N_i r_i G_i S_i\n\nwith\n\nS_i = xi (S + 1) - 1 quad xi = frace_selle_si\n\nHere:\n\nN_l, r_l, and G_l are the number concentration, radius, and condensational growth coefficient of liquid droplets,\nN_i, r_i, and G_i are the corresponding values for ice crystals,\nrho_w and rho_i are the densities of liquid water and ice.\n\nWe define:\n\nK_l = 4 pi rho_w N_l r_l G_l gamma quad K_i = 4 pi rho_i N_i r_i G_i gamma_i\n\nyielding the modified supersaturation equation at peak supersaturation:\n\n0 = alpha w - gamma f(S_max) - K_l S_max - K_i big xi (S_max + 1) - 1 big","category":"section"},{"location":"AerosolActivation/#Approximate-Solution","page":"Aerosol activation","title":"Approximate Solution","text":"Let S_0 be the ARG solution obtained by solving:\n\nalpha w = gamma f(S_0)\n\nand approximate the nonlinear sink function f(S) as linear between 0 and S_0:\n\nf(S) approx f(S_0) cdot fracSS_0\n\nSubstituting into the modified budget and solving for S_1:\n\nalpha w = gamma f(S_0) cdot fracS_1S_0 + K_l S_1 + K_i bigxi (S_1 + 1) - 1 big\n\nyields:\n\nS_1 = frac(alpha w - K_i (xi - 1)) S_0alpha w + (K_l + K_i xi) S_0\n\nThe final expression for the modified supersaturation becomes:\n\nS_textmax^textmodified = frac(alpha w - K_i (xi - 1)) S_textmax^textARGalpha w + (K_l + K_i xi) S_textmax^textARG\n\nWhen K_l = K_i = 0, the formula reduces to the original ARG solution.\nLarger values of K_l or K_i reduce the supersaturation due to vapor uptake by preexisting hydrometeors.\nThis extension allows the ARG activation scheme to be applied at any vertical level, making it suitable for use as a local operator in models that resolve cloud-scale dynamics.","category":"section"},{"location":"AerosolActivation/#Example","page":"Aerosol activation","title":"Example","text":"To illustrate the behavior of the modified ARG scheme, we compare the maximum supersaturation it predicts against that from a detailed parcel model in four idealized scenarios:\n\nVarying the liquid droplet number concentration with no ice particles present,\nVarying the ice crystal number concentration with no liquid droplets present,\nVarying the initial droplet radius with no ice particles present,\nVarying the initial ice particle radius with no liquid droplets present.\n\nIn all cases, the parcel model assumes an initial zero supersaturation and includes activation, condensational growth, and depositional growth during adiabatic ascent. A background population of sulfate aerosol with an initial concentration of 500 cm⁻³ is present in all scenarios. For simplicity, ice particles are assumed to be monodisperse. Liquid droplets formed through activation and those present initially are represented as two separate monodisperse populations.\n\nThe figure below shows the ratio of the maximum supersaturation reached in the parcel model to that predicted by the modified ARG scheme. This comparison highlights the conditions under which the modified ARG provides a good approximation to the more detailed parcel-model results.\n\ninclude(\"plots/ARGmodified_plots.jl\")\n\n(Image: )","category":"section"},{"location":"CloudDiagnostics/#Diagnostics","page":"Cloud diagnostics","title":"Diagnostics","text":"CloudMicrophysics.jl offers a couple of options to compute cloud and precipitation radiative properties based on different available parameterizations and their underlying assumptions about the size distribution and properties of particles.\n\nAvailable diagnostics are:\n\nRadar reflectivity\nEffective radius\n\nCalculating these diagnostics make use of the physical moment equation for the generalized gamma distribution, as a function of particle mass. We denote the moment as M_x^n to emphasize that it is the moment with respect to the particle size distribution written as a function of particle mass x.\n\nbeginequation\nM_x^n(N ν μ B)\n  = _0^ x^n  f(x) dx\n  = N  B^-fracnμ  fracΓleft(fracν+1+nμright)Γleft(fracν+1μright)\nendequation\n\nwhere:\n\nbeginequation\nf(x) = A  x^ν  exp(-B  x^μ)\nendequation\n\nis the particle size distribution as a function of particle mass, and\n\nbeginequation\nB = left( barx fracΓleft(fracν+1μright)Γleft(fracν+2μright) right)^-μ\nendequation\n\nis the particle size distribution parameter, in which barx = LN is the mean particle mass. See the particle size distribution section in Microphysics 2M for more details.","category":"section"},{"location":"CloudDiagnostics/#Radar-reflectivity","page":"Cloud diagnostics","title":"Radar reflectivity","text":"The radar reflectivity factor Z is used to measure the power returned   by a radar signal when it encounters particles (cloud, rain droplets, etc),   and is defined as the sixth moment of the particles distributions n(r):\n\nbeginequation\nZ = int_0^infty r^6  n(r)  dr\nlabeleqZ\nendequation\n\nZ is typically normalized by radar reflectivity factor Z_0 of a drop of radius 1 mm in a volume of 1 m^3, and is reported as a decimal logarithm to obtain the normalized logarithmic rain radar reflectivity L_Z.\n\nbeginequation\nL_Z = 10  log_10 left( fracZZ_0 right)\nendequation\n\nThe resulting logarithmic dimensionless unit is decibel relative to Z_0, or dBZ.","category":"section"},{"location":"CloudDiagnostics/#1-moment-microphysics","page":"Cloud diagnostics","title":"1-moment microphysics","text":"For the 1-moment scheme   we only consider the rain drop size distribution. Integrating over the assumed Marshall-Palmer distribution leads to\n\nbeginequation\nZ = frac6  n_0^railambda^7\nendequation\n\nwhere:\n\nn_0^rai and lambda - rain drop size distribution parameters.","category":"section"},{"location":"CloudDiagnostics/#2-moment-microphysics","page":"Cloud diagnostics","title":"2-moment microphysics","text":"For the 2-moment scheme   we take into consideration the effect of both cloud and rain droplets. The radar reflectivity, as written above is proportional to the 2nd moment cloud number distribution in mass\n\nbeginequation\nZ_c = M_x^2  C^2\nendequation\n\nwhere:\n\nC = frac43 π ρ_w.\n\nThe additional factor of C^2 results in a radar reflectivity that equals the 6th moment in radius.\n\nSimilar for rain drop exponential distribution\n\nbeginequation\nZ_r = M_x^2  C^2\nendequation\n\nThe final radar reflectivity factor is a sum of Z_c and Z_r.","category":"section"},{"location":"CloudDiagnostics/#Effective-radius","page":"Cloud diagnostics","title":"Effective radius","text":"The effective radius of hydrometeors (r_texteff) is defined as the area weighted radius of the population of particles. It can be computed as the ratio of the third to the second moment of the size distribution.","category":"section"},{"location":"CloudDiagnostics/#2-moment-microphysics-2","page":"Cloud diagnostics","title":"2-moment microphysics","text":"We compute the total third and second moment as a sum of cloud condensate and precipitation moments:\n\nbeginequation\nr_eff\n  = fracM^3_rc + M^3_rrM^2_rc + M^2_rr\n  = frac_0^ r^3  (n_c(r) + n_r(r))  dr_0^ r^2  (n_c(r) + n_r(r))  dr\nlabeleqreff\nendequation\n\nThe 3rd moment in radius, M^3_r equals the 1st moment in mass, M^1_x,\n\nbeginequation\nM^3_r = M^1_x  C\nendequation\n\nwhere\n\nC = frac43 π ρ_w relates radius to mass for a spherical particle, x = C r^3.\n\nSimilarly, the 2nd moment in radius, M^2_r equals the \"2/3rd\" moment in mass, M^2_x,\n\nbeginequation\nM_r^2 = M_x^frac23  C^frac23\nendequation","category":"section"},{"location":"CloudDiagnostics/#Liu-and-Hallett-1997","page":"Cloud diagnostics","title":"Liu and Hallett 1997","text":"For 1-moment microphysics scheme the effective radius is parameterized following [58]:\n\nbeginequation\n  r_eff = fracr_volk^frac13\nendequation\n\nwhere:\n\nr_vol represents the volume-averaged radius,\nk = 08.\n\nWhere the volume-averaged radius is computed using\n\nbeginequation\n  r_vol = left(frac34 pi rho_wright)^frac13  left(fracLNright)^frac13 = left(frac3  rho (q_lcl + q_rai)4 pi rho_w (N_lcl + N_rai)right)^frac13\nendequation\n\nwhere:\n\nL = rho q, is the liquid water content (cloud water and rain),\nN = N_lcl + N_rai.\n\nBy default for the 1-moment scheme we don't consider precipitation and assume a constant cloud droplet number concentration of 100 cm^-3.","category":"section"},{"location":"CloudDiagnostics/#Constant","page":"Cloud diagnostics","title":"Constant","text":"For testing purposes we also provide a constant effective radius option. The default values are 14 mu m for liquid clouds and 25 mu m for ice clouds, and can be easily overwritten via ClimaParams.jl.","category":"section"},{"location":"CloudDiagnostics/#Example-figures","page":"Cloud diagnostics","title":"Example figures","text":"Below we show effective radius and radar reflecivity plots as a function of cloud water and rain water. The effective radius is computed assuming a constant cloud droplet number concentration   of 100 or 1000 per cubic centimeter. The radar reflectivity is computed assuming a constant rain drop number concentration   of 10 or 100 per cubic centimeter. Note the effect of using the limiters in SB2006 scheme on the radar reflectivity.\n\ninclude(\"plots/CloudDiagnostics.jl\")\n\n(Image: )","category":"section"},{"location":"#CloudMicrophysics.jl","page":"Home","title":"CloudMicrophysics.jl","text":"The CloudMicrophysics.jl is a library of bulk cloud microphysics and aerosol schemes:\n\nlibrary means that CloudMicrophysics.jl provides a variety of parameterizations  that can be used to define tendencies in different numerical models.\ncloud microphysics and aerosol schemes mean that the parameterizations represent  small-scale processes leading to the formation of clouds on aerosol particles and  the formation of precipitation.\nbulk schemes mean that the schemes parameterize behavior of populations  of particles (aerosol, cloud and precipitation), instead of tracking the evolution  of individual cloud droplets or ice crystals. Bulk schemes typically consider different  somewhat arbitrary water categories such as cloud water, cloud ice, rain and snow.  They predict total mass and (optionally) number concentration of particles in each category.","category":"section"},{"location":"#Features","page":"Home","title":"Features","text":"CloudMicrophysics.jl is designed to allow data driven parameter calibrations. All free parameters are passed as inputs to the functions and can be easily overwritten by the user. The package is tested on Unix, OSX and Windows. The package can be used on both CPUs and GPUs.\n\nAvailable parameterizations:\n\n0-moment scheme that instantly removes the precipitable cloud condensate,\n1-moment scheme for warm rain and mixed-phase clouds (cloud water and ice, ran and snow (aggregate)),\n2-moment scheme for warm rain clouds (cloud water and rain),\ncollection of different 2-moment autoconversion and accretion functions,\nexperimental non-equilibrium cloud formation scheme,\na collection of logistic functions for smooth transitions at thresholds,\naerosol activation scheme\nice nucleation scheme via water vapor deposition on dust aerosol, heterogeneous and homogeneous freezing of droplets.","category":"section"},{"location":"#Documentation-outline","page":"Home","title":"Documentation outline","text":"Parameterizations provide notes on the derivations and assumptions behind each of the implemented schemes.  The scripts that generate different plots in the documentation are stored in docs/src/plots folder,  and can serve as usage examples of the schemes.\nHow to guides provide simple examples on how to get started using the package.\nModels discuss two 0-dimensional models that are build using the package and are focused on  testing different ice nucleation schemes.\nAPI provides package interface documentation.\nDeveloper's Guide offers some hints for beginner contributors.\nGlossary explains some basic terminology.\nReferences provide links to the publications on which we based our implementations.","category":"section"},{"location":"#Contributing-and-license","page":"Home","title":"Contributing and license","text":"CloudMicrophysics.jl is developed by the Climate Modeling Alliance and is released under the Apache License Version 2.0. Please check contributing section if you would like to contribute to the project and are looking for ideas. Please open an issue or reach out to us if you have any questions or comments.\n\n(Image: Clima logo)","category":"section"}]
}
