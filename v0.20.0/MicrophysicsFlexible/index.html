<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>N-moment precipitation microphysics · CloudMicrophysics.jl</title><meta name="title" content="N-moment precipitation microphysics · CloudMicrophysics.jl"/><meta property="og:title" content="N-moment precipitation microphysics · CloudMicrophysics.jl"/><meta property="twitter:title" content="N-moment precipitation microphysics · CloudMicrophysics.jl"/><meta name="description" content="Documentation for CloudMicrophysics.jl."/><meta property="og:description" content="Documentation for CloudMicrophysics.jl."/><meta property="twitter:description" content="Documentation for CloudMicrophysics.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="CloudMicrophysics.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">CloudMicrophysics.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox" checked/><label class="tocitem" for="menuitem-2"><span class="docs-label">Parameterizations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../Microphysics0M/">0-moment precipitation microphysics</a></li><li><a class="tocitem" href="../Microphysics1M/">1-moment precipitation microphysics</a></li><li><a class="tocitem" href="../Microphysics2M/">2-moment precipitation microphysics</a></li><li class="is-active"><a class="tocitem" href>N-moment precipitation microphysics</a><ul class="internal"><li><a class="tocitem" href="#Moments-and-Sub-Distributions"><span>Moments and Sub-Distributions</span></a></li><li><a class="tocitem" href="#Loading-the-extension"><span>Loading the extension</span></a></li><li><a class="tocitem" href="#Setting-up-a-system"><span>Setting up a system</span></a></li></ul></li><li><a class="tocitem" href="../P3Scheme/">P3 Scheme</a></li><li><a class="tocitem" href="../MicrophysicsNonEq/">Non-equilibrium cloud formation</a></li><li><a class="tocitem" href="../ThresholdsTransition/">Smooth transition at thresholds</a></li><li><a class="tocitem" href="../AerosolActivation/">Aerosol activation</a></li><li><a class="tocitem" href="../WaterActivity/">Water Activity</a></li><li><a class="tocitem" href="../IceNucleation/">Ice Nucleation</a></li><li><a class="tocitem" href="../AerosolNucleation/">Aerosol Nucleation</a></li><li><a class="tocitem" href="../PrecipitationSusceptibility/">Precipitation Susceptibility</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">How to guides</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../guides/literated/GettingStarted/">Getting started</a></li><li><a class="tocitem" href="../guides/literated/Parameters/">Handling parameters</a></li><li><a class="tocitem" href="../guides/literated/SimpleModel/">Building a model</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Models</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../IceNucleationParcel0D/">Adiabatic parcel model</a></li><li><a class="tocitem" href="../IceNucleationBox0D/">Box Model</a></li></ul></li><li><a class="tocitem" href="../API/">API</a></li><li><a class="tocitem" href="../DevelopersGuide/">Developer&#39;s Guide</a></li><li><a class="tocitem" href="../Glossary/">Glossary</a></li><li><a class="tocitem" href="../References/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Parameterizations</a></li><li class="is-active"><a href>N-moment precipitation microphysics</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>N-moment precipitation microphysics</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CliMA/CloudMicrophysics.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/CliMA/CloudMicrophysics.jl/blob/main/docs/src/MicrophysicsFlexible.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Microphysics-Flexible"><a class="docs-heading-anchor" href="#Microphysics-Flexible">Microphysics Flexible</a><a id="Microphysics-Flexible-1"></a><a class="docs-heading-anchor-permalink" href="#Microphysics-Flexible" title="Permalink"></a></h1><p>The <code>MicrophysicsFlexible.jl</code> module relies on the extension defined in <code>ext/CloudyExt.jl</code>, based on a flexible N-moment microphysics scheme built in the external package <a href="https://github.com/CliMA/Cloudy.jl">Cloudy.jl</a>. This option currently handles warm-rain processes including coalescence, condensation/evaporation, and sedimentation (terminal velocity). Unlike typical moment-based schemes which distinguish between categories such as rain and cloud, and which determine rates of conversion between categories (the canonical autoconversion, accretion, and self-collection), this option gives the user the flexibility to define as many or as few moments as they please, with these coalescence-based processes being solved directly without relying on conversion rates. Likewise, the rate of condensation/evaporation is defined through the rate of diffusion of water vapor to/from the surface of droplets defined by the subdistributions which underpin the method. The user has not only the flexibility to specify the number of moments (and therefore the complexity/accuracy) to use, but also the assumed size distributions corresponding to these moments. For instance, one might define a 5-moment implementation using an Exponential mode for smaller cloud droplets, plus a Gamma mode for larger rain droplets. Or, more creatively, perhaps a 12-moment implementation comprised of four Gamma modes.</p><p>Options for dynamics and size distributions are under continuous development in the <code>Cloudy.jl</code> package, thus only the default and suggested use cases are described in detail here.</p><h2 id="Moments-and-Sub-Distributions"><a class="docs-heading-anchor" href="#Moments-and-Sub-Distributions">Moments and Sub-Distributions</a><a id="Moments-and-Sub-Distributions-1"></a><a class="docs-heading-anchor-permalink" href="#Moments-and-Sub-Distributions" title="Permalink"></a></h2><p>The prognostic variables of this parameterization are a set of N moments, which can be further divided into P sets of moments, each of which correponds to a subdistribution p. By design these moments begin at order 0 and increase as integers up to the maximum number of parameters for the chosen subdistribution. The first three such default moments have interpretable meanings:</p><ul><li><span>$M_0$</span> - the number density of droplets [1/m^3]</li><li><span>$M_1$</span> - the mass density of droplets [kg/m^3]</li><li><span>$M_2$</span> - proportional to the radar reflectivity [kg^2/m^3]</li></ul><p>and can be converted to more canonical definitions of <code>q_liq</code> and <code>q_rai</code> through numerical integration.</p><p>When the user wishes to use more than 2 or 3 total variables to represent the system, these moments must be divided between <span>$P &gt; 1$</span> sub-distributions, each of which assumes the form of a particular mathematical distribution, such as an Exponential, Lognormal, or Monodisperse (each of which has two parameters), or a Gamma distribution (which takes 3 parameters). </p><h2 id="Loading-the-extension"><a class="docs-heading-anchor" href="#Loading-the-extension">Loading the extension</a><a id="Loading-the-extension-1"></a><a class="docs-heading-anchor-permalink" href="#Loading-the-extension" title="Permalink"></a></h2><p>The package <code>Cloudy.jl</code> and its dependencies are not loaded by default when using <code>CloudMicrophysics.jl</code>. Rather, one must specify:</p><pre><code class="nohighlight hljs">using CloudMicrophysics
using Cloudy</code></pre><p>from the Julia REPL. Upon recognizing that <code>Cloudy.jl</code> is being loaded, the extension <code>CloudyExt.jl</code> will then be loaded and overwrite the function stubs defined in <code>src/MicrophysicsFlexible.jl</code>.</p><h2 id="Setting-up-a-system"><a class="docs-heading-anchor" href="#Setting-up-a-system">Setting up a system</a><a id="Setting-up-a-system-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-up-a-system" title="Permalink"></a></h2><p>All the details from the number of moments and type of subdistributions, to the parameterizations of coalescence, condensation, and sedimentation are defined through the <code>CLSetup</code> (CLoudySetup) mutable struct. This struct is mutable specifically because certain of its components, such as backend-computed coalescence tendencies, are updated prior to being passed to the timestepper. The components of a <code>CLSetup</code> object and their defaults are further described below.</p><table><tr><th style="text-align: right">component</th><th style="text-align: right">description</th><th style="text-align: right">default</th></tr><tr><td style="text-align: right"><span>$pdists$</span></td><td style="text-align: right">Vector of subdistributions corresponding</td><td style="text-align: right"><span>$[Exponential, Gamma]$</span></td></tr><tr><td style="text-align: right"></td><td style="text-align: right">to the moments</td><td style="text-align: right"></td></tr><tr><td style="text-align: right"><span>$mom$</span></td><td style="text-align: right">Prognostic mass moments, in the same order</td><td style="text-align: right"><span>$[1e8 / m^3, 1e-2 kg/m^3,$</span></td></tr><tr><td style="text-align: right"></td><td style="text-align: right">as the corresponding subdistributions;</td><td style="text-align: right"><span>$1e6/m^3, 1e-3 kg/m^3,$</span></td></tr><tr><td style="text-align: right"></td><td style="text-align: right">first 2 for Exp, next 3 for Gamma</td><td style="text-align: right"><span>$2e-12 kg^2/m^3]$</span></td></tr><tr><td style="text-align: right"><span>$KernelFunc$</span></td><td style="text-align: right">Form of the coalescence kernel function</td><td style="text-align: right"><span>$LongKernelFunction$</span></td></tr><tr><td style="text-align: right"><span>$mass_thresholds$</span></td><td style="text-align: right">Particle size thresholds for coalescence</td><td style="text-align: right"><span>$[10.0, Inf]$</span></td></tr><tr><td style="text-align: right"></td><td style="text-align: right">integration</td><td style="text-align: right"></td></tr><tr><td style="text-align: right"><span>$kernel order$</span></td><td style="text-align: right">Polynomial order for the approx. kernel</td><td style="text-align: right"><span>$1$</span></td></tr><tr><td style="text-align: right"><span>$kernel_limit$</span></td><td style="text-align: right">Size threshold for approx. kernel</td><td style="text-align: right"><span>$500$</span></td></tr><tr><td style="text-align: right"><span>$vel$</span></td><td style="text-align: right">Power-series coefficients for velocity</td><td style="text-align: right"><span>$[2.0, 1/6]$</span></td></tr><tr><td style="text-align: right"><span>$norms$</span></td><td style="text-align: right">Normalizing number density &amp; mass</td><td style="text-align: right"><span>$[1e6/m^3, 1e-9 kg]$</span></td></tr></table></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Microphysics2M/">« 2-moment precipitation microphysics</a><a class="docs-footer-nextpage" href="../P3Scheme/">P3 Scheme »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Thursday 9 May 2024 19:19">Thursday 9 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
