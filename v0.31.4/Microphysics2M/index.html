<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>2-moment precipitation microphysics · CloudMicrophysics.jl</title><meta name="title" content="2-moment precipitation microphysics · CloudMicrophysics.jl"/><meta property="og:title" content="2-moment precipitation microphysics · CloudMicrophysics.jl"/><meta property="twitter:title" content="2-moment precipitation microphysics · CloudMicrophysics.jl"/><meta name="description" content="Documentation for CloudMicrophysics.jl."/><meta property="og:description" content="Documentation for CloudMicrophysics.jl."/><meta property="twitter:description" content="Documentation for CloudMicrophysics.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="CloudMicrophysics.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">CloudMicrophysics.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox" checked/><label class="tocitem" for="menuitem-2"><span class="docs-label">Parameterizations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../Microphysics0M/">0-moment precipitation microphysics</a></li><li><a class="tocitem" href="../Microphysics1M/">1-moment precipitation microphysics</a></li><li class="is-active"><a class="tocitem" href>2-moment precipitation microphysics</a><ul class="internal"><li><a class="tocitem" href="#The-Seifert-and-Beheng-(2006)-parametrization"><span>The Seifert and Beheng (2006) parametrization</span></a></li><li><a class="tocitem" href="#Additional-2-moment-microphysics-options"><span>Additional 2-moment microphysics options</span></a></li><li><a class="tocitem" href="#Number-concentration-adjustment-(Horn-2012)"><span>Number concentration adjustment (Horn 2012)</span></a></li><li><a class="tocitem" href="#Example-figures"><span>Example figures</span></a></li></ul></li><li><a class="tocitem" href="../P3Scheme/">P3 Scheme</a></li><li><a class="tocitem" href="../TerminalVelocity/">Terminal Velocity</a></li><li><a class="tocitem" href="../MicrophysicsNonEq/">Non-equilibrium cloud formation</a></li><li><a class="tocitem" href="../ThresholdsTransition/">Smooth transition at thresholds</a></li><li><a class="tocitem" href="../AerosolActivation/">Aerosol activation</a></li><li><a class="tocitem" href="../WaterActivity/">Water Activity</a></li><li><a class="tocitem" href="../IceNucleation/">Ice Nucleation</a></li><li><a class="tocitem" href="../AerosolNucleation/">Aerosol Nucleation</a></li><li><a class="tocitem" href="../CloudDiagnostics/">Cloud diagnostics</a></li><li><a class="tocitem" href="../PrecipitationSusceptibility/">Precipitation Susceptibility</a></li></ul></li><li><a class="tocitem" href="../Thermodynamics/">Thermodynamics interface</a></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">How to guides</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../guides/literated/GettingStarted/">Getting started</a></li><li><a class="tocitem" href="../guides/literated/Parameters/">Handling parameters</a></li><li><a class="tocitem" href="../guides/literated/SimpleModel/">Building a model</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Models</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../IceNucleationParcel0D/">Adiabatic parcel model</a></li><li><a class="tocitem" href="../IceNucleationBox0D/">Box Model</a></li></ul></li><li><a class="tocitem" href="../API/">API</a></li><li><a class="tocitem" href="../DevelopersGuide/">Developer&#39;s Guide</a></li><li><a class="tocitem" href="../Glossary/">Glossary</a></li><li><a class="tocitem" href="../References/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Parameterizations</a></li><li class="is-active"><a href>2-moment precipitation microphysics</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>2-moment precipitation microphysics</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CliMA/CloudMicrophysics.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/CliMA/CloudMicrophysics.jl/blob/main/docs/src/Microphysics2M.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Microphysics-2M"><a class="docs-heading-anchor" href="#Microphysics-2M">Microphysics 2M</a><a id="Microphysics-2M-1"></a><a class="docs-heading-anchor-permalink" href="#Microphysics-2M" title="Permalink"></a></h1><p>The <code>Microphysics2M.jl</code> module provides 2-moment warm rain bulk parameterization of cloud microphysical processes including autoconversion, accretion, cloud droplets and raindrops self-collection, raindrops breakup, mean terminal velocity and rain evaporation. Autoconversion defines the rate of transfer from cloud liquid water to rain water due to collisions between cloud droplets. Accretion defines the rate of transfer from cloud liquid water to rain water due to collisions between cloud droplets and rain drops. Cloud self-collection defines the rate of change of cloud droplets number density due to collisions between cloud droplets, and similarly, rain self-collection defines the rate of change of raindrops number density due to collsions between raindrops. Rain drops breakup defines the rate of new raindrops production due to the disintegration of larger raindrops. Mean terminal velocity represents the mean fall speed of raindrops, and rain evaporation describes the rate of the transformation of rainwater to water vapor. Specifically, <code>Microphysics2M.jl</code> implements:</p><ul><li>the double-moment [<a href="../References/#SeifertBeheng2006">10</a>] parametrization, which includes autoconversion, accretion, cloud and rain self-collection rates, breakup, terminal velocity and evaporation;</li><li>and other double-moment autoconversion and accretions schemes from [<a href="../References/#Wood2005">13</a>] based on the works of [<a href="../References/#KhairoutdinovKogan2000">17</a>], [<a href="../References/#Beheng1994">18</a>], [<a href="../References/#TripoliCotton1980">19</a>] and [<a href="../References/#LiuDaum2004">20</a>].</li></ul><p>The microphysics variables are expressed as specific contents [kg substance / kg air] and number densities [1 / m<span>$^3$</span> air]:</p><ul><li><code>q_lcl</code> - cloud water specific content,</li><li><code>q_rai</code> - rain specific content,</li><li><code>N_lcl</code> - cloud droplets number density,</li><li><code>N_rai</code> - raindrops number density.</li></ul><p>The default values of free parameters are defined in   <a href="https://github.com/CliMA/ClimaParams.jl">ClimaParams</a>   and can be overwritten using the <code>toml</code> files.</p><h2 id="The-Seifert-and-Beheng-(2006)-parametrization"><a class="docs-heading-anchor" href="#The-Seifert-and-Beheng-(2006)-parametrization">The Seifert and Beheng (2006) parametrization</a><a id="The-Seifert-and-Beheng-(2006)-parametrization-1"></a><a class="docs-heading-anchor-permalink" href="#The-Seifert-and-Beheng-(2006)-parametrization" title="Permalink"></a></h2><p>The [<a href="../References/#SeifertBeheng2006">10</a>] parametrization provides process rates for autoconversion, accretion, self-collection of cloud droplets and raindrops, raindrops breakup, raindrops mean fall speed, and rain evaporation. This parametrization is directly derived from the stochastic collection equation (SCE) with a piecewise polynomial collsion kernel. It assumes</p><ul><li>a generalized gamma distribution for cloud droplets (as a function of mass)</li><li>an exponential distribution for raindrops (as a function of diameter)</li></ul><p>The piece-wise polynomial collection kernel, used for the derivation of the parametrization, is given by:</p><p class="math-container">\[\begin{align}
    K(x,y) =
    \begin{cases}
    k_{cc}(x^2+y^2), \quad &amp; x\wedge y &lt; x^*\\
    k_{cr}(x+y), \quad &amp; x\oplus y \geq x^*,\\
    k_{rr}(x+y)\exp[-\kappa_{rr} (x^{1/3} + y^{1/3})], \quad &amp; x\wedge y \geq x^*,
    \end{cases}
\end{align}\]</p><p>where <span>$x$</span> [kg] and <span>$y$</span> [kg] are drop masses and <span>$x^*$</span> [kg] is the mass threshold chosen to separate the cloud and rain portions of the mass distribution. <span>$K$</span> has units of m<span>$^3$</span> s<span>$^{-1}$</span>, and the constants are:</p><table><tr><th style="text-align: right">symbol</th><th style="text-align: right">default value</th></tr><tr><td style="text-align: right"><span>$k_{cc}$</span></td><td style="text-align: right"><span>$4.44 × 10^9$</span> m<span>$^3$</span> kg<span>$^{-2}$</span> s<span>$^{-1}$</span></td></tr><tr><td style="text-align: right"><span>$k_{cr}$</span></td><td style="text-align: right"><span>$5.25$</span> m<span>$^3$</span> kg<span>$^{-1}$</span> s<span>$^{-1}$</span></td></tr><tr><td style="text-align: right"><span>$k_{rr}$</span></td><td style="text-align: right"><span>$7.12$</span> m<span>$^3$</span> kg<span>$^{-1}$</span> s<span>$^{-1}$</span></td></tr><tr><td style="text-align: right"><span>$κ_{rr}$</span></td><td style="text-align: right"><span>$60.7$</span> kg<span>$^{-1/3}$</span></td></tr><tr><td style="text-align: right"><span>$x^*$</span></td><td style="text-align: right"><span>$6.54 × 10^{-11}$</span> kg</td></tr></table><p>Assuming spherical raindrops, the mass <span>$x$</span> is related to the drop radius <span>$r$</span> by <span>$x = \frac{4π}{3}ρ_w r^3$</span>, then the default value of <span>$x^*=6.54\times 10^{-11}$</span> kg corresponds to the drop radius <span>$r^* ≈ 25$</span> μm.</p><h3 id="Assumed-size-distributions"><a class="docs-heading-anchor" href="#Assumed-size-distributions">Assumed size distributions</a><a id="Assumed-size-distributions-1"></a><a class="docs-heading-anchor-permalink" href="#Assumed-size-distributions" title="Permalink"></a></h3><p>In this section, we describe the assumed size distributions for cloud droplets and raindrops. We use the symbol <span>$f$</span> to denote the number distribution as a function of mass, <span>$x$</span> [kg], and the symbol <span>$n$</span> to denote the number distribution as a function of diameter, <span>$D$</span> [m]. We will show how to convert between the two representations. Symbols related to cloud droplets and raindrops are denoted with the subscript <span>$c$</span> and <span>$r$</span>, respectively (e.g. <span>$f_c(x)$</span> and <span>$f_r(D)$</span>).</p><h4 id="Cloud-droplets"><a class="docs-heading-anchor" href="#Cloud-droplets">Cloud droplets</a><a id="Cloud-droplets-1"></a><a class="docs-heading-anchor-permalink" href="#Cloud-droplets" title="Permalink"></a></h4><p>The cloud droplet number distribution, as a function of mass <span>$x$</span> [kg], is assumed to follow a generalized Gamma distribution<sup class="footnote-reference"><a id="citeref-1" href="#footnote-1" class="footnote-ref">[1]</a><span class="footnote-preview" id="fn-1"></span></sup></p><div class="admonition is-todo" id="Form-of-size-distribution-parameters-bb6b41cb3e85e335"><header class="admonition-header">Form of size distribution parameters<a class="admonition-anchor" href="#Form-of-size-distribution-parameters-bb6b41cb3e85e335" title="Permalink"></a></header><div class="admonition-body"><p>It would simplify math (and intuition?) if we instead defined the size distribution parameters in the form:</p><p class="math-container">\[f(x) = \frac{N}{x̄} ⋅ \left(\frac{x}{x̄}\right)^ν ⋅ A ⋅ \exp\left(- \left(B\frac{x}{x̄}\right)^μ\right)\]</p><p>where</p><p class="math-container">\[A = \frac{μ ⋅ B^{ν+1}}{Γ(\frac{ν + 1}{μ})}, \qquad
B = \frac{Γ(\frac{ν + 2}{μ})}{Γ(\frac{ν + 1}{μ})}\]</p><p>At least, it would imply that <span>$x$</span> is always normalized by <span>$x̄$</span>, and that <span>$A$</span> and <span>$B$</span> are non-dimensional.</p></div></div><p class="math-container">\[\begin{align}
    f_c(x) = A_c x^{ν_c} \exp\left(-B_c x^{μ_c} \right),
\end{align}\]</p><p>We assume that <span>$ν_c$</span> and <span>$μ_c$</span> are fixed constants. Our default choice for these parameters are <span>$ν_c = 1$</span> and <span>$μ_c = 1$</span>.</p><p>The free parameters for cloud droplets (<span>$A_c$</span>, <span>$B_c$</span>) can be found analytically by integrating over the assumed mass distribution to find the prognostic variables</p><p class="math-container">\[\begin{align}
    N_c = ∫_0^∞ f_c(x) dx, \quad  L_c = ρ_a q_c = ∫_0^∞ x \; f_c(x) dx
\end{align}\]</p><p>where <span>$L_c = ρ_a q_c$</span> [kg / m<span>$^3$</span>] is the cloud liquid water content, <span>$ρ_a$</span> [kg / m<span>$^3$</span>] is the air density, and <span>$\overline{x}_c = \tfrac{L_c}{N_c}$</span> [kg] is the mean droplet mass.</p><details class="admonition is-details" id="Derivation-of-the-expressions-for-A_c-and-B_c-9f686d4a76781210"><summary class="admonition-header">Derivation of the expressions for ``A_c`` and ``B_c``<a class="admonition-anchor" href="#Derivation-of-the-expressions-for-A_c-and-B_c-9f686d4a76781210" title="Permalink"></a></summary><div class="admonition-body"><p>TODO: Add derivation</p></div></details><p>Then<sup class="footnote-reference"><a id="citeref-2" href="#footnote-2" class="footnote-ref">[2]</a><span class="footnote-preview" id="fn-2"></span></sup>,</p><p class="math-container">\[\begin{align}
    B_c = \left(\overline{x}_c \; \frac{Γ\left(\frac{ν_c+1}{μ_c}\right)}{Γ\left(\frac{ν_c+2}{μ_c}\right)}\right)^{-μ_c}, \qquad
    A_c = \frac{μ_c \, N_c \, }{Γ\left(\frac{ν_c+1}{μ_c}\right)} \; B_c^{\frac{ν_c+1}{μ_c}}.
\end{align}\]</p><h5 id="Interactions-with-the-P3-scheme"><a class="docs-heading-anchor" href="#Interactions-with-the-P3-scheme">Interactions with the P3 scheme</a><a id="Interactions-with-the-P3-scheme-1"></a><a class="docs-heading-anchor-permalink" href="#Interactions-with-the-P3-scheme" title="Permalink"></a></h5><p>For interactions (e.g. collisions) with frozen particles, as parameterized in the P3 scheme, bulk rates are computed by integrating over diameter instead of mass.</p><details class="admonition is-details" id="Change-of-variables-between-mass-(x)-and-diameter-(D)-355943279fc1f380"><summary class="admonition-header">Change of variables between mass (x) and diameter (D)<a class="admonition-anchor" href="#Change-of-variables-between-mass-(x)-and-diameter-(D)-355943279fc1f380" title="Permalink"></a></summary><div class="admonition-body"><p>Assuming spherical raindrops, the raindrop mass <span>$x$</span> is related to the raindrop diameter <span>$D$</span> by</p><p class="math-container">\[x = k_m D^3= \frac{π}{6} ρ_w D^3,\]</p><p>where <span>$k_m = \tfrac{ρ_w π}{6}$</span>, and <span>$ρ_w$</span> is the density of water. In terms of <span>$x$</span>, we have <span>$D = k_m^{-1/3} x^{1/3}$</span>. To do a change of variable from <span>$x$</span> to <span>$D$</span>, we need to consider the transformation of <span>$dx$</span> to <span>$dD$</span>, which would appear in an integral against <span>$f$</span>. We can calculate <span>$\tfrac{dx}{dD} = 3k_m D^2$</span> and thus <span>$dx = 3k_m D^2 dD$</span>. Thus, an integral expression with <span>$f(x)dx$</span> becomes</p><p class="math-container">\[f(x)dx \rightarrow f(x(D)) 3k_m D^2 dD\]</p><p>Similarly, starting from an integral expression <span>$n(D)dD$</span>, in terms of <span>$x$</span> we have <span>$dD = \tfrac{1}{3} k_m^{-1/3} x^{-2/3} dx$</span>, so</p><p class="math-container">\[n(D)dD \rightarrow n(D(x)) \frac{1}{3} k_m^{-1/3} x^{-2/3} dx\]</p><p>We remark that if the integration bounds are at <span>$0$</span> and <span>$∞$</span>,  then they remain unchanged by the change of variable. For any other bounds, we would need to consider the transformation of the bounds.</p></div></details><p>The resulting cloud droplet distribution in terms of diameter is</p><p class="math-container">\[\begin{align}
    n_c(D)
    = f_c(x(D)) \frac{ρ_w π}{2} D^2
    = A_c x(D)^{\nu_c} \exp\left(-B_c x(D)^{\mu_c} \right) 3k_m D^2
\end{align}\]</p><p>where <span>$x(D) = k_m D^3 = \tfrac{π}{6} ρ_w D^3$</span>, and <span>$ρ_w$</span> is the density of water. Explicitly written out, we have</p><p class="math-container">\[\begin{align}
    n_c(D) = 3 A_c k_m^{ν_c + 1} D^{3ν_c + 2} \exp\left(-B_c k_m^{μ_c} D^{3μ_c} \right)
\end{align}\]</p><div class="admonition is-info" id="Undeveloped-cloud-droplet-spectrum-fed906fb0d026bd5"><header class="admonition-header">Undeveloped cloud droplet spectrum<a class="admonition-anchor" href="#Undeveloped-cloud-droplet-spectrum-fed906fb0d026bd5" title="Permalink"></a></header><div class="admonition-body"><p>In the derivation of the parametrization, it is assumed that the cloud droplet distribution <span>$f_c(x)$</span> does not contain a significant number of droplets with masses almost equal or larger than <span>$x^*$</span>. This is reffered to as the undeveloped cloud droplet spectrum assumption. Similarly the raindrop distribution does not contain a significant number of rain drops with masses almost equal or smaller than <span>$x^*$</span>. These assumptions allow us to simplify the calculation of moments of the distributions by integrating from zero to infinity.</p></div></div><h4 id="Raindrops"><a class="docs-heading-anchor" href="#Raindrops">Raindrops</a><a id="Raindrops-1"></a><a class="docs-heading-anchor-permalink" href="#Raindrops" title="Permalink"></a></h4><div class="admonition is-todo" id="Notation-fixes-6786fff246fe405c"><header class="admonition-header">Notation fixes<a class="admonition-anchor" href="#Notation-fixes-6786fff246fe405c" title="Permalink"></a></header><div class="admonition-body"><p>This section describes the psd in terms of <code>λ_r</code>. In the code, we use <code>D_mean ≡ 1/λ_r</code>. Once this change has percolated through the code, we should use <code>D_mean</code> consistently, including in the equations below.</p></div></div><p>The raindrop number distribution, as a function of diameter <span>$D$</span> [m], is assumed to follow an exponential distribution</p><p class="math-container">\[\begin{align}
    n_r(D) = N_0 \exp\left(- \frac{D}{\overline{D}_r} \right).
\end{align}\]</p><p>To find the free parameters <span>$N_0$</span> and <span>$\overline{D}_r$</span>, we write the expressions for the raindrop number density and the raindrop liquid water content:</p><p class="math-container">\[\begin{align}
    N_r = ∫_0^∞ n_r(D) dD, \quad
    L_r = ρ_a q_r = k_m ∫_0^∞ D^3 \; n_r(D) dD
\end{align}\]</p><p>where <span>$L_r$</span> [kg / m<span>$^3$</span>] is the raindrop content. The second expression comes from integrating the raindrop distribution against the raindrop mass <span>$x(D) = k_m D^3 = \tfrac{ρ_w π}{6} D^3$</span>.</p><details class="admonition is-details" id="Derivation-of-the-expressions-for-N-and-Dᵣ-a1114caeb11c2ce2"><summary class="admonition-header">Derivation of the expressions for N₀ and D̄ᵣ<a class="admonition-anchor" href="#Derivation-of-the-expressions-for-N-and-Dᵣ-a1114caeb11c2ce2" title="Permalink"></a></summary><div class="admonition-body"><p>The moments of the exponential distribution are given by</p><p class="math-container">\[M^k =∫_0^∞ D^k n_r(D) dD = N_0 ∫_0^∞ D^k \exp\left(- \frac{D}{\overline{D}_r} \right) dD = N_0 Γ(k+1) \overline{D}_r^{k+1}.\]</p><p>for any <span>$k&gt;-1$</span>, <span>$\overline{D}_r &gt; 0$</span>. This allows us to solve the integrals above for <span>$N_0$</span> and <span>$\overline{D}_r$</span>:</p><p class="math-container">\[N_r = N_0 \overline{D}_r, \quad
L_r = k_m N_0 Γ(4) \overline{D}_r^4
    = 6 k_m N_r \overline{D}_r^3\]</p><p>where the last equality uses <span>$N_0 = N_r / \overline{D}_r$</span>. This implies that</p><p class="math-container">\[    N_0            = \frac{N_r}{\overline{D}_r}, \quad
    \overline{D}_r = \left( \frac{L_r}{6 k_m N_r} \right)^{1/3}
                   = \left( \frac{\overline{x}_r}{6 k_m} \right)^{1/3}
                   = \left( \frac{\overline{x}_r}{ρ_w π} \right)^{1/3}\]</p></div></details><p>we find</p><p class="math-container">\[\begin{align}
    \overline{D}_r
      = \left( \frac{\overline{x}_r}{6 k_m} \right)^{1/3}
      = \left( \frac{\overline{x}_r}{π ρ_w} \right)^\frac{1}{3}, \qquad
    N_0 = \frac{N_r}{\overline{D}_r}.
\end{align}\]</p><p>where <span>$\overline{x}_r = L_r / N_r$</span> is the mean raindrop mass. This implies a relation between the mean mass and mean diameter</p><p class="math-container">\[\begin{align}
    \overline{x}_r = 6 k_m \overline{D}_r^3 = ρ_w π \overline{D}_r^3.
\end{align}\]</p><details class="admonition is-details" id="Raindrop-distribution-in-terms-of-mass-e982132aeaa25d3b"><summary class="admonition-header">Raindrop distribution in terms of mass<a class="admonition-anchor" href="#Raindrop-distribution-in-terms-of-mass-e982132aeaa25d3b" title="Permalink"></a></summary><div class="admonition-body"><p>To express the raindrop distribution in terms of mass, we use the change of variable machinery from the previous section, noting in particular <span>$D = k_m^{-1/3} x^{1/3}$</span> where <span>$k_m = \tfrac{ρ_w π}{6}$</span>, and <span>$dD = \tfrac{1}{3} k_m^{-1/3} x^{-2/3} dx$</span>. In terms of mass, the distribution is given by</p><p class="math-container">\[\begin{align*}
    f_r(x)
    &amp;= n(D(x)) \frac{1}{3} k_m^{-1/3} x^{-2/3} \\
    &amp;= \frac{N_0 k_m^{-1/3}}{3} x^{-2/3} \exp\left(- \frac{k_m^{-1/3} x^{1/3}}{\overline{D}_r}\right) \\
    &amp;= \frac{N_r k_m^{-1/3}}{3\overline{D}_r} x^{-2/3} \exp\left(- \frac{k_m^{-1/3} x^{1/3}}{\overline{D}_r}\right) \\
\end{align*}\]</p><p>We identify <span>$B_r$</span> by <span>$B_r = \tfrac{k_m^{-1/3}}{\overline{D}_r} = \left(\tfrac{\overline{x}_r}{6}\right)^{-1/3}$</span>. This implies that <span>$A_r = \frac{N_r}{3}B_r$</span>.</p></div></details><p>In the model code, we provide two options for calculating the raindrop number distribution parameters <span>$N_0$</span> and <span>$\overline{D}_r$</span>. One option is to use the expressions above. The other option, described below, limits the range of <span>$\overline{x}_r$</span>, <span>$N_0$</span> and <span>$\overline{D}_r$</span> to avoid numerical artifacts.</p><h5 id="Limiting-the-range-of-Dᵣ"><a class="docs-heading-anchor" href="#Limiting-the-range-of-Dᵣ">Limiting the range of D̄ᵣ</a><a id="Limiting-the-range-of-Dᵣ-1"></a><a class="docs-heading-anchor-permalink" href="#Limiting-the-range-of-Dᵣ" title="Permalink"></a></h5><div class="admonition is-todo" id="Comment-on-the-limiting-procedure-5bcf81b05b382865"><header class="admonition-header">Comment on the limiting procedure<a class="admonition-anchor" href="#Comment-on-the-limiting-procedure-5bcf81b05b382865" title="Permalink"></a></header><div class="admonition-body"><p>Given that each step limits the range of a &quot;problematic&quot; quantity, which is then used in the next limiting step, it is odd that we need to consider additional limits in subsequent steps. We should check whether the subsequent limiting steps are reached, and thus whether those limits are needed at all.</p></div></div><p>[<a href="../References/#WackerSeifert2001">21</a>] showed that every one- or two-moment scheme may experience numerical artifacts, especially as <span>$N→0$</span> and <span>$L→0$</span>, which results in <span>$\overline{x}_r = L_r / N_r$</span> being ill-defined. This manifests, for example, in the bulk rates for sedimentation and evaporation. To avoid this, [<a href="../References/#SeifertBeheng2006">10</a>] proposed limiting the range of <span>$λ_r ≡ \tfrac{1}{\overline{D}_r}$</span>, <span>$N_0$</span>, and <span>$\overline{x}_r$</span> by a sequence of steps.</p><p>First, compute a limited mean mass by</p><p class="math-container">\[\begin{align}
    \tilde{x}_r → \overline{x}_{r, \text{min}} ≤ \frac{L_r}{N_r} ≤ \overline{x}_{r, \text{max}}.
\end{align}\]</p><p>Then, limit <span>$N_0$</span> to be consistent with the limited mean mass</p><details class="admonition is-details" id="Derivation-of-the-limit-on-N-2cbb79bf845cbabc"><summary class="admonition-header">Derivation of the limit on N₀<a class="admonition-anchor" href="#Derivation-of-the-limit-on-N-2cbb79bf845cbabc" title="Permalink"></a></summary><div class="admonition-body"><p>Substitute the expression <span>$\overline{D}_r = \left(\tfrac{\overline{x}_r}{ρ_w π}\right)^{1/3}$</span> into the expression for <span>$N_0$</span>:</p><p class="math-container">\[N_0 = \frac{N_r}{\overline{D}_r} = N_r \left(\frac{π ρ_w}{\tilde{x}_r}\right)^\frac{1}{3}.\]</p></div></details><p>The resulting expression is</p><p class="math-container">\[\begin{align}
    N_0 → N_{0, \text{min}} ≤ N_r \left(\frac{π ρ_w}{\tilde{x}_r}\right)^\frac{1}{3} ≤ N_{0, \text{max}}.
\end{align}\]</p><p>With the limited <span>$N_0$</span>, we then limit <span>$λ_r ≡ \tfrac{1}{\overline{D}_r}$</span>.</p><details class="admonition is-details" id="Derivation-of-the-limit-on-λᵣ-12bd7104dc31f17a"><summary class="admonition-header">Derivation of the limit on λᵣ<a class="admonition-anchor" href="#Derivation-of-the-limit-on-λᵣ-12bd7104dc31f17a" title="Permalink"></a></summary><div class="admonition-body"><div class="admonition is-todo" id="TODO:-Change-from-limiting-λᵣ-to-limiting-Dᵣ-4f9d6f53be1943a2"><header class="admonition-header">TODO: Change from limiting λᵣ to limiting D̄ᵣ<a class="admonition-anchor" href="#TODO:-Change-from-limiting-λᵣ-to-limiting-Dᵣ-4f9d6f53be1943a2" title="Permalink"></a></header><div class="admonition-body"><p>The limit on <span>$λ_r$</span> is what is proposed in [<a href="../References/#SeifertBeheng2006">10</a>]. However, we use <span>$\overline{D}_r$</span> in the code, so we should limit <span>$\overline{D}_r$</span> instead. This requires a change to the <code>ClimaParams</code> parameters.</p></div></div><p>Next, limit <span>$λ_r$</span> by considering the integral expression for <span>$L_r$</span>:</p><p class="math-container">\[\begin{align*}
    L_r &amp;= k_m ∫_0^∞ D^3 n_r(D) dD \\
        &amp;= k_m N_0 ∫_0^∞ D^3 \exp\left(-λ_r D\right) dD \\
        &amp;= k_m N_0 \frac{Γ(3+1)}{λ_r^{3+1}}
         = \frac{6 k_m N_0}{λ_r^4}.
\end{align*}\]</p><p>which implies</p><p class="math-container">\[λ_r = \left( \frac{6 k_m N_0}{L_r} \right)^\frac{1}{4}
    = \left( \frac{ρ_w π N_0}{L_r} \right)^\frac{1}{4}.\]</p></div></details><p>The resulting expression is</p><p class="math-container">\[\begin{align}
    λ_r → λ_{r, \text{min}} ≤ \left( \frac{ρ_w π N_0}{L_r} \right)^\frac{1}{4} ≤ λ_{r, \text{max}}.
\end{align}\]</p><p>Finally, we obtain the limited mean mass <span>$\overline{x}_r$</span> from the relation <span>$N_0 = λ_r N_r = λ_r \tfrac{L_r}{\overline{x}_r}$</span>, which is consistent with the limited <span>$N_0$</span> and <span>$λ_r$</span>:</p><p class="math-container">\[\begin{align}
    \overline{x}_r → \overline{x}_{r, \text{min}} ≤ \frac{λ_r L_r}{N_0} ≤ \overline{x}_{r, \text{max}}.
\end{align}\]</p><p>We obtain the limited <span>$\overline{D}_r$</span> by <span>$\overline{D}_r = \tfrac{1}{λ_r}$</span>.</p><h3 id="Autoconversion"><a class="docs-heading-anchor" href="#Autoconversion">Autoconversion</a><a id="Autoconversion-1"></a><a class="docs-heading-anchor-permalink" href="#Autoconversion" title="Permalink"></a></h3><p>The autoconversion rate can be estimated by looking at variations in the second moment of the particle mass spectrum. Specifically, the sum of variations in the second moment of the cloud droplets and raindrops spectrum equals the variations in the second moment of the particle mass spectrum:</p><p class="math-container">\[\begin{align}
\frac{\partial Z}{\partial t} = \frac{\partial Z_c}{\partial t} + \frac{\partial Z_r}{\partial t},
\end{align}\]</p><p>where <span>$Z$</span> represents the second moment, and <span>$c$</span> and <span>$r$</span> subscripts denote cloud and rain categories respectively. In the early stages of rain evolution, an estimate of the variations in the second moment of the particle mass spectrum is obtained from the stochastic collection equation: <span>$\tfrac{∂Z}{∂t} ≈ 2k_c L_c M_c^{(3)}$</span>, where <span>$M_c^{(3)}$</span> is the third moment of the cloud droplets spectrum. Using these equations, along with computing <span>$Z_c$</span>, <span>$M_c^{(3)}$</span>, <span>$Z_r$</span> directly by integrating the distribution functions, allows us to derive an equation for the autoconversion rate. To simplify the derivation, we assume that in the initial stage of the rain evolution raindrops have sizes of the order of <span>$x^*$</span> and the mean radius of cloud droplets is much less than <span>$x^*$</span>. This approach yields an approximation of the autoconversion rate in the early stages of rain evolution. The early stage rain evolution assumption is then relaxed by means of a universal function that depends on a process time scale.</p><p>The rate of change of rain specific content by autoconversion is finally expressed as</p><p class="math-container">\[\begin{equation}
  \left. \frac{∂q_{rai}}{∂t} \right|_\text{acnv}
  = \frac{k_{cc}}{20 \; x^* \; ρ} \frac{(ν+2)(ν+4)}{(ν+1)^2} (q_{lcl} ρ)^2 \overline{x}_c^2 \left(1+\frac{ϕ_\text{acnv}(τ)}{1-τ^2}\right)\frac{ρ_0}{ρ},
\end{equation}\]</p><p>where:</p><ul><li><span>$q_{lcl}$</span> is the cloud liquid water specific content,</li><li><span>$ρ$</span> is the moist air density,</li><li><span>$ρ_0 = 1.225$</span> [kg / m<span>$^3$</span>] is the air density at surface conditions,</li><li><span>$k_{cc}$</span> is the cloud-cloud collection kernel constant,</li><li><span>$ν$</span> is the cloud droplet gamma distribution parameter,</li><li><span>$x^*$</span> is the drop mass separating the cloud and rain categories</li><li><span>$\overline{x}_c = (q_{lcl} ρ) / N_{lcl}$</span> is the cloud droplet mean mass with <span>$N_{lcl}$</span> denoting the cloud droplet number density. Here, to ensure numerical stability, we limit <span>$\overline{x}_c$</span> by the upper bound of <span>$x^*$</span>.</li></ul><p>The function <span>$ϕ_\text{acnv}(τ)$</span> is used to correct the autoconversion rate for the undeveloped cloud droplet spectrum and the early stage rain evolution assumptions. This is a universal function which is obtained by fitting to numerical results of the SCE:</p><p class="math-container">\[\begin{equation}
  ϕ_\text{acnv}(τ) = A τ^a(1-τ^a)^b,
\end{equation}\]</p><p>where</p><ul><li><span>$τ = 1 - \tfrac{q_{lcl}}{q_{lcl} + q_{rai}}$</span> is a dimensionless internal time scale with <span>$q_{rai}$</span> being the cloud liquid water specific content.</li></ul><p>The default free parameter values are:</p><table><tr><th style="text-align: right">symbol</th><th style="text-align: right">default value</th></tr><tr><td style="text-align: right"><span>$ν$</span></td><td style="text-align: right"><span>$1$</span></td></tr><tr><td style="text-align: right"><span>$A$</span></td><td style="text-align: right"><span>$400$</span></td></tr><tr><td style="text-align: right"><span>$a$</span></td><td style="text-align: right"><span>$0.7$</span></td></tr><tr><td style="text-align: right"><span>$b$</span></td><td style="text-align: right"><span>$3$</span></td></tr></table><p>The rate of change of raindrops number density is</p><p class="math-container">\[\begin{equation}
  \left. \frac{∂N_{rai}}{∂t} \right|_\text{acnv}
  = \frac{ρ}{x^*} \left. \frac{d \, q_{rai}}{dt} \right|_\text{acnv},
\end{equation}\]</p><p>and the rate of change of liquid water specific content and cloud droplets number density are</p><p class="math-container">\[\begin{align}
  \left. \frac{∂q_{lcl}}{∂t} \right|_{acnv}
    = - \left. \frac{∂q_{rai}}{∂t} \right|_{acnv},\\
  \left. \frac{∂N_{lcl}}{∂t} \right|_{acnv}
    = -2 \left. \frac{∂N_{rai}}{∂t} \right|_{acnv}.
\end{align}\]</p><div class="admonition is-info" id="Note-8da1e0212e361325"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-8da1e0212e361325" title="Permalink"></a></header><div class="admonition-body"><p>The Seifert and Beheng parametrization is formulated for the rate of change of liquid water content <span>$L = ρ q$</span>. Here, we assume constant <span>$ρ$</span> and divide the rates by <span>$ρ$</span> to derive the equations for the rate of change of specific contents.</p></div></div><h3 id="Accretion"><a class="docs-heading-anchor" href="#Accretion">Accretion</a><a id="Accretion-1"></a><a class="docs-heading-anchor-permalink" href="#Accretion" title="Permalink"></a></h3><p>An approximation for the accretion rate is obtained by directly evaluating the integral:</p><p class="math-container">\[\begin{align}
    \left. \frac{∂q_{rai}}{∂t} \right|_\text{accr} = \frac{1}{ρ} ∫_{x=0}^∞ ∫_{y=0}^∞ f_c(x) f_r(y) K(x,y) x dy dx.
\end{align}\]</p><p>Similar to the autoconversion rate, the accretion rate is modified by a universal function. Thus, the rate of change of rain specific content by accretion becomes</p><p class="math-container">\[\begin{align}
  \left. \frac{∂ q_{rai}}{∂t} \right|_\text{accr} = &amp; \frac{k_{cr}}{ρ} (q_{lcl} ρ) (q_{rai} ρ) ϕ_\text{accr}(τ),\nonumber\\
   = &amp; k_r ρ q_{lcl} q_{rai} ϕ_\text{accr}(τ) \left(\frac{ρ_0}{ρ}\right)^{1/2},
\end{align}\]</p><p>where:</p><ul><li><span>$q_{lcl}$</span> is the cloud liquid water specific content,</li><li><span>$q_{rai}$</span> is the rain liquid water specific content,</li><li><span>$ρ$</span> is the moist air density,</li><li><span>$ρ_0$</span> is the air density at surface conditions,</li><li><span>$k_{cr}$</span> is the cloud-rain collection kernel constant.</li></ul><p>The universal function <span>$ϕ_\text{accr}(τ)$</span> is used to correct the accretion rate for the assumption of collsion efficiency being one. Fitting to numerical solutions of the SCE obtains:</p><p class="math-container">\[\begin{equation}
  ϕ_\text{accr}(τ) = \left(\frac{τ}{τ+τ_0}\right)^c,
\end{equation}\]</p><p>where</p><ul><li><span>$τ = 1 - \tfrac{q_{lcl}}{q_{lcl} + q_{rai}}$</span> is a dimensionless internal time scale.</li></ul><p>The default free parameter values are:</p><table><tr><th style="text-align: right">symbol</th><th style="text-align: right">default value</th></tr><tr><td style="text-align: right"><span>$τ_0$</span></td><td style="text-align: right"><span>$5 × 10^{-5}$</span></td></tr><tr><td style="text-align: right"><span>$c$</span></td><td style="text-align: right"><span>$4$</span></td></tr></table><p>The rate of change of raindrops number density by accretion is zero, and the rate of change of liquid water specific content and cloud droplets number density are</p><p class="math-container">\[\begin{align}
  \left. \frac{∂q_{lcl}}{∂t} \right|_\text{accr} = - \left. \frac{∂q_{rai}}{∂t} \right|_\text{accr},\\
  \left. \frac{∂N_{lcl}}{∂t} \right|_\text{accr} = \frac{ρ}{\overline{x}_c} \left. \frac{∂q_{lcl}}{∂t} \right|_\text{accr},
\end{align}\]</p><p>where <span>$\overline{x}_c = \tfrac{q_{lcl}}{N_{lcl}}$</span> is the cloud droplet mean mass.</p><h3 id="Cloud-droplet-self-collection"><a class="docs-heading-anchor" href="#Cloud-droplet-self-collection">Cloud droplet self-collection</a><a id="Cloud-droplet-self-collection-1"></a><a class="docs-heading-anchor-permalink" href="#Cloud-droplet-self-collection" title="Permalink"></a></h3><p>An approximation for the self-collection rate of cloud droplets is obtained by the following equation:</p><p class="math-container">\[\begin{align}
   \left. \frac{∂N_{lcl}}{∂t} \right|_\text{sc}
     &amp;= \left. \frac{∂N_{lcl}}{∂t} \right|_\text{acnv, sc}
      - \left. \frac{∂q_{rai}}{∂t} \right|_\text{acnv}\nonumber\\
     &amp;= - \frac{1}{2}∫_{x=0}^{∞}∫_{y=0}^{∞} f_c(x) f_c(y) K(x,y) dy dx
        - \left. \frac{d \, q_{rai}}{dt} \right|_\text{acnv}.
\end{align}\]</p><p>Direct evaluation of the integral results in the following approximation of the rate of change of cloud droplets number density due to self-collection</p><p class="math-container">\[\begin{equation}
  \left. \frac{∂N_{lcl}}{∂t} \right|_\text{sc}
    = -k_{cc} \frac{ν + 2}{ν + 1} \frac{ρ_0}{ρ} (q_{lcl} ρ)^2
    - \left. \frac{∂N_{lcl}}{∂t} \right|_\text{acnv},
\end{equation}\]</p><p>where:</p><ul><li><span>$q_{lcl}$</span> is the cloud liquid water specific content,</li><li><span>$ρ$</span> is the moist air density,</li><li><span>$ρ_0$</span> is the air density at surface conditions,</li><li><span>$k_{cc}$</span> is the Long&#39;s collection kernel constant,</li><li><span>$ν$</span> is the cloud droplet gamma distribution parameter,</li><li><span>$\left. \frac{d \, N_{lcl}}{dt} \right|_\text{acnv}$</span> is the rate of change of cloud droplets number density by autoconversion.</li></ul><h3 id="Raindrop-self-collection"><a class="docs-heading-anchor" href="#Raindrop-self-collection">Raindrop self-collection</a><a id="Raindrop-self-collection-1"></a><a class="docs-heading-anchor-permalink" href="#Raindrop-self-collection" title="Permalink"></a></h3><p>An approximation for rate of change of raindrops number density due to self-collection is obtained by directly evaluating the integral:</p><p class="math-container">\[\begin{align}
    \left. \frac{∂N_{rai}}{∂t} \right|_\text{sc}= -\frac{1}{2} ∫_{x=0}^∞ ∫_{y=0}^∞ f_r(x) f_r(y) K(x,y) dy dx.
\end{align}\]</p><p>This yields,</p><p class="math-container">\[\begin{equation}
  \left. \frac{∂N_{rai}}{∂t} \right|_\text{sc} = -k_{rr} N_{rai} (q_{rai} ρ) \left(1+\frac{κ_{rr}}{B_r} \right)^d \left(\frac{ρ_0}{ρ}\right)^{1/2},
\end{equation}\]</p><p>where:</p><ul><li><span>$q_{rai}$</span> is the rain water specific content,</li><li><span>$ρ$</span> is the moist air density,</li><li><span>$ρ_0$</span> is the air density at surface conditions,</li><li><span>$N_{rai}$</span> is the raindrops number density,</li><li><span>$k_{rr}$</span> and <span>$κ_{rr}$</span> are the rain-rain collection kernel constants.</li><li><span>$B_r$</span> is the raindrops mass distribution parameter <span>$B_r = \left(\frac{6}{\overline{x}_r}\right)^{1/3}$</span>.</li></ul><p>The default constant value is:</p><table><tr><th style="text-align: right">symbol</th><th style="text-align: right">default value</th></tr><tr><td style="text-align: right"><span>$d$</span></td><td style="text-align: right"><span>$-5$</span></td></tr></table><div class="admonition is-info" id="Note-deb0d7e5c7ce4aeb"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-deb0d7e5c7ce4aeb" title="Permalink"></a></header><div class="admonition-body"><p>In the paper <span>$d=-9$</span> which seems to be a mistake! Evaluating the integral for derving the self-collection rate results in <span>$d=-5$</span>.</p></div></div><div class="admonition is-info" id="Note-a1107681964b7f2c"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-a1107681964b7f2c" title="Permalink"></a></header><div class="admonition-body"><p>For the same numerical instabilities which in the paper are mentioned for terminal velocity and evaporation, here for rain self-collection, the value of <span>$\lambda_r$</span> is bounded within a range. In fact we first compute the bounded <span>$\lambda_r$</span> based on drop diameter by the algorithm given in the paper and then convert it to <span>$\lambda_r$</span> based on mass (the conversion can be done by multiplying to a constant value).</p></div></div><h3 id="Raindrops-breakup"><a class="docs-heading-anchor" href="#Raindrops-breakup">Raindrops breakup</a><a id="Raindrops-breakup-1"></a><a class="docs-heading-anchor-permalink" href="#Raindrops-breakup" title="Permalink"></a></h3><p>Raindrops breakup is modeled by assuming that in a precipitation event coalescence and breakup ultimately reach an equilibrium with a self-similar equilibrium size distribution. As a result, the breakup process can be coupled to raindrops self-collection by the following parameterization</p><p class="math-container">\[\begin{equation}
  \left. \frac{\partial N_{rai}}{\partial t} \right|_{br} = -[\Phi_{br}(\Delta \overline{D}_r) + 1] \left. \frac{\partial N_{rai}}{\partial t} \right|_{sc},
\end{equation}\]</p><p>where <span>$\Delta \overline{D}_r = \overline{D}_r - \overline{D}_{eq}$</span> with <span>$\overline{D}_r$</span> denoting the mean volume raindrop diameter and <span>$\overline{D}_{eq}$</span> being the equilibrium mean diameter. The function <span>$\Phi_{br}(\Delta \overline{D}_r)$</span> is given by</p><p class="math-container">\[  \begin{align}
    \Phi_{br}(\Delta \overline{D}_r) =
    \begin{cases}
    -1, \quad &amp; \overline{D}_r &lt; \overline{D}_{threshold},\\
    k_{br} \Delta \overline{D}_r, \quad &amp; \overline{D}_{threshold} &lt; \overline{D}_r &lt; \overline{D}_{eq},\\
    2 (exp(\kappa_{br} \Delta \overline{D}_r) -1), \quad &amp; \overline{D}_{eq} &lt; \overline{D}_r.
    \end{cases}
  \end{align}\]</p><p>The default free parameter values are:</p><table><tr><th style="text-align: right">symbol</th><th style="text-align: right">default value</th></tr><tr><td style="text-align: right"><span>$k_{br}$</span></td><td style="text-align: right"><span>$1000 \, m^{-1}$</span></td></tr><tr><td style="text-align: right"><span>$\kappa_{br}$</span></td><td style="text-align: right"><span>$2300 \, m^{-1}$</span></td></tr><tr><td style="text-align: right"><span>$\overline{D}_{threshold}$</span></td><td style="text-align: right"><span>$0.35 \times 10^{-3}  \, m$</span></td></tr><tr><td style="text-align: right"><span>$\overline{D}_{eq}$</span></td><td style="text-align: right"><span>$0.9 \times 10^{-3}  \, m$</span></td></tr></table><div class="admonition is-info" id="Note-dd942d1dde37984b"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-dd942d1dde37984b" title="Permalink"></a></header><div class="admonition-body"><p>In the paper for <span>$\overline{D}_{eq} &lt; \overline{D}_r$</span> the equation <span>$\Phi_{br}(\Delta \overline{D}_r) = 2 exp(\kappa_{br} \Delta \overline{D}_r) -1$</span> is given. This equations seems to be missing parentheses as the equation must be continuous at <span>$\Delta \overline{D}_r = 0$</span> as shown in Fig. 2 of the paper.</p></div></div><h3 id="Rain-evaporation"><a class="docs-heading-anchor" href="#Rain-evaporation">Rain evaporation</a><a id="Rain-evaporation-1"></a><a class="docs-heading-anchor-permalink" href="#Rain-evaporation" title="Permalink"></a></h3><p>The parametrization of rain evaporation is obtained by considering the time scale of evaporation of individual raindrops:</p><p class="math-container">\[\begin{equation}
  \tau_{eva} = \frac{x_r}{\frac{dx_r}{dt}\bigg|_{eva}} = \frac{x_r}{2 \pi G_{lv}(T, p) S D_r(x_r) F_v(x_r)},
\end{equation}\]</p><p>where</p><p class="math-container">\[\begin{equation}
  G_{lv}(T, p) = \left[\frac{R_v T}{p_{lv}(T) D_v} + \frac{L_{lv}}{K_T T} \left(\frac{L_{lv}}{R_v T}-1\right)\right]^{-1}
\end{equation}\]</p><p>with temperature <span>$T$</span>, thermal conductivity <span>$K_T$</span>, diffucivity of water vapor <span>$D_v$</span>, specific gas constant for water vapor <span>$R_v$</span>, latent heat of evaporation <span>$L_{lv}$</span> and liquid-vapor saturation pressure <span>$p_{lv}$</span>. The ventilation factor is given by <span>$F_v(x_r) = a_v + b_v N_{Sc}^{1/3} N_{Re}(x_r)^{1/2}$</span> where <span>$N_{Sc} = \nu_{air} / D_v$</span> is the Schmidt number and <span>$N_{Re}(x_r) = \frac{v_r (x_r) D_r (x_r)}{\nu_{air}}$</span> is the Reynolds number with kinematic viscosity of air <span>$\nu_{air}$</span>. The average evaporation rates are obtained from the following integral:</p><p class="math-container">\[\begin{equation}
  \frac{\partial M_r^k}{\partial t}\bigg|_{eva} = \int_0^\infty \frac{x^k f_r(x)}{\tau_{eva}} dx = 2 \pi G_{lv}(T, p) S \int_0^\infty D_r(x) F_v(x) f_r(x) x^{k-1} dx.
\end{equation}\]</p><p>where the superscript <span>$k$</span> indicates the moment number, <span>$k=0$</span> for number-weighted and <span>$k=1$</span> for mass-weighted average. Here in the computation of the evaporation rate, a power-law fall speed is assumed: <span>$v_r(x) \cong \alpha_r x^{\beta_r} \left(\frac{\rho_0}{\rho}\right)^{\frac{1}{2}}$</span>. Evaluating the integral results in:</p><p class="math-container">\[\begin{equation}
  \frac{\partial M_r^k}{\partial t}\bigg|_{eva} = 2 \pi G_{lv}(T, p) S N_{rai} D_r(\overline{x}_r) \overline{F}_{v,\, k}(\overline{x}_r) \overline{x}_r^{k-1},
\end{equation}\]</p><p>where <span>$\overline{F}_{v,\, k}$</span> is an average ventilation factor for the <span>$k$</span>-th moment:</p><p class="math-container">\[\begin{equation}
\overline{F}_{v,\, k}(\overline{x}_r) = a_{vent,\, k} + b_{vent,\, k} N_{Sc}^{1/3} N_{Re}(\overline{x}_r)^{1/2},
\end{equation}\]</p><p>with</p><p class="math-container">\[\begin{align}
  a_{vent,\, k} &amp;= a_v 6^{2/3-k} \Gamma(3k-1),\\
  b_{vent,\, k} &amp;= b_v 6^{1/2-\beta_r/2-k} \Gamma(3k-1/2+3\beta_r/2).
\end{align}\]</p><div class="admonition is-info" id="Note-f6f5ef4f6172c4bc"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-f6f5ef4f6172c4bc" title="Permalink"></a></header><div class="admonition-body"><p>For <span>$k = 0$</span> the integral for computing the mean evaporation rate does not converge. In this case it is reasonable to change the lower bound of the integral to <span>$x=x^*$</span>. The results remain the same except that the Gamma functions in the equations for <span>$a_{vent,\, 0}$</span> and <span>$b_{vent,\, 0}$</span>, which are <span>$\Gamma(-1)$</span> and <span>$\Gamma(-1/2+3\beta_r/2)$</span>, are replaced by the upper incomplete gamma function <span>$\Gamma(-1, (6 x^* / \overline{x}_r)^{1/3})$</span> and <span>$\Gamma(-1/2+3\beta_r/2, (6 x^* / \overline{x}_r)^{1/3})$</span>, respectively. This issue and the suggested workaround are not mentioned in the paper.</p></div></div><p>The two-moment parametrization of evaporation suffers from the similar numerical instability issues as the sedimentation scheme. Thus, the same limiting algorithm as the sedimentation scheme is applied here to bound size distribution parameters. These limited parameters are then used to compute the mean raindrop mass by the following equation:</p><p class="math-container">\[\begin{equation}
  \overline{x}_r = max \left(\overline{x}_{r,\, min} , min \left(\overline{x}_{r,\, max} , \frac{\rho q_{rai} \lambda_r}{N_0}\right)\right).
\end{equation}\]</p><p>This mean mass is used for computing the evaporation rate.</p><p>The default free parameter values are:</p><table><tr><th style="text-align: right">symbol</th><th style="text-align: right">default value</th></tr><tr><td style="text-align: right"><span>$a_v$</span></td><td style="text-align: right"><span>$0.78$</span></td></tr><tr><td style="text-align: right"><span>$b_v$</span></td><td style="text-align: right"><span>$0.308$</span></td></tr><tr><td style="text-align: right"><span>$\alpha_r$</span></td><td style="text-align: right"><span>$159 \, m \cdot s^{-1} \cdot kg^{-\beta_r}$</span></td></tr><tr><td style="text-align: right"><span>$\alpha_r$</span></td><td style="text-align: right"><span>$0.266$</span></td></tr></table><div class="admonition is-info" id="Note-1694e7ecfe6409ac"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-1694e7ecfe6409ac" title="Permalink"></a></header><div class="admonition-body"><p>In our implementation we approximate the incomplete gamma function in order to get good performance on the GPU. Below we show the evaporation rates for the number concnetration and mass using both the exact and approximated gamma function</p></div></div><pre><code class="language-julia hljs">include(&quot;plots/RainEvapoartionSB2006.jl&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">CairoMakie.Screen{SVG}
</code></pre><p><img src="../SB2006_rain_evaporation.svg" alt/></p><h3 id="Terminal-velocity"><a class="docs-heading-anchor" href="#Terminal-velocity">Terminal velocity</a><a id="Terminal-velocity-1"></a><a class="docs-heading-anchor-permalink" href="#Terminal-velocity" title="Permalink"></a></h3><p>The number- and mass-weighted terminal velocities for rain water are obtained by calculating the following integral:</p><p class="math-container">\[\begin{equation}
  \overline{v}_{r,\, k} = \frac{1}{M_r^k} \int_0^\infty x^k f_r(x) v(x) dx,
\end{equation}\]</p><p>where the superscript <span>$k$</span> indicates the moment number,  with <span>$k=0$</span> for number density and <span>$k=1$</span> for mass.</p><p>The individual terminal velocity of particles is approximated by</p><p class="math-container">\[v(D) = \left(\rho_0/\rho\right)^{\frac{1}{2}} [a_R - b_R exp(-c_R D)]\]</p><p>where <span>$a_R$</span>, <span>$b_R$</span> and <span>$c_R$</span> are free parameters and <span>$D$</span> is the particle diameter. Evaluating the integral results in</p><p class="math-container">\[\begin{equation}
  \overline{v}_{r,\, k} = \left(\frac{\rho_0}{\rho}\right)^{\frac{1}{2}}\left[a_R - b_R \left(1+\frac{c_R}{\lambda_r}\right)^{-(3k+1)}\right],
\label{eq:SBTerminalVelocity}
\end{equation}\]</p><p>where <span>$\lambda_r$</span> is the raindrop size distribution parameter (based on diameter): <span>$\lambda_r = (\phi \rho_w/\overline{x}_r)^{1/3}$</span>. To avoid numerical instabilities, especially when <span>$N_{rai} \rightarrow 0$</span> and <span>$q_{rai} \rightarrow 0$</span>, <span>$\lambda_r$</span> is bounded. The limiting algorithm is as follows:</p><p class="math-container">\[\begin{align}
\widetilde{x}_r &amp;= \max \left[ \overline{x}_{r,\, \min} , \min \left(\overline{x}_{r,\, \max} , \frac{\rho q_{rai}}{N_{rai}}\right)\right] ,\\
N_0 &amp;= \max \left[ N_{0,\, \min} , \min \left(N_{0,\, \max} , N_{rai}\left(\frac{\pi \rho_w}{\widetilde{x}_r}\right)^{\frac{1}{3}}\right)\right],\\
\lambda_r &amp;= \max \left[ \lambda_{\min} , \min \left(\lambda_{\max} , \left(\frac{\pi \rho_w N_0}{\rho q_{rai}}\right)^{\frac{1}{4}}\right)\right].
\end{align}\]</p><p>When the limiting algorithm is not applied, the terminal velocity given by eq. (\ref{eq:SBTerminalVelocity}) can become negative for small mean radius values. This occurs because the equation for the individual particle&#39;s terminal velocity may predict negative values for small particles. To avoid negative terminal velocities (or a sudden transition to zero velocity if we return zero instead of negative values), we need to adjust the integration bounds. Specifically, the integrals should be evaluated from the radius at which the individual terminal velocity is zero to infinity. This adjustment leads to the following equation for the terminal velocity:</p><p class="math-container">\[\begin{align}
  \overline{v}_{r,\, k} &amp;= \frac{1}{M_r^k} \int_{r_c}^\infty x^k f_r(x) v(x) dx \nonumber\\
  &amp;= \left(\frac{\rho_0}{\rho}\right)^{\frac{1}{2}}\left[a_R \frac{\Gamma(3k+1, 2r_c\lambda_r)}{\Gamma(3k+1)} - b_R \frac{\Gamma(3k+1, 2r_c(\lambda_r + c_R))}{\Gamma(3k+1)} \left(1+\frac{c_R}{\lambda_r}\right)^{-(3k+1)}\right],
\label{eq:SBModifiedTerminalVelocity}
\end{align}\]</p><p>where <span>$r_c = -\ln(a_R / b_R)/(2c_R)$</span>.</p><p>The default parameter values are:</p><table><tr><th style="text-align: right">symbol</th><th style="text-align: right">default value</th></tr><tr><td style="text-align: right"><span>$a_R$</span></td><td style="text-align: right"><span>$9.65 \, m \cdot s^{-1}$</span></td></tr><tr><td style="text-align: right"><span>$b_R$</span></td><td style="text-align: right"><span>$10.3 \, m \cdot s^{-1}$</span></td></tr><tr><td style="text-align: right"><span>$c_R$</span></td><td style="text-align: right"><span>$600 \, m^{-1}$</span></td></tr><tr><td style="text-align: right"><span>$\overline{x}_{r,\, \min}$</span></td><td style="text-align: right"><span>$6.54 \times 10^{-11} \, m$</span></td></tr><tr><td style="text-align: right"><span>$\overline{x}_{r,\, \max}$</span></td><td style="text-align: right"><span>$5 \times 10^{-6}  \, m$</span></td></tr><tr><td style="text-align: right"><span>$N_{0,\, \min}$</span></td><td style="text-align: right"><span>$3.5 \times 10^{5}  \, m^{-4}$</span></td></tr><tr><td style="text-align: right"><span>$N_{0,\, \max}$</span></td><td style="text-align: right"><span>$2 \times 10^{10}  \, m^{-4}$</span></td></tr><tr><td style="text-align: right"><span>$\lambda_{\min}$</span></td><td style="text-align: right"><span>$1 \times 10^{3}  \, m^{-1}$</span></td></tr><tr><td style="text-align: right"><span>$\lambda_{\max}$</span></td><td style="text-align: right"><span>$4 \times 10^{4}  \, m^{-1}$</span></td></tr></table><p>Below we compare number-weighted (left) and mass-weighted (right) terminal velocities   for the original parameterization of SB2006 [<a href="../References/#SeifertBeheng2006">10</a>]   and the modifed parameterzation given by eq. (\ref{eq:SBModifiedTerminalVelocity}),   without the limiting distribution shape factor <span>$\lambda_r$</span>.</p><pre><code class="language-julia hljs">include(&quot;plots/TerminalVelocity2M.jl&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&quot;/home/runner/work/CloudMicrophysics.jl/CloudMicrophysics.jl/docs/build/2M_terminal_velocity_comparisons.svg&quot;</code></pre><p><img src="../2M_terminal_velocity_comparisons.svg" alt/></p><p>For cloud liquid droplets in two-moment microphysics schemes, we use the analytical Stokes-regime expression for the terminal velocity of an individual spherical particle:</p><p class="math-container">\[v(r) = \frac{2}{9} \frac{(\rho_{water} - \rho_{air}) g}{\mu_{air}} r^2\]</p><p>with <span>$\mu_{air} = \rho_{air} \, \nu_{air}$</span> and assuming constant kinematic viscosity <span>$\nu_{air}$</span> in our parameterization. When droplet sizes follow a gamma distribution (as in Seifert &amp; Beheng 2006), integrating this equation over the size spectrum yields the number- and mass-weighted mean terminal velocities:</p><p class="math-container">\[\begin{align*}
  \overline{v}_{c,\, k} = \frac{2}{9}\, \left(\frac{3}{4\, \pi\, \rho_{water}}\right)^{2/3}\, \left(\frac{\rho_{water}}{\rho_{air}}-1\right)\, \frac{g}{\nu_{air}}\, \frac{M_{k+2/3}}{M_k}
\end{align*}\]</p><p>where</p><ul><li><span>$M_i$</span> is the <span>$i$</span>-th moment of the droplet size distribution.</li><li><span>$k$</span> is the weighting moment: <span>$k=0$</span> for number-mean velocity, <span>$k=1$</span> for mass-mean velocity.</li></ul><p>For a gamma distribution with shape parameters <span>$\nu_c$</span> and <span>$\mu_c$</span>, the mean terminal velocities can be written analytically as:</p><p class="math-container">\[\begin{align*}
  \overline{v}_{c,\, k} = \frac{\Gamma(\frac{k+2/3+\nu_c+1}{\mu_c})}{\Gamma(\frac{k+\nu_c+1}{\mu_c})}\left[\frac{\Gamma(\frac{\nu_c+1}{\mu_c})}{\Gamma(\frac{\nu_c+2}{\mu_c})}\right]^{2/3} v_{c,\, k}(\overline{r})
\end{align*}\]</p><p>where <span>$v_{c,\, k}(\overline{r})$</span> is the fall speed of a particle with mean radius <span>$\overline{r}$</span>.</p><p>For the Chen et al. [<a href="../References/#Chen2022">12</a>] terminal velocity parameterization,   the number- and mass-weighted group terminal velocities are:</p><p class="math-container">\[\begin{equation}
  \overline{v_k} = \frac{\int_0^\infty v(D) \, D^k \, n(D) \, dD}
             {\int_0^\infty D^k \, n(D) \, dD}
             = (\phi)^{\kappa} \Sigma_{i} \frac{a_i \lambda^\delta \Gamma(b_i + \delta)}
             {(\lambda + c_i)^{b_i + \delta} \; \Gamma(\delta)},
\end{equation}\]</p><p>where <span>$\Gamma$</span> is the gamma function, <span>$\delta = k + 1$</span>, and <span>$\lambda$</span> is the size distribution parameter. The velocity <span>$\overline{v_k}$</span> is the number-weighted mean terminal velocity when k = 0, and the mass-weighted mean terminal velocity when k = 3.</p><h2 id="Additional-2-moment-microphysics-options"><a class="docs-heading-anchor" href="#Additional-2-moment-microphysics-options">Additional 2-moment microphysics options</a><a id="Additional-2-moment-microphysics-options-1"></a><a class="docs-heading-anchor-permalink" href="#Additional-2-moment-microphysics-options" title="Permalink"></a></h2><p>The other autoconversion and accretion rates in the <code>Microphysics2M.jl</code> module   are implemented after Table 1 from [<a href="../References/#Wood2005">13</a>] and are based on the works of   [<a href="../References/#KhairoutdinovKogan2000">17</a>],   [<a href="../References/#Beheng1994">18</a>],   [<a href="../References/#TripoliCotton1980">19</a>] and   [<a href="../References/#LiuDaum2004">20</a>] respectively. From the above works:   (i) the [<a href="../References/#KhairoutdinovKogan2000">17</a>] parameterisation is based   on a fit to drop spectrum resolving scheme and designed to work   for stratocumulus topped boundary layers,   (ii) the [<a href="../References/#Beheng1994">18</a>] parameterisation is based on a fit   to stochastic collection equation,   (iii) the [<a href="../References/#TripoliCotton1980">19</a>] parameterisation is developed   for a deep convective case, and   (iv) the [<a href="../References/#LiuDaum2004">20</a>] parameterisation is derived to   include the effects of relative dispersion   of the cloud droplet size distribution on precipitation formation rates   and assumes a modified gamma distribution.</p><h3 id="Autoconversion-2"><a class="docs-heading-anchor" href="#Autoconversion-2">Autoconversion</a><a class="docs-heading-anchor-permalink" href="#Autoconversion-2" title="Permalink"></a></h3><h4 id="Khairoutdinov-and-Kogan-(2000)"><a class="docs-heading-anchor" href="#Khairoutdinov-and-Kogan-(2000)">Khairoutdinov and Kogan (2000)</a><a id="Khairoutdinov-and-Kogan-(2000)-1"></a><a class="docs-heading-anchor-permalink" href="#Khairoutdinov-and-Kogan-(2000)" title="Permalink"></a></h4><p class="math-container">\[\begin{equation}
  \left. \frac{d \, q_{rai}}{dt} \right|_{acnv} = A \; q_{lcl}^a \; N_d^b \; \rho^c
\end{equation}\]</p><p>where:</p><ul><li><span>$q_{lcl}$</span> is the cloud liquid water specific content,</li><li><span>$N_d$</span> is the cloud droplet concentration,</li><li><span>$\rho$</span> is the air density,</li></ul><p>and the default free parameter values are:</p><table><tr><th style="text-align: right">symbol</th><th style="text-align: right">default value</th></tr><tr><td style="text-align: right"><span>$A$</span></td><td style="text-align: right"><span>$7.42 \times 10^{13}$</span></td></tr><tr><td style="text-align: right"><span>$a$</span></td><td style="text-align: right"><span>$2.47$</span></td></tr><tr><td style="text-align: right"><span>$b$</span></td><td style="text-align: right"><span>$-1.79$</span></td></tr><tr><td style="text-align: right"><span>$c$</span></td><td style="text-align: right"><span>$-1.47$</span></td></tr></table><h4 id="Beheng-(1994)"><a class="docs-heading-anchor" href="#Beheng-(1994)">Beheng (1994)</a><a id="Beheng-(1994)-1"></a><a class="docs-heading-anchor-permalink" href="#Beheng-(1994)" title="Permalink"></a></h4><p class="math-container">\[\begin{equation}
  \left. \frac{d \, q_{rai}}{dt} \right|_{acnv} = \frac{C \; d^a \; (q_{lcl} \rho)^b \; N_d^c}{\rho}
\end{equation}\]</p><p>where:</p><ul><li><span>$q_{lcl}$</span> is the cloud liquid water specific content,</li><li><span>$N_d$</span> is the cloud droplet number concentration,</li></ul><p>and the default free parameter values are:</p><table><tr><th style="text-align: right">symbol</th><th style="text-align: right">default value</th></tr><tr><td style="text-align: right"><span>$C$</span></td><td style="text-align: right"><span>$3 \times 10^{34}$</span></td></tr><tr><td style="text-align: right"><span>$a$</span></td><td style="text-align: right"><span>$-1.7$</span></td></tr><tr><td style="text-align: right"><span>$b$</span></td><td style="text-align: right"><span>$4.7$</span></td></tr><tr><td style="text-align: right"><span>$c$</span></td><td style="text-align: right"><span>$-3.3$</span></td></tr><tr><td style="text-align: right"><span>$d$</span></td><td style="text-align: right"><span>$9.9$</span> for <span>$N_d &lt; 200 cm^{-3}$</span>,  <span>$3.9$</span> for <span>$N_d &gt; 200 cm ^{-3}$</span></td></tr></table><h4 id="Tripoli-and-Cotton-(1980)"><a class="docs-heading-anchor" href="#Tripoli-and-Cotton-(1980)">Tripoli and Cotton (1980)</a><a id="Tripoli-and-Cotton-(1980)-1"></a><a class="docs-heading-anchor-permalink" href="#Tripoli-and-Cotton-(1980)" title="Permalink"></a></h4><p class="math-container">\[\begin{equation}
  \left. \frac{d \, q_{rai}}{dt} \right|_{acnv} =
    D \; q_{lcl}^a \; N_d^b \; \mathrm{H}(q_{lcl} - q_{lcl\_threshold})
\end{equation}\]</p><p>where:</p><ul><li><span>$q_{lcl}$</span> is the cloud liquid water specific content,</li><li><span>$q_{lcl_threshold}$</span> is the cloud liquid to rain water threshold,</li><li><span>$N_d$</span> is the cloud droplet number concentration,</li><li><span>$\mathrm{H}(x)$</span> is the Heaviside step function.</li></ul><p>The cloud liquid to rain water autoconversion threshold is defined   assuming spherical liquid water drops of radius equal to <span>$7 \mu m$</span>:</p><p class="math-container">\[\begin{equation}
  q_{lcl\_threshold} = \frac{4}{3} \pi \rho_w N_d r_{cm}^3
\end{equation}\]</p><p>where:</p><ul><li><span>$\rho_w$</span> is the liquid water density,</li></ul><p>and the default free parameter values are:</p><table><tr><th style="text-align: right">symbol</th><th style="text-align: right">default value</th></tr><tr><td style="text-align: right"><span>$D$</span></td><td style="text-align: right"><span>$3268$</span></td></tr><tr><td style="text-align: right"><span>$a$</span></td><td style="text-align: right"><span>$\frac{7}{3}$</span></td></tr><tr><td style="text-align: right"><span>$b$</span></td><td style="text-align: right"><span>$\frac{-1}{3}$</span></td></tr><tr><td style="text-align: right"><span>$r_{cm}$</span></td><td style="text-align: right"><span>$7 \times 10^{-6} m$</span></td></tr></table><h4 id="Liu-and-Daum-(2004)"><a class="docs-heading-anchor" href="#Liu-and-Daum-(2004)">Liu and Daum (2004)</a><a id="Liu-and-Daum-(2004)-1"></a><a class="docs-heading-anchor-permalink" href="#Liu-and-Daum-(2004)" title="Permalink"></a></h4><p class="math-container">\[\begin{equation}
  \left. \frac{d \, q_{rai}}{dt} \right|_{acnv} =
    \frac{E \; (q_{lcl} \; \rho)^3 \; \mathrm{H}(R_6 - R_{6C})}{N_d \; \rho}
\end{equation}\]</p><p>where:</p><ul><li><span>$q_{lcl}$</span> is the cloud liquid water specific content,</li><li><span>$N_d$</span> is the cloud droplet number concentration,</li><li><span>$\rho$</span> is the air density.</li></ul><p>The parameterisation is formulated using mean volume radius   <span>$r_{vol}$</span> expressed in <span>$\mu m$</span> which we compute as</p><p class="math-container">\[\begin{equation}
    r_{vol} = \left(\frac{\rho q_{lcl}}{4/3 \pi \; \rho_w \; N_d}\right)^{1/3} 10^6
\end{equation}\]</p><p>where:</p><ul><li><span>$\rho_w$</span> is the liquid water density.</li></ul><p>Then the <span>$R_6$</span> and <span>$R_{6C}$</span> are defined as</p><ul><li><span>$R_6 = \beta_6 \; r_{vol}$</span></li><li><span>$R_{6C} = \frac{R_{C0}}{(q_{lcl} \rho)^{1/6} R_6^{1/2}}$</span></li><li><span>$\beta_6 = \left( \frac{r_{vol} + 3}{r_{vol}} \right)^{1/3}$</span></li><li><span>$E = E_0 \beta_6^6$</span></li></ul><table><tr><th style="text-align: right">symbol</th><th style="text-align: right">default value</th></tr><tr><td style="text-align: right"><span>$R_{C0}$</span></td><td style="text-align: right"><span>$7.5$</span></td></tr><tr><td style="text-align: right"><span>$E_0$</span></td><td style="text-align: right"><span>$1.08 \times 10^{10}$</span></td></tr></table><h4 id="Auto-conversion-with-time-scale-depending-on-number-density"><a class="docs-heading-anchor" href="#Auto-conversion-with-time-scale-depending-on-number-density">Auto-conversion with time scale depending on number density</a><a id="Auto-conversion-with-time-scale-depending-on-number-density-1"></a><a class="docs-heading-anchor-permalink" href="#Auto-conversion-with-time-scale-depending-on-number-density" title="Permalink"></a></h4><p class="math-container">\[\begin{equation}
  \left. \frac{d \, q_{rai}}{dt} \right|_{acnv} =
    \frac{q_{lcl}}{\tau_{acnv,\, 0} \left(\frac{N_d}{100\, cm^{-3}}\right)^{\alpha_{acnv}}}
\end{equation}\]</p><p>where:</p><ul><li><span>$q_{lcl}$</span> is the cloud liquid water specific content,</li><li><span>$N_d$</span> is the cloud droplet number concentration,</li><li><span>$\tau_{acnv,\, 0}$</span> is the auto-conversion time scale at <span>$N_d = 100 cm^{-3}$</span>.</li></ul><p>The default free parameter values are:</p><table><tr><th style="text-align: right">symbol</th><th style="text-align: right">default value</th></tr><tr><td style="text-align: right"><span>$\tau_{acnv,\, 0}$</span></td><td style="text-align: right"><span>$1000\ s$</span></td></tr><tr><td style="text-align: right"><span>$\alpha_{acnv}$</span></td><td style="text-align: right"><span>$1$</span></td></tr></table><h3 id="Accretion-2"><a class="docs-heading-anchor" href="#Accretion-2">Accretion</a><a class="docs-heading-anchor-permalink" href="#Accretion-2" title="Permalink"></a></h3><h4 id="Khairoutdinov-and-Kogan-(2000)-2"><a class="docs-heading-anchor" href="#Khairoutdinov-and-Kogan-(2000)-2">Khairoutdinov and Kogan (2000)</a><a class="docs-heading-anchor-permalink" href="#Khairoutdinov-and-Kogan-(2000)-2" title="Permalink"></a></h4><p class="math-container">\[\begin{equation}
  \left. \frac{d \, q_{rai}}{dt} \right|_{accr} = A \; (q_{lcl} q_{rai})^a \; \rho^b
\end{equation}\]</p><p>where:</p><ul><li><span>$q_{lcl}$</span> is the cloud liquid water specific content,</li><li><span>$q_{rai}$</span> is the rain water specific content,</li><li><span>$\rho$</span>    is the air density,</li></ul><p>and the default free parameter values are:</p><table><tr><th style="text-align: right">symbol</th><th style="text-align: right">default value</th></tr><tr><td style="text-align: right"><span>$A$</span></td><td style="text-align: right"><span>$67$</span></td></tr><tr><td style="text-align: right"><span>$a$</span></td><td style="text-align: right"><span>$1.15$</span></td></tr><tr><td style="text-align: right"><span>$b$</span></td><td style="text-align: right"><span>$-1.3$</span></td></tr></table><h4 id="Beheng-(1994)-2"><a class="docs-heading-anchor" href="#Beheng-(1994)-2">Beheng (1994)</a><a class="docs-heading-anchor-permalink" href="#Beheng-(1994)-2" title="Permalink"></a></h4><p class="math-container">\[\begin{equation}
  \left. \frac{d \, q_{rai}}{dt} \right|_{accr} = A \; q_{lcl} \; q_{rai} \; \rho
\end{equation}\]</p><p>where:</p><ul><li><span>$q_{lcl}$</span> is the cloud liquid water specific content,</li><li><span>$q_{rai}$</span> is the rain specific content,</li><li><span>$\rho$</span>    is the air density,</li></ul><p>and the default free parameter values are:</p><table><tr><th style="text-align: right">symbol</th><th style="text-align: right">default value</th></tr><tr><td style="text-align: right"><span>$A$</span></td><td style="text-align: right"><span>$6$</span></td></tr></table><h4 id="Tripoli-and-Cotton-(1980)-2"><a class="docs-heading-anchor" href="#Tripoli-and-Cotton-(1980)-2">Tripoli and Cotton (1980)</a><a class="docs-heading-anchor-permalink" href="#Tripoli-and-Cotton-(1980)-2" title="Permalink"></a></h4><p class="math-container">\[\begin{equation}
  \left. \frac{d \, q_{rai}}{dt} \right|_{accr} = A \; q_{lcl} \; q_{rai}
\end{equation}\]</p><p>where:</p><ul><li><span>$q_{lcl}$</span> is cloud liquid water specific content</li><li><span>$q_{rai}$</span> is rain specific content</li></ul><p>and the default free parameter values are:</p><table><tr><th style="text-align: right">symbol</th><th style="text-align: right">default value</th></tr><tr><td style="text-align: right"><span>$A$</span></td><td style="text-align: right"><span>$4.7$</span></td></tr></table><h2 id="Number-concentration-adjustment-(Horn-2012)"><a class="docs-heading-anchor" href="#Number-concentration-adjustment-(Horn-2012)">Number concentration adjustment (Horn 2012)</a><a id="Number-concentration-adjustment-(Horn-2012)-1"></a><a class="docs-heading-anchor-permalink" href="#Number-concentration-adjustment-(Horn-2012)" title="Permalink"></a></h2><p>To ensure that the number concentration <span>$N$</span> remains physically consistent with the mass mixing ratio <span>$q$</span>, the <code>Microphysics2M.jl</code> module provides a pair of relaxation tendencies that bound the implied mean particle mass <span>$x = \rho q / N$</span> within user-defined limits <span>$[x_{min}, x_{max}]$</span>. This is useful in two-moment schemes to prevent unphysical droplet masses and improve numerical stability.</p><p>The tendencies are applied over a relaxation timescale <span>$\tau$</span>, following the method described in [<a href="../References/#Horn2012">22</a>]. The total tendency can be written as:</p><p class="math-container">\[\frac{\partial N}{\partial t} = \frac{1}{\tau}\left[max\left(0, \frac{\rho q}{x_{max}}-N\right) + min\left(0, \frac{\rho q}{x_{min}}-N\right)\right].\]</p><p>This correction increases <span>$N$</span> when droplets are too heavy (i.e., <span>$x &gt; x_{max}$</span>) and decreases <span>$N$</span> when they are too light (<span>$x &lt; x_{min}$</span>), while applying no correction when <span>$x$</span> lies within bounds.</p><p>This formulation is implemented as two separate functions:</p><ul><li><code>number_increase_for_mass_limit</code>: returns the rate needed to increase <code>N</code> when particles are too heavy (<code>x &gt; x_{max}</code>).</li><li><code>number_decrease_for_mass_limit</code>: returns the rate needed to decrease <code>N</code> when particles are too light (<code>x &lt; x_{min}</code>).</li></ul><p>No correction is applied when x lies within bounds. The default parameter value is</p><table><tr><th style="text-align: right">symbol</th><th style="text-align: right">default value</th></tr><tr><td style="text-align: right"><span>$\tau$</span></td><td style="text-align: right"><span>$100 \, s$</span></td></tr></table><p>The adjustment is assumed to exchange number concentration with a background reservoir of cloud condensation nuclei (CCN), so that any increase in droplet number is accompanied by a corresponding decrease in CCN number, and vice versa:</p><p class="math-container">\[\frac{\partial N_{CCN}}{\partial t} = -\frac{\partial N}{\partial t}\]</p><div class="admonition is-info" id="Note-9105b1db9df540b3"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-9105b1db9df540b3" title="Permalink"></a></header><div class="admonition-body"><p>In the reference paper, this approach is given for the number concentration of cloud droplets; however, the same formulation can also be used for raindrops.</p></div></div><h2 id="Example-figures"><a class="docs-heading-anchor" href="#Example-figures">Example figures</a><a id="Example-figures-1"></a><a class="docs-heading-anchor-permalink" href="#Example-figures" title="Permalink"></a></h2><pre><code class="language-julia hljs">include(&quot;plots/Microphysics2M_plots.jl&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">CairoMakie.Screen{SVG}
</code></pre><p><img src="../Autoconversion_accretion.svg" alt/></p><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>c.f. Eq. (79) in [<a href="../References/#SeifertBeheng2006">10</a>], but using the symbol <code>B</code> instead of <code>λ</code></li><li class="footnote" id="footnote-2"><a class="tag is-link" href="#citeref-2">2</a>c.f. Eq. (80) in [<a href="../References/#SeifertBeheng2006">10</a>]</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Microphysics1M/">« 1-moment precipitation microphysics</a><a class="docs-footer-nextpage" href="../P3Scheme/">P3 Scheme »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Friday 6 February 2026 08:31">Friday 6 February 2026</span>. Using Julia version 1.11.8.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
