using Plots

include("../../src/Nucleation.jl")
using .Nucleation

# Reproduces figures from Vehkamaki et al, 2002 doi:10.1029/2002JD002184
# In order verify that the implementation is correct
# Nucleation rate shown here is without any adjustment due to self-coagulation

function plot_vehk(
    rh,
    temp,
    so4,
    xticks,
    yticks,
    xlog = true,
    ylog = true,
    points = [],
)
    rates = map(
        x -> Nucleation.vehkamaki_nucleation_timestep(rh, temp, x * 1e6) / 1e6,
        so4,
    )
    title = "$temp K, RH=$(round(rh*100;digits=3))%"
    Plots.plot(
        title = title,
        so4,
        rates,
        xaxis = (xlog ? :log : ""),
        yaxis = (ylog ? :log : ""),
        lw = 3,
        yticks = yticks,
        xticks = xticks,
        ylabel = "Nucleation rate cm⁻³ s⁻¹",
        label = "Parameterization",
    )
    if !isempty(points)
        Plots.scatter!(points, label = "Vehkamaki Points")
    end
    Plots.svg("Vehk_$(temp)_K_$(round(rh*100;digits=3))_P")

end

# Plot Figure 8
rh = 0.55
temp = 236
points = [
    (1298835.744844125, 0.012609461745149965),
    (1517707.106355105, 0.02730160637148875),
    (1773461.247755558, 0.05808380288353431),
    (2072313.4154942925, 0.1257612065396323),
    (2421526.208972762, 0.27517769838153977),
    (2829586.073660263, 0.5916365039626502),
    (3306409.535682287, 1.285498506916657),
    (3863584.189721794, 2.7541547759655813),
    (4514650.296636012, 5.942306287181388),
    (5275429.834074182, 12.248903599245514),
    (6164410.996567544, 23.53640666058532),
    (6758603.604795893, 33.20369689458422),
    (7731936.671682362, 56.5990300645773),
    (8537045.159389375, 92.24660659297759),
    (9975652.546607932, 169.34361824471785),
    (11656684.704449095, 298.0490389914247),
    (13620993.48028524, 539.518465478903),
    (15916314.809403693, 942.9209396621906),
    (18598428.776778094, 1636.4182834510375),
    (21732515.164912526, 2830.012826849917),
    (25394737.429801922, 4911.424211151047),
    (29674093.59823078, 8583.737218609192),
    (34674579.06625929, 14740.783591716958),
    (40517713.85845967, 25944.150887001757),
    (47345495.76446015, 44397.514328754965),
    (55323851.11887285, 74027.50826663981),
    (64646667.08423688, 118671.93719694731),
    (75540503.42808671, 194700.77569525814),
    (88270098.29807869, 314983.26721944544),
    (103144801.79457615, 506897.1414486024),
    (120526093.68708414, 787594.328623085),
    (140836367.96742246, 1225879.5472261026),
    (164569197.7187241, 1921511.2985324645),
    (192301329.75347197, 2969875.4575187573),
    (224706700.51000667, 4655146.796248826),
    (262572813.8168654, 7232960.922122826),
    (306819878.5315516, 11277785.205414228),
    (358523171.1298721, 17601033.742370903),
    (418939166.6935356, 29919886.534360085),
    (488151913.0934289, 54052325.64490412),
    (566990274.4213885, 89999246.85658284),
    (669476504.4276373, 156222159.9347447),
    (773725467.3180381, 250475535.94522732),
    (911247757.6336973, 439469443.50121087),
    (1020068772.6004658, 946683147.0403998),
    (1044072351.0529115, 2319533439.91387),
    (1077537597.273697, 5444463068.280552),
]
so4 = 1e6:1e6:1e9
yticks =
    [1e-3, 1e-2, 1e-1, 1, 1e1, 1e2, 1e3, 1e4, 1e5, 1e6, 1e7, 1e8, 1e9, 1e10]
xticks = [1e6, 2e6, 5e6, 1e7, 2e7, 5e7, 1e8, 2e8, 5e8, 1e9, 2e9]
plot_vehk(rh, temp, so4, xticks, yticks, true, true, points)

# Figure 9
rh = 0.523
temp = 298
so4 = 8e9:1e7:3.7e10
points = [
    (7288909595.342726, 11.96646706047804)
    (7871992142.740219, 24.77166780156159)
    (8683237426.075861, 67.89317693440923)
    (9317022803.681831, 137.6534698288896)
    (9976159596.392038, 256.82372013330667)
    (10762053464.623442, 531.6483007516296)
    (12131029880.252338, 1554.9221283402333)
    (13221140729.734608, 3452.7754754990033)
    (13918304645.101173, 5125.135897357296)
    (14887996272.838308, 9562.101623622182)
    (16123877759.16995, 18694.545971621163)
    (17492854174.798843, 37413.926436242786)
    (18169736958.082016, 53135.56107292365)
    (19609697336.002785, 97771.97687928099)
    (20437843562.741257, 131254.68872915464)
    (21257539317.778305, 176759.6672822807)
    (22094136016.218185, 237367.03081233922)
    (22930732714.658066, 308094.6050546815)
    (23734734736.535355, 396189.22303149843)
    (24710402054.97563, 527358.3150989985)
    (25491225640.186188, 657363.2391770338)
    (26163038140.448517, 788501.889502651)
]
yticks = [1e-3, 1e-2, 1e-1, 1, 1e1, 1e2, 1e3, 1e4, 1e5, 1e6]
xticks = [1e10, 2e10, 3e10, 4e10]
plot_vehk(rh, temp, so4, xticks, yticks, false, true, points)

rh = 0.382
temp = 298
so4 = 8e9:1e7:3.7e10
points = [
    (7426971024.258759, 0.21195400608530945),
    (7910293126.684633, 0.4208941711399863),
    (8501726752.021561, 1.0235978021487016),
    (9177105795.148245, 2.4129229106943697),
    (9741829514.824795, 4.363628162274978),
    (10676676212.938004, 12.597576078381007),
    (11630601415.094337, 30.162841894449365),
    (12947018194.070078, 92.68216571989927),
    (14295232479.784363, 259.35408708387274),
    (15312752695.417788, 499.2085870660803),
    (16724561994.609161, 1176.7823596519613),
    (17525859164.420483, 1820.9112684266506),
    (18517941374.66307, 3077.8776727661807),
    (19357395552.560642, 4812.359902247927),
    (20311320754.71698, 7293.273713444696),
    (21265245956.873314, 11168.659129419555),
    (22638898247.97843, 20408.892380868605),
    (23573744946.09164, 29902.87808964924),
    (24394120619.946087, 41339.818397170675),
    (25335326819.407005, 55742.11389175719),
    (26149342991.913742, 72260.24028465174),
    (26988797169.811317, 93525.79581960016),
    (27828251347.708893, 120024.54279340037),
    (28667705525.606464, 150577.3813797534),
    (29507159703.50404, 190520.9696715219),
    (30346613881.401615, 238342.41866205257),
    (31186068059.299187, 293138.7118953767),
    (32025522237.196762, 361556.46295770287),
    (32864976415.094337, 434709.3627303672),
    (33704430592.991913, 530123.9973354866),
    (34543884770.88948, 642826.3817718341),
    (7018867924.5283, 0.10969291342637828),
]
yticks = [1e-3, 1e-2, 1e-1, 1, 1e1, 1e2, 1e3, 1e4, 1e5, 1e6]
xticks = [1e10, 2e10, 3e10, 4e10]
plot_vehk(rh, temp, so4, xticks, yticks, false, true, points)
